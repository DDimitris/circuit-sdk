(function (root, factory) {
  if (root === undefined && window !== undefined) root = window;
  if (typeof define === 'function' && define.amd) {
    // AMD. Register as an anonymous module unless amdModuleId is set
    define([], function () {
      return (root['Circuit'] = factory());
    });
  } else if (typeof module === 'object' && module.exports) {
    // Node. Does not work with strict CommonJS, but
    // only CommonJS-like environments that support module.exports,
    // like Node.
    module.exports = factory();
  } else {
    root['Circuit'] = factory();
  }
}(this, function () {

/**
 *  Copyright 2018 Unify Software and Solutions GmbH & Co.KG.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License.
 *
 *  @version: 1.2.3302
 */

var Circuit = {}; Object.defineProperty(Circuit, 'version', { value: '1.2.3302'});


var global=Function("return this")(),window=global.window||global,navigator=global.navigator||window.navigator||{},document=window.document,WebSocket=global.WebSocket,XMLHttpRequest=global.XMLHttpRequest,Promise=global.Promise,Circuit=function(ye){"use strict";var be=ye.Enums.ConnectionState,Pe=ye.Enums.ConversationType,Ue=ye.Constants,Le=ye.logger,Me=ye.PrivateData,we=ye.Enums.Targets,Ge=ye.Utils;!function(e,t){if(e.location.hash||e.location.search){var n=Object.assign({},Ge.parseQS(e.location.hash),Ge.parseQS(e.location.search));if(n.state)try{Object.assign(n,JSON.parse(n.state))}catch(e){Le.error("Could not decode state parameter")}if(n.display&&"popup"===n.display&&n.redirect_uri===e.location.origin+e.location.pathname&&e.document.addEventListener("DOMContentLoaded",function(){e.document.body.innerHTML="Redirecting, please wait..."}),n.callback){var i=n.callback;if(i in t)try{delete n.callback,t[i](n)}catch(e){}}n.display&&"popup"===n.display&&function(){if(window.frameElement&&window.parent)window.parent.document.body.removeChild(window.frameElement);else try{window.close()}catch(e){}}()}}(window,window.opener||window.parent);var t=Ge.getBrowserInfo();return ye.ExtensionConnHandlerSingleton.getInstance(),ye.Client=function(e){ye.BaseEventTarget.call(this,ye.logger);var l=this,t=ye.Enums.ConnectionState.Disconnected,c=Ge.shallowCopy(e)||{};c.domain=c.domain||"circuitsandbox.net",c.emoticonMode=c.emoticonMode||"standard",h(e);var s,d,n,i,r,o,a="node"===window.navigator.platform,u="dotnet"===window.navigator.platform,C="Win32"===window.navigator.platform,E="iOS"===window.navigator.platform||"Android"===window.navigator.platform,T=[],p=!1,S=null,I=new ye.ClientApiHandler(c),f=new ye.UserToUserHandler(I),v=ye.RtcSessionController;l._clientApiHandler=I,l._userToUserHandler=f,l._rtcSessionController=v;var R=new ye.SdkServices(I,f);function g(e,t,n,i){if(e===Ue.ReturnCode.NO_RESULT&&n)return!1;if(e){var r=I.getLastError();return i&&i(r),r&&delete r.errObj,t(r),!0}return!1}function A(e,t){return!!e&&(t(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,e)),!0)}function _(){return"https://"+l.domain+"/"}function m(e,t,n){var i,r={};return r.width=t,r.height=n,r.left=window.screenX+(window.outerWidth-t)/2,r.top=window.screenY+(window.outerHeight-n)/2,r.scrollbars="yes",i=Object.keys(r).map(function(e){return e+"="+r[e]}).join(", "),window.open(e,r.name,i)}function N(e){return 0<=c.scope.split(",").indexOf(e)||0<=c.scope.split(",").indexOf("ALL")}function h(e){e=e||{},c.client_id=e.client_id,c.client_secret=e.client_secret,c.redirect_uri=e.redirect_uri||window.location.origin+window.location.pathname,c.scope=(e.scope?e.scope.replace(/\s+/g,""):"")||"ALL",N(Ue.OAuthScope.READ_USER_PROFILE)||(c.scope=Ue.OAuthScope.READ_USER_PROFILE+","+e.scope),N(Ue.OAuthScope.ALL)&&(c.scope=Ue.OAuthScope.ALL)}function O(o){return new Promise(function(t,n){var e,i=a?new XMLHttpRequest(c):new XMLHttpRequest;if(i.open(o.type||o.dataType||"GET",o.url,!0),i.withCredentials=o.xhrFields&&o.xhrFields.withCredentials,!s||o.headers&&o.headers.Authorization||i.setRequestHeader("Authorization","Bearer "+s),o.headers)for(var r in o.headers)o.headers.hasOwnProperty(r)&&i.setRequestHeader(r,o.headers[r]);i.onload=function(){if(200===i.status)o.success&&o.success(i.responseText),t(i.responseText);else{var e=new Circuit.Error(i.status,i.responseText||i.statusText);o.error&&o.error(e),n(e)}},i.onerror=function(){var e=new Circuit.Error(Ue.ErrorCode.AUTHORIZATION_FAILED,"Network error or incorrect credentials");o.error&&o.error(e),n(e)},o.data&&(e=Ge.toQS(o.data),i.setRequestHeader("Content-type","application/x-www-form-urlencoded")),i.send(e)})}function D(n){return new Promise(function(e,t){O({type:"POST",url:"https://"+l.domain+"/sdklogin",data:{token:n.token||void 0,accessToken:n.accessToken||void 0},xhrFields:{withCredentials:!0},crossDomain:!0}).then(function(){n.accessToken&&(s=n.accessToken),e()}).catch(t)})}function y(){return O({url:"https://"+l.domain+"/validateSession",xhrFields:{withCredentials:!0},crossDomain:!0}).then(function(){})}function b(){return new Promise(function(e,t){S&&(window.clearInterval(S),S=null,I.disconnect()),I.setToken(s),I.setClientInfo({deviceType:Ue.DeviceType.SDK,deviceSubtype:function(){switch(window.navigator.platform){case"node":return"NODE_SDK";case"dotnet":return"DOT_NET_SDK";case"Win32":return"WIN_JS_SDK";case"iOS":return"IOS_SDK";case"Android":return"ANDROID_SDK";default:return"JS_SDK"}}(),clientVersion:ye.version}),I.connect(function(){Le.info("[SDK]: Successfully connected to access server."),S=window.setInterval(De,50),e()},function(e){Le.error("[SDK]: Failed to connect: ",e),I.disconnect(),t(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,e))},l.domain)})}function P(){return new Promise(function(e,t){if(c.client_id)if(window.localStorage){var n=window.localStorage.getItem("oauth");try{n=JSON.parse(n)}catch(e){return window.localStorage.removeItem("oauth"),void t(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"Error parsing OAuth app in localStorage"))}n&&"object"==typeof n||(n={}),n[c.client_id]={access_token:s,domain:l.domain,expires_at:d},window.localStorage.setItem("oauth",JSON.stringify(n)),Le.debug("[SDK]: Stored access_token for client_id: "+c.client_id),e()}else e();else t(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"client_id missing in client object"))})}function U(){return new Promise(function(e,t){var n=window.localStorage.getItem("oauth");if(n){try{n=JSON.parse(n)}catch(e){return void t(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"Error parsing OAuth app in localStorage"))}if("object"==typeof n){var i=n[c.client_id];i&&i.access_token?(s=i.access_token,d=i.expires_at,Le.debug("[SDK]: Retrieved access_token for client_id: "+c.client_id),e(s)):t(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"client_id not found in localStorage"))}else t(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"invalid data in localStorage"))}else t(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"OAuth access token not found in localStorage"))})}function L(e){var t="_circuit_"+parseInt(1e12*Math.random(),10).toString(36);return window[t]=function(){try{e.apply(this,arguments)&&delete window[t]}catch(e){Le.error(e)}},t}function M(){return new Promise(function(n,i){var r=null;if(!c.client_id)return l.oauthwin&&(l.oauthwin.close(),l.oauthwin=null),void i(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"client_id missing in client object"));s=void 0;var e=L(function(e){if(r&&window.clearInterval(r),!e||e.error){s=void 0;var t=e?e.error:"The authentication was not completed";i(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,t))}else s=e.access_token,d=e.expires_in&&Date.now()+1e3*e.expires_in,P().catch(function(e){Le.error("[SDK]: Failed to store the OAuth access token.",e)}).then(function(){n({username:e.username,accessToken:e.access_token})})}),t={client_id:c.client_id,redirect_uri:c.redirect_uri,response_type:"token",scope:c.scope||""};t.state=JSON.stringify({callback:e,display:"popup",redirect_uri:t.redirect_uri});var o="https://"+c.domain+"/oauth/authorize?"+Ge.toQS(t),a=l.oauthwin||m(o,450,500);a?(l.oauthwin=null,a.location.href=o,r=window.setInterval(function(){a&&!a.closed||(r&&window.clearInterval(r),i(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"OAuth popup cancelled")))},500)):i(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,"OAuth popup blocked"))})}function w(){return new Promise(function(n,i){var r=null,e=L(function(e){if(r&&window.clearInterval(r),!e||e.error){var t=e?e.error:"The authentication was not completed";i(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,t))}else n({username:e.username})}),t=JSON.stringify({callback:e,display:"popup",redirect_uri:c.redirect_uri}),o={return_to:c.redirect_uri+"#state="+t},a="https://"+c.domain+"/oauth/login?"+Ge.toQS(o),s=l.oauthwin||m(a,450,500);l.oauthwin=null,s.location.href=a,r=window.setInterval(function(){s&&!s.closed||(r&&window.clearInterval(r),i(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"OAuth popup cancelled")))},500)})}function G(e){return e=e||s,O({type:"GET",url:"https://"+l.domain+"/oauth/token/"+e,crossDomain:!0}).then(function(e){try{return JSON.parse(e)}catch(e){return Promise.reject(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"Invalid token returned"))}})}function H(){if(c.autoRenewToken&&d){n&&window.clearTimeout(n);var e=d-Date.now()-6e4;0<e&&(n=window.setTimeout(k,e))}}function k(){return new Promise(function(i,r){var e={type:"POST",url:"https://"+l.domain+"/oauth/token",data:{scope:c.scope,grant_type:"implicit"}};c.client_secret&&(e.headers={Authorization:"Basic "+window.btoa(c.client_id+":"+c.client_secret)},e.data.grant_type="client_credentials"),O(e).then(function(e){var t=JSON.parse(e);if(t&&t.access_token&&"Bearer"===t.token_type)s=t.access_token,I.setToken(s),d=t.expires_in&&Date.now()+1e3*t.expires_in,H(),Oe({type:"accessTokenRenewed"}),i(s);else{d=s=null;var n=new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"Error renewing OAuth2 access token");Oe({type:"renewAccessTokenFailed",error:n}),r(n)}}).catch(r)})}function V(){return new Promise(function(n,i){var e=[Ue.GetStuffType.USER,Ue.GetStuffType.SUPPORT_CONVERSATION_ID,Ue.GetStuffType.TELEPHONY_CONVERSATION_ID,Ue.GetStuffType.ACCOUNTS,Ue.GetStuffType.PRESENCE_STATE];I.getStuff(e,function(e,t){g(e,i,!0)||(r=t.telephonyConvId,o=t.supportConvId,ge(t.user).then(function(e){l.loggedOnUser=e,R.SdkHelperSvc.setLocalUser(e),n()}).catch(i))})})}function F(){return N(Ue.OAuthScope.CALLS)?R.CallControlSvc.initActiveSessionsForSdk():Promise.resolve()}function B(){return N(Ue.OAuthScope.CALLS)&&c.enableTelephony&&R.AtcRegistrationSvc.initAtcForSdk(),Promise.resolve()}function x(){return new Promise(function(n,i){I.getUserData(function(e,t){g(e,i)||(v.processClientSettings(t.clientSettings),n(t))})}).then(V).then(F).then(B)}function W(){return b().then(x).then(function(){return l.loggedOnUser})}function Y(){return new Promise(function(n,i){O({type:"POST",url:"https://"+l.domain+"/oauth/token",headers:{Authorization:"Basic "+window.btoa(c.client_id+":"+c.client_secret)},data:{grant_type:"client_credentials",scope:c.scope}}).then(function(e){var t=JSON.parse(e);t&&t.access_token&&"Bearer"===t.token_type?(s=t.access_token,d=t.expires_in&&Date.now()+1e3*t.expires_in,H(),n({accessToken:s})):(d=s=null,i(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"Internal error with Client Credentials Grant authentication")))}).catch(i)})}function K(o){return new Promise(function(i,r){o&&o.filterConnector?(o.retrieveAction=o.retrieveAction||Circuit.Enums.RetrieveAction.CONVERSATIONS,o.retrieveAction!==Circuit.Enums.RetrieveAction.CONVERSATIONS&&o.retrieveAction!==Circuit.Enums.RetrieveAction.CONVERSATION_IDS&&r(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"Invalid retrieveAction")),I.getConversationsByFilter(o,function(e,t){if(!g(e,r,!0))if(o.retrieveAction===Circuit.Enums.RetrieveAction.CONVERSATIONS){var n=t.conversations||[];Promise.all(n.map(Ne)).then(i).catch(r)}else o.retrieveAction===Circuit.Enums.RetrieveAction.CONVERSATION_IDS&&i(t.conversationIds||[])})):r(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"options.filterConnector"))})}function q(e){return new Promise(function(n,i){I.getConversationById(e,function(e,t){g(e,i)||Ne(t).then(n).catch(i)})})}function j(e){return new Promise(function(n,i){I.getUserByEmail(e,function(e,t){g(e,i,null,function(e){e&&e.code===Ue.ReturnCode.NO_RESULT&&(e.info="User does not exist")})||ge(t).then(n).catch(i)})})}function Q(){return new Promise(function(n,i){I.getDevices(function(e,t){g(e,i,!0)||n(t||[])})})}function X(r){return"string"==typeof r&&(r={userId:r,createIfNotExists:!1}),new Promise(function(n,i){r.userId?I.getConversationByUser(r.userId,function(e,t){e?e===Ue.ReturnCode.NO_RESULT?r.createIfNotExists?J(r.userId).then(function(e){n(e&&e.conversation)}):n():g(e,i):Ne(t).then(n).catch(i)}):i(new Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"user ID is required"))})}function z(e,t){return"string"!=typeof e?Promise.reject(new Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"email or user ID is required")):e.match(Ge.EMAIL_ADDRESS_PATTERN)?j(e).then(function(e){return{userId:e.userId,createIfNotExists:t}}).then(X):X({userId:e,createIfNotExists:t})}function J(t){return new Promise(function(i,r){if(l.loggedOnUser.userId===t)return r(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"userId is of logged on user"));var e={type:Ue.ConversationType.DIRECT,participants:[{userId:t},{userId:l.loggedOnUser.userId}]};I.createConversation(e,function(e,t,n){g(e,r)||Ne(t).then(function(e){i({conversation:e,alreadyExists:n})})})})}function $(e,i){return new Promise(function(t,n){e?I.updateGuestAccess(e,i,function(e){g(e,n)||t()}):n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId is required"))})}function Z(e){var t={};return e&&e.forEach(function(e){switch(e.key){case Ue.UserSettingKey.OPT_OUT_PRESENCE:t.presenceOptOut=e.booleanValue;break;case Ue.UserSettingKey.SHARE_LOCATION:t.shareLocation=e.booleanValue;break;case Ue.UserSettingKey.VOICEMAIL_ENABLED:t.voicemailEnabled=e.booleanValue;break;case Ue.UserSettingKey.VOICEMAIL_TIMEOUT:t.voicemailTimeout=e.numberValue;break;case Ue.UserSettingKey.VOICEMAIL_CUSTOMGREETING_ENABLED:t.voicemailCustomGreetingEnabled=e.booleanValue;break;case Ue.UserSettingKey.VOICEMAIL_CUSTOMGREETING_URI:t.voicemailCustomGreetingUri=e.stringValue?_()+"fileapi?fileid="+e.stringValue:null}}),t}function ee(e){return new Promise(function(t,n){e.userId=l.loggedOnUser.userId,I.setPresence(e,function(e){g(e,n)||t()})})}function te(e,t){return new Promise(function(n,i){I.getPresence(e,t,function(e,t){g(e,i)||n(t)})})}function ne(){return new Promise(function(t,n){I.renewToken(l.loggedOnUser.userId,function(e){g(e,n)?Oe({type:"renewSessionTokenFailed",error:e}):(Le.debug("[SDK]: Session token renewed"),Oe({type:"sessionTokenRenewed"}),t())})})}function ie(t){return Q().then(function(e){return e.some(function(e){return t?e.clientId===t:e.clientId!==l.loggedOnUser.clientId&&(e.clientInfo.deviceType===Ue.DeviceType.WEB||e.clientInfo.deviceType===Ue.DeviceType.APPLICATION&&"DESKTOP_APP"===e.clientInfo.deviceSubtype)})})}function re(t){return Q().then(function(e){return e.some(function(e){return e.clientId===t})})}function oe(e){var t=R.CallControlSvc.findCall(e);return t||((t=R.CallControlSvc.getActiveCall(e))||null)}function ae(e){return e.pin=e.tenantPIN+e.sessionPIN,e.link&&(e.link="https://"+l.domain+e.link),delete e.tenantPIN,delete e.sessionPIN,delete e.conversationId,e}function se(e){return new Promise(function(t,n){e?R.CallControlSvc.endCall(e,function(e){A(e,n)||t()}):n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})}function ce(i,r){return new Promise(function(t,e){var n={audio:!1,video:Circuit.WebRTCAdapter.getVideoOptions({sourceId:i,hdVideo:{VGA:"",HD:"720p",FHD:"1080p"}[r]})};Circuit.WebRTCAdapter.getUserMedia(n,function(e){Circuit.WebRTCAdapter.stopMediaStream(e),t(r)},e)})}function le(n,i){return function(e){var t=e&&e.name;return"ConstraintNotSatisfiedError"===t||"OverconstrainedError"===t?ce(n,i):Promise.reject(e)}}function de(i,r){return new Promise(function(t,n){if(i){var e=oe(i);if(e)if(e.hasLocalScreenShare())R.CallControlSvc.removeMediaStream(i,function(e){A(e,n)||t()});else{if(!r)return void n(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"Missing MediaStream"));R.CallControlSvc.addMediaStream(i,r,function(e){A(e,n)||t()})}else n(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"No call found"))}else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})}function ue(r){return new Promise(function(e,t){if(void 0!==r){var n=R.CallControlSvc.getActiveCall();if(n){var i=n.sessionCtrl.getLocalStream(r);i?e(i):t("No stream found with id "+r)}else t(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"No call found"))}else t(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"id is required"))})}var Ce="/content/images/icon-general-default-avatar",Ee="/content/images/icon-general-openconvo-avatar",Te="/content/images/icon-general-large-conference",pe="/content/images/icon-general-emptyconvo-avatar",Se=["-blue","-green","-orange","-yellow"];function Ie(e){var t=0;if(e)for(var n=0;n<e.length;n++)t+=e.charCodeAt(n);return Se[t%Se.length]}function fe(e,t){if("function"==typeof e)try{var n=e(t);if(n&&"object"==typeof n)return"function"==typeof n.then?n:Promise.resolve(n)}catch(e){Le.error("[SDK]: Error applying injector. ",e)}return Promise.resolve(t)}var ve=["activeMediaType","callId","convId","convType","direction","isMeetingPointInvited","isRemote","isTelephonyCall","isTestCall","locallyMuted","localMediaType","localVideoStream","localVideoUrl","mediaType","participants","remoteAudioDisabled","remoteAudioStream","remoteAudioUrl","remotelyMuted","remoteVideoDisabled","remoteVideoStreams","recording","ringAllAllowed","ringAllMaxNumber","whiteboardEnabled"];function Re(t){if(!t)return Promise.resolve();var n={};return ve.forEach(function(e){n[e]=Ge.shallowCopy(t[e])}),n.state=t.state.name,n.isEstablished=t.state.established,fe(Circuit.Injectors.callInjector,n)}function ge(e){if(!e)return Promise.resolve();if(e.smallImageUri&&e.largeImageUri)e.avatar=_()+"fileapi/"+e.userId+"_s.jpg?fileid="+e.smallImageUri,e.avatarLarge=_()+"fileapi/"+e.userId+"_b.jpg?fileid="+e.largeImageUri,e.hasAvatar=!0;else{var t=Ie(e.userId);e.avatar="https://"+l.domain+Ce+t+".png",e.avatarLarge="https://"+l.domain+Ce+t+"-XL.png"}return delete e.smallImageUri,delete e.largeImageUri,delete e.tenantId,delete e.roles,delete e.accountTemplateType,delete e.associatedGTCUserId,delete e.reroutingPhoneNumber,delete e.assignedPhoneNumbers,e.accounts&&e.accounts.length&&(e.tenantId=e.accounts[0].tenantId),e.hasPermission=function(t){if(!this.accounts||!t)return!1;var e=this.accounts[0],n=e&&e.permissions;return!!n&&n.some(function(e){return e.systemPermission===t})},fe(Circuit.Injectors.userInjector,e)}function Ae(e){if(!e)return Promise.resolve();switch(e.type){case Ue.ConversationItemType.TEXT:e.text.state===Ue.TextItemState.DELETED?e.text.content="":(e.attachments=e.attachments||[],e.externalAttachments=e.externalAttachments||[],"standard"===c.emoticonMode&&(e.text.content=Ge.standardizeEmoticon(e.text.content)),Me.retrievePrivateDataFromContent(e),c.removeMentionHtml&&(e.text.content=Ge.removeMentionHtml(e.text.content)));break;case Ue.ConversationItemType.SYSTEM:e.system.affectedParticipants&&(e.system.affectedParticipants=e.system.affectedParticipants.map(function(e){return e.userId}))}return e.attachments&&e.attachments.forEach(function(e){e.url=_()+"fileapi/"+encodeURIComponent(e.fileName)+"?fileid="+e.fileId+"&itemid="+e.itemId}),fe(Circuit.Injectors.itemInjector,e)}function _e(n){return new Promise(function(t){n&&n.topLevelItem?(Le.debug("[SDK]: Publicize the topLevelItem. convId = ",n.convId),Ae(n.topLevelItem).then(function(){Le.debug("[SDK]: Publicized topLevelItem. convId = ",n.convId),t(n)}).catch(function(e){Le.error("[SDK]: Failed to publicize topLevelItem. ",e),t(n)})):t(n)})}function me(n){return new Promise(function(t){if(n&&n.parentItem){Le.debug("[SDK]: Publicize the thread. itemId = ",n.parentItem.intemId),n.comments=n.comments||[];var e=n.comments.slice(0);e.unshift(n.parentItem),Promise.all(e.map(Ae)).then(function(){t(n)}).catch(function(e){Le.error("[SDK]: Failed to publicize thread. ",e),t(n)})}else t(n)})}function Ne(e){if(!e)return Promise.resolve();if(Le.debug("[SDK]: Publicize conversation. convId = ",e.convId),e.participants=e.participants.map(function(e){return e.userId}),e.moderators=e.moderators&&e.moderators.map(function(e){return e.userId}),e.isTelephonyConversation=e.convId===r,e.isSupportConversation=e.convId===o,e.type!==Ue.ConversationType.DIRECT){if(e.conversationAvatar&&e.conversationAvatar.smallPictureId&&e.conversationAvatar.largePictureId)e.avatar=_()+"avatar?convId="+e.convId+"&type=small&fileid="+e.conversationAvatar.smallPictureId,e.avatarLarge=_()+"avatar?convId="+e.convId+"&type=large&fileid="+e.conversationAvatar.largePictureId,e.hasConversationAvatar=!0;else if(e.type===Ue.ConversationType.OPEN){var t=e.isDraft?"-grey":Ie(e.convId);e.avatar="https://"+l.domain+Ee+t+".png",e.avatarLarge="https://"+l.domain+Ee+t+"-XL.png"}else e.type===Ue.ConversationType.LARGE?(e.avatar="https://"+l.domain+Te+".png",e.avatarLarge="https://"+l.domain+Te+"-XL.png"):(e.avatar="https://"+l.domain+pe+".png",e.avatarLarge="https://"+l.domain+pe+"-XL.png");e.type===Ue.ConversationType.OPEN&&(e.type=Pe.COMMUNITY)}return fe(Circuit.Injectors.conversationInjector,e).then(_e)}function he(e){if(!e)return Promise.resolve();if(e.smallImageUri&&e.largeImageUri)e.avatar=_()+"fileapi/"+e.userId+"_s.jpg?fileid="+e.smallImageUri,e.avatarLarge=_()+"fileapi/"+e.userId+"_b.jpg?fileid="+e.largeImageUri,e.hasAvatar=!0;else{var t=Ie(e.userId);e.avatar="https://"+l.domain+Ce+t+".png",e.avatarLarge="https://"+l.domain+Ce+t+"-XL.png"}return delete e.smallImageUri,delete e.largeImageUri,fe(Circuit.Injectors.participantInjector,e)}function Oe(e){Le.debug("[SDK]: Enqueue "+e.type),T.push(e)}function De(){if(!p&&T.length){p=!0;try{var t=T.shift();if(Le.debug("[SDK]: Dequeue "+t.type+". Events left in the queue: "+T.length),!l.hasEventListener(t.type))return void Le.debug("[SDK]: There is no listener for this event");var e=[];e.push(t.user?ge(t.user):void 0),e.push(t.item?Ae(t.item):void 0),e.push(t.conversation?Ne(t.conversation):void 0),e.push(t.call?Re(t.call):void 0),Promise.all(e).then(function(e){e[0]&&(t.user=e[0]),e[1]&&(t.item=e[1]),e[2]&&(t.conversation=e[2]),e[3]&&(t.call=e[3]),Le.debug("[SDK]: Dispatch ",t.type),l.dispatch(t)})}catch(e){Le.error("[SDK]: Error processing event queue. ",e)}finally{p=!1}}}return Object.defineProperty(l,"domain",{get:function(){return c.domain},set:function(e){c.domain=e},enumerable:!0,configurable:!1}),Object.defineProperty(l,"accessToken",{get:function(){return s},set:function(e){s=e},enumerable:!0,configurable:!0}),Object.defineProperty(l,"expiresAt",{get:function(){return d},enumerable:!0,configurable:!0}),Object.defineProperty(l,"connectionState",{get:function(){return t},enumerable:!0,configurable:!0}),Object.defineProperty(l,"getAudioVideoStats",{get:function(){var e=R.CallControlSvc.getActiveCall();if(!e)return function(){return Promise.reject(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"No call found"))};var t=e.sessionCtrl.getCurrentPeerConnection();return t&&t.getStats?t.origGetStats?t.origGetStats.bind(t):t.getStats.bind(t):function(){return Promise.reject(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"No PeerConnection present"))}},enumerable:!1,configurable:!1}),l.setOauthConfig=h,l.logon=function(e){var t,n,r,o;if(e){if("object"!=typeof e)return t="OAuth2 is the only supported authentication menthod. Basic Auth is not supported anymore.",Le.error(t),Promise.reject(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,"Credentials mismatch. Details: "+t));if(c.client_id&&c.client_secret)return t="Circuit.Client is created with client_id and client_secret (Client Credentials Grant), so no token should be passed to the logon API.",Le.error(t),Promise.reject(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,"Credentials mismatch. Details: "+t));if(c.client_id&&e.token)return t="Circuit.Client is created with client_id, so no API token should be passed to the logon API.",Le.error(t),Promise.reject(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,"Credentials mismatch. Details: "+t));if(!c.client_id&&!e.token)return t="Circuit.Client was not created with client_id, so API token should be passed to the logon API.",Le.error(t),Promise.reject(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,"Credentials mismatch. Details: "+t))}else if(!c.client_id)return t="Login with a session cookie has been disabled. OAuth2 or API token are the only supported authentication method.",Le.error(t),Promise.reject(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,"Credentials mismatch. Details: "+t));return c.client_id&&c.client_secret?Y().then(D).then(W):c.client_id&&e&&e.username&&e.password?(r=e.username,o=e.password,new Promise(function(n,i){O({type:"POST",url:"https://"+l.domain+"/oauth/token",headers:{Authorization:"Basic "+window.btoa(c.client_id)},data:{username:r,password:o,grant_type:"password",scope:c.scope}}).then(function(e){var t=JSON.parse(e);t&&t.access_token&&"Bearer"===t.token_type?(s=t.access_token,d=t.expires_in&&Date.now()+1e3*t.expires_in,H(),n({accessToken:s})):(d=s=null,i(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"Internal error with Client Credentials Grant authentication")))}).catch(i)})).then(D).then(W):c.client_id&&e&&e.accessToken?a||u||C||E||e.skipTokenValidation?D(e).then(W):(e.prompt&&(n="https://"+c.domain+"/dist/oauthLoading.html",l.oauthwin=m(n,450,500)),s=e.accessToken,G().then(function(){return e.prompt?y().then(function(){l.oauthwin.close(),l.oauthwin=null}).catch(w).then(W):W()}).catch(function(e){return l.oauthwin&&l.oauthwin.close(),l.oauthwin=null,Promise.reject(e)})):c.client_id?l.logonChecked?W():e&&e.logonChecked?U().then(G).then(y).then(W):(n="https://"+c.domain+"/dist/oauthLoading.html",l.oauthwin=m(n,450,500),U().then(G).then(y).then(function(){l.oauthwin.close(),l.oauthwin=null}).catch(M).then(W)):e&&e.token?D(e).then(W):Promise.reject(new Circuit.Error(Ue.ErrorCode.MISSING_REQUIRED_PARAMETER,"Missing credentials"))},l.logonCheck=function(){return U().then(G).then(y).then(function(){l.logonChecked=!0,i&&window.clearTimeout(i),i=window.setTimeout(function(){i=null,l.logonChecked=!1},5e3)})},l.changePassword=function(){return new Promise(function(n,i){var r=null,e=L(function(e){if(r&&window.clearInterval(r),!e||e.error){var t=e?e.error:"The password change failed";i(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,t))}else n()}),t={client_id:c.client_id,redirect_uri:c.redirect_uri,response_type:"token",scope:c.scope||""};t.state=JSON.stringify({callback:e,display:"popup",redirect_uri:t.redirect_uri});var o="https://"+c.domain+"/oauth/changePassword?"+Ge.toQS(t),a=l.oauthwin||m(o,450,500);l.oauthwin=null,a.location.href=o,r=window.setInterval(function(){a&&!a.closed||(r&&window.clearInterval(r),i(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"OAuth popup cancelled")))},500)})},l.logout=function(e){return e?new Promise(function(e){var t=function(){d=s=null,I.disconnect(),window.clearInterval(S),l.dispatch({type:"connectionStateChanged",state:be.Disconnected}),e()},n=window.setTimeout(function(){n=null,t()},2e3);I.logout(function(){n&&(window.clearTimeout(n),t())})}):(d=s=null,I.disconnect(),Promise.resolve())},l.revokeToken=function(e){return new Promise(function(t,n){e=e||s,d=s=null,P(),I.revokeAccessToken(e,function(e){e!==Ue.ReturnCode.DISCONNECTED&&g(e,n)||t()})})},l.setCookie=function(e){c.cookie=e},l.getCookie=function(){return c.cookie},l.isAuthenticated=y,l.validateToken=G,l.getLoggedOnUser=function(){return new Promise(function(n,i){I.getLoggedOnUser(function(e,t){g(e,i)||ge(t.user).then(function(e){l.loggedOnUser=e,R.SdkHelperSvc.setLocalUser(e),n(e)})})})},l.getTelephonyConversationId=function(){return new Promise(function(n,i){I.getTelephonyConversationId(function(e,t){g(e,i)||n(t)})})},l.getSupportConversationId=function(){return new Promise(function(n,i){I.getSupportConversationId(function(e,t){g(e,i)||n(t)})})},l.getTenantUsers=function(e){return new Promise(function(n,i){(e=e||{}).pageSize=e.pageSize||25,e.sorting=e.sorting||Ue.GetAccountsSorting.BY_FIRST_NAME,I.getAccounts(e,function(e,t){g(e,i)||Promise.all(t.accounts.map(function(e){return ge(e.user)})).then(n).catch(i)})})},l.getAccounts=function(e){return new Promise(function(i,n){(e=e||{}).pageSize=e.pageSize||25,e.sorting=e.sorting||Ue.GetAccountsSorting.BY_FIRST_NAME,I.getAccounts(e,function(e,t){g(e,n)||Promise.all(t.accounts.map(function(e){return ge(e.user)})).then(function(n){var e=t.accounts.map(function(e,t){return{account:e.account,user:n[t]}});i({accounts:e,searchPointer:t.searchPointer,hasMore:t.hasMoreResults})}).catch(n)})})},l.subscribePresence=function(e){return new Promise(function(t,n){I.subscribePresence(e,function(e){g(e,n)||t()})})},l.unsubscribePresence=function(e){return new Promise(function(t,n){I.unsubscribePresence(e,function(e){g(e,n)||t()})})},l.subscribeTenantPresence=function(){return new Promise(function(t,n){c.client_secret?n(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"API only allowed for bots")):I.subscribeTenantPresence(l.loggedOnUser.tenantId,function(e){g(e,n)||t()})})},l.unsubscribeTenantPresence=function(){return new Promise(function(t,n){c.client_secret?n(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"API only allowed for bots")):I.unsubscribeTenantPresence(l.loggedOnUser.tenantId,function(e){g(e,n)||t()})})},l.renewSessionToken=ne,l.renewToken=k,l.getUserById=function(e){return new Promise(function(n,i){e?I.getUser(e,function(e,t){g(e,i)||ge(t).then(n).catch(i)}):i(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"userId is required"))})},l.getUsersById=function(e,t){return new Promise(function(n,i){if(e){if(!e.length)return n([]);(t?I.getPartialUsersByIds:I.getUsersByIds)(e,function(e,t){g(e,i)||Promise.all(t.map(ge)).then(n).catch(i)})}else i(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"userIds is required"))})},l.getUserByEmail=j,l.getUsersByEmail=function(t){return new Promise(function(n,i){if(t){if(!t.length)return n([]);var e={emailAddresses:t};I.getUsersByEmails(e,function(e,t){g(e,i)||Promise.all(t.map(ge)).then(n).catch(i)})}else i(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"email is required"))})},l.updateUser=function(e){return new Promise(function(t,n){I.updateUser(e,function(e){g(e,n)||t()})})},l.getPresence=te,l.setPresence=ee,l.setStatusMessage=function(i){return new Promise(function(t,n){i=i||"",I.setUserSettings({key:Ue.UserSettingKey.STATUS_MESSAGE_TEXT,dataType:Ue.UserSettingDataType.STRING,stringValue:i},function(e){g(e,n)||te([l.loggedOnUser.userId]).then(function(e){return ee({state:e.length&&e[0].state,statusMessage:i})}).then(t).catch(n)})})},l.getStatusMessage=function(){return new Promise(function(i,r){I.getUserSettings([Ue.UserSettingArea.ALL],function(e,t){if(!g(e,r)){var n="";t&&t.some(function(e){if(e.key===Ue.UserSettingKey.STATUS_MESSAGE_TEXT)return n=e.stringValue,!0}),i(n)}})})},l.setUserSettings=function(i){return new Promise(function(t,n){if(i){var e=[];void 0!==i.presenceOptOut&&e.push({key:Ue.UserSettingKey.OPT_OUT_PRESENCE,dataType:Ue.UserSettingDataType.BOOLEAN,booleanValue:!!i.presenceOptOut}),void 0!==i.shareLocation&&e.push({key:Ue.UserSettingKey.SHARE_LOCATION,dataType:Ue.UserSettingDataType.BOOLEAN,booleanValue:!!i.shareLocation}),void 0!==i.voicemailEnabled&&e.push({key:Ue.UserSettingKey.VOICEMAIL_ENABLED,dataType:Ue.UserSettingDataType.BOOLEAN,booleanValue:!!i.voicemailEnabled}),void 0!==i.voicemailTimeout&&e.push({key:Ue.UserSettingKey.VOICEMAIL_TIMEOUT,dataType:Ue.UserSettingDataType.NUMBER,numberValue:i.voicemailTimeout}),void 0!==i.voicemailCustomGreetingEnabled&&e.push({key:Ue.UserSettingKey.VOICEMAIL_CUSTOMGREETING_ENABLED,dataType:Ue.UserSettingDataType.BOOLEAN,booleanValue:!!i.voicemailCustomGreetingEnabled}),I.setUserSettings(e,function(e){g(e,n)||t()})}else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"userSettings is required"))})},l.getUserSettings=function(){return new Promise(function(n,i){I.getUserSettings([Ue.UserSettingArea.ALL],function(e,t){g(e,i)||n(Z(t))})})},l.uploadCustomVoicemailGreeting=function(e){return new Promise(function(n,i){e?new ye.FileUpload(c).uploadFiles([e],l.domain).then(function(e){if(e&&e.length){var t=[{key:Ue.UserSettingKey.VOICEMAIL_CUSTOMGREETING_URI,dataType:Ue.UserSettingDataType.STRING,stringValue:e[0].fileId}];I.setUserSettings(t,function(e){g(e,i)||n()})}else i(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"error uploading file"))}).catch(function(e){Le.error("[SDK]: Fileupload error.",e),i(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,e))}):i(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"file is required"))})},l.getDevices=Q,l.getConversations=function(e){return new Promise(function(n,i){(e=e||{}).numberOfConversations=e.numberOfConversations||25,e.direction=e.direction||Ue.SearchDirection.BEFORE,I.getConversations(l.loggedOnUser.userId,e.timestamp,e.direction,e.numberOfConversations,Ue.ConversationFilter.ALL,function(e,t){g(e,i)||Promise.all(t.map(Ne)).then(n).catch(i)})})},l.getMarkedConversations=function(){return new Promise(function(n,i){I.getMarkedConversationsList(function(e,t){g(e,i,!0)||n(t||[])})})},l.getFavoriteConversationIds=function(){return new Promise(function(n,i){I.getFavoriteConversationIds(function(e,t){g(e,i,!0)||n(t||[])})})},l.favoriteConversation=function(e){return new Promise(function(t,n){e?I.markConversation({convId:e,markType:Ue.ConversationMarkFilter.FAVORITE},function(e){g(e,n)||t()}):n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId is required"))})},l.unfavoriteConversation=function(e){return new Promise(function(t,n){e?I.unmarkConversation({convId:e,markType:Ue.ConversationMarkFilter.FAVORITE},function(e){g(e,n)||t()}):n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId is required"))})},l.archiveConversation=function(e){return new Promise(function(t,n){e?I.markConversation({convId:e,markType:Ue.ConversationMarkFilter.MUTE},function(e){g(e,n)||t()}):n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId is required"))})},l.unarchiveConversation=function(e){return new Promise(function(t,n){e?I.unmarkConversation({convId:e,markType:Ue.ConversationMarkFilter.MUTE},function(e){g(e,n)||t()}):n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId is required"))})},l.getAllLabels=function(){return new Promise(function(n,i){I.getAllLabels(function(e,t){g(e,i,!0)||n(t||[])})})},l.getConversationsByFilter=K,l.getConversationsByLabel=function(e,t){return e?((t=t||{}).filterConnector={conditions:[{filterTarget:Ue.FilterTarget.LABEL_ID,expectedValue:[e]}]},t.retrieveAction=Circuit.Enums.RetrieveAction.CONVERSATIONS,K(t)):Promise.reject(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"labelId"))},l.getArchivedConversations=function(e){return(e=e||{}).filterConnector={conditions:[{filterTarget:Ue.FilterTarget.LABEL_ID,expectedValue:[Ue.SystemLabel.ARCHIVED]}]},e.retrieveAction=Circuit.Enums.RetrieveAction.CONVERSATIONS,K(e)},l.getConversationById=q,l.getConversationsByIds=function(e){return new Promise(function(n,i){I.getConversationsByIds(e,function(e,t){g(e,i)||Promise.all(t.map(Ne)).then(n).catch(i)})})},l.getConversationParticipants=function(e,t){return new Promise(function(n,i){t=t||{},I.getConversationParticipants(e,t,function(e,t){g(e,i)||Promise.all(t.participants.map(he)).then(function(e){t.participants=e,n(t)}).catch(i)})})},l.getItemById=function(e){return new Promise(function(n,i){I.getItemById(e,function(e,t){g(e,i)||Ae(t).then(n).catch(i)})})},l.getConversationItems=function(e,t){return new Promise(function(n,i){(t=t||{}).modificationDate=t.modificationDate||void 0,t.creationDate=t.creationDate||t.creationTime||void 0,t.direction=t.direction||Ue.SearchDirection.BEFORE,t.numberOfItems=t.numberOfItems||25,I.getConversationItems(e,t.modificationDate,t.creationDate,t.direction,t.numberOfItems,function(e,t){g(e,i)||Promise.all(t.map(Ae)).then(n).catch(i)})})},l.getConversationFeed=function(e,t){return new Promise(function(i,r){t=t||{},I.getConversationFeed(e,t.timestamp,t.minTotalItems,t.maxTotalUnread,t.commentsPerThread,t.maxUnreadPerThread,function(e,t,n){g(e,r)||Promise.all(t.map(me)).then(function(e){i({threads:e,hasOlderThreads:n})}).catch(r)})})},l.getItemsByThread=function(n,o,a){return new Promise(function(i,r){var e=(a=a||{}).modificationDate||a.creationDate,t=a.modificationDate?Ue.TimestampFilter.MODIFICATION:Ue.TimestampFilter.CREATION;I.getThreadComments(n,o,e,t,a.direction,a.number||a.numberOfItems,function(e,t,n){g(e,r)||Promise.all(t.map(Ae)).then(function(e){i({items:e,hasMore:n})}).catch(r)})})},l.addTextItem=function(e,o){return new Promise(function(n,i){function t(e){e.mentionedUsers=Ge.createMentionedUsersArray(e.content),I.addTextItem(e,function(e,t){g(e,i)||Ae(t).then(n).catch(i)})}if(e)if(o)if("string"==typeof o)t({convId:e,content:o,contentType:"RICH"});else if("object"==typeof o){var r={convId:e,parentId:o.parentId,contentType:o.contentType||Ue.TextItemContentType.RICH,subject:o.subject,content:o.content,externalAttachmentMetaData:o.externalAttachments};o.attachments&&0<o.attachments.length?new ye.FileUpload(c).uploadFiles(o.attachments,l.domain).then(function(e){r.attachmentMetaData=[],e.forEach(function(e){r.attachmentMetaData.push(e)}),t(r)}).catch(function(e){Le.error("[SDK]: Fileupload error.",e),i(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,e))}):t(r)}else i(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"Invalid content"));else i(new Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"content is required"));else i(new Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId is required"))})},l.updateTextItem=function(r){return new Promise(function(n,i){function t(e){e.mentionedUsers=Ge.createMentionedUsersArray(e.content),I.updateTextItem(e,function(e,t){g(e,i)||Ae(t).then(n).catch(i)})}r?r.itemId?"object"==typeof r?r.attachments&&0<r.attachments.length?new ye.FileUpload(c).uploadFiles(r.attachments,l.domain).then(function(e){r.attachmentMetaData=[],e.forEach(function(e){r.attachmentMetaData.push(e)}),t(r)}).catch(function(e){Le.error("[SDK]: Fileupload error.",e),i(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,e))}):t(r):i(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"Invalid content")):i(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"item.itemId is required")):i(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"item is required"))})},l.getDirectConversationWithUser=z,l.addParticipant=function(r,o,a){return new Promise(function(t,i){var e={convId:r,userId:o};I.addParticipant(e,function(e,n){g(e,i)||(Ne(n.conversation).then(t).catch(i),a&&R.SdkHelperSvc.getConversationPromise(r).then(function(e){if(e.call)if(n.conversation.convId===e.convId){var t=o.map(function(e){return{userId:e}});R.PubSubSvc.publish("/conversation/participants/add",[e.call,t])}else R.PubSubSvc.publish("/conversation/upgrade",[e,n.conversation])}))})})},l.removeParticipant=function(e,i){return new Promise(function(t,n){I.removeParticipant(e,i,function(e){g(e,n)||t()})})},l.getFlaggedItems=function(){return new Promise(function(n,i){I.getFlaggedItems(function(e,t){g(e,i,!0)||n(t||[])})})},l.flagItem=function(e,i){return new Promise(function(t,n){I.setFlagItem({convId:e,itemId:i},function(e){g(e,n)||t()})})},l.unflagItem=function(e,i){return new Promise(function(t,n){I.clearFlagItem(e,i,function(e){g(e,n)||t()})})},l.likeItem=function(e){return new Promise(function(t,n){I.likeTextItem(e,l.loggedOnUser.userId,function(e){g(e,n)||t()})})},l.unlikeItem=function(e){return new Promise(function(t,n){I.unlikeTextItem(e,l.loggedOnUser.userId,function(e){g(e,n)||t()})})},l.markItemsAsRead=function(e,i){return new Promise(function(t,n){i=i||Date.now(),I.setReadPointer(e,i,function(e){g(e,n)||t()})})},l.moderateConversation=function(e){return new Promise(function(n,i){e?I.moderateConversation(e,function(e,t){g(e,i)||(t&&"LOCK_OK"===t.moderateResult?n():i(t))}):i(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId is required"))})},l.unmoderateConversation=function(e){return new Promise(function(n,i){e?I.unmoderateConversation(e,function(e,t){g(e,i)||(t&&"UNLOCK_OK"===t.moderateResult?n():i(t))}):i(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId is required"))})},l.grantModeratorRights=function(e,t){return new Promise(function(n,i){e&&t?I.grantModeratorRights(e,t,function(e,t){g(e,i)||(t&&"GRANT_OK"===t.grantModeratorResult?n():i(t))}):i(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId and userId are required"))})},l.dropModeratorRights=function(e,t){return new Promise(function(n,i){e&&t?I.dropModeratorRights(e,t,function(e,t){g(e,i)||(t&&"DROP_OK"===t.dropModeratorResult?n():i(t))}):i(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"convId and userId are required"))})},l.enableGuestAccess=function(e){return $(e,!1)},l.disableGuestAccess=function(e){return $(e,!0)},l.createDirectConversation=function(e){return e&&"string"==typeof e?e.match(Ge.EMAIL_ADDRESS_PATTERN)?j(e).then(function(e){return e.userId}).then(J):J(e):Promise.reject(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"Participant email or user ID is required"))},l.createGroupConversation=function(t,r){return new Promise(function(n,i){if(t)if(-1===t.indexOf(l.loggedOnUser.userId)&&t.unshift(l.loggedOnUser.userId),t.length<2)i(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"At least one participant (other than self) is required"));else if(-1<t.indexOf("")||-1<t.indexOf(null))i(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"Participant cannot be empty"));else{t=t.map(function(e){return{userId:e}});var e={type:Ue.ConversationType.GROUP,participants:t,topic:r};I.createConversation(e,function(e,t){g(e,i)||Ne(t).then(n).catch(i)})}else i(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"Participants is required"))})},l.createConferenceBridge=function(t){return new Promise(function(n,i){if(t){var e={type:Ue.ConversationType.GROUP,participants:[{userId:l.loggedOnUser.userId}],topic:t};I.createConversation(e,function(e,t){g(e,i)||Ne(t).then(n).catch(i)})}else i(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"Topic is required"))})},l.createCommunity=function(t,r,o){return new Promise(function(n,i){t&&t.length||(t=[l.loggedOnUser.userId]),t=t.map(function(e){return{userId:e}});var e={type:Ue.ConversationType.OPEN,participants:t,topic:r,description:o};I.createConversation(e,function(e,t){g(e,i)||Ne(t).then(n).catch(i)})})},l.findCall=function(e){return Promise.resolve(Re(oe(e)))},l.getCalls=function(){return Promise.all(R.CallControlSvc.getCalls().map(Re))},l.getActiveCall=function(){return Promise.resolve(Re(R.CallControlSvc.getActiveCall()))},l.getActiveRemoteCalls=function(){return Promise.all(R.CallControlSvc.getActiveRemoteCall().map(Re))},l.getStartedCalls=function(){return Promise.all(R.CallControlSvc.getCalls().filter(function(e){return e.state.name===Circuit.Enums.CallState.Started.name}).map(Re))},l.startConference=function(e,t){return q(e).then(function(e){return new Promise(function(i,r){e?(R.SdkHelperSvc.addConversationToCache(e),R.CallControlSvc.startConference(e.convId,t,function(e,t,n){A(e,r)||Re(n).then(i).catch(r)})):r(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"Conversation does not exist"))})})},l.getConversationDetails=function(e){return new Promise(function(n,i){I.getJoinDetails(e,!1,function(e,t){g(e,i)||n(ae(t))})})},l.changeConversationPin=function(e){return new Promise(function(n,i){I.getJoinDetails(e,!0,function(e,t){g(e,i)||n(ae(t))})})},l.joinConference=function(r,o,a){return new Promise(function(n,i){r?a&&a!==l.loggedOnUser.clientId?re(a).then(function(e){if(e){var t={content:{type:"JOIN_CONFERENCE_REQUEST",callId:r,mediaType:o},destUserId:l.loggedOnUser.userId,destClientId:a};f.sendContactCardRequest(t,function(e,t){e?i(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,e)):t&&t.response?t.response.code&&"OK"!==t.response.code?i(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,t.response.code)):n():i(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,"Invalid response for JOIN_CONFERENCE_REQUEST"))})}else i(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,"No client found for clientId "+a))}):R.CallControlSvc.joinGroupCall(r,o,function(e){A(e,i)||n()}):i(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.pullRemoteCall=function(e,i){return new Promise(function(t,n){e?R.CallControlSvc.pullRemoteCall(e,i,function(e){A(e,n)||t()}):n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.leaveConference=se,l.endConference=function(e){return new Promise(function(t,n){e?R.CallControlSvc.endConference(e,function(e){A(e,n)||t()}):n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.setMediaDevices=function(i){return new Promise(function(t,e){if(i)if(i.playback||i.recording||i.video||i.ringing){i.playback&&(i.playback=Array.isArray(i.playback)?i.playback:[i.playback],v.playbackDevices=i.playback.map(function(e){return{id:e}})),i.recording&&(i.recording=Array.isArray(i.recording)?i.recording:[i.recording],v.recordingDevices=i.recording.map(function(e){return{id:e}})),i.video&&(i.video=Array.isArray(i.video)?i.video:[i.video],v.videoDevices=i.video.map(function(e){return{id:e}})),i.ringing&&(i.ringing=Array.isArray(i.ringing)?i.ringing:[i.ringing],v.ringingDevices=i.ringing.map(function(e){return{id:e}}));var n=R.CallControlSvc.getActiveCall();n?R.CallControlSvc.renegotiateMedia(n.callId,function(e){e&&Le.warn("[SDK]: Unable to renegotiate media.",e),t()}):t()}else e(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"devices must contain playback, recording, video or ringing attributes"));else e(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"devices is required"))})},l.makeCall=function(e,t,n){return z(e,n).then(function(e){return new Promise(function(i,r){e?(R.SdkHelperSvc.addConversationToCache(e),R.CallControlSvc.makeCall(e.convId,t,function(e,t,n){A(e,r)||Re(n).then(i).catch(r)})):r(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,"Conversation does not exist"))})})},l.endRemoteCall=function(e){return new Promise(function(t,n){e?R.CallControlSvc.endRemoteCall(e,function(e){A(e,n)||t()}):n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.dropParticipant=function(e,i){return new Promise(function(t,n){e?R.CallControlSvc.dropParticipant(e,{userId:i},function(e){A(e,n)||t()}):n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.muteParticipant=function(e,i){return new Promise(function(t,n){e?R.CallControlSvc.muteParticipant(e,{userId:i},function(e){A(e,n)||t()}):n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.muteRtcSession=function(e){return new Promise(function(t,n){e?R.CallControlSvc.muteRtcSession(e,function(e){A(e,n)||t()}):n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.getCallDevices=function(){return R.CallControlSvc.getCallDevices().map(function(e){return e.name})},l.getPushDevices=function(){return R.CallControlSvc.getPushDevices().map(function(e){return e.name})},l.getAnswerDevices=function(e){return R.CallControlSvc.getAnswerDevices(e).map(function(e){return e.name})},l.getAtcCalls=R.CallControlSvc.getAtcCalls,l.dialNumber=function(e,t){return new Promise(function(i,r){Ge.PHONE_PATTERN.test(e||null)?R.CallControlSvc.dialNumber(e,t,{audio:!0,video:!1},function(e,t,n){A(e||t,r)||Re(n).then(i).catch(r)}):r(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"Invalid number"))})},l.getTelephonyData=R.SdkHelperSvc.getTelephonyData,l.sendDigits=function(e,i){return new Promise(function(t,n){/^[\d#\*,]+$/.exec(i)?R.CallControlSvc.sendDigits(e,i,function(e){A(e,n)||t()}):n(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"Invalid DTMF digits (Allowed: 0-9,#,*)"))})},l.sendClickToCallRequest=function(a,s,n,c){return new Promise(function(i,r){if(a){s=s||"audio";var e=a.match(Ge.PHONE_DIAL_PATTERN),o=e&&e.length&&e[0];o&&(a=null),n?re(n).then(function(e){e?t(n):r(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,"No client found for clientId "+n))}):ie().then(function(e){e?t():c?r(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,"No clients found and launch parameter not set.")):function(){var e,t=l.domain.startsWith("sdk.")?l.domain.substr(4):l.domain;e=o?"https://"+t+"/#/phone?number="+o:"https://"+t+"/#/call?user="+a+"&media="+s;var n=window.open(e,"_blank");n?(n.focus(),i({type:"CALL_VIA_URL",win:n})):r(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,"Popup blocker prevented opening Circuit in new window"))}()})}else r(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"emailAddress is required"));function t(e){var t={content:{type:"CLICK_TO_CALL_REQUEST",mediaType:o?"telephony":s,contact:{email:a,phoneNumber:o},promptBeforeDial:!e,sdk:!0},destUserId:l.loggedOnUser.userId};e&&(t.destClientId=e),f.sendContactCardRequest(t,function(e){e?r(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,e)):i({type:"CALL_VIA_OTHER_CLIENT"})})}})},l.sendClickToAnswerRequest=function(r,o,a){return new Promise(function(n,i){function t(e){var t={content:{type:"CLICK_TO_ANSWER_REQUEST",mediaType:o,callId:r,promptBeforeAnswer:!e,sdk:!0},destUserId:l.loggedOnUser.userId};e&&(t.destClientId=e),f.sendContactCardRequest(t,function(e){e?i(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,e)):n({type:"ANSWER_VIA_OTHER_CLIENT"})})}o=o||"audio",a?re(a).then(function(e){e?t(a):i(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,"No client found for clientId "+a))}):ie().then(function(e){e?t():i(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,"No clients found and launch parameter not set."))})})},l.muteDevice=function(r,o,a){return new Promise(function(n,i){r?(void 0===(a=a||{}).mic&&(a.mic=!0),void 0===a.speaker&&(a.speaker=!0),ie(o).then(function(e){if(e){var t={content:{type:"MUTE_DEVICE_REQUEST",callId:r,option:a},destUserId:l.loggedOnUser.userId,destClientId:o,sdk:!0};f.sendContactCardRequest(t,function(e,t){e?i(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,e)):t&&t.response?t.response.code&&"OK"!==t.response.code?i(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,t.response.code)):n():i(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,"Invalid response for MUTE_DEVICE_REQUEST"))})}else i(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,"Device not found"))})):i(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.addParticipantToCall=function(r,e){return new Promise(function(t,n){if(r)if(e)if(e.userId||e.email||e.number){var i={userId:e.userId||void 0,dialOutPhoneNumber:e.number||void 0,displayName:e.displayName||void 0};!e.userId&&e.email&&e.email.match(Ge.EMAIL_ADDRESS_PATTERN)?j(e.email).then(function(e){i.userId=e.userId,R.CallControlSvc.addParticipantToCall(r,i,function(e){e?n(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,e)):t()})}).catch(n):R.CallControlSvc.addParticipantToCall(r,i,function(e){e?n(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,e)):t()})}else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"to.userId, to.email or to.number is required"));else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"to parameter is required"));else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.addParticipantToRtcSession=function(r,e){return new Promise(function(t,n){if(r)if(e)if(e.userId||e.email||e.number){var i={userId:e.userId||void 0,dialOutPhoneNumber:e.number||void 0,displayName:e.displayName||void 0};!e.userId&&e.email&&e.email.match(Ge.EMAIL_ADDRESS_PATTERN)?j(e.email).then(function(e){i.userId=e.userId,R.CallControlSvc.addParticipantToRtcSession(r,i,function(e){e?n(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,e)):t()})}).catch(n):R.CallControlSvc.addParticipantToRtcSession(r,i,function(e){e?n(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,e)):t()})}else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"to.userId, to.email or to.number is required"));else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"to parameter is required"));else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.answerCall=function(e,i,r){return new Promise(function(t,n){e?R.CallControlSvc.answerCallOnDevice(e,i,r&&we[r],function(e){A(e,n)||t()}):n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.endCall=se,l.toggleVideo=function(e){return new Promise(function(t,n){e?R.CallControlSvc.toggleVideo(e,function(e){A(e,n)||t()}):n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.changeHDVideo=function(e,i){return new Promise(function(t,n){e?(i=!!i,R.CallControlSvc.changeHDVideo(e,i,function(e){A(e,n)||t()})):n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.getMaxVideoResolution=function(e){return e?ce(e,Circuit.Enums.VideoResolution.FHD).catch(le(e,Circuit.Enums.VideoResolution.HD)).catch(le(e,Circuit.Enums.VideoResolution.VGA)).catch(function(){return Promise.reject("No video supported for deviceId: "+e)}):Promise.reject(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"deviceId is required"))},l.toggleRemoteAudio=function(i){return new Promise(function(e,t){if(i){var n=oe(i);n?(n.remoteAudioDisabled?R.CallControlSvc.enableRemoteAudio(i):R.CallControlSvc.disableRemoteAudio(i),e(i)):t(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"No call found"))}else t(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.toggleRemoteVideo=function(e){return new Promise(function(t,n){e?R.CallControlSvc.toggleRemoteVideo(e,function(e){A(e,n)||t()}):n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.toggleScreenShare=function(i){return new Promise(function(t,n){if(i){var e=oe(i);e?e.hasLocalScreenShare()?R.CallControlSvc.removeScreenShare(i,function(e){A(e,n)||t()}):R.CallControlSvc.addScreenShare(i,null,function(e){A(e,n)||t()}):n(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"No call found"))}else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.setScreenshareStream=de,l.toggleMediaStream=de,l.getLocalAudioVideoStream=ue.bind(l,v.LOCAL_STREAMS.AUDIO_VIDEO),l.getLocalScreenshareStream=ue.bind(l,v.LOCAL_STREAMS.DESKTOP),l.setAudioVideoStream=function(i,r){return new Promise(function(t,n){if(i)if(r)if(oe(i))if(Circuit.WebRTCAdapter.origGetUserMedia)n(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"Already setting another audio/video stream"));else{var e={audio:!!r.getAudioTracks().length,video:!!r.getVideoTracks().length};Circuit.WebRTCAdapter.origGetUserMedia=Circuit.WebRTCAdapter.getUserMedia,Circuit.WebRTCAdapter.getUserMedia=function(e,t){t&&t(r)},R.CallControlSvc.setMediaType(i,e,function(e){Circuit.WebRTCAdapter.getUserMedia=Circuit.WebRTCAdapter.origGetUserMedia,delete Circuit.WebRTCAdapter.origGetUserMedia,A(e,n)||t()})}else n(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"No call found"));else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"stream is required"));else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.startRecording=function(i,r){return new Promise(function(t,n){if(i){var e=R.CallControlSvc.getActiveCall();e?i===e.callId?R.CallControlSvc.startRecording(function(e){A(e,n)||t()},r):n(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"Call ID is not for active call")):n(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"No active call found"))}else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.stopRecording=function(i){return new Promise(function(t,n){if(i){var e=R.CallControlSvc.getActiveCall();e?i===e.callId?R.CallControlSvc.stopRecording(function(e){A(e,n)||t()}):n(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"Call ID is not for active call")):n(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"No active call found"))}else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.deleteRecording=function(e){return new Promise(function(t,n){I.deleteRecording(e,function(e){g(e,n)||t()})})},l.mute=function(e){return new Promise(function(t,n){e?R.CallControlSvc.mute(e,function(e){A(e,n)||t()}):n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.unmute=function(e){return new Promise(function(t,n){e?R.CallControlSvc.unmute(e,function(e){A(e,n)||t()}):n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.getLastRtpStats=function(e){if(!e)throw new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required");var t=oe(e);return t&&t.sessionCtrl?t.sessionCtrl.getLastSavedStats()||[]:null},l.getRemoteStreams=function(e){if(!e)throw new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required");var t=oe(e);return t&&t.sessionCtrl?t.sessionCtrl.getRemoteStreams()||[]:null},l.enableWhiteboard=function(i,r){return new Promise(function(t,n){if(i)if(r){var e={rtcSessionId:i,viewbox:r};I.enableWhiteboard(e,function(e){g(e,n)||t()})}else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"viewbox is required"));else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.disableWhiteboard=function(i){return new Promise(function(t,n){if(i){var e={rtcSessionId:i};I.disableWhiteboard(e,function(e){g(e,n)||t()})}else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.addWhiteboardElement=function(i,r){return new Promise(function(t,n){if(i)if(r){var e={rtcSessionId:i,xmlElement:r};I.addWhiteboardElement(e,function(e){g(e,n)||t()})}else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"xmlElement is required"));else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.removeWhiteboardElement=function(i,r){return new Promise(function(t,n){if(i)if(r){var e={rtcSessionId:i,xmlId:r};I.removeWhiteboardElement(e,function(e){g(e,n)||t()})}else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"xmlId is required"));else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.updateWhiteboardElement=function(i,r,o){return new Promise(function(t,n){if(i)if(r)if(o){var e={rtcSessionId:i,xmlId:r,xmlElement:o};I.updateWhiteboardElement(e,function(e){g(e,n)||t()})}else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"xmlElement is required"));else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"xmlId is required"));else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.clearWhiteboard=function(i,r){return new Promise(function(t,n){if(i){var e={rtcSessionId:i,userId:r||void 0};I.clearWhiteboard(e,function(e){g(e,n)||t()})}else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.getWhiteboard=function(t){return new Promise(function(n,i){if(t){var e={rtcSessionId:t};I.getWhiteboard(e,function(e,t){g(e,i)||(t.callId=t.rtcSessionId,delete t.rtcSessionId,n(t))})}else i(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.setWhiteboardBackground=function(r,t){return new Promise(function(n,i){if(r)if(t)if("object"==typeof t)new ye.FileUpload(c).uploadFiles([t],l.domain,null,null,!0).then(function(e){if(e.length){var t={rtcSessionId:r,url:e[0].url};I.setWhiteboardBackground(t,function(e){g(e,i)||n()})}else i(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"File upload error"))}).catch(function(e){Le.error("[SDK]: File upload error. ",e),i(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,e))});else if("string"==typeof t){var e={rtcSessionId:r,url:t};I.setWhiteboardBackground(e,function(e){g(e,i)||n()})}else i(new Circuit.Error(Ue.ReturnCode.SDK_ERROR,"file must be a File object or a string"));else i(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"file is required"));else i(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.clearWhiteboardBackground=function(i){return new Promise(function(t,n){if(i){var e={rtcSessionId:i};I.clearWhiteboardBackground(e,function(e){g(e,n)||t()})}else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.toggleWhiteboardOverlay=function(i){return new Promise(function(t,n){if(i){var e={rtcSessionId:i};I.toggleWhiteboardOverlay(e,function(e){g(e,n)||t()})}else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.undoWhiteboard=function(i,r,o){return new Promise(function(t,n){if(i){var e={rtcSessionId:i,steps:r,userId:o||void 0};I.undoWhiteboard(e,function(e){g(e,n)||t()})}else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"callId is required"))})},l.startUserSearch=function(e){return"string"==typeof e&&(e={query:e}),new Promise(function(n,i){I.startUserSearch(e,function(e,t){e?i(e):n(t)})})},l.startBasicSearch=function(e){var t;return t="string"==typeof e?{scope:Ue.SearchTerm.Scope.ALL,searchTerm:e}:e,new Promise(function(n,i){I.startBasicSearch(t,null,function(e,t){e?i(e):n(t)})})},l.cancelSearch=function(e){return new Promise(function(t,n){I.cancelSearch(e,function(e){g(e,n)||t()})})},l.sendAppMessageToUser=function(i,r,o){return new Promise(function(t,n){if(i&&"string"==typeof i)if(r&&"string"==typeof r)if(o&&"object"==typeof o){var e={content:{type:i,message:o},destUserId:r};f.sendSdkRequest(e,function(e){e?n(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,e)):t()})}else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"content [object] is required"));else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"userId [string] is required"));else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"type [string] is required"))})},l.sendAppMessageToClient=function(i,r,o){return new Promise(function(t,n){if(i&&"string"==typeof i)if(r&&"string"==typeof r)if(o&&"object"==typeof o){var e={content:{type:i,message:o},destUserId:l.loggedOnUser.userId,destClientId:r};f.sendSdkRequest(e,function(e){e?n(new Circuit.Error(Ue.ErrorCode.SDK_ERROR,e)):t()})}else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"content [object] is required"));else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"destClientId [string] is required"));else n(new Circuit.Error(Ue.ReturnCode.MISSING_REQUIRED_PARAMETER,"type [string] is required"))})},l.addAppMessageListener=function(e,t){f.on("SDK."+e,t)},l.removeAppMessageListener=f.off,R.PubSubSvc.subscribe("/localUser/update",function(){Oe({type:"loggedOnUserUpdated",user:l.loggedOnUser})}),I.on("Conversation.ADD_ITEM",function(e){Oe({type:"itemAdded",item:e.item})}),I.on("Conversation.UPDATE_ITEM",function(e){Oe({type:"itemUpdated",item:e.item})}),I.on("Conversation.CREATE",function(e){Oe({type:"conversationCreated",conversation:e.conversation})}),I.on("Conversation.UPDATE",function(e){Oe({type:"conversationUpdated",conversation:e.conversation})}),R.PubSubSvc.subscribe("/conversation/new",function(e){Oe({type:"conversationUpdated",conversation:e})}),I.on("Conversation.CONVERSATION_MARKED",function(e){switch(e.filter){case Ue.ConversationMarkFilter.MUTE:Oe({type:"conversationArchived",convId:e.convId});break;case Ue.ConversationMarkFilter.FAVORITE:Oe({type:"conversationFavorited",convId:e.convId})}}),I.on("Conversation.CONVERSATION_UNMARKED",function(e){switch(e.filter){case Ue.ConversationMarkFilter.MUTE:Oe({type:"conversationUnarchived",convId:e.convId});break;case Ue.ConversationMarkFilter.FAVORITE:Oe({type:"conversationUnfavorited",convId:e.convId})}}),I.on("Conversation.USER_DATA_CHANGED",function(e){Oe({type:"conversationUserDataChanged",data:e})}),I.on("Conversation.READ_ITEMS",function(e){Oe({type:"conversationReadItems",data:e})}),I.on("User.USER_PRESENCE_CHANGE",function(e){Oe({type:"userPresenceChanged",presenceState:e.newState})}),I.on("User.TENANT_PRESENCE_CHANGE",function(e){e.newState.forEach(function(e){Oe({type:"userPresenceChanged",presenceState:e})})}),I.on("User.USER_UPDATED",function(e){Oe({type:"userUpdated",user:e.user})}),I.addEventListener("connectionStateChange",function(e){t===be.Reconnecting&&e.newState===be.Connected&&x().catch(function(e){Le.error("Error initializing websocket on reconenct",e)}),t=e.newState,Oe({type:"connectionStateChanged",state:e.newState})}),I.addEventListener("reconnectFailed",function(){Oe({type:"reconnectFailed"}),c.client_secret&&Y().then(D).then(W).catch(function(e){Le.error("Error re-authenticating on auto-reconnect for client credentials grant",e)})}),I.on("User.SESSION_EXPIRES",function(){l.loggedOnUser&&ne()}),I.on("User.SESSION_EXPIRING",function(){Oe({type:"sessionExpiring"})}),I.on("User.SESSION_CLOSED",function(e){Oe({type:"sessionClosed",reason:e.reason})}),I.on("User.PASSWORD_CHANGED",function(){Oe({type:"passwordChanged"})}),I.on("User.USER_SETTING_UPDATED",function(e){var t=Z(e.settings);0<Object.keys(t).length&&Oe({type:"userSettingsChanged",userSettings:t})}),I.on("Search.BASIC_SEARCH_RESULT",function(e){Oe({type:"basicSearchResults",data:e})}),I.on("Search.SEARCH_STATUS",function(e){Oe({type:"searchStatus",data:e})}),I.on("System.MAINTENANCE",function(e){Oe({type:"systemMaintenance",data:e})}),I.on("User.USER_DELETED",function(e){Oe({type:"userDeleted",data:e})}),I.on("Conversation.DELETE",function(e){Oe({type:"conversationDeleted",convId:e.convId})}),I.on("RTCSession.WHITEBOARD_ENABLED",function(e){var t=oe(e.sessionId);t&&Oe({type:"whiteboardEnabled",enabled:t.whiteboardEnabled=!0,whiteboard:e.whiteboard,data:{enabled:!0,whiteboard:e.whiteboard}})}),I.on("RTCSession.WHITEBOARD_DISABLED",function(e){var t=oe(e.sessionId);t&&Oe({type:"whiteboardEnabled",enabled:t.whiteboardEnabled=!1,data:{enabled:!1}})}),I.on("RTCSession.WHITEBOARD_CLEARED",function(e){Oe({type:"whiteboardCleared",userId:e.userId,possibleUndoOperations:e.possibleUndoOperations})}),I.on("RTCSession.WHITEBOARD_ELEMENT_ADDED",function(e){Oe({type:"whiteboardElement",action:"added",element:e.element,possibleUndoOperations:e.possibleUndoOperations})}),I.on("RTCSession.WHITEBOARD_ELEMENT_REMOVED",function(e){Oe({type:"whiteboardElement",action:"removed",elementId:e.elementId,possibleUndoOperations:e.possibleUndoOperations})}),I.on("RTCSession.WHITEBOARD_ELEMENT_UPDATED",function(e){Oe({type:"whiteboardElement",action:"updated",element:e.element,possibleUndoOperations:e.possibleUndoOperations})}),I.on("RTCSession.WHITEBOARD_BACKGROUND_SET",function(e){Oe({type:"whiteboardBackground",action:"set",element:e.element,possibleUndoOperations:e.possibleUndoOperations})}),I.on("RTCSession.WHITEBOARD_BACKGROUND_CLEARED",function(){Oe({type:"whiteboardBackground",action:"cleared"})}),I.on("RTCSession.WHITEBOARD_OVERLAY_TOGGLED",function(){Oe({type:"whiteboardOverlayToggled"})}),I.on("RTCSession.WHITEBOARD_SYNC",function(e){Oe({type:"whiteboardSync",whiteboard:e.whiteboard,possibleUndoOperations:e.possibleUndoOperations})}),I.on("ActivityStream.ACTIVITY_CREATED",function(e){e.navigableItem&&e.navigableItem.mention&&Oe({type:"mention",mention:e.navigableItem.mention})}),R.PubSubSvc.subscribe("/call/incoming",function(e){Oe({type:"callIncoming",call:e})}),a&&R.PubSubSvc.subscribe("/call/warmupFailed",function(e,t){Oe({type:"callIncoming",call:t})}),R.PubSubSvc.subscribe("/call/state",function(e){Oe({type:"callStatus",call:e,reason:"callStateChanged"})}),R.PubSubSvc.subscribe("/call/remoteStreamUpdated",function(e){Oe({type:"callStatus",call:e,reason:"remoteStreamUpdated"})}),R.PubSubSvc.subscribe("/call/localStreamEnded",function(e){Oe({type:"callStatus",call:e,reason:"localStreamEnded"})}),R.PubSubSvc.subscribe("/call/muted",function(e){Oe({type:"callStatus",call:e,reason:"callMuted"})}),R.PubSubSvc.subscribe("/call/localUser/muted",function(e){Oe({type:"callStatus",call:oe(e),reason:"localUserMuted"})}),R.PubSubSvc.subscribe("/call/localUser/unmuted",function(e){Oe({type:"callStatus",call:oe(e),reason:"localUserUnmuted"})}),R.PubSubSvc.subscribe("/call/localUser/mutedSelf",function(e,t){var n=oe(e);Oe(t?{type:"callStatus",call:n,reason:"localUserSelfMuted"}:{type:"callStatus",call:n,reason:"localUserSelfUnmuted"})}),R.PubSubSvc.subscribe("/call/locked",function(e){Oe({type:"callStatus",call:e,reason:"callLocked"})}),R.PubSubSvc.subscribe("/call/moved",function(e,t){Oe({type:"callStatus",call:oe(t),reason:"callMoved"})}),R.PubSubSvc.subscribe("/call/participant/updated",function(e,t){Oe({type:"callStatus",call:oe(e),participant:t,reason:"participantUpdated"})}),R.PubSubSvc.subscribe("/call/participants/updated",function(e,t){Oe({type:"callStatus",call:oe(e),participants:t,reason:"participantsUpdated"})}),R.PubSubSvc.subscribe("/call/participant/added",function(e,t){Oe({type:"callStatus",call:oe(e),participant:t,reason:"participantAdded"})}),R.PubSubSvc.subscribe("/call/participants/added",function(e,t){Oe({type:"callStatus",call:oe(e),participants:t,reason:"participantsAdded"})}),R.PubSubSvc.subscribe("/call/participant/joined",function(e,t){Oe({type:"callStatus",call:e,participant:t,reason:"participantJoined"})}),R.PubSubSvc.subscribe("/call/participant/removed",function(e){Oe({type:"callStatus",call:oe(e),reason:"participantRemoved"})}),R.PubSubSvc.subscribe("/call/recording/info",function(e){Oe({type:"callStatus",call:e,reason:"callRecording"})}),R.PubSubSvc.subscribe("/call/droppedRemotely",function(e){Oe({type:"callStatus",call:e,reason:"droppedRemotely"})}),R.PubSubSvc.subscribe("/call/sdpConnected",function(e){Oe({type:"callStatus",call:e,reason:"sdpConnected"})}),R.PubSubSvc.subscribe("/call/network/quality",function(e){Oe({type:"callNetworkQualityChanged",data:e})}),R.PubSubSvc.subscribe("/call/rtp/threshholdExceeded/detected",function(e){Oe({type:"callRtpThresholdReached",call:oe(e)})}),R.PubSubSvc.subscribe("/call/rtp/threshholdExceeded/cleared",function(e){Oe({type:"callRtpThresholdCleared",call:oe(e)})}),R.PubSubSvc.subscribe("/call/ended",function(e){oe(e.callId)||Oe({type:"callEnded",call:e})}),l},ye.Client.prototype.name="Client",ye.isCompatible=function(){var e=parseInt(t.version,10);return t.chrome&&44<=e||t.firefox&&42<=e||t.edge},ye.supportedFeatures=function(){return ye.isCompatible()?{text:!0,rtc:t.chrome||t.firefox}:{text:!1,rtc:!1}},Object.defineProperty(ye,"supportedEvents",{get:function(){return["accessTokenRenewed","renewAccessTokenFailed","loggedOnUserUpdated","itemAdded","itemUpdated","conversationCreated","conversationUpdated","conversationArchived","conversationFavorited","conversationUnarchived","conversationUnfavorited","conversationUserDataChanged","conversationReadItems","userPresenceChanged","userUpdated","connectionStateChanged","sessionTokenRenewed","reconnectFailed","userSettingsChanged","basicSearchResults","systemMaintenance","whiteboardEnabled","whiteboardElement","whiteboardCleared","mention","callIncoming","callStatus","callNetworkQualityChanged","callRtpThresholdReached","callRtpThresholdCleared","callEnded","whiteboardBackground","whiteboardOverlayToggled","whiteboardSync"]},enumerable:!0,configurable:!0}),ye}(Circuit=function(e){"use strict";return e.Injectors={},e}((Circuit=function(n){"use strict";var r=n.Constants,o=n.logger,a=n.PhoneNumberFormatter,s=n.Utils;var i=function(e,t){return window.setTimeout(e,t)};i.cancel=function(e){e&&window.clearTimeout(e)};var c=function(e,t,n){if(void 0===n)return window.setInterval(e,t);if(n<=0)return null;var i=0,r=null;return r=window.setInterval(function(){e(),n<=++i&&window.clearInterval(r)},t)};c.cancel=function(e){e&&window.clearInterval(e)};var l=null;n.ClientApiHandlerSingleton.getInstance=function(){return l};var d=null;return n.UserToUserHandlerSingleton.getInstance=function(){return d},n.SdkServices=function(e,t){l=e,d=t,this.rootScope={localUser:null,clientVersion:"",browser:s.getBrowserInfo(),circuitLabs:{},$$phase:!0,$apply:function(e){e&&e()},$digest:function(){},i18n:{localize:function(e){return e},map:{res_Unknown:"Unknown"}},localize:function(e){return e}},n.Conversation={extend:function(t,e){if(!t||!t.localUser)return o.warn("[sdk-services]: Cannot extend Conversation object without localUser"),null;if(!e||e.isExtended)return e;var n=Object.create(e);n.isExtended=!0,n.moderators=n.moderators||[];var i=e.participants.map(function(e){return"string"==typeof e?{userId:e}:e}).filter(function(e){return e.userId===t.localUser.userId&&(n.hasJoined=!0),e.userId!==t.localUser.userId});return n.peerUsers=i,e.type===r.ConversationType.DIRECT&&(n.peerUser=i[0]),n.userIsModerator=function(t){return!!t&&n.moderators.some(function(e){return e.userId===t.userId})},n}.bind(null,this.rootScope)},n.UserProfile={extend:function(e){if(!e||e.isExtended)return e;var t=Object.create(e);return t.isExtended=!0,t}.bind(null),syncTelephonyConfig:function(e){var t=e&&e.accounts&&e.accounts[0],n=t&&t.telephonyConfiguration;if(n){if(n.phoneNumber=a.format(n.phoneNumber)||"",n.callerId=a.format(n.callerId)||"",n.reroutingPhoneNumber=a.format(n.reroutingPhoneNumber)||"",e.reroutingPhoneNumber=n.reroutingPhoneNumber,e.ondSipAuthenticationHash=n.ondSipAuthenticationHash,e.onsSipAuthenticationHash=n.onsSipAuthenticationHash,e.associatedTelephonyUserID=n.associatedTelephonyUserID,e.associatedTelephonyUserType=n.associatedTelephonyUserType,e.previousAlternativeNumbers=(n.previousAlternativeDevice||[]).map(s.cleanPhoneNumber),e.reroutingPhoneNumber){var i=s.cleanPhoneNumber(e.reroutingPhoneNumber);e.previousAlternativeNumbers.includes(i)||e.previousAlternativeNumbers.unshift(i)}e.associatedTelephonyUserID&&e.associatedTelephonyUserType===r.GtcTrunkType.ATC_TRUNK_TYPE?(e.associatedGTCUserId=e.associatedTelephonyUserID,e.isATC=!0):e.isATC=!1}else delete e.associatedGTCUserId,delete e.reroutingPhoneNumber,delete e.ondSipAuthenticationHash,delete e.onsSipAuthenticationHash,delete e.associatedTelephonyUserID,delete e.associatedTelephonyUserType,delete e.isATC}.bind(null)},this.PubSubSvc=new n.PubSubSvcImpl(o),this.ExtensionSvc=new n.ExtensionSvcImpl(this.rootScope,i,window,Promise,o,this.PubSubSvc,null),this.SdkHelperSvc=new n.SdkHelperSvcImpl(this.rootScope,Promise,o,this.PubSubSvc),this.AtcRegistrationSvc=new n.AtcRegistrationSvcImpl(this.rootScope,i,o,this.PubSubSvc,this.SdkHelperSvc,this.SdkHelperSvc),this.DeviceDiagnosticSvc=new n.DeviceDiagnosticSvcImpl(this.rootScope,i,o,this.PubSubSvc,null),this.CircuitCallControlSvc=new n.CircuitCallControlSvcImpl(this.rootScope,i,c,window,Promise,o,this.PubSubSvc,this.SdkHelperSvc,this.SdkHelperSvc,null,this.SdkHelperSvc,this.DeviceDiagnosticSvc),this.CstaSvc=new n.CstaSvcImpl(this.rootScope,i,o,this.PubSubSvc,this.CircuitCallControlSvc,this.AtcRegistrationSvc,this.SdkHelperSvc,this.SdkHelperSvc),this.CallControlSvc=new n.CallControlSvcImpl(this.rootScope,Promise,i,o,this.PubSubSvc,this.CircuitCallControlSvc,this.SdkHelperSvc,this.CstaSvc,null,null,this.SdkHelperSvc,this.SdkHelperSvc),n.Conversation=null,n.UserProfile=null,d=l=null},n}(Circuit=function(e){"use strict";var O=e.Enums.CallState,D=e.Enums.CstaCallState,y=e.Constants,b=e.Enums,P=e.Enums.Targets,U=e.Utils,L=e.UserToUserHandlerSingleton;return e.CallControlSvcImpl=function(t,i,r,c,o,l,a,d,s,u,C,E){c.debug("New Service: CallControlSvc");var T,p=2e3,S=[],I=this,e=L.getInstance();function f(e){var t;for(t=0;t<S.length;t++)if(e.sameAs(S[t])){S.splice(t,1);break}}function v(e){for(var t=0;t<S.length;t++)if(S[t].callId===e)return S[t]}function R(){for(var e=null,t=0;t<S.length;t++){if(S[t].state===O.ActiveRemote)return S[t];S[t].checkCstaState(D.Conference)&&(e=S[t])}return e}function g(e){c.debug("[CallControlSvc]: Publish /call/state event. callId = "+e.callId+", state = "+e.state.name),o.publish("/call/state",[e])}function A(e){e.terminate()}function _(e){e&&(c.debug("[CallControlSvc]: Publish /conversation/update event. convId = ",e.convId),o.publish("/conversation/update",[e]))}function n(e){if(e)if(e.isAtcRemote){var t=a.getConversationFromCache(e.convId);if(t&&t.isTelephonyConv){if(!e.checkCstaState([D.Idle,D.Terminated])&&(function(e){for(var t=0;t<S.length;t++)if(e.sameAs(S[t]))return c.debug("[CallControlSvc]: Updating call with callId = "+e.callId),S[t]=e;S.push(e)}(e),!t.call||t.call.isHandoverInProgress&&!t.call.sameAs(e)||t.call.isAtcRemote&&t.call.isHolding())){if(t.call&&t.call.isHandoverInProgress){var n=t.call;n.clearAtcHandoverInProgress(),e.establishedTime=n.establishedTime,n.isAtcRemote?f(n):l.removeCallFromList(n),n.terminateReason=b.CallClientTerminatedReason.USER_ENDED,A(n),c.debug("[CallControlSvc]: Publish /call/ended event."),o.publish("/call/ended",[n,!1])}t.call=e}switch(e.getCstaState()){case D.Initiated:case D.Offered:case D.ExtendedRinging:e.setState(O.Started);break;case D.Delivered:e.setState(O.Delivered);break;case D.Busy:e.setState(O.Busy);break;case D.Ringing:e.checkState(O.Ringing)||(e.setState(O.Ringing),u&&u.show({type:Circuit.Enums.NotificationType.INCOMING_VOICE_CALL,user:e.peerUser,extras:{conversation:t,call:e}}));break;case D.Idle:case D.TransferFailed:case D.Failed:e.setState(O.Idle);break;case D.Terminated:e.setState(O.Terminated);break;default:e.setState(O.ActiveRemote)}e.state!==O.Idle&&e.state!==O.Terminated&&e.state!==O.Started?(_(t),g(e),d.isPrimaryClient()&&e.state!==O.Ringing&&E.setPresenceWithLocation(y.PresenceState.BUSY)):e.state!==O.Idle&&e.state!==O.Terminated||(A(e),f(e),c.debug("[CallControlSvc]: Publish /call/ended event"),o.publish("/call/ended",[e,!1]),e.isHandoverInProgress||t.call&&t.call.sameAs(e)&&(t.call=R(),t.call||l.getActiveCall()||E.setPresenceWithLocation(y.PresenceState.AVAILABLE)),_(t))}else c.warn("[CallControlSvc]: Call in /atccall/info event is not for telephony conversation")}else g(e);else c.warn("[CallControlSvc]: Invalid call object in /atccall/info event")}function m(e){var t=function(){for(var e=0;e<S.length;e++)if(S[e].isHandoverInProgress)return S[e];return null}();if(t){t.atcCallInfo.transferCb&&(t.atcCallInfo.transferCb(null,null,e),delete t.atcCallInfo.transferCb);var n=a.getConversationFromCache(e.convId);e.establishedTime=t.establishedTime,A(t),f(t),n&&n.call&&(n.call=e,_(n))}}function N(e){var t=l.getActiveCall();return!!t&&e===t.callId}function h(e){c.debug("[CallControlSvc]: Publish /call/nativeDial event"),o.publish("/call/nativeDial",[e])}return o.subscribe("/atccall/info",function(e){c.debug("[CallControlSvc]: Received /atccall/info event"),n(e)}),o.subscribe("/atccall/replace",function(e){c.debug("[CallControlSvc]: Received /atccall/replace event"),m(e)}),o.subscribe("/call/ended",function(e){if(c.debug("[CallControlSvc]: Received /call/ended event"),e.sendDtmfTimer&&(r.cancel(e.sendDtmfTimer),e.sendDtmfTimer=null),delete e.dtmfDigits,e.isAtcRemote)e.clearAtcHandoverInProgress(),f(e);else{var t=a.getConversationFromCache(e.convId);t&&t.isTelephonyConv&&!t.call&&(t.call=R()||function(){for(var e=0;e<S.length;e++)if(S[e].state===O.Ringing)return S[e]}(),t.call&&_(t)),e.isRemote||l.getActiveCall()||(d.isPrimaryClient()&&R()||E.setPresenceWithLocation(y.PresenceState.AVAILABLE),E.cancelAutoSnooze())}}),o.subscribe("/atccall/hangingcall",function(e){var n;c.debug("[CallControlSvc]: Received /atccall/hangingcall event"),n=e,a.getTelephonyConversation(function(e,t){!e&&t&&t.call&&t.call.atcCallInfo.getCstaCallId()===n&&(t.call=null,_(t))})}),o.subscribe("/call/state",function(e){c.debug("[CallControlSvc]: Received /call/state event"),e&&e.state.established&&(e.isRemote||E.setPresenceWithLocation(y.PresenceState.BUSY),e.dtmfDigits&&function(e){var t=e.dtmfDigits;if(t){delete e.dtmfDigits;var n=t.match(/^\,*/)[0].length,i=n*p+1e3;n&&(t=t.substr(n)),e.sendDtmfTimer=r(function(){e.sendDtmfTimer=null,e.isPresent()&&(c.debug("[CallControlSvc]: Send delayed DTMF digits "+t+" for call "+e.callId),I.sendDigits(e.callId,t))},i)}}(e))}),o.subscribe("/screenshare/started",function(){c.info("[CallControlSvc]: Received /screenshare/started event. Screenshare was started. Start Auto-Snooze."),E.startAutoSnooze()}),o.subscribe("/screenshare/ended",function(){c.info("[CallControlSvc]: Received /screenshare/ended event. Screenshare was ended. Resume from Auto-Snooze."),E.cancelAutoSnooze()}),o.subscribe("/call/action",function(e){switch(c.debug("[CallControlSvc]: Received /call/action event with action ",e.type),e.type){case b.NotificationActionType.ANSWER:I.answerCall(e.callId,{audio:!0,video:!1,desktop:!1});break;case b.NotificationActionType.DECLINE:return void I.endCall(e.callId)}var t=I.findConversationByCallId(e.callId);t&&(c.debug("[CallControlSvc]: Publish /conversation/navigate event"),o.publish("/conversation/navigate",[t]))}),U.isMobile()&&e.on("MOBILE_BREAKOUT.DIAL",function(e){c.info("[CallControlSvc]: Received UserToUser MOBILE_BREAKOUT.DIAL event."),t.$apply(function(){!function(e){if(e&&e.phoneNumber){c.debug("[CallControlSvc]: Received MobileBreakout.DIAL event");var t={phoneNumber:e.phoneNumber,autoDial:e.autoDial,userName:e.userName},n=[];e.conversationId&&n.push(a.getConversationPromise(e.conversationId)),e.userId&&n.push(C.getUserPromise(e.userId)),n.length?i.all(n).then(function(e){e&&e.forEach(function(e){e.userId?t.user=e:t.conversation=e}),h(t)}):h(t)}}(e)})}),this.initActiveSessionsForSdk=l.initActiveSessionsForSdk,this.setDisableRemoteVideoByDefault=l.setDisableRemoteVideoByDefault,this.getDisableRemoteVideoByDefault=l.getDisableRemoteVideoByDefault,this.setClientDiagnosticsDisabled=l.setClientDiagnosticsDisabled,this.getCalls=l.getCalls,this.getPhoneCalls=l.getPhoneCalls,this.getActiveCall=l.getActiveCall,this.isConnectionInProgress=l.isConnectionInProgress,this.getIncomingCall=l.getIncomingCall,this.getActiveRemoteCall=l.getActiveRemoteCall,this.joinGroupCall=l.joinGroupCall,this.makeCall=l.makeCall,this.makeAtcCall=function(e,t,n){var i=U.cleanPhoneNumber("object"==typeof t?t.dialedDn:t);"object"==typeof t?t.dialedDn=i:t={dialedDn:i},t.dtmfDigits&&(t.dtmfDigits=U.cleanPhoneNumberDigitsWithPin(t.dtmfDigits));var r,o,a=(r=e,o=null,S.some(function(e){if(e.atcCallInfo.getPosition()===r)return o=e,!0}),o);a?d.consultationCall(a,t,n):d.makeCall(e,t,n)},this.makeEchoTestCall=l.makeEchoTestCall,this.dialNumber=l.dialNumber,this.dialPhoneNumber=l.dialPhoneNumber,this.dialUsingDefaultDevice=function(i,r){r=r||function(){};var o=i&&i.dialedDn;o&&U.PHONE_DIAL_PATTERN.test(o)?(c.debug("[CallControlSvc]: Calling "+o+" with name: "+i.toName),a.getTelephonyConversation(function(e,t){if(!e&&t){if(t.call&&t.call.consultation){var n=t.call.getPosition()||T;if(n&&n!==P.WebRTC)return c.info("[CallControlSvc]: Start consultation from "+n.name+" to ",o),I.makeAtcCall(n,i,r),void(t.call.consultation=!1)}else if(T&&T!==P.WebRTC)return c.info("[CallControlSvc]: Make call from "+T.name+" to ",o),void I.makeAtcCall(T,i,r);i.mediaType=i.mediaType||{audio:!0,video:!1,desktop:!1},I.dialPhoneNumber(i,r)}else c.debug("[CallControlSvc]: error on getTelephonyConversation ",e)})):r("Missing or wrong number")},this.setDefaultCallDevice=function(t){t&&t.name&&Object.keys(P).some(function(e){if(t.name===P[e].name)return T=P[e],c.debug("[CallControlSvc]: Set defaultCallDevice to ",T.name),!0})},this.startConference=l.startConference,this.answerCall=function(e,t,n){if(1<l.getEstablishedLocalPhoneCalls().length)return c.warn("[CallControlSvc]: answerCall - There are already 2 local phone calls"),void(n&&n("Can not answer the call"));var i=l.findCall(e);if(i)l.answerCall(e,t,n);else{i=v(e);var r=l.getActiveCall(),o=l.getIncomingCall();i?r&&!r.isTelephonyCall?l.endActiveCall(function(){d.pullRemoteCall(e,null,n)}):o&&!o.isTelephonyCall?l.endCallWithCauseCode(o.callId,y.InviteRejectCause.BUSY,function(){d.pullRemoteCall(e,null,n)}):d.pullRemoteCall(e,null,n):(c.warn("[CallControlSvc]: answerCall - There is no alerting call"),n&&n("No alerting call"))}},this.answerCallOnDevice=function(e,t,n,i){if(!n||n===P.WebRTC)return I.answerCall(e,t,i);var r=l.findCall(e);r?r.isTelephonyCall?d.deflect(e,n,null,i):c.warn("[CallControlSvc]: answerCallOnDevice - The active call is not a telephony call"):(r=v(e))?r.pickupNotification?d.pickupCall(e,n,i):r.getPosition()!==n?d.deflect(e,n,null,i):d.answer(e,i):(c.warn("[CallControlSvc]: answerCallOnDevice - There is no alerting call"),i&&i("No alerting call"))},this.endCall=function(e,t){I.endCallWithCauseCode(e,null,t)},this.endCallWithCauseCode=function(e,t,n){var i=l.findCall(e);i?i.isRemote?l.endRemoteCall(e,n):t?l.endCallWithCauseCode(e,t,n):l.endCall(e,n):(i=v(e))&&1<S.length&&I.reconnectCall(e,n)||(i?d.endRemoteCall(e,n):(c.warn("[CallControlSvc]: endCall invoked without a valid call. callId = ",e),n&&n("Call not found")))},this.endConference=l.endConference,this.startScreenShare=l.startScreenShare,this.addScreenShare=l.addScreenShare,this.selectMediaToShare=l.selectMediaToShare,this.removeScreenShare=l.removeScreenShare,this.addAudio=l.addAudio,this.removeAudio=l.removeAudio,this.enableRemoteAudio=l.enableRemoteAudio,this.disableRemoteAudio=l.disableRemoteAudio,this.addVideo=l.addVideo,this.removeVideo=l.removeVideo,this.toggleRemoteVideo=l.toggleRemoteVideo,this.toggleVideo=l.toggleVideo,this.changeHDVideo=l.changeHDVideo,this.renegotiateMedia=l.renegotiateMedia,this.setMediaType=l.setMediaType,this.addMediaStream=l.addMediaStream,this.removeMediaStream=l.removeMediaStream,this.pullRemoteCall=function(e,t,n){var i=l.findCall(e);if(i)l.pullRemoteCall(e,t,n);else if(i=v(e)){var r=l.getActiveCall();if(r)return r.isTelephonyCall?void l.holdCall(r.callId,function(){d.pullRemoteCall(e,null,n)}):void l.endActiveCall(function(){d.pullRemoteCall(e,null,n)});d.pullRemoteCall(e,null,n)}else c.warn("[CallControlSvc]: pullRemoteCall invoked without a valid call"),n&&n("No active remote call")},this.pushLocalCall=function(e,t,n){d.pushLocalCall(e,t,n)},this.getAtcCalls=function(){return S},this.swapCall=function(e,t){var n=l.findCall(e);if(n&&n.isTelephonyCall&&!n.isRemote)l.swapCall(e,t);else if(S.length<=1)c.warn("[CallControlSvc]: swapCall possible only with 2 calls");else{var i,r=null;for(i=0;i<S.length;i++)if(S[i].isHolding()&&S[i].callId===e){r=S[i];break}if(r){var o=r.atcCallInfo.getPosition();for(i=0;i<S.length;i++)if(S[i].checkCstaState([D.Active,D.Conference])&&S[i].atcCallInfo.getPosition()===o&&S[i].callId!==e){var a=S[i];return void d.alternate(r,a,t)}}}},this.mergeCall=function(e,t){var n=l.getPhoneCalls(!0);if(S.length<=1&&n.length<=1)c.warn("[CallControlSvc]: mergeCall possible only with 2 calls");else{var i,r,o;if(1<n.length&&(i=l.findActivePhoneCall(!0),r=l.findHeldPhoneCall(!0),i&&r)){if(!r.isAtcConferenceCall())return void d.conference(r,i,t);I.swapCall(r.callId,function(e){e?t(e):d.conference(i,r,t)})}for(o=0;o<S.length;o++)if(S[o].checkCstaState([D.Active,D.Conference])&&S[o].callId===e){i=S[o];break}if(i){var a=i.atcCallInfo.getPosition();for(o=0;o<S.length;o++)if(S[o].isHolding()&&S[o].atcCallInfo.getPosition()===a&&S[o].callId!==e)return r=S[o],void d.conference(r,i,t)}}},this.transferCall=function(e,t,n){var i,r=l.findCall(e),o=l.getPhoneCalls(!0);if(t=U.cleanPhoneNumber(t),r&&1===o.length)r.isTelephonyCall?d.transfer(r,t,n):(c.warn("[CallControlSvc]: The active call is not a telephony call"),n&&n("The active call is not a telephony call"));else if(r&&2===o.length)r.isTelephonyCall?(i=l.findHeldPhoneCall(!0),d.consultationTransfer(r,i,n)):(c.warn("[CallControlSvc]: The active call is not a telephony call"),n&&n("The active call is not a telephony call"));else{if(S.length<1)return c.warn("[CallControlSvc]: transferCall possible only with 1 or 2 calls"),void(n&&n("Not enough calls for the transfer"));if(1===S.length&&!S[0].isHolding())return r=S[0],void d.transfer(r,t,n);var a;for(a=0;a<S.length;a++)if(!S[a].isHolding()&&S[a].callId===e){r=S[a];break}if(r){var s=r.atcCallInfo.getPosition();for(a=0;a<S.length;a++)if(S[a].isHolding()&&S[a].atcCallInfo.getPosition()===s&&S[a].callId!==e)return i=S[a],void d.consultationTransfer(r,i,n)}}},this.holdCall=function(e,t){var n=l.findCall(e);return n?n.isHolding()?(c.warn("[CallControlSvc]: Call is not in valid state"),void(t&&t("Call is not in valid state"))):void l.holdCall(e,t):(n=v(e))?n.isHolding()?(c.warn("[CallControlSvc]: Call is not in valid state"),void(t&&t("Call is not in valid state"))):void d.hold(n,t):(c.warn("[CallControlSvc]: holdCall invoked without a valid call"),void(t&&t("No active remote call")))},this.retrieveCall=function(e,t){var n=l.findCall(e);return n?n.isHolding()?void l.retrieveCall(e,t):(c.warn("[CallControlSvc]: Call is not in valid state"),void(t&&t("Call is not in valid state"))):(n=v(e))?n.isHolding()?void d.retrieve(n,t):(c.warn("[CallControlSvc]: Call is not in valid state"),void(t&&t("Call is not in valid state"))):(c.warn("[CallControlSvc]: retrieveCall invoked without a valid call"),void(t&&t("No active remote call")))},this.reconnectCall=function(e,t){if(S.length<=1)return c.warn("[CallControlSvc]: reconnectCall possible only with 2 calls"),!1;var n,i=null;for(n=0;n<S.length;n++)if(!S[n].isHolding()&&S[n].callId===e){i=S[n];break}if(i){var r=i.atcCallInfo.getPosition();for(n=0;n<S.length;n++)if(S[n].isHolding()&&S[n].atcCallInfo.getPosition()===r&&S[n].callId!==e){var o=S[n];return d.reconnect(i,o,t),!0}}return!1},this.ignoreCall=function(e,t){var n=v(e);n.pickupNotification?d.ignoreCall(n,t):t&&t("No pickup call")},this.hideRemoteCall=l.hideRemoteCall,this.dropParticipant=l.dropParticipant,this.addParticipantToCall=l.addParticipantToCall,this.addParticipantToRtcSession=l.addParticipantToRtcSession,this.mute=l.mute,this.unmuteLocally=l.unmuteLocally,this.unmute=l.unmute,this.toggleMute=l.toggleMute,this.muteParticipant=function(t,n,i){if(t&&n){if(i=i||function(){},!N(t))return c.warn("[CallControlSvc]: muteParticipant - There is no local call"),void i("Call invalid");if(n.isMeetingPointInvitee){if(!s)return c.error("[CallControlSvc]: MeetingPointSvc is not initialized"),void i("res_MuteParticipantFailed");s.muteMeetingPoint(n.userId,function(e){e?(c.warn("[CircuitCallControlSvc]: Failed to mute Meeting Point locally"),i("res_MuteParticipantFailed")):l.muteParticipant(t,n,i)})}else l.muteParticipant(t,n,i)}},this.hasUnmutedParticipants=l.hasUnmutedParticipants,this.muteRtcSession=l.muteRtcSession,this.unmuteParticipant=function(e,t,n){if(e&&t){if(n=n||function(){},!N(e))return c.warn("[CallControlSvc]: unmuteParticipant - There is no local call"),void n("Call invalid");if(t.isMeetingPointInvitee){if(!s)return c.error("[CallControlSvc]: MeetingPointSvc is not initialized"),void n("res_UnmuteParticipantFailed");s.unmuteMeetingPoint(t.userId,function(e){e?(c.warn("[CircuitCallControlSvc]: Failed to unmute Meeting Point locally"),n("res_UnmuteParticipantFailed")):n()})}else l.unmuteParticipant(e,t,n)}},this.toggleMuteParticipant=function(e,t,n){if(e&&t)return t.muted?I.unmuteParticipant(e,t,n):I.muteParticipant(e,t,n)},this.toggleVideoParticipant=function(e,t,n){if(e&&t&&t.userId){if(n=n||function(){},!N(e))return c.warn("[CallControlSvc]: toggleVideoParticipant - There is no local call"),void n("Call invalid");if(t.isMeetingPointInvitee){if(!s)return c.error("[CallControlSvc]: MeetingPointSvc is not initialized"),void n("res_StartVideoParticipantFailed");s.toggleVideoMeetingPoint(t.userId,function(e){e?(c.warn("[CallControlSvc]: Failed to toggle video MeetingPoint participant"),n("res_StartVideoParticipantFailed")):n()})}else c.warn("[CallControlSvc]: Cannot toggle video MeetingPoint participant: ",t.userId),n("res_StartVideoParticipantFailed")}},this.stopRingingTone=l.stopRingingTone,this.endActiveCall=l.endActiveCall,this.startRecording=l.startRecording,this.stopRecording=l.stopRecording,this.submitCallQualityRating=l.submitCallQualityRating,this.raiseQuestion=l.raiseQuestion,this.inviteToStage=l.inviteToStage,this.inviteToStageAnswer=l.inviteToStageAnswer,this.inviteToStageCancel=l.inviteToStageCancel,this.removeFromStage=l.removeFromStage,this.getQuestions=l.getQuestions,this.updateQuestionState=l.updateQuestionState,this.openCurtain=l.openCurtain,this.closeCurtain=l.closeCurtain,this.getNodeState=l.getNodeState,this.canSendWebRTCDigits=l.canSendWebRTCDigits,this.sendDigits=function(e,t,n){if(n=n||function(){},!t)return c.warn("[CallControlSvc]: sendDigits invoked without any digit"),void n("No digits");var i=l.findCall(e);i?i.sessionCtrl.canSendDTMFDigits()?l.sendDigits(e,t,n):i.atcCallInfo?d.generateDigits(i,t,function(e){e?n("res_SendDtmfFailed"):n()}):n("res_SendDtmfFailed"):(i=v(e))?d.generateDigits(i,t,n):(c.warn("[CallControlSvc]: SendDigits invoked without a valid call"),n("Call not found"))},this.disableIncomingVideo=l.disableIncomingVideo,this.enableIncomingVideo=l.enableIncomingVideo,this.toggleParticipantPointer=l.toggleParticipantPointer,this.findCall=l.findCall,this.findConversationByCallId=function(e){var t=a.getConversationByRtcSession(e);if(t)return t;for(var n=0;n<S.length;n++)if(S[n].callId===e)return a.getConversationFromCache(S[n].convId);return null},this.sendParticipantPointer=l.sendParticipantPointer,this.sendParticipantDrawing=l.sendParticipantDrawing,this.getCallDevices=d.getCallDevices,this.getPushDevices=d.getPushDevices,this.getAnswerDevices=function(e){if(e&&"object"==typeof e)return d.getAnswerDevices(e);var t=l.findCall(e)||v(e);return d.getAnswerDevices(t)},this.updateActiveCallMediaDevices=l.updateActiveCallMediaDevices,this.addSimulatedParticipants=l.addSimulatedParticipants,this.canStartScreenShare=l.canStartScreenShare,this.addConferenceAsGuest=l.addConferenceAsGuest,this.removeConferenceAsGuest=l.removeConferenceAsGuest,this.testCandidatesCollection=l.testCandidatesCollection,this},e}(Circuit=function(Me){"use strict";var we=Circuit.Enums.AgentState,Ge=Me.AtcCallInfo,He=Me.Enums.AtcMessage,ke=Me.Enums.AtcRegistrationState,Ve=Me.AtcRemoteCall,Fe=Me.BusyHandlingOptions,Be=Me.Enums.CallDirection,xe=Me.Enums.CallState,We=Me.ClientApiHandlerSingleton,Ye=Me.Constants,Ke=Me.Enums.CstaCallState,qe=Me.CstaParser,je=Me.Enums.JournalEntryTypes,Qe=Me.Enums.MissedReasonTypes,Xe=Circuit.PhoneNumberFormatter,ze=Circuit.Enums.RedirectionTypes,Je=Me.RoutingOptions,$e=Me.Enums.Targets,Ze=Me.UserToUserHandlerSingleton,et=Me.Utils,tt=Me.Enums.TransferCallFailedCauses;return Me.CstaSvcImpl=function(c,d,C,E,u,o,s,e){C.debug("New Service: CstaSvc");var a=4e3,l=5e3,T=2e3,p=["connected","hold","queued"],S=["connected","hold"],r="Number not available",I="02000000000000000000000000000000",f=/Forward/,t=3,n=6e4,i=2e3,v=this,R={forwardList:[]},g=Ze.getInstance(),A=We.getInstance(),_=new qe,m=null,N=null,h=null,O=null,D={},y=null,b=[],P={},U={},L=!1,M=!0,w=!0,G={},H={},k=[],V=[],F=!1,B=null,x=null,W=null,Y=null,K=null,q=null,j=null,Q=null,X=!1,z=0,J=0,$=null,Z=null;function ee(t,n,e,i,r){t.setPeerUser(n,i);var o=d(function(){o=null,t.isPresent()&&(r&&r(),r=null)},T,!1);s.startReverseLookUp(e,function(e){d.cancel(o),t.isPresent()&&(e&&t.setPeerUser(n,e.displayName,e.userId),r&&r())})}function te(t,n,i,e,r,o){if(!t.redirectingUser||!t.redirectingUser.redirectionType){t.setRedirectingUser(n,i,e,null,r);var a=d(function(){a=null,t.isPresent()&&(o&&o(),o=null)},T,!1);s.startReverseLookUp(i,function(e){d.cancel(a),t.isPresent()&&(e&&t.setRedirectingUser(n,i,e.displayName,e.userId,r),o&&o())})}}function ne(){if(V.length){var i=V.splice(0,1);s.startPhoneCallSearch(i[0].phoneNumber,function(){var e=s.getUserSearchList().slice(0),t=i[0].call;delete i[0].call;var n=null;(n=1===e.length?t.addParticipant({userId:e[0].userId,phoneNumber:i[0].phoneNumber,displayName:e[0].displayName,participantId:i[0].participantId}):t.addParticipant(i[0]))&&m&&(C.debug("[CstaSvc]: Publish /atccall/participant/added"),E.publish("/atccall/participant/added",[t.callId,n])),d(ne,0)})}else F=!1}function ie(){c.localUser.isATC&&((m=m||e.getCachedTelephonyConversation())||e.getTelephonyConversationPromise().then(function(e){m=e}).catch(function(){C.debug("[CstaSvc]: No telephony conversation found")}),Object.assign(R,o.getAtcRegistrationData()),N=function(){var e=u.getActiveCall();if(e&&e.isTelephonyCall){var t=re(e);if(t)return t;var n=Object.create(e);return n.atcCallInfo=e.atcCallInfo||new Ge,b.push(n),n}}(),h=function(){var e=u.findHeldPhoneCall();if(e){var t=re(e);if(t)return t;var n=Object.create(e);return n.atcCallInfo=e.atcCallInfo||new Ge,b.push(n),n}}(),O=oe(),y=function(){var e=u.getActiveRemoteCall()[0];if(e&&e.isTelephonyCall){var t=re(e);return t||(e.atcCallInfo=e.atcCallInfo||new Ge,b.push(e),e)}}(),0<b.length&&(b=b.filter(function(e){return!e.checkState(xe.Terminated)||(N===e&&(N=null),h===e&&(h=null),O===e&&(O=null),y===e&&(y=null),!1)})),N||O||h||y||b.empty())}function re(e){for(var t=0;t<b.length;t++)if(b[t].callId===e.callId){var n=b[t].atcCallInfo;return e.peerUser.phoneNumber!==b[t].peerUser.phoneNumber&&n.clearServicesPermitted(),(b[t]=e).atcCallInfo&&e.atcCallInfo.cstaConn||(b[t].atcCallInfo=n),b[t]}return null}function oe(){var e=u.getIncomingCall();if(e&&e.isTelephonyCall){var t=re(e);if(t)return t;var n=Object.create(e);return n.atcCallInfo=e.atcCallInfo||new Ge,b.push(n),n}}function ae(e,t){if(D[e]){C.debug("[CstaSvc]: Remove remote call with Call Id = "+e);var n=D[e];!t&&function(e){if(!c.localUser.noCallLog){if(!e)return C.error("[CstaSvc]: No remoteCall");if(!e.atcCallInfo.getIgnoreCall()&&e.isAtcRemote){if(!m)return C.error("[CstaSvc]: No telephony conversation");if(!e.peerUser.phoneNumber&&e.peerUser.displayName===m.peerUser.displayName)return C.warn("[CstaSvc]: This call has no peer display information.");var t=e.atcCallInfo.originalPartnerDisplay&&e.atcCallInfo.originalPartnerDisplay.fqn&&e.atcCallInfo.originalPartnerDisplay.fqn!==e.atcCallInfo.peerFQN,n={phoneNumber:t?e.atcCallInfo.originalPartnerDisplay.dn:e.peerUser.phoneNumber,displayName:t?e.atcCallInfo.originalPartnerDisplay.name:e.peerUser.displayName,userId:t?m.peerUser.userId:e.peerUser.userId||m.peerUser.userId,resolvedUser:!!e.peerUser.userId&&!t,fqn:t?e.atcCallInfo.originalPartnerDisplay.fqn:e.atcCallInfo.peerFQN},i={convId:m.convId,starter:e.direction===Be.INCOMING?n.userId:c.localUser.userId,source:e.direction===Be.INCOMING?n.fqn:c.localUser.phoneNumber,destination:e.direction===Be.OUTGOING?n.fqn:c.localUser.phoneNumber,startTime:e.creationTime,duration:e.establishedTime?Date.now()-e.establishedTime:0,type:0===e.establishedTime?je.MISSED:je.REGULAR,participants:[{userId:c.localUser.userId,type:"USER",phoneNumber:c.localUser.phoneNumber,displayName:c.localUser.displayName},{userId:n.userId,type:"TELEPHONY",phoneNumber:n.phoneNumber,displayName:n.displayName,resolvedUser:n.resolvedUser}]};if(i.type===je.MISSED)switch(e.atcCallInfo.getMissedReason()){case Qe.DEST_OUT_OF_ORDER:i.missedReason=Ye.RTCItemMissed.UNREACHABLE;break;case Qe.REORDER_TONE:i.missedReason=Ye.RTCItemMissed.INVALID_NUMBER;break;case Qe.BUSY:i.missedReason=Ye.RTCItemMissed.USER_BUSY;break;case Qe.CANCELLED:i.missedReason=Ye.RTCItemMissed.CANCELED;break;case Qe.DECLINED:i.missedReason=Ye.RTCItemMissed.DECLINED;break;case Qe.TRANSFERRED:i.type=je.REGULAR;break;default:i.missedReason=Ye.RTCItemMissed.TEMPORARILY_UNAVAILABLE}if(w)A.addJournalEntry(i);else{var r=1e3+1e3*Math.random();d(function(){var e,n;(n=(e=i)&&e.participants&&e.participants[1])&&k.some(function(e,t){if(et.cleanPhoneNumber(e.phoneNumber)===et.cleanPhoneNumber(n.phoneNumber)&&e.displayName===n.displayName)return C.debug("[CstaSvc]: Call log entry already sent by another client"),k.splice(t,1),!0})||A.addJournalEntry(i)},r,!1)}}}}(n),n.setCstaState(Ke.Idle),C.debug("[CstaSvc]: Publish /atccall/info event"),E.publish("/atccall/info",[n]),delete D[e]}}function se(){for(var e in D)D.hasOwnProperty(e)&&ae(e,!0)}function ce(e){for(var t in D)if(D.hasOwnProperty(t)&&D[t].callId===e)return D[t];return null}function le(e){if(!m)return null;var t=Object.create(m);return t.rtcSessionId=e,new Ve(t)}function de(i){var r=i.endpoints;if(r&&!(r.length<2)){var t,o=null,a=r[0].callIdentifier.cID,s=2<r.length?Ke.Conference:Ke.Active;return r.forEach(function(e){if(s)if(ue(e.deviceOnCall)){if(-1===p.indexOf(e.localConnectionState))return void(s=null);var t=Ce(e.deviceOnCall,i.epid);t===$e.WebRTC&&(N||y)?N?o=N:(o=y,t=$e.Other):o=le(a),o.atcCallInfo.setPosition(t),o.atcCallInfo.setCstaConnection(e.callIdentifier),Object.assign(i.servicesPermitted,e.servicesPermitted),"queued"===e.localConnectionState?s=Ke.Parked:"hold"===e.localConnectionState&&(s=2<r.length?Ke.ConferenceHolding:s===Ke.Held?Ke.HoldOnHold:Ke.Holding)}else if(2===r.length){if(-1===S.indexOf(e.localConnectionState))return void(s=null);var n=Ee(e.deviceOnCall);o.atcCallInfo.setPartnerDisplay(n),ee(o,o.atcCallInfo.peerDn,o.atcCallInfo.peerFQN,o.atcCallInfo.peerName),"hold"===e.localConnectionState&&(s=s===Ke.Holding?Ke.HoldOnHold:Ke.Held)}}),i.callingDevice&&i.callingDevice.replace("+","")===c.localUser.phoneNumber.replace("+","")?o.direction=Be.OUTGOING:o.direction=Be.INCOMING,s?(o.atcCallInfo.setServicesPermitted(i.servicesPermitted),o.setCstaState(s),(D[a]=o).atcCallInfo.getPosition()===$e.WebRTC&&v.isPrimaryClient()?(t=o,C.info("[CstaSvc]: Found a hanging WebRTC call"),t.atcCallInfo.setPosition($e.Other),void(t.atcCallInfo.isSeamlessHandoverAllowed()?(C.info("[CstaSvc]: Attempt to recover the hanging call by initiating a Seamless Handover"),he(t,$e[$e.WebRTC.name],null,function(e){e?(C.warn("[CstaSvc]: Failed to move the hanging call. ",e),v.hangupRemote(t)):C.info("[CstaSvc]: Hanging call has been successfully moved")})):(C.info("[CstaSvc]: Clear the hanging call"),v.hangupRemote(t)))):(C.debug("[CstaSvc]: Created new Remote Call object: ",o),o)):void 0}}function ue(e){return!(!e||e.indexOf(R.onsFQN)<0||0<e.indexOf("uid=")||0<e.indexOf("keyId="))}function Ce(e,t){if(C.debug("[CstaSvc]: Get call position for "+e),!ue(e))return C.error("[CstaSvc]: Invalid device ID ("+e+"). Cannot determine position."),$e.Other;var n=$e.Other,i=/ond=(\+?\d+)/.exec(e);if(i&&i[1]){var r=i[1];r===R.osmoFQN?n=t&&t!==R.epid?$e.Other:$e.WebRTC:r===R.cell?n=$e.Cell:r===R.parkingDn&&(n=$e.Queue)}else n=$e.Desk;return C.debug("[CstaSvc]: Call position is:",n.name),n}function Ee(e){var t={fqn:"",dn:r,name:""};if(e){var n=/N<([^>]*)>([^;]*)((?:[^;]*;)*(?:displayNumber=(\d*)))?(?:;.*)*/,i=n.exec(e);i?(t.fqn=i[1]||"",t.name=i[2]||"",t.dn=i[4]||i[1]||"Number not available"):(i=(n=/N([^;]*)/).exec(e))?(t.fqn=i[1]||"",t.dn=i[1]||"Number not available"):(t.fqn=e,t.dn=e)}return C.debug("[CstaSvc]: Retrieved partner display: ",t),t}function Te(e){ie();for(var t=u.getPhoneCalls(),n=[],i=0;i<t.length;i++)if(t[i].atcCallInfo&&t[i].atcCallInfo.getCstaCallId()){if(t[i].atcCallInfo.getCstaCallId()===e)return N=t[i]}else{var r=t[i].getRedirectingUser();t[i].atcCallInfo=new Ge,r&&(t[i].atcCallInfo.redirectingUser=r),n.push(t[i])}return O&&O.atcCallInfo.getCstaCallId()===e?O:(O&&!O.atcCallInfo.getCstaCallId()&&n.push(O),n[0])}function pe(){se(),ie(),v.snapshotDevice(function(e,t){if(L=!0,e)-1<e.indexOf("deviceOutOfService")&&(M=!0,E.publish("/csta/deviceChange"));else if(M=!1,E.publish("/csta/deviceChange"),t.activeCalls)try{t.activeCalls.forEach(function(e){e.localCallState.length<2||(2!==e.localCallState.length||-1!==p.indexOf(e.localCallState[0])&&-1!==S.indexOf(e.localCallState[1]))&&v.snapshotCall(e.connectionId,function(e,t){if(!e&&t){var n=de(t);n&&(C.debug("[CstaSvc]: Publish /atccall/info event"),E.publish("/atccall/info",[n]))}})})}catch(e){C.error(e)}})}function Se(){pe(),v.getForwarding(Ue),v.getAgentState(Le)}function Ie(e,t,n){var i=R.onsFQN+";ond=";switch(e){case $e.WebRTC:i+=n?R.osmoFQN:R.osmoFQN+";epid="+R.epid;break;case $e.Cell:if(!R.cell)return C.error("[CstaSvc]: Cell phone is not configured"),null;i+=R.cell;break;case $e.Desk:i+=R.onsFQN;break;case $e.VM:i=R.vm;break;case $e.Other:t?i+=t:i=R.vm;break;default:return C.error("[CstaSvc]: Invalid target: "+e),null}return i}function fe(e){return Object.assign(R,o.getAtcRegistrationData()),!(!c.localUser.cstaNumber||!R)||(e&&e("There is no registered user."),!1)}function ve(i,r){var e=_.genCstaRequest(i);if(!e)return C.error("[CstaSvc]: Failed to build CSTA request: "+i.request),void(r&&r("Failed to send the request"));if(W===ke.Registered){var t={content:{type:He.CSTA,phoneNumber:c.localUser.cstaNumber,CSTA:e},destUserId:c.localUser.associatedTelephonyUserID};g.sendAtcRequest(t,function(t,n){c.$apply(function(){if(t)C.warn("[CstaSvc]: ",t),r&&r(t);else{var e=_.parseResponse(i.request,n.CSTA);e||""===e?e.error?("Operation Error"===e.errorCategory&&"invalidConnectionID"===e.errorValue&&"busy"!==i.reason&&"AcceptCall"!==i.request&&"DeflectCall"!==i.request&&pe(),r&&r(e.errorCategory+" - "+e.errorValue)):r&&r(null,e):r&&r("Failed to parse response from server")}})})}else r&&r("Client is not registered with ATC")}function Re(e,t){var n,i,r,o;t.transferredCall&&!t.seamlessHandover&&(U[e]={newCallId:t.transferredCall.cID,failedCallId:(n=t.transferredCall.cID,r=(parseInt(n.substring(0,2),16)+2).toString(16).toUpperCase(),o=n.substring(2),i=r.length<2?"0"+r+o:r+o,C.debug("[CstaSvc]: FailedCallId to be tracked: "+i),i),timeout:d(function(){delete U[e]},a)})}function ge(e,t){return!(!e||!fe()||t!==$e.Other&&e.atcCallInfo.position===t||!(n=ye(),R&&R.vm&&n.push($e.VM),n.push($e.Other),n).includes(t)&&(C.error("[CstaSvc]: isTargetAllowed invoked with invalid target: "+t),1));var n}function Ae(){C.debug("[CstaSvc]: Synchronize the selected routing option"),v.updateRoutingOption(c.localUser.selectedRoutingOption)}function _e(e){var t,n,i=Te(e.connection.cID);if(i)i.direction===Be.OUTGOING&&f.test(e.cause)&&(te(i,(t=Ee(e.divertingDevice)).dn,t.fqn,t.name,ze.CallForward),n=Ee(e.newDestination),i.setPeerUser(n.dn,n.name));else if("distributed"===e.cause&&ue(e.divertingDevice)&&Ce(e.newDestination)===$e.Desk)C.debug("[CstaSvc]: Ignore Diverted event with cause = distributed and newDestination = desk");else{if(i=D[e.connection.cID]){if(i.atcCallInfo.masterParallelHgCall)return void C.debug("[CstaSvc]: Ignore Diverted event for master parallel hunt group")}else i=le(e.connection.cID);if("null"===e.localConnectionInfo&&ue(e.divertingDevice)){if(ue(e.newDestination)){if(ue(e.newDestination)){if(i){if(i.pickupNotification)return;if("redirected"===e.cause&&e.lastRedirectionDevice&&!ue(e.lastRedirectionDevice)){var r=Ee(e.lastRedirectionDevice);te(i,r.dn,r.fqn,r.name,ze.CallForward),D[e.connection.cID]=i}if(i.forwarded)return;if(i.checkCstaState(Ke.Ringing)&&Ce(e.newDestination)===i.atcCallInfo.getPosition())return void C.debug("[CstaSvc]: new destination has the same position as the current alerting position. Ignore event");i.atcCallInfo.setIgnoreCall(!0),C.debug("[CstaSvc]: Publish /atccall/info event"),E.publish("/atccall/info",[i])}Ce(e.newDestination)===$e.WebRTC&&(G={cID:e.connection.cID,dID:e.newDestination})}}else{if(((s=e.newDestination)&&Ee(s).dn===R.vm||Ce(e.connection.dID)===$e.WebRTC)&&i.atcCallInfo.setIgnoreCall(!0),i.setCstaState(Ke.Idle),i.direction=Be.INCOMING,i.atcCallInfo.setMissedReason(Qe.CANCELLED),f.test(e.cause)){D[e.connection.cID]=i;var o=Ee(e.callingDevice);C.debug("[CstaSvc]: Update partner display to ",o),i.atcCallInfo.setPartnerDisplay(o),ee(i,i.atcCallInfo.peerDn,i.atcCallInfo.peerFQN,i.atcCallInfo.peerName)}C.debug("[CstaSvc]: Publish /atccall/info event"),E.publish("/atccall/info",[i])}i&&!i.isHandoverInProgress&&ae(e.connection.cID)}else if(!ue(e.divertingDevice)&&i){var a=Ee(e.divertingDevice);if(a&&i.atcCallInfo.setOriginalPartnerDisplay(a),i.direction===Be.OUTGOING&&f.test(e.cause))return te(i,(t=Ee(e.divertingDevice)).dn,t.fqn,t.name,ze.CallForward),n=Ee(e.newDestination),void i.setPeerUser(n.dn,n.name);i.atcCallInfo.setMissedReason(Qe.CANCELLED),C.debug("[CstaSvc]: Publish /atccall/info event"),E.publish("/atccall/info",[i])}var s}}function me(e,t){H&&H.newCallId===t&&(e.direction=H.direction,te(e,H.redirectingUser.phoneNumber,H.redirectingUser.fqNumber,H.redirectingUser.displayName,H.redirectingUser.redirectionType),e.atcCallInfo.transferCb=H.transferCb,delete H.transferCb,H={})}function Ne(e){if($)return C.warn("[CstaSvc]: Queue new forwarding request until loop detected timer expires"),void(Z=e);Date.now()-z<i?J++:J=0,z=Date.now(),C.debug("[CstaSvc]: Forward loop counter: "+J+" timestamp: "+z),t<J?(C.error("[CstaSvc]: Loop detected while trying to update forwarding data."),Z=e,$=d(function(){C.debug("[CstaSvc]: Loop detection timeout has expired. Process queued request."),J=0,$=null,Z&&Z(),Z=null},n,!1)):e&&e()}function he(n,t,e,i){if(fe(i))if(n.atcCallInfo&&(n.checkCstaState([Ke.Active])||n.atcCallInfo.isHandoverAllowed()||n.atcCallInfo.isDeflectAllowed()))if(ge(n,t)){var r=Ie(t,e);if(r){var o={autoAnswer:t===$e.Desk||t===$e.WebRTC};n.checkCstaState([Ke.Ringing,Ke.Parked])?(o.request="DeflectCall",o.callToBeDiverted=n.atcCallInfo.getCstaConnection(),o.newDestination=r,c.localUser.isOSV||(C.debug("[CstaSvc]: Publish /csta/handover event"),E.publish("/csta/handover",n.atcCallInfo.getCstaCallId())),n.setAtcHandoverInProgress(),ve(o,function(e){e?(i&&i("res_MoveCallFailed"),n.clearAtcHandoverInProgress(),c.localUser.isOSV||(C.debug("[CstaSvc]: Publish /atccall/moveFailed event"),E.publish("/atccall/moveFailed",[!0]))):(c.localUser.isOSV&&(C.debug("[CstaSvc]: Publish /csta/handover event"),E.publish("/csta/handover",n.atcCallInfo.getCstaCallId())),t===$e.WebRTC&&n.atcCallInfo.setIgnoreCall(!0),n.atcCallInfo.transferCb=i)})):(o.request="SingleStepTransferCall",o.activeCall=n.atcCallInfo.getCstaConnection(),o.transferredTo=r,o.seamlessHandover=n.atcCallInfo.isSeamlessHandoverAllowed(),c.localUser.isOSV||(C.debug("[CstaSvc]: Publish /csta/handover event"),E.publish("/csta/handover",n.atcCallInfo.getCstaCallId())),n.setAtcHandoverInProgress(),ve(o,function(e,t){e||!t?(i&&i("res_MoveCallFailed"),n.clearAtcHandoverInProgress(),c.localUser.isOSV||(C.debug("[CstaSvc]: Publish /atccall/moveFailed event"),E.publish("/atccall/moveFailed",[!0]))):(Re(o.activeCall.cID,t),H={primaryCallId:o.activeCall.cID,newCallId:t.transferredCall.cID,direction:n.direction,redirectingUser:n.redirectingUser,transferCb:i},c.localUser.isOSV&&(C.debug("[CstaSvc]: Publish /csta/handover event"),E.publish("/csta/handover",n.atcCallInfo.getCstaCallId())),n.atcCallInfo.transferCb=i)}))}else i&&i("Failed to create new destination.")}else i&&i("The selected target is not available for this call.");else i&&i("res_MoveCallFailed")}function Oe(e,t){var n=le(e.dialedDn);ee(n,e.dialedDn,e.dialedDn,e.toName),n.setCstaState(Ke.Delivered),n.direction=Be.OUTGOING,n.atcCallInfo.setPosition(t);var i={dn:e.dialedDn,fqn:e.dialedDn,name:e.toName||""};n.atcCallInfo.setPartnerDisplay(i),n.atcCallInfo.setIgnoreCall(!0),D[e.dialedDn]=n,C.debug("[CstaSvc]: Publish /atccall/info event"),E.publish("/atccall/info",[n]),C.debug("[CstaSvc]: Created new Remote Call object: ",n)}function De(e,t,n){var i=ce(t.dialedDn);if(i)i.atcCallInfo.setCstaConnection(e),i.setCallIdForTelephony(e.cID),i.setCstaState(Ke.Delivered),i.atcCallInfo.setIgnoreCall(!1),t.dtmfDigits&&(i.dtmfDigits=t.dtmfDigits),delete D[t.dialedDn];else{ee(i=le(e.cID),t.dialedDn,t.dialedDn,t.toName),i.setCstaState(Ke.Delivered),i.direction=Be.OUTGOING,i.atcCallInfo.setCstaConnection(e),i.atcCallInfo.setPosition(n);var r={dn:t.dialedDn,fqn:t.dialedDn,name:t.toName||""};i.atcCallInfo.setPartnerDisplay(r)}D[e.cID]=i,C.debug("[CstaSvc]: Publish /atccall/info event"),E.publish("/atccall/info",[i]),C.debug("[CstaSvc]: Created new Remote Call object: ",i)}function ye(){var e=[];return Me.WebRTCAdapter.enabled&&e.push($e.WebRTC),M||e.push($e.Desk),R&&R.cell&&e.push($e.Cell),e}function be(e){var t=e.atcCallInfo&&e.atcCallInfo.getCstaConnection()||G;w&&ve({request:"DeflectCall",callToBeDiverted:t,newDestination:Ie($e.Desk)})}function Pe(n){var i=null;if(c.localUser.selectedBusyHandlingOption!==Fe.DefaultRouting.name){var r=n.atcCallInfo&&n.atcCallInfo.getCstaConnection()||G;if(w){switch(c.localUser.selectedBusyHandlingOption){case Fe.SendToAlternativeNumber.name:i={request:"DeflectCall",callToBeDiverted:r,newDestination:Ie($e.Cell)};break;case Fe.BusySignal.name:i={request:"ClearConnection",connectionToBeCleared:r,reason:"busy"};break;case Fe.SendToVM.name:i={request:"DeflectCall",callToBeDiverted:r,newDestination:Ie($e.VM)};break;default:return}ve(i,function(e){if(!e&&"ClearConnection"===i.request)if(n.atcCallInfo)n.atcCallInfo.setMissedReason(Qe.BUSY),n.checkCstaState(Ke.Offered)&&n.setCstaState(Ke.Failed);else if(o.isClearConnectionBusySupported()){var t=D[r.cID]||le(r.cID);t.peerUser=n.peerUser,t.direction=Be.INCOMING,t.creationTime=n.creationTime,t.atcCallInfo.setMissedReason(Qe.BUSY),D[r.cID]=t,ae(r.cID)}}),G={}}}else n.checkCstaState(Ke.Offered)&&(ve(i={request:"AcceptCall",callToBeAccepted:n.atcCallInfo.getCstaConnection()}),G={})}function Ue(e,t){!e&&t&&(c.localUser.callForwardingAvailable=!c.localUser.isOSV,t.forwardList&&0<t.forwardList.length&&t.forwardList.forEach(function(e){"forwardImmediate"===e.forwardingType&&(c.localUser.callForwardingAvailable=!0,e.forwardDN!==R.vm?(c.localUser.callForwardingNumber=Xe.format(e.forwardDN),c.localUser.callForwardingEnabled=e.forwardStatus):c.localUser.callForwardingToVMEnabled=e.forwardStatus)}),R.forwardList=t.forwardList||[],t.hasOwnProperty("voicemailActive")&&(c.localUser.voicemailPBXEnabled=!0,c.localUser.voicemailActive=t.voicemailActive,c.localUser.voicemailRingDuration=t.voicemailRingDuration,K=t.voicemailRingDuration),t.mainRingDuration&&(c.localUser.ringDurationEnabled=!0,c.localUser.mainRingDuration=t.mainRingDuration,c.localUser.clientRingDuration=t.clientRingDuration,c.localUser.cellRingDuration=t.cellRingDuration,q=t.mainRingDuration,j=t.clientRingDuration,Q=t.cellRingDuration,c.localUser.alternativeNumber=t.alternativeNumber||et.cleanPhoneNumber(c.localUser.reroutingPhoneNumber),c.localUser.routeToCell=t.routeToCell,t.hasOwnProperty("overrideProfile")&&(c.localUser.ringDurationConfigurable=t.overrideProfile)),C.debug("[CstaSvc]: Publish /localUser/update event"),E.publish("/localUser/update",[c.localUser]),C.debug("[CstaSvc]: Publish /csta/getForwardingResponse"),E.publish("/csta/getForwardingResponse"),Ae())}function Le(e,t){!e&&t&&(c.localUser.isAgent=t.loggedOnState,c.localUser.isAgent&&(c.localUser.agentStateReady=t.agentState===we.Ready,C.debug("[CstaSvc]: Publish /agent/state/ready event"),E.publish("/agent/state/ready",[c.localUser.agentStateReady])))}return g.on("ATC.CSTA",function(e){C.info("[CstaSvc]: Received CSTA event: ",e),e.type===He.CSTA&&e.CSTA&&c.$apply(function(){!function(e){var t=_.parseEvent(e);if(t)switch(C.debug("[CstaSvc]: Parsed CSTA Event: ",t),t.category){case"CallControl":case"CallAssociatedFeature":v.handleCallEvent(t);break;case"LogicalDeviceFeature":v.handleLogicalDeviceEvent(t);break;case"PhysicalDeviceFeature":break;case"DeviceMaintenance":v.handleDeviceEvent(t);break;default:C.debug("[CstaSvc]: Unsupported CSTA Event category: "+t.category)}}(e.CSTA)})}),g.on("ATC.PRIMARYCLIENT",function(e){var t;C.info("[CstaSvc]: Received PRIMARYCLIENT event:",e),e.type===He.PRIMARYCLIENT&&e.primaryClientId&&(t=e.primaryClientId,c.localUser.clientId!==t?(C.debug("[CstaSvc]: This is not the Primary ATC client"),w=!1):(C.debug("[CstaSvc]: This is the primary ATC client"),w=!0))}),g.on("ATC.ADVANCING",function(e){if(e.type===He.ADVANCING){C.debug("[CstaSvc]: Received UserToUser ATC.ADVANCING");var t=u.getIncomingCall(e.rtcSessionId);t&&(H={newCallId:t.atcCallInfo.getCstaCallId(),direction:t.direction,redirectingUser:t.redirectingUser})}}),E.subscribe("/atcRegistration/state",function(e){C.debug("[CstaSvc]: Received /atcRegistration/state event."),W=e,c.localUser.isATC&&(!L&&e===ke.Registered&&X?Se():L=!1,e!==ke.Registered&&se())}),E.subscribe("/activeSessions/received",function(){C.debug("[CstaSvc]: Received /activeSessions/received event"),X=!0,L||W===ke.Registered&&Se()}),E.subscribe("/registration/state",function(e){C.debug("[CstaSvc]: Received /registration/state event"),e!==RegistrationState.Registered&&(X=!1)}),E.subscribe("/call/incoming",function(e){e&&m&&e.convId===m.convId&&(C.debug("[CstaSvc]: Received /call/incoming event."),Object.keys(D).some(function(e){var t=D[e];if(t.checkCstaState(Ke.Ringing)&&t.atcCallInfo.getPosition()===$e.WebRTC)return(O=oe())&&(C.debug("[CstaSvc]: Found a matching ATC remote call. Move call info to alerting call."),O.atcCallInfo=t.atcCallInfo,t.atcCallInfo=new Ge,t.atcCallInfo.setIgnoreCall(!0),ae(e)),!0}))}),E.subscribe("/atccall/firstcall",function(e){C.debug("[CstaSvc]: Received /atccall/firstcall event"),be(e)}),E.subscribe("/atccall/secondcall",function(e){C.debug("[CstaSvc]: Received /atccall/secondcall event."),Pe(e)}),E.subscribe("/conversation/item/add",function(e){e&&m&&e.convId===m.convId&&e.rtc&&e.rtc.rtcParticipants&&2===e.rtc.rtcParticipants.length&&(k.unshift("TELEPHONY"===e.rtc.rtcParticipants[0].type?e.rtc.rtcParticipants[0]:e.rtc.rtcParticipants[1]),2<k.length&&k.pop())}),E.subscribe("/call/ended",function(e){e&&e.isTelephonyCall&&!e.isRemote&&(B=e,d.cancel(x),x=d(function(){x=B=null},2e3)),ie()}),E.subscribe("/routing/alternativeNumber/changed",function(){C.debug("[CstaSvc]: Received /routing/alternativeNumber/changed event"),Ae()}),E.subscribe("/localUser/update",function(){c.localUser.isATC&&(C.debug("[CstaSvc]: Received /localUser/update event"),Ae())}),this.alternate=function(t,n,i){if(fe(i))if(t&&n){t.setRetrieveInProgress(),n.setHoldInProgress();var e={request:"AlternateCall"};e.activeCall=n.atcCallInfo.getCstaConnection(),e.heldCall=t.atcCallInfo.getCstaConnection(),ve(e,function(e){e?(t.clearRetrieveInProgress(),n.clearHoldInProgress(),i&&i("res_RetrieveCallFailed")):i&&i(null)})}else i&&i("Invalid calls to alternate")},this.conference=function(e,t,n){if(fe(n))if(e&&t){var i={request:"ConferenceCall"};i.activeCall=t.atcCallInfo.getCstaConnection(),i.heldCall=e.atcCallInfo.getCstaConnection(),ve(i,function(e,t){!e&&t||n&&n("res_MergeCallFailed")})}else n&&n("Invalid calls to conference")},this.answer=function(t,e){if(fe(e)){var n=ce(t);if(!n){if(!O||!O.atcAdvancing)return void(e&&e("There is no call to be answered"));var i=(n=O).atcCallInfo.getCstaConnection();i.dID=R.onsFQN,n.atcCallInfo.setCstaConnection(i)}var r=n.atcAdvancing?$e.Desk:n.atcCallInfo.getPosition(),o=Object.values(D).find(function(e){return e.callId!==t&&e.atcCallInfo.getPosition()===r});o?v.alternate(n,o,e):ve({request:"AnswerCall",callToBeAnswered:n.atcCallInfo.getCstaConnection()},e)}},this.pickupCall=function(e,t,n){if(fe(n)){var i=ce(e);i&&i.pickupNotification?(ve({request:"GroupPickupCall",newDestination:Ie(t=t||$e.WebRTC)},n),C.debug("[CstaSvc]: Publish /atccall/pickUpInProgress"),E.publish("/atccall/pickUpInProgress",[i]),i.setAtcHandoverInProgress()):n&&n("There is no call to be picked up")}},this.clearTransferredCall=function(e){U[e]&&(d.cancel(U[e].timeout),delete U[e])},this.consultationTransfer=function(e,t,n){fe(n)&&ve({request:"TransferCall",heldCall:t.atcCallInfo.getCstaConnection(),activeCall:e.atcCallInfo.getCstaConnection()},function(e,t){e||!t?n&&n(tt.Unreachable.ui):n&&n(null)})},this.deflect=function(e,t,n,i){if(fe(i)){var r=Te(e)||u.getIncomingCall()||ce(e);if(r)if(ge(r,t))if(r.atcAdvancing&&t===$e.Desk)v.answer(e,i);else{var o=Ie(t,n);o?ve({request:"DeflectCall",callToBeDiverted:r.atcCallInfo.getCstaConnection(),newDestination:o,autoAnswer:t===$e.Desk||t===$e.WebRTC},function(e){e?i&&i("res_MoveCallFailed"):t!==$e.VM&&r.setAtcHandoverInProgress()}):i&&i("Failed to create new destination.")}else i&&i("The selected target is not available for this call.");else i&&i("There is no call to be deflected")}},this.generateDigits=function(e,t,n){fe(n)&&ve({request:"GenerateDigits",connectionToSendDigits:e.atcCallInfo.getCstaConnection(),charactersToSend:t},n)},this.getDoNotDisturb=function(e){fe(e)&&ve({request:"GetDoNotDisturb",device:R.ons},e)},this.getForwarding=function(e){fe(e)&&ve({request:"GetForwarding",device:c.localUser.isOSV?et.normalizeDn(R.onsFQN):R.onsFQN},e)},this.getMessageWaiting=function(e){fe(e)&&ve({request:"GetMessageWaitingIndicator",device:R.ons},e)},this.getTransferredCall=function(e){return U[e]},this.pullRemoteCall=function(e,t,n){var i=ce(e);i?i.pickupNotification?v.pickupCall(e,null,n):he(i,$e[$e.WebRTC.name],null,n):(C.warn("[CstaSvc]: pullRemoteCall invoked without a valid call"),n("No active remote call"))},this.pushLocalCall=function(e,t,n){ie();var i=N&&N.callId===e?N:h&&h.callId===e?h:null;i?he(i,$e[t],null,n):(C.warn("[CstaSvc]: pushLocalCall invoked without a valid call"),n("No active local call"))},this.endRemoteCall=function(e,t){var n=ce(e);n?this.hangupRemote(n,t):(C.warn("[CstaSvc]: endRemoteCall invoked without a valid call"),t("No active remote call"))},this.hangupRemote=function(t,n){t.isRemote&&fe(n)&&ve({request:"ClearConnection",connectionToBeCleared:t.atcCallInfo.getCstaConnection()},function(e){e?n&&n(e):(t.getCstaState().established||t.atcCallInfo.getMissedReason()||(t.direction===Be.INCOMING?t.atcCallInfo.setMissedReason(Qe.DECLINED):t.atcCallInfo.setMissedReason(Qe.CANCELLED),ae(t.atcCallInfo.getCstaCallId())),n&&n())})},this.hold=function(t,n){if(fe(n)){var e={request:"HoldCall",callToBeHeld:t.atcCallInfo.getCstaConnection()};t.setHoldInProgress(),ve(e,function(e){e?(t.clearHoldInProgress(),n&&n("res_HoldCallFailed")):n&&n(null)})}},this.reconnect=function(e,t,n){fe(n)&&ve({request:"ReconnectCall",heldCall:t.atcCallInfo.getCstaConnection(),activeCall:e.atcCallInfo.getCstaConnection()},n)},this.retrieve=function(t,n){if(fe(n)){var e={request:"RetrieveCall",callToBeRetrieved:t.atcCallInfo.getCstaConnection()};t.setRetrieveInProgress(),ve(e,function(e){e?(t.clearRetrieveInProgress(),n&&n("res_RetrieveCallFailed")):n&&n(null)})}},this.setDoNotDisturb=function(e,t){fe(t)&&ve({request:"SetDoNotDisturb",device:R.ons,doNotDisturbOn:e},t)},this.setForwarding=function(e,t){fe(t)&&ve({request:"SetForwarding",device:c.localUser.isOSV?et.normalizeDn(R.onsFQN):R.onsFQN,activateForward:e.activateForward,forwardDN:e.forwardDN||"",forwardingType:e.forwardingType,ringCount:e.ringCount},t)},this.snapshotCall=function(e,t){fe(t)&&ve({request:"SnapshotCall",snapshotObject:e},t)},this.snapshotDevice=function(e){fe(e)&&ve({request:"SnapshotDevice",snapshotObject:R.onsFQN,osmo:R.osmo},e)},this.transfer=function(e,t,n){if(fe(n)){var i={};e.checkCstaState([Ke.Ringing,Ke.Parked])?(i.request="DeflectCall",i.callToBeDiverted=e.atcCallInfo.getCstaConnection(),i.newDestination=t,ve(i,n)):(i.request="SingleStepTransferCall",i.activeCall=e.atcCallInfo.getCstaConnection(),i.transferredTo=t,ve(i,function(e,t){if(e||!t){if(e&&-1!==e.indexOf("internalResourceBusy"))return Re(i.activeCall.cID,{transferredCall:{cID:"00000000000000000000000000000000"}}),void(n&&n(null));n&&n(tt.Unreachable.ui)}else Re(i.activeCall.cID,t),n&&n(null)}))}},this.consultationCall=function(n,i,r){if(fe(r)&&i){var e={request:"ConsultationCall"};e.consultedDevice=i.dialedDn,e.existingCall=n.atcCallInfo.getCstaConnection(),Oe(i,n.atcCallInfo.getPosition());var o=D[i.dialedDn];ve(e,function(e,t){if(e||!t){if(r&&r("res_MakeCallFailed"),e.endsWith("invalidCalledDeviceID"))o.atcCallInfo.setMissedReason(Qe.REORDER_TONE);else{if(e.endsWith("requestIncompatibleWithCallingDevice")||e.endsWith("invalidDeviceID"))return;o.atcCallInfo.setMissedReason(Qe.DEST_OUT_OF_ORDER)}o.atcCallInfo.setIgnoreCall(!1),ae(i.dialedDn)}else De(t.iC,i,n.atcCallInfo.getPosition()),r&&r()})}},this.makeCall=function(n,i,r){if(fe(r)&&i){var e={request:"MakeCall"};e.calledDirectoryNumber=i.dialedDn,e.callingDevice=Ie(n),e.autoOriginate=n===$e.Desk||n===$e.WebRTC?"doNotPrompt":"prompt",Oe(i,n);var o=D[i.dialedDn];ve(e,function(e,t){if(e||!t){if(r&&r("res_MakeCallFailed"),e.endsWith("invalidCalledDeviceID"))o.atcCallInfo.setMissedReason(Qe.REORDER_TONE);else{if(e.endsWith("requestIncompatibleWithCallingDevice")||e.endsWith("invalidDeviceID"))return;o.atcCallInfo.setMissedReason(Qe.DEST_OUT_OF_ORDER)}o.atcCallInfo.setIgnoreCall(!1),ae(i.dialedDn)}else De(t.caD,i,n),r&&r()})}},this.ignoreCall=function(e,t){ae(e.callId),t&&t()},this.callBackCallRelated=function(e,t){fe(t)&&ve({request:"CallBackCallRelated",callBackConnection:e.atcCallInfo.getCstaConnection()},t)},this.callBackNonCallRelated=function(e,t){fe(t)&&ve({request:"CallBackNonCallRelated",orD:R.onsFQN,tD:e},t)},this.cancelCallBack=function(e,t){fe(t)&&ve({request:"CancelCallBack",orD:R.onsFQN,td:e||void 0},t)},this.setMicrophoneMute=function(e,t){fe(t)&&ve({request:"SetMicrophoneMute",device:R.ons,mute:e},t)},this.getMicrophoneMute=function(e){fe(e)&&ve({request:"GetMicrophoneMute",device:R.ons},e)},this.callLogSnapShot=function(e){fe(e)&&ve({request:"CallLogSnapShot",device:R.ons},e)},this.snapshot=function(){pe()},this.getAgentState=function(e){fe(e)&&ve({request:"GetAgentState",device:R.onsFQN},e)},this.setAgentState=function(e,t){(e=!!e)!==c.localUser.agentStateReady&&fe(t)&&ve({request:"SetAgentState",device:R.onsFQN,state:e?we.Ready:we.NotReady},t)},this.handleCallEvent=function(e){var t,n,i;if(e)if(ie(),L)try{switch(e.name){case"CallInformationEvent":!function(e){var t=e.connection.cID,n=null;if(e.device&&e.device.includes("Pickup Group Number")){if(!c.circuitLabs.GROUP_PICKUP||u.getActiveCall())return C.debug("[CstaSvc]: Ignore group pickup notification");n=D[t];var i=Ee(e.connection.dID),r=Ee(e.callingDevice);n?(C.debug("[CstaSvc]: Existing pickup call for: ",i.dn),n.atcCallInfo.setCstaConnection(e.connection)):(C.debug("[CstaSvc]: New pickup call for: ",i.dn),(n=le(t)).atcCallInfo.setPosition($e.Other),n.atcCallInfo.setPartnerDisplay(r),ee(n,n.atcCallInfo.peerDn,n.atcCallInfo.peerFQN,n.atcCallInfo.peerName),n.atcCallInfo.setServicesPermitted(e.servicesPermitted),n.setCstaState(Ke.Ringing),n.direction=Be.INCOMING,n.atcCallInfo.setCstaConnection(e.connection),te(n,i.dn,i.fqn,i.name,ze.CallPickupNotification),n.atcCallInfo.setOriginalPartnerDisplay(i),D[t]=n,C.debug("[CstaSvc]: Publish /atccall/info event"),E.publish("/atccall/info",[n]))}else if(n=Ce(e.connection.dID,e.epid)===$e.WebRTC?Te(t):D[t]){if(n.atcCallInfo.setCstaConnection(e.connection),e.callingDevice&&!ue(e.callingDevice)){var o=Ee(e.callingDevice);n.atcCallInfo.setPartnerDisplay(o),ee(n,n.atcCallInfo.peerDn,n.atcCallInfo.peerFQN,n.atcCallInfo.peerName)}e.servicesPermitted&&(n.atcCallInfo.setServicesPermitted(e.servicesPermitted),e.servicesPermitted.eSP&&e.servicesPermitted.eSP.sST&&(n.checkCstaState(Ke.ConferenceHolding)?n.setCstaState(Ke.Holding):n.checkCstaState(Ke.Conference)&&n.setCstaState(Ke.Active))),n.checkCstaState([Ke.Offered,Ke.ExtendedRinging,Ke.Idle])?C.debug("[CstaSvc]: Do not publish /atccall/info event at Offered state"):(C.debug("[CstaSvc]: Publish /atccall/info event"),E.publish("/atccall/info",[n]))}else C.warn("[CstaSvc]: Could not find call corresponding to CallInformation Event.")}(e);break;case"ConferencedEvent":!function(e){e.secondaryOldCall&&ae(e.secondaryOldCall.cID);var a=null,s=e.primaryOldCall.cID,t=Ce(e.primaryOldCall.dID,e.epid);(a=t===$e.WebRTC?Te(s):D[s])?(e.conferenceConnections.forEach(function(e){if(e.endpoint&&ue(e.endpoint)||e.connection&&ue(e.connection.dID)){if(a.atcCallInfo.setCstaConnection(e.connection),a.isAtcRemote){var t=a.atcCallInfo,n=a.peerUser,i=a.participants,r=a.direction;a.setCstaState(Ke.Idle),C.debug("[CstaSvc]: Publish /atccall/info event"),E.publish("/atccall/info",[a]),delete D[s],(a=le(e.connection.cID)).atcCallInfo=t,a.peerUser=n,a.participants=i,a.direction=r,D[e.connection.cID]=a}C.info("[CstaSvc]: Updated the CSTA connection ID for the call: ",e.connection)}else{var o=e.endpoint&&Ee(e.endpoint)||Ee(e.connection.dID);V.push({call:a,userId:e.connection.dID,participantId:e.connection.dID,phoneNumber:o.dn,displayName:o.name}),F||(F=!0,ne())}}),"hold"===e.localConnectionInfo?a.setCstaState(Ke.ConferenceHolding):a.setCstaState(Ke.Conference),a.atcCallInfo.setServicesPermitted(e.servicesPermitted),C.debug("[CstaSvc]: Publish /atccall/info event"),E.publish("/atccall/info",[a])):C.debug("[CstaSvc]: Could not find a call with Call Id = "+s)}(e);break;case"ConnectionClearedEvent":!function(t){var e=t.droppedConnection.cID,n=Te(e)||D[e];if(G={},n){if(n.pickupNotification&&n.isHandoverInProgress)return;if("null"!==t.localConnectionInfo){if(C.info("[CstaSvc]: Local connection info is not null.Update services permitted."),n.atcCallInfo.setServicesPermitted(t.servicesPermitted),1<n.participants.length&&(n.participants.some(function(e){if(e.participantId===t.droppedConnection.dID)return n.removeParticipant(e.userId),!0}),1===n.participants.length&&n.isRemote||2===n.participants.length&&!n.isRemote)){var i=n.participants[n.isRemote?0:1];n.removeParticipant(i.userId),ee(n,i.phoneNumber,i.phoneNumber,i.displayName),n.checkCstaState(Ke.Conference)?n.setCstaState(Ke.Active):n.checkCstaState(Ke.ConferenceHolding)&&n.setCstaState(Ke.Holding)}return n.atcCallInfo.getMissedReason()||n.establishedTime||(n.direction===Be.INCOMING?n.atcCallInfo.setMissedReason(ue(t.releasingDevice)?Qe.DECLINED:Qe.CANCELLED):n.atcCallInfo.setMissedReason(ue(t.releasingDevice)?Qe.CANCELLED:Qe.DECLINED)),C.debug("[CstaSvc]: Publish /atccall/info event"),E.publish("/atccall/info",[n])}if(C.info("[CstaSvc]: Local connection info is null."),n.atcCallInfo.getMissedReason()||n.establishedTime||n.atcCallInfo.setMissedReason(n.direction===Be.INCOMING&&"normalClearing"===t.cause?Qe.DECLINED:Qe.CANCELLED),n.clearAtcHandoverInProgress(),n.checkCstaState(Ke.Busy)&&n.atcCallInfo.isCallBackAllowed())return d(function(){C.debug("[CstaSvc]: Callback presenting timer expired - terminate call"),ae(n.atcCallInfo.getCstaCallId())},l)}var r=P[t.droppedConnection.cID]||P[I];r&&((n=le(r)).atcCallInfo.setCstaConnection(t.droppedConnection),"normalClearing"!==t.cause&&(n.setCstaState(Ke.TransferFailed),n.atcCallInfo.setTransferCallFailedCause(t.cause)),C.debug("[CstaSvc]: Publish /atccall/info event"),E.publish("/atccall/info",[n]),delete P[t.droppedConnection.cID],delete P[I]),ae(t.droppedConnection.cID)}(e);break;case"DeliveredEvent":!function(e){var t,n,i,r,o,a=null;if(G={},ue(e.callingDevice))r=Ke.Delivered,n=e.alertingDevice,i=e.calledDevice,t={cID:e.connection.cID,dID:e.callingDevice},o=Be.OUTGOING;else{if(!ue(e.alertingDevice))return C.error("[CstaSvc]: ONS DN is neither in callingDevice nor in alertingDevice?!?");r=Ke.Ringing,n=e.callingDevice,t=e.connection,o=Be.INCOMING}var s=Ce(t.dID,e.epid),c=Ee(n);if("enteringDistribution"===e.cause)return C.debug("[CstaSvc]: This event is for the master of the parallel hunt group"),(a=D[t.cID])||(a=le(t.cID),D[t.cID]=a,C.debug("[CstaSvc]: Created new Remote Call object for callID= ",t.cID)),a.setCstaState(r),a.atcCallInfo.setPosition(s),a.atcCallInfo.setCstaConnection(t),a.atcCallInfo.setIgnoreCall(),a.atcCallInfo.masterParallelHgCall=!0;if(s===$e.WebRTC){if(a=Te(t.cID)){if(a.atcCallInfo.setCstaConnection(t),a.atcCallInfo.setServicesPermitted(e.servicesPermitted),a.setCstaState(Ke.Ringing),s=a.isRemote?$e.Other:s,a.atcCallInfo.setPosition(s),c){C.debug("[CstaSvc]: Update partner display to ",c),a.atcCallInfo.setPartnerDisplay(c),ee(a,a.atcCallInfo.peerDn,a.atcCallInfo.peerFQN,a.atcCallInfo.peerName);var l=ce(t.cID);l&&(l.forwarded&&te(a,l.redirectingUser.phoneNumber,l.redirectingUser.fqNumber,l.redirectingUser.displayName,l.redirectingUser.redirectionType),l.atcCallInfo.setIgnoreCall(!0),ae(t.cID))}return C.debug("[CstaSvc]: Publish /atccall/info event"),E.publish("/atccall/info",[a])}if(B&&B.atcCallInfo&&B.atcCallInfo.getCstaCallId()===e.connection.cId)return C.warn("[CstaSvc]: The Delivered event is for a local call that was just terminated. Ignore it");C.warn("[CstaSvc]: There is no local call associated with the Delivered Event")}var d=t.cID;if((a=D[d])||(a=le(d),D[d]=a,C.debug("[CstaSvc]: Created new Remote Call object for callID= ",d)),a.atcCallInfo.masterParallelHgCall)C.debug("[CstaSvc]: Ignore Delivered event for master parallel hunt group");else if(a.setCstaState(r),a.atcCallInfo.setServicesPermitted(e.servicesPermitted),a.atcCallInfo.setPosition(s),a.atcCallInfo.setCstaConnection(t),a.clearAtcHandoverInProgress(),a.direction=o,a.receivedAlerting=!0,c){if(a.atcCallInfo.setPartnerDisplay(c),i){var u=Ee(i);u.fqn!==c.fqn?a.atcCallInfo.setOriginalPartnerDisplay(u):a.atcCallInfo.setOriginalPartnerDisplay(c)}ee(a,a.atcCallInfo.peerDn,a.atcCallInfo.peerFQN,a.atcCallInfo.peerName,function(){L&&(C.debug("[CstaSvc]: Publish /atccall/info event"),E.publish("/atccall/info",[a]))})}else C.debug("[CstaSvc]: Publish /atccall/info event"),E.publish("/atccall/info",[a])}(e);break;case"DigitsGeneratedEvent":n=(t=e).connection.cID,(i=Te(n))||(i=D[n]),i&&ue(t.connection.dID)&&(C.info("[CstaSvc]: Digits played",t.digitGeneratedList),E.publish("/call/singleDigitSent",[i]));break;case"DivertedEvent":_e(e);break;case"EstablishedEvent":!function(e){var t,n,i,r,o;if(G={},ue(e.callingDevice))t={cID:e.establishedConnection.cID,dID:e.callingDevice},n=e.answeringDevice,i=Be.OUTGOING,o=Ee(e.calledDevice);else{if(!ue(e.answeringDevice))return C.error("[CstaSvc]: ONS DN is neither in callingDevice nor in answeringDevice?!?");t=e.establishedConnection,n=e.callingDevice,i=Be.INCOMING,o=Ee(e.callingDevice)}C.debug("[CstaSvc]: LocalConnection: ",t),C.debug("[CstaSvc]: Partner Device ID: ",n);var a=Ee(n),s=Ce(t.dID,e.epid);if(s===$e.WebRTC){if(C.info("[CstaSvc]: The Established Event is for a local WebRTC call"),r=Te(t.cID)){r.atcCallInfo.setCstaConnection(t),C.info("[CstaSvc]: Set the CSTA connection ID for the active call: ",t),r.isRemote&&(C.warn("[CstaSvc]: There is no local call associated with the Established Event"),s=$e.Other),r.atcCallInfo.setServicesPermitted(e.servicesPermitted),"hold"===e.localConnectionInfo?r.setCstaState(Ke.Holding):r.setCstaState(Ke.Active),r.atcCallInfo.setPartnerDisplay(a),r.atcCallInfo.setPosition(s),r.clearAtcHandoverInProgress(),r.receivedAlerting=!0,ee(r,r.atcCallInfo.peerDn,r.atcCallInfo.peerFQN,r.atcCallInfo.peerName),me(r,t.cID);var c=ce(t.cID);return c&&(c.forwarded||c.pickupNotification)&&(te(r,c.redirectingUser.phoneNumber,c.redirectingUser.fqNumber,c.redirectingUser.displayName,c.redirectingUser.redirectionType===ze.CallForward?ze.CallForward:ze.CallPickedUp),c.atcCallInfo.setIgnoreCall(!0),ae(t.cID)),r.isRemote||r.updateCallState(),C.debug("[CstaSvc]: Publish /atccall/info event"),E.publish("/atccall/info",[r])}if("recall"===e.cause)return r=u.findActivePhoneCall(),C.info("[CstaSvc]: Recalled call callId:",r.atcCallInfo.getCstaCallId()),r.atcCallInfo.setCstaConnection(t),C.debug("[CstaSvc]: Publish /atccall/info event"),E.publish("/atccall/info",[r]);if(ue(e.answeringDevice)&&!e.epid)return C.debug("[CstaSvc]: This is a call answered by VM. Ignore it");if(B&&B.atcCallInfo&&B.atcCallInfo.getCstaCallId()===t.cId)return C.warn("[CstaSvc]: The Established event is for a local call that was just terminated. Ignore it")}var l=!1;(r=D[t.cID])||(l=!0,me(r=le(t.cID),t.cID)),r.atcCallInfo.masterParallelHgCall?C.debug("[CstaSvc]: Ignore Established event for master parallel hunt group"):(r.atcCallInfo.setPosition(s),r.atcCallInfo.setPartnerDisplay(a),r.atcCallInfo.setOriginalPartnerDisplay(o),ee(r,r.atcCallInfo.peerDn,r.atcCallInfo.peerFQN,r.atcCallInfo.peerName),r.atcCallInfo.setServicesPermitted(e.servicesPermitted),r.atcCallInfo.setCstaConnection(t),r.direction=i,r.atcCallInfo.transferCb&&(r.atcCallInfo.transferCb&&r.atcCallInfo.transferCb(null,null,r),delete r.atcCallInfo.transferCb),r.clearAtcHandoverInProgress(),r.receivedAlerting=!0,"hold"===e.localConnectionInfo?r.setCstaState(Ke.Holding):(r.setCstaState(Ke.Active),r.clearRetrieveInProgress()),"callPickup"===e.cause&&e.lastRedirectionDevice&&te(r,Ee(e.lastRedirectionDevice).dn,Ee(e.lastRedirectionDevice).fqn,Ee(e.lastRedirectionDevice).name,ze.CallPickedUp),l&&(C.debug("[CstaSvc]: Created new Remote Call object: ",r),D[t.cID]=r),C.debug("[CstaSvc]: Publish /atccall/info event"),E.publish("/atccall/info",[r]))}(e);break;case"FailedEvent":!function(e){var t,n,i;if("fail"===e.localConnectionInfo&&ue(e.failingDevice)){if((t=D[e.failedConnection.cID]).atcCallInfo.masterParallelHgCall)return C.debug("[CstaSvc]: Ignore Failed event for master parallel hunt group");switch(ue(e.callingDevice)&&(i=Ee(e.calledDevice)).dn!==r&&t&&i.fqn!==et.cleanPhoneNumber(t.atcCallInfo.peerFQN)&&(ee(t,i.dn,i.fqn,i.name),t.atcCallInfo.setPartnerDisplay(i)),e.cause){case"blocked":P[e.failedConnection.cID]&&C.debug("[CstaSvc]: Received Failed event for transfer, waiting for ConnectionCleared event"),c.localUser.isOSV||(n=e.failedConnection.cID,(t=Ce(e.failedConnection.dID)===$e.WebRTC?Te(n):D[n])&&t.isHandoverInProgress&&(C.debug("[CstaSvc]: Received Failed event from non OSV PBX while handover is in progress"),t.clearAtcHandoverInProgress(),C.debug("[CstaSvc]: Publish /atccall/moveFailed event"),E.publish("/atccall/moveFailed")));break;case"doNotDisturb":(t=D[e.failedConnection.cID])?(C.debug("[CstaSvc]: Publish /atccall/info event"),E.publish("/atccall/info",[t])):C.warn("[CstaSvc]: DND call does not exist. Ignore Failed event");break;case"reorderTone":(t=D[e.failedConnection.cID])?(t.atcCallInfo.setMissedReason(Qe.REORDER_TONE),C.debug("[CstaSvc]: Publish /atccall/info event"),E.publish("/atccall/info",[t])):C.warn("[CstaSvc]: Outgoing call failed with reorder tone");break;case"busy":(t=D[e.failedConnection.cID])?(t.atcCallInfo.setMissedReason(Qe.BUSY),t.checkCstaState(Ke.Offered)&&t.setCstaState(Ke.Failed),C.debug("[CstaSvc]: Publish /atccall/info event"),E.publish("/atccall/info",[t])):C.warn("[CstaSvc]: Busy call does not exist. Ignore Failed event")}}else if("connected"===e.localConnectionInfo&&ue(e.callingDevice)){if((t=Te(n=e.failedConnection.cID))&&t.atcCallInfo.getCstaCallId()===n||(t=D[n]),!t)return C.warn("[CstaSvc]: Could not find call corresponding to handle FailedEvent Event.");switch(t.atcCallInfo.setServicesPermitted(e.servicesPermitted),t.atcCallInfo.peerFQN||(i=Ee(e.failingDevice||e.calledDevice))&&(t.atcCallInfo.setPartnerDisplay(i),ee(t,t.atcCallInfo.peerDn,t.atcCallInfo.peerFQN,t.atcCallInfo.peerName)),e.cause){case"busy":t.isRemote&&(t.setCstaState(Ke.Busy),t.atcCallInfo.setMissedReason(Qe.BUSY));break;case"reorderTone":t.atcCallInfo.setMissedReason(Qe.REORDER_TONE);break;case"blocked":t.atcCallInfo.setMissedReason(Qe.DECLINED);break;case"destOutOfOrder":t.atcCallInfo.setMissedReason(Qe.DEST_OUT_OF_ORDER);break;default:t.atcCallInfo.setMissedReason(Qe.DEFAULT)}C.debug("[CstaSvc]: Publish /atccall/info event"),E.publish("/atccall/info",[t])}}(e);break;case"HeldEvent":!function(e){var t=e.heldConnection.cID,n=Te(t);if(n||(n=D[t])){if(ue(e.holdingDevice)){switch(n.atcCallInfo.setCstaConnection(e.heldConnection),n.getCstaState()){case Ke.Held:n.setCstaState(Ke.HoldOnHold);break;case Ke.Conference:n.setCstaState(Ke.ConferenceHolding);break;default:n.setCstaState(Ke.Holding)}n.clearHoldInProgress()}else"hold"===e.localConnectionInfo?n.checkCstaState(Ke.ConferenceHolding)||n.setCstaState(Ke.HoldOnHold):n.checkCstaState(Ke.Conference)||n.setCstaState(Ke.Held);n.atcCallInfo.setServicesPermitted(e.servicesPermitted),C.debug("[CstaSvc]: Publish /atccall/info event"),E.publish("/atccall/info",[n])}else C.warn("[CstaSvc]: Could not find call corresponding to Held Event.")}(e);break;case"OfferedEvent":!function(e){var t,n;if(ue(e.offeredDevice)){if(t=e.offeredConnection,n=e.callingDevice,C.debug("[CstaSvc]: LocalConnection: ",t),C.debug("[CstaSvc]: Partner Device ID: ",n),c.localUser.callForwardingEnabled)return C.debug("[CstaSvc]: Immediate call forwarding is enabled. Accept call"),ve({request:"AcceptCall",callToBeAccepted:t});var i=Ee(n),r=D[t.cID];if(!r||!r.pickupNotification){if((r=le(t.cID)).atcCallInfo.setPosition($e.Desk),r.atcCallInfo.setPartnerDisplay(i),ee(r,r.atcCallInfo.peerDn,r.atcCallInfo.peerFQN,r.atcCallInfo.peerName),r.atcCallInfo.setServicesPermitted(e.servicesPermitted),r.setCstaState(Ke.Offered),r.direction=Be.INCOMING,r.atcCallInfo.setCstaConnection(t),f.test(e.cause)){var o=Ee(e.lastRedirectionDevice);te(r,o.dn,o.fqn,o.name,ze.CallForward)}C.debug("[CstaSvc]: Created new Remote Call object: ",r),D[t.cID]=r,G={cID:t.cID,dID:Ie($e.WebRTC,null,!0)},c.localUser.selectedRoutingOption!==Je.DeskPhone.name?u.isSecondCall()||m.call&&m.call.isAtcRemote?Pe(r):(ve({request:"AcceptCall",callToBeAccepted:r.atcCallInfo.getCstaConnection()}),G={}):be(r)}}else C.debug("[CstaSvc]: ONS DN is not the offered device. Ignore Offered event.")}(e);break;case"QueuedEvent":!function(e){var t,n;if(ue(e.queue)){t=e.queuedConnection,n=e.callingDevice,C.debug("[CstaSvc]: LocalConnection: ",t),C.debug("[CstaSvc]: Partner Device ID: ",n);var i=Ce(t.dID,e.epid),r=Ee(n),o=t.cID,a=D[o];if(!a){if("noAvailableAgents"===e.cause)return C.debug("[CstaSvc]: Cause=noAvailableAgents. Ignore Queued event");a=le(o),D[o]=a,C.debug("[CstaSvc]: Created new Remote Call object for callID= ",o)}a.atcCallInfo.setPosition(i),a.atcCallInfo.setPartnerDisplay(r),ee(a,a.atcCallInfo.peerDn,a.atcCallInfo.peerFQN,a.atcCallInfo.peerName),a.atcCallInfo.setServicesPermitted(e.servicesPermitted),a.setCstaState(Ke.Parked),a.atcCallInfo.setCstaConnection(t),C.debug("[CstaSvc]: Publish /atccall/info event"),E.publish("/atccall/info",[a])}else C.debug("[CstaSvc]: ONS DN is not the queue device. Ignore Queued event.")}(e);break;case"RetrievedEvent":!function(e){var t=e.retrievedConnection.cID,n=Te(t);if(n||(n=D[t])){if(ue(e.retrievingDevice))n.atcCallInfo.setCstaConnection(e.retrievedConnection),n.checkCstaState(Ke.HoldOnHold)?(n.setCstaState(Ke.Held),e.servicesPermitted.eSP&&e.servicesPermitted.eSP.zsiHo&&n.setCstaState(Ke.Active)):n.checkCstaState(Ke.ConferenceHolding)?(n.setCstaState(Ke.Conference),e.servicesPermitted.eSP&&e.servicesPermitted.eSP.sST&&n.setCstaState(Ke.Active)):n.setCstaState(Ke.Active),n.clearRetrieveInProgress();else if(n.checkCstaState([Ke.ConferenceHolding,Ke.Conference]))"hold"===e.localConnectionInfo?n.setCstaState(Ke.ConferenceHolding):n.setCstaState(Ke.Conference);else if("hold"===e.localConnectionInfo?n.setCstaState(Ke.Holding):n.setCstaState(Ke.Active),n.isRemote){var i=Ee(e.retrievingDevice);n.atcCallInfo.setPartnerDisplay(i),ee(n,n.atcCallInfo.peerDn,n.atcCallInfo.peerFQN,n.atcCallInfo.peerName)}n.atcCallInfo.setServicesPermitted(e.servicesPermitted),C.debug("[CstaSvc]: Publish /atccall/info event"),E.publish("/atccall/info",[n])}else C.warn("[CstaSvc]: Could not find call corresponding to Retrieved Event.")}(e);break;case"ServiceCompletionFailureEvent":!function(e){var t=e.primaryCall.connectionID.cID,n=Ce(e.primaryCall.connectionID.dID,R.epid)===$e.WebRTC?Te(t):D[t];if(!n)return C.debug("[CstaSvc]: Could not find a call with Call Id = "+t),C.debug("[CstaSvc]: Publish /atccall/hangingcall event"),E.publish("/atccall/hangingcall",t);if(C.debug("[CstaSvc]: Publish /atccall/moveFailed event"),E.publish("/atccall/moveFailed"),n.checkState([xe.Terminated,xe.Idle])){var i=n.atcCallInfo,r=n.peerUser,o=n.establishedTime,a=n.direction;delete D[t],(n=le(t)).atcCallInfo=i,n.peerUser=r,n.establishedTime=o,n.direction=a,D[t]=n}n.clearAtcHandoverInProgress(),C.debug("[CstaSvc]: Publish /atccall/info event"),E.publish("/atccall/info",[n])}(e);break;case"ServiceInitiatedEvent":!function(e){var t,n=Ce(e.initiatingDevice,e.epid);if(n===$e.WebRTC&&(t=Te(e.initiatedConnection.cID)))if(t.atcCallInfo.setCstaConnection(e.initiatedConnection),t.atcCallInfo.setServicesPermitted(e.servicesPermitted),!t.isRemote&&t.checkState([xe.Initiated,xe.Ringing,xe.Delivered]))C.info("[CstaSvc]: Set the CSTA connection ID for the call: ",e.initiatedConnection),t.setCstaState(Ke.Initiated),C.debug("[CstaSvc]: Publish /atccall/info event"),E.publish("/atccall/info",[t]);else{if(t.isRemote)return C.info("[CstaSvc]: Set the CSTA connection ID for the remote call: ",e.initiatedConnection);C.error("[CstaSvc]: Call Initiated for WebRTC client has no active call or not in Initiated/Ringing state")}else(t=D[e.initiatedConnection.cID])||(t=le(e.initiatedConnection.cID)).setCstaState(Ke.Initiated),t.atcCallInfo.setPosition(n),t.atcCallInfo.setServicesPermitted(e.servicesPermitted),t.direction=Be.OUTGOING,t.atcCallInfo.setCstaConnection(e.initiatedConnection),D[e.initiatedConnection.cID]=t,C.debug("[CstaSvc]: Created new Remote Call object: ",t)}(e);break;case"TransferredEvent":!function(a){if("null"!==a.localConnectionInfo){var s=null,c=a.primaryOldCall.cID,l=Te(c)||D[c];if(l){if(a.transferredConnections.forEach(function(e){if(e.endpoint&&ue(e.endpoint)||e.connection&&ue(e.connection.dID))l.atcCallInfo.setCstaConnection(e.connection),C.info("[CstaSvc]: Updated the CSTA connection ID for the call: ",e.connection);else{if(l.isAtcRemote){var t=l.atcCallInfo;l.setCstaState(Ke.Idle);var n=l.peerUser,i=l.direction,r=l.establishedTime;C.debug("[CstaSvc]: Publish /atccall/info event"),E.publish("/atccall/info",[l]),delete D[c],(l=le(e.connection.cID)).atcCallInfo=t,ee(l,n.phoneNumber,n.phoneNumber,n.displayName),l.direction=i,l.establishedTime=r;var o=Ee(a.transferringDevice);l.atcCallInfo.setOriginalPartnerDisplay(o),D[l.callId]=l}s=e.endpoint&&Ee(e.endpoint)||e.connection.dID&&Ee(e.connection.dID)}}),!l.isRemote&&!l.isEstablished())return C.debug("[CstaSvc]: This is a WebRTC call that has not been answered. Update the display"),s&&(l.atcCallInfo.setPartnerDisplay(s),ee(l,l.atcCallInfo.peerDn,l.atcCallInfo.peerFQN,l.atcCallInfo.peerName,function(){L&&(C.debug("[CstaSvc]: Publish /atccall/info event"),E.publish("/atccall/info",[l]))}));switch(a.localConnectionInfo){case"hold":l.setCstaState(Ke.Holding);break;case"connected":l.setCstaState(Ke.Active);break;case"alerting":l.setCstaState(Ke.Ringing);break;default:C.debug("[CstaSvc]: Unexpected localConnectionInfo: ",a.localConnectionInfo)}l.atcCallInfo.setServicesPermitted(a.servicesPermitted),s&&(l.atcCallInfo.setPartnerDisplay(s),ee(l,l.atcCallInfo.peerDn,l.atcCallInfo.peerFQN,l.atcCallInfo.peerName,function(){L&&(C.debug("[CstaSvc]: Publish /atccall/info event"),E.publish("/atccall/info",[l]))})),C.debug("[CstaSvc]: Publish /atccall/info event"),E.publish("/atccall/info",[l])}else C.debug("[CstaSvc]: Could not find a call with Call Id = "+c)}else{if(a.secondaryOldCall){ae(a.primaryOldCall.cID);var e=D[a.secondaryOldCall.cID];e&&e.atcCallInfo.setMissedReason(Qe.TRANSFERRED),d(function(){ae(a.secondaryOldCall.cID)},1e3)}else{if(ue(a.transferringDevice)&&ue(a.transferredToDevice)){var t=D[a.primaryOldCall.cID];t&&t.atcCallInfo.setIgnoreCall(!0)}ae(a.primaryOldCall.cID)}if("singleStepTransfer"===a.cause){var n=v.getTransferredCall(a.primaryOldCall.cID);n&&(v.clearTransferredCall(a.primaryOldCall.cID),P[n.failedCallId]=a.primaryOldCall.cID)}else if("transfer"===a.cause){var i=le(a.secondaryOldCall.cID);C.debug("[CstaSvc]: Publish /atccall/info event"),E.publish("/atccall/info",[i])}}}(e);break;default:C.debug("[CstaSvc]: Ignore CSTA Call Event ("+e.name+")")}}catch(e){C.error(e)}else C.debug("[CstaSvc]: Ignore any call event until snapshot is performed")},this.handleDeviceEvent=function(e){if(e)try{switch(e.name){case"BackInServiceEvent":M=!1,C.debug("[CstaSvc]: Publish /csta/deviceChange event"),E.publish("/csta/deviceChange");break;case"OutOfServiceEvent":M=!0,C.debug("[CstaSvc]: Publish /csta/deviceChange event"),E.publish("/csta/deviceChange");break;default:C.debug("[CstaSvc]: Ignore CSTA Device Event ("+e.name+")")}}catch(e){C.error(e)}},this.handleLogicalDeviceEvent=function(e){var t;if(e)try{switch(e.name){case"ForwardingEvent":(t=e)&&(R.forwardList.some(function(e){if(e.forwardingType===t.forwardingType)return e.forwardStatus=t.forwardStatus,e.forwardDN=t.forwardTo,!0})||R.forwardList.push({forwardDN:t.forwardTo,forwardStatus:t.forwardStatus,forwardType:t.forwardingType}),"forwardImmediate"===t.forwardingType&&(c.localUser.callForwardingAvailable=!0,t.forwardTo!==R.vm?(c.localUser.callForwardingNumber=Xe.format(t.forwardTo),c.localUser.callForwardingEnabled=t.forwardStatus,c.localUser.callForwardingToVMEnabled=!1):(c.localUser.callForwardingToVMEnabled=t.forwardStatus,c.localUser.callForwardingEnabled=!1)),t.hasOwnProperty("staticOndActive")&&(t.staticOndActive?(Y=t.staticOndDN,t.staticOndDN===et.cleanPhoneNumber(c.localUser.reroutingPhoneNumber)?c.localUser.selectedRoutingOption=Je.AlternativeNumber.name:(c.localUser.selectedRoutingOption=Je.Other.name,c.localUser.otherRoutingNumber=Xe.format(t.staticOndDN))):(Y="",c.localUser.selectedRoutingOption!==Je.AlternativeNumber.name&&c.localUser.selectedRoutingOption!==Je.Other.name||(c.localUser.selectedRoutingOption=Je.DefaultRouting.name))),t.hasOwnProperty("voicemailActive")&&(c.localUser.voicemailPBXEnabled=!0,c.localUser.voicemailActive=t.voicemailActive,c.localUser.voicemailRingDuration=t.voicemailRingDuration,K=t.voicemailRingDuration),t.hasOwnProperty("mainRingDuration")&&(c.localUser.ringDurationEnabled=!0,c.localUser.mainRingDuration=t.mainRingDuration,c.localUser.clientRingDuration=t.clientRingDuration,c.localUser.cellRingDuration=t.cellRingDuration,q=t.mainRingDuration,j=t.clientRingDuration,Q=t.cellRingDuration,c.localUser.alternativeNumber=t.alternativeNumber,c.localUser.routeToCell=t.routeToCell,t.hasOwnProperty("overrideProfile")&&(c.localUser.ringDurationConfigurable=t.overrideProfile)),C.debug("[CstaSvc]: Publish /localUser/update event"),E.publish("/localUser/update",[c.localUser]),C.debug("[CstaSvc]: Publish /csta/forwardingEvent"),E.publish("/csta/forwardingEvent"));break;case"AgentReadyEvent":c.localUser&&c.localUser.isAgent&&!c.localUser.agentStateReady&&(c.localUser.agentStateReady=!0,C.debug("[CstaSvc]: Publish /agent/state/ready event"),E.publish("/agent/state/ready",[c.localUser.agentStateReady]));break;case"AgentNotReadyEvent":case"AgentBusyEvent":c.localUser&&c.localUser.isAgent&&c.localUser.agentStateReady&&(c.localUser.agentStateReady=!1,C.debug("[CstaSvc]: Publish /agent/state/ready event"),E.publish("/agent/state/ready",[c.localUser.agentStateReady]));break;default:C.debug("[CstaSvc]: Ignore CSTA Logical Device Event ("+e.name+")")}}catch(e){C.error(e)}},this.isPrimaryClient=function(){return w},this.getDisplayInfo=Ee,this.getCallDevices=ye,this.getPushDevices=function(){var e=[];return M||e.push($e.Desk),R&&R.cell&&e.push($e.Cell),e},this.getAnswerDevices=function(e){var t=[];return e&&(M||t.push($e.Desk),R&&R.cell&&e.getPosition()!==$e.Cell&&t.push($e.Cell),R&&R.vm&&t.push($e.VM)),t},this.updateStaticOnd=function(e,t){if(fe(t)){e=!!e,C.debug("[CstaSvc]: Update static OND status to ",e);var n={staticOndActive:e};if(e&&(n.staticOndDN=et.cleanPhoneNumber(c.localUser.reroutingPhoneNumber),!n.staticOndDN))return void(t&&t("Cannot activate static OND without the static OND DN"));e!==!!Y||e&&n.staticOndDN!==Y?ve({request:"SetForwarding",device:et.normalizeDn(R.onsFQN),staticOndActive:n.staticOndActive,staticOndDN:n.staticOndDN},function(e){e?t&&t(e):(Y=n.staticOndDN||"",t&&t(null))}):t&&t(null)}},this.updateRoutingOption=function(e,t){switch(e){case Je.AlternativeNumber.name:v.updateStaticOnd(!0,function(e){e?t&&t(e):v.setForwardingToVM(!1,t)});break;case Je.VM.name:v.setForwardingToVM(!0,function(e){e?t&&t(e):v.updateStaticOnd(!1,t)});break;default:v.setForwardingToVM(!1,function(e){e?t&&t(e):v.updateStaticOnd(!1,t)})}},this.setForwardingImmediate=function(e,t,n){t=t||c.localUser.callForwardingNumber;var i={activateForward:!!e,forwardDN:et.cleanPhoneNumber(t),forwardingType:"forwardImmediate"};v.setForwarding(i,n)},this.setForwardingToVM=function(e,t){if(v.getForwardingVMStatus()!==e){var n={activateForward:!!e,forwardDN:et.cleanPhoneNumber(R.vm),forwardingType:"forwardImmediate"};v.setForwarding(n,t)}else t&&t()},this.getForwardingData=function(){return R.forwardList},this.getForwardingImmediate=function(){var e=R.forwardList.find(function(e){return"forwardImmediate"===e.forwardingType&&e.forwardDN!==R.vm});return{status:!(!e||!e.forwardStatus),forwardDN:e&&e.forwardDN}},this.getForwardingVMStatus=function(){return R.forwardList.some(function(e){return"forwardImmediate"===e.forwardingType&&e.forwardDN===R.vm&&e.forwardStatus})},this.setVoicemail=function(e,t,n){if(fe(n))if(t=t||K,c.localUser.voicemailPBXEnabled)if(C.debug("[CstaSvc]: Set voice mail duration to: ",t),e!==c.localUser.voicemailActive||K!==t){var i={request:"SetForwarding",device:et.normalizeDn(R.onsFQN),voicemailActive:e!==c.localUser.voicemailActive?e:void 0,voicemailRingDuration:e?t:void 0};Ne(function(){ve(i,function(e){e?n&&n(e):(K=t,n&&n(null))})})}else n&&n(null);else n&&n("Cannot configure VM on PBX")},this.setRoutingTimers=function(t,n){if(fe(n))if(c.localUser.ringDurationEnabled){if(C.debug("[CstaSvc]: Set routing timers to: ",t),q!==t.mainRingDuration||Q!==t.cellRingDuration||j!==t.clientRingDuration||!c.localUser.routeToCell){var e={request:"SetForwarding",device:et.normalizeDn(R.onsFQN),mainRingDuration:t.mainRingDuration||void 0,clientRingDuration:t.clientRingDuration||void 0,cellRingDuration:t.cellRingDuration||void 0,routeToCell:!0};Ne(function(){ve(e,function(e){e?n&&n(e):(q=t.mainRingDuration||q,j=t.clientRingDuration||j,Q=t.cellRingDuration||Q,n&&n(null))})})}}else C.debug("[CstaSvc]: Cannot set routing timers"),n&&n("Cannot configure routing timers on PBX")},this},Me}(Circuit=function(et){"use strict";var tt=et.AtcCallInfo,nt=et.Enums.AtcMessage,it=et.BusyHandlingOptions,rt=et.ClientApiHandlerSingleton,ot=et.Constants,at=et.Enums,st=et.LocalCall,ct=et.Proto,lt=Circuit.Enums.RedirectionTypes,dt=et.RemoteCall,ut=et.RoutingOptions,Ct=et.RtcParticipant,Et=et.RtcSessionController,Tt=et.sdpParser,pt=et.UserToUserHandlerSingleton,St=et.Utils,It=et.ScreenSharingController;return et.CircuitCallControlSvcImpl=function(I,f,c,l,E,v,R,C,p,r,a,T){var o=et.Conversation,s=et.UserProfile;v.debug("New Service: CircuitCallControlSvc");var d=St.isMobile(),u="iOS"===l.navigator.platform,g="dotnet"===l.navigator.platform,A=!!l.cordova,S=3200,t=6e4,_=2e3,m=5e3,N=this,h=rt.getInstance(),O=pt.getInstance(),D=[],y=null,b=null,P=[],U=null,L=!1,M=!1,w={},G=[],H=null,n=!1,k=!1,V={},F=null,B=null,x=null;function W(e){return p.getConversationAsGuestById(e)||p.getConversationFromCache(e)}function Y(){if(B){var e=1e3*(B.ttl||0);e=Math.max(e-t,0),B.expirationTimestamp=Date.now()+e}}function K(o){return new E(function(n,i){var e=B&&B.expirationTimestamp||0;if(Date.now()<e){var t=new Date(e);return v.debug("[CircuitCallControlSvc]: Existing credentials are still valid. Expiration: "+t),void n(B)}v.debug("[CircuitCallControlSvc]: Get new TURN credentials");var r=T.createActionInfo(o,ot.RtcDiagnosticsAction.RENEW_TURN_CREDENTIALS);h.renewTurnCredentials(o.callId,function(e,t){I.$apply(function(){return r&&(r.data=JSON.stringify(t),T.finishActionInfo(o,r)),e?(v.error("[CircuitCallControlSvc]: Error renewing TURN credentials.",e),void i(e)):t&&t.length?(t=t[0],v.info("[CircuitCallControlSvc]: Received new TURN credentials=",t.turnServer),B=t,Y(),void n(B)):(v.error("[CircuitCallControlSvc]: Error renewing TURN credentials. No server(s) available."),void i("No TURN server(s) available"))})})})}function q(e){if(e){if(e.startsWith("res_"))return e;if(e===ot.ErrorCode.PERMISSION_DENIED)return"res_JoinRTCSessionFailedPermission";if(e===ot.SdpFailedCause.JOIN_FORBIDDEN)return"res_JoinRTCSessionFailedForbidden";if(e===ot.ErrorCode.RTC_NO_MEDIA_NODES_AVAILABLE)return"res_JoinRTCSessionFailedMissingResources";if(e===ot.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED)return e;if(e===ot.ReturnCode.DISCONNECTED||e===ot.ReturnCode.FAILED_TO_SEND)return"res_NotConnectedTryAgain"}return"res_JoinRTCSessionFailed"}function e(){return y&&y.isMocked&&!y.isDirect&&1<y.participants.length}function j(){!H&&e()&&(H=c(function(){v.debug("[CircuitCallControlSvc]: Active speaker simulation interval has fired"),e()?y.isEstablished()&&function(){if(St.randomBoolean()){var e=y.participants.filter(function(e){return e.pcState===at.ParticipantState.Active});if(!(e.length<2)){e.push(I.localUser);var t={sessionId:y.callId},n=["first","second","third"],i=St.randomNumber(0,3),r=e.randomCopy(i);-1===r.indexOf(e[0])&&St.randomBoolean()&&(r.unshift(e[0]),i<3&&i++);for(var o=0;o<i;o++)t[n[o]]=r[o].userId;if(v.debug("[CircuitCallControlSvc]: Firing mocked ACTIVE_SPEAKER event: ",t),Ge(t),!(0<y.sessionCtrl.getNumberOfExtraVideoChannels()||y.hasRemoteScreenShare())){var a=r[0];a&&a.userId!==I.localUser.userId&&a.mediaType.video&&!a.streamId&&He({sessionId:y.callId,userId:a.userId,videoStreamId:"mock"})}}}}():(v.debug("[CircuitCallControlSvc]: Active speaker simulation is no longer needed. Stop interval."),c.cancel(H),H=null)},2e3,0,!1))}function Q(e,t){if(!e.checkState(at.CallState.Ringing)||(G.push(e),!t)){for(var n=0;n<D.length;n++)if(e.sameAs(D[n]))return v.debug("[CircuitCallControlSvc]: Updating call with callId = "+e.callId),void(D[n]=e);D.push(e),e===y&&j(),U=null}}function X(e){var t;for(t=0;t<D.length;t++)if(e.sameAs(D[t])){D.splice(t,1);break}for(t=0;t<G.length;t++)if(e.sameAs(G[t])&&!e.isHandoverInProgress){G.splice(t,1);break}for(t=0;t<P.length;t++)if(e.sameAs(P[t])){P.splice(t,1);break}e.isRemote?U=null:(L=e.sessionCtrl&&e.sessionCtrl.isMuted(),U=e,f(function(){U===e&&(U=null)},S))}function z(e){e&&(v.debug("[CircuitCallControlSvc]: Publish /conversation/update event. convId = ",e.convId),R.publish("/conversation/update",[e]))}function J(e,t){e&&e.state!==at.CallState.Terminated&&(v.debug("[CircuitCallControlSvc]: Publish /call/state event. callId = "+e.callId+", state = "+e.state.name),R.publish("/call/state",t?[e,t]:[e]))}function i(e,t){e&&e.isEstablished()&&(v.debug("[CircuitCallControlSvc]: Publish /call/rtp/iceConnectionState event. callId = "+e.callId+", iceState = "+t),R.publish("/call/rtp/iceConnectionState",[e.callId,t]))}function $(e,t,n){if(e){v.info("[CircuitCallControlSvc]: Terminating call...");var i,r,o=function(e){if(y&&y.sameAs(e)){var t=N.getIncomingCall();return!!(t&&t.replaces&&t.replaces.sameAs(e))}return!!(y&&y.replaces&&y.replaces.sameAs(e))}(e);Qe(e),e.isRemote||(t&&function(e){switch(e){case at.CallClientTerminatedReason.DISCONNECTED:case at.CallClientTerminatedReason.FAILED_TO_SEND:case at.CallClientTerminatedReason.REQUEST_TIMEOUT:return!0;default:return!1}}(e.terminateReason=t)&&function(e){if(e){var t="";switch(e.terminateReason){case at.CallClientTerminatedReason.DISCONNECTED:t=ot.RtcClientInfoReason.DISCONNECTED;break;case at.CallClientTerminatedReason.FAILED_TO_SEND:t=ot.RtcClientInfoReason.FAILED_TO_SEND;break;case at.CallClientTerminatedReason.REQUEST_TIMEOUT:t=ot.RtcClientInfoReason.REQUEST_TIMEOUT;break;default:return}var n={userId:I.localUser.userId,convId:e.convId,clientInfoType:ot.RtcClientInfoType.OFFLINE_JOIN_FAILURE,reason:t,timestamp:Date.now(),sessionId:e.callId},i=p.getConversationByRtcSession(e.callId);i&&i.call&&i.call.instanceId&&(n.instanceId=i.call.instanceId),v.info("[CircuitCallControlSvc]: Store new offline join failure. ",n),T.storeClientInfo(n)}}(e),T.forceFinishDeviceDiagnostics(e)),e.screenShareEventHandler&&(It.unregEvtHandlers(e.screenShareEventHandler),e.screenShareEventHandler=null),e.rejectGetScreenPromise&&(e.rejectGetScreenPromise(ot.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED),e.rejectGetScreenPromise=null),(r=(i=e)&&i.sessionCtrl)&&(r.onIceCandidate=null,r.onSessionDescription=null,r.sessionClosed=null,r.onSdpConnected=null,r.onIceConnected=null,r.onIceDisconnected=null,r.onRemoteVideoAdded=null,r.onRemoteVideoRemoved=null,r.onRemoteStreamUpdated=null,r.onDTMFToneChange=null,r.onRtcError=null,r.onRtcWarning=null,r.onLocalStreamEnded=null,r.onStatsThresholdExceeded=null,r.onStatsNoOutgoingPackets=null,r.onNetworkQuality=null),X(e),e.terminate(),I.closePopoutCallStage&&I.closePopoutCallStage(e),y&&y.sameAs(e)?(f.cancel(y.terminateTimer),y=b,b=null):b&&b.sameAs(e)&&(f.cancel(b.terminateTimer),b=null);var a=W(e.convId);if(a&&a.call&&a.call.sameAs(e)&&!e.isHandoverInProgress){if(e.isTelephonyCall){var s=ne()||ie();a.call=s||null}else a.call=null;(e.isDirect||e.establishedTime&&Date.now()-e.establishedTime>=m)&&p.updateLastCallTime(a),z(a)}H&&!y&&(c.cancel(H),H=null),n||(v.debug("[CircuitCallControlSvc]: Publish /call/ended event. Replaced=",o),R.publish("/call/ended",[e,o]))}}function Z(e){return y&&y.callId===e?y:b&&b.callId===e?b:null}function ee(e){var t;for(t=0;t<D.length;t++)if(D[t].callId===e)return D[t];for(t=0;t<G.length;t++)if(G[t].callId===e)return G[t];var n=p.getConversationByRtcSession(e);return n&&n.call&&!n.call.isAtcRemote&&n.call.state.established&&n.call.callId===e?(D.push(n.call),n.call):Z(e)}function te(n,i){if(n.participantType===ot.RTCParticipantType.TELEPHONY&&n.phoneNumber){var e=y.getParticipant(n.userId);if(e&&e.phoneNumber&&e.phoneNumber===n.phoneNumber)return;C.startReverseLookUp(n.phoneNumber,function(e){if(i.isPresent()&&e){var t=y.getParticipant(n.userId);t&&(t.firstName=e.firstName,t.lastName=e.lastName,t.resolvedUserId=e.userId,Oe(i,t))}})}}function ne(t){return D.find(function(e){return e.isTelephonyCall&&e.state.established&&!e.isHolding()&&(!t||!e.isRemote)})||null}function ie(t){return D.find(function(e){return e.isTelephonyCall&&e.state.established&&e.isHolding()&&(!t||!e.isRemote)})||null}function re(){return!I.localUser.selectedBusyHandlingOption||I.localUser.selectedBusyHandlingOption===it.DefaultRouting.name}function oe(t,n,e,i,r,o){if(!e&&t.atcCallInfo&&(e=t.atcCallInfo.peerFQN),t.setPeerUser(n,i,r),!r&&e){var a=null;o&&(a=f(function(){a=null,t.isPresent()&&(o(),o=null)},_)),C.startReverseLookUp(e,function(e){f.cancel(a),t.isPresent()&&(e?(t.setPeerUser(n,e.displayName,e.userId),o?o():J(t)):o&&o())})}else o&&o()}function ae(t,n,i,e,r){t.redirectingUser&&t.redirectingUser.redirectionType||(t.setRedirectingUser(n,i,e,null,r),i&&C.startReverseLookUp(i,function(e){e&&t.isPresent()&&(t.setRedirectingUser(n,i,e.displayName,e.userId,r),J(t))}))}function se(e,t){var n,i=!(e.participantType&&e.participantType!==ot.RTCParticipantType.USER&&e.participantType!==ot.RTCParticipantType.MEETING_POINT||e.userId==="echo_"+I.localUser.userId||e.isExternal);if(e.userId===I.localUser.userId?n=I.localUser:i&&(n=C.getUserFromCache(e.userId)),!n){e.userDisplayName=e.userDisplayName||e.phoneNumber||I.i18n.map.res_Unknown;var r=e.userDisplayName.split(" ");e.participantType===ot.RTCParticipantType.MEETING_POINT?(e.lastName=r[0],e.location=r.splice(1).join(" ").trim().slice(1,-1)):(e.firstName=r[0],e.lastName=r.splice(1).join(" ")),i?(n=s.extend({userId:e.userId,firstName:e.firstName,lastName:e.lastName,displayName:e.displayName,location:e.location,userType:e.participantType===ot.RTCParticipantType.MEETING_POINT?ot.UserType.MEETING_POINT:ot.UserType.REGULAR}),e.isSimulated?n.isSimulated=!0:(n.noData=!0,C.addUsersToCache(n,!0,!1))):(e.participantType===ot.RTCParticipantType.SESSION_GUEST&&(e.userType=ot.UserType.SESSION_GUEST),(n=s.extend(e)).isSessionGuest&&(n.initials=((n.firstName[0]||"")+(n.lastName[0]||"")).toUpperCase()))}var o=Ct.createFromUser(n,at.ParticipantState.Active);return o.streamId=e.videoStreamId||"",o.screenStreamId=e.screenStreamId||"",o.mediaType=ct.getMediaType(e.mediaTypes||t),o.muted=e.muted||!o.mediaType.audio,o.participantType=e.participantType||ot.RTCParticipantType.USER,o.screenSharePointerSupported=!!e.screenSharePointerSupported,o.isModerator=!!e.isModerator,o.isMeetingGuest=e.isMeetingGuest,o}function ce(e,t){if(t&&t.length){var n=w[e];n?n.turnServers=t:w[e]={turnServers:t}}}function le(e){switch(e){case ot.ReturnCode.DISCONNECTED:return at.CallClientTerminatedReason.DISCONNECTED;case ot.ReturnCode.FAILED_TO_SEND:return at.CallClientTerminatedReason.FAILED_TO_SEND;case ot.ReturnCode.REQUEST_TIMEOUT:return at.CallClientTerminatedReason.REQUEST_TIMEOUT;default:return at.CallClientTerminatedReason.REQUEST_TO_SERVER_FAILED}}function de(e,t){e&&(v.debug("[CircuitCallControlSvc]: New call has been terminated during call setup. Call Id:",e.callId),e.callState!==at.CallState.Terminated&&$(e,at.CallClientTerminatedReason.USER_ENDED),t&&t("Call already terminated"))}function ue(e,t,n,i){if($e(e,n,i)){y&&(b=y);var r={clientId:h.clientId};n.replaces&&t.desktop&&(r.reuseDesktopStreamFrom=n.replaces.sessionCtrl),(y=new st(e,r)).setState(at.CallState.Initiated),Q(y);var o=e.call;if(o&&o.isRemote&&!o.isAtcRemote&&(v.debug("[CircuitCallControlSvc]: Terminate the remote call and add the new local call to the conversation"),n.handover&&(y.activeClient=o.activeClient,o.isTelephonyCall&&(y.atcCallInfo=o.atcCallInfo,oe(y,o.peerUser.phoneNumber,null,o.peerUser.displayName),y.participants=o.participants),e.call=y),y.hadRemoteCall=!0,o.isTelephonyCall||$(o)),y.setCallIdForTelephony(n.callId),y.setTransactionId(),(I.isSessionGuest||I.localUser.isCMP||e.isTemporary)&&!e.testCall&&y.sessionCtrl.useMaxNumberOfExtraVideoChannels(),(M||e.isTelephonyConv)&&(v.info("[CircuitCallControlSvc] Disabling remote video for outgoing call"),y.disableRemoteVideo()),y.direction=at.CallDirection.OUTGOING,y.mediaType=t,n.replaces){y.replaces=n.replaces;var a=n.replaces.sessionCtrl.getLocalStream(Et.LOCAL_STREAMS.DESKTOP);a&&(v.debug("[CircuitCallControlSvc] Reusing desktop stream from call ID=",n.replaces.callId),y.sessionCtrl.setLocalStream(Et.LOCAL_STREAMS.DESKTOP,a),n.replaces.sessionCtrl.setLocalStream(Et.LOCAL_STREAMS.DESKTOP,null)),(a=n.replaces.sessionCtrl.getLocalStream(Et.LOCAL_STREAMS.AUDIO_VIDEO))&&(v.debug("[CircuitCallControlSvc] Reusing audio/video stream from call ID=",n.replaces.callId),y.sessionCtrl.setLocalStream(Et.LOCAL_STREAMS.AUDIO_VIDEO,a),n.replaces.sessionCtrl.setLocalStream(Et.LOCAL_STREAMS.AUDIO_VIDEO,null))}if(n.joiningGroupCall&&(y.isJoiningGroupCall=!0),n.callOut&&(y.setPeerUsersAsParticipants(),y.isCallOut=!0),y.isTelephonyCall)if(n.handover){var s=ge(y.callId);s&&!s.isAtcConferenceCall()&&(y.atcCallInfo=s.atcCallInfo,oe(y,s.peerUser.phoneNumber,null,s.peerUser.displayName),$(s)),y.handover=!0}else oe(y,n.dialedDn,null,n.toName,n.userId),n.dtmfDigits&&(y.dtmfDigits=n.dtmfDigits);return J(y),e.call&&e.call.isRemote&&n.handover||y.conferenceCall||(v.debug("[CircuitCallControlSvc]: Publish /call/outgoing event"),R.publish("/call/outgoing",[y])),y.isNewSession=!e.call||e.call!==y&&!n.handover,e.call=y,z(e),!0}}function Ce(n,t,r,o){if(!y)return o(q()),void v.error("[CircuitCallControlSvc]: joinSession failed because there's no local call");o=o||function(){},v.debug("[CircuitCallControlSvc]: joinSession - rtcSessionId=",r.callId||n.rtcSessionId);var e,i,l,d,a=y,s=y.sessionCtrl,c=function(e){if(s.onSessionDescription=null,s.onClosed=null,y===a){y.mediaType=s.getMediaConstraints();var t={convId:n.convId,rtcSessionId:y.callId||n.rtcSessionId,ownerId:n.creatorId,sdp:e.sdp,mediaType:y.mediaType,callOut:r.callOut,handover:r.handover,sendInviteCancel:!r.callOut,replaces:r.replaces&&r.replaces.callId,isTelephonyConversation:y.isTelephonyCall,displayName:I.localUser.displayName,transactionId:y.transactionId,screenSharePointerSupported:!(!y.pointer||!y.pointer.isEnabled)};y.isTelephonyCall&&(t.fromDn=St.cleanPhoneNumber(I.localUser.callerId),t.fromName=I.localUser.displayName,t.fromUserId=I.localUser.userId,t.dialedDn=St.cleanPhoneNumber(r.dialedDn),t.toName=r.toName,t.toUserId=r.userId,t.noCallLog=I.localUser.noCallLog),n.isTemporary&&n.guestToken&&(t.guestToken=n.guestToken),I.localUser.hasTelephonyRole&&(t.fromName="Gru",t.fromDn="+19998455246");var i=T.createActionInfo(y,ot.RtcDiagnosticsAction.JOIN);i&&(i.data=JSON.stringify(t.sdp)),h.joinRtcCall(t,function(n){I.$apply(function(){if(T.finishActionInfo(y,i),y===a)if(n){var e=y.replaces,t=le(n);y.hadRemoteCall?N.endCallWithCauseCode(y.callId,t):$(y,t),e&&(y=e),o(q(n))}else v.debug("[CircuitCallControlSvc]: Join RTC session call was successful"),y.conferenceCall&&(v.debug("[CircuitCallControlSvc]: Publish /conference/participant/joining event"),R.publish("/conference/participant/joining",[y])),o(null,r.warning,y);else de(a,o)})})}else de(a,o)},u=function(e){if(y===a){var t=le(e);if(v.warn("[CircuitCallControlSvc]: Failed to initiate call. ",e),r.handover)$(y,t);else if(y.setDisconnectCause(ot.DisconnectCause.CALL_SETUP_FAILED,e),y.hadRemoteCall)N.endCallWithCauseCode(y.callId,t);else{var n=y.isDirect?"terminateRtcCall":"leaveRtcCall";h[n](y.callId,y.disconnectCause,function(e){e&&v.warn("[CircuitCallControlSvc]: Error terminating RTC call. ",e)}),$(y,t)}o(q(e))}else de(a,o)},C=function(){s.onClosed=null,s.onSessionDescription=null,o&&o(q())};y.isNewSession?(i=n,l=y,d=r,e=new E(function(a,s){var e={convId:i.convId,rtcSessionId:l.callId,ownerId:i.creatorId,mediaNode:l.getMediaNode(),isTelephonyConversation:i.isTelephonyConv,replaces:d.replaces&&d.replaces.callId};T.startDiagnostics(l),l.isDirect||T.startJoinDelayTimer(l);var c=T.createActionInfo(l,ot.RtcDiagnosticsAction.PREPARE);h.prepareSession(e,function(i,r,o){I.$apply(function(){if(c&&(c.data=i?i.toString():JSON.stringify(r),T.finishActionInfo(l,c)),i)return i===ot.ErrorCode.RTC_CONCURRENT_INCOMING_CALL?v.debug("[CircuitCallControlSvc]: Concurrent incoming call, aborting own attempt."):i===ot.ErrorCode.RTC_NO_MEDIA_NODES_AVAILABLE?v.error("[CircuitCallControlSvc]: No media nodes available, call not possible."):i===ot.ErrorCode.RTC_MEDIA_NODE_UNREACHABLE?v.error("[CircuitCallControlSvc]: Specified media node is not reachable, call not possible."):v.error("[CircuitCallControlSvc]: Error retrieving start session data. ",i),void s(i);if(!r||!r.length)return v.error("[CircuitCallControlSvc]: Error getting TURN credentials. No server(s) available."),void s("No TURN server(s) available");if(v.info("[CircuitCallControlSvc]: Received new TURN credentials"),r=r[0],B=r,Y(),l.isTelephonyCall&&o&&o!==l.callId){var e=W(l.convId);if(e&&(St.isMobile()||et.isSDK)){l.setCallIdForTelephony(o);var t=new st(e,{clientId:l.clientId});(e.call=t).terminate(),v.debug("[CircuitCallControlSvc]: Publish /call/ended event"),R.publish("/call/ended",[t,!0]),e.call=l,z(e),J(l),v.debug("[CircuitCallControlSvc]: Publish /call/moved event"),R.publish("/call/moved",[t.callId,l.callId])}else{var n=l.callId;l.setCallIdForTelephony(o),J(l,n)}}a(B)})})})):e=K(y),e.then(function(e){e&&(ce(n.rtcSessionId,e.turnServer),s.setTurnUris(e.turnServer),s.setTurnCredentials(e)),s.warmup(t,null,function(){y===a?I.$apply(function(){v.debug("[CircuitCallControlSvc]: The connection warmup was successful. Start the call."),s.onSessionDescription=c,s.onClosed=C,Me(y),s.start(t,null)}):de(a,o)},function(e){I.$apply(u.bind(null,e))},r.screenConstraint)}).catch(u)}function Ee(e,n,i,t,r,o,a){v.info("[CircuitCallControlSvc]: changeMediaType - Media type: ",i);var s=ee(e);if(!s)return v.warn("[CircuitCallControlSvc]: changeMediaType - There is no local call"),void o("No active call");if(e!==s.callId)return v.info("[CircuitCallControlSvc]: changeMediaType - The given call ID does not match the local call"),void o("Invalid callId");if(!s.isEstablished())return v.info("[CircuitCallControlSvc]: changeMediaType - The local call is not established"),void o("Call not established");var c=s.sessionCtrl;if(c.isConnStable()){var l=function(e){c.onSessionDescription=null,s.setTransactionId(n);var t={rtcSessionId:s.callId,sdp:e.sdp,mediaType:i,transactionId:s.transactionId,screenSharePointerSupported:!(!s.pointer||!s.pointer.isEnabled)};h.changeMediaType(t,function(e){I.$apply(function(){s.clearTransactionId(),e?(c.renegotiationFailed(e),o(e)):v.debug("[CircuitCallControlSvc]: changeMediaType was successful. Wait for SDP_ANSWER event")})})},d=s.localMediaType.desktop;K(s).then(function(e){c.setTurnUris(e.turnServer),c.setTurnCredentials(e),c.onSessionDescription=l,"boolean"==typeof r?(r?c.holdCall:c.retrieveCall)(function(e){e?(v.error("[CircuitCallControlSvc]: Error in hold/retrieve media"),c.onSessionDescription=null,c.renegotiationFailed(e),o("Error in hold/retrieve media")):o()}):(s.lastMediaType=s.mediaType,c.changeMediaType(i,t,function(e){e?I.$apply(function(){v.warn("[CircuitCallControlSvc]: changeMediaType failed - reason: ",e),c.onSessionDescription=null,c.renegotiationFailed(e),o(e||"Error changing media")}):(d&&!s.localMediaType.desktop&&(v.debug("[CircuitCallControlSvc]: Publish /screenshare/ended event"),R.publish("/screenshare/ended"),s.pointer.isSupported=s.pointer.isEnabled=!1),s.updateMediaDevices(),o())},a))}).catch(function(e){o(q(e))})}else o("Connection not stable")}function Te(e,t,n,i,r){if(!e)return null;if(e.isTemporary&&!t&&(!e.guestToken||!I.circuitLabs.CIRCUIT_GUEST))return v.debug("[CircuitCallControlSvc]: Publish /conversation/temporary/ended event"),R.publish("/conversation/temporary/ended",[e]),null;var o=new dt(e);return o.setState(t?at.CallState.ActiveRemote:at.CallState.Started),n&&n.instanceId&&o.setInstanceId(n.instanceId),i&&o.setCallIdForTelephony(i),Q(o),t&&(o.setActiveClient(t),_e(o),n&&(1===n.participants.length&&n.callOut&&(o.pullNotAllowed=!0),o.mediaType=ct.getMediaType(n.mediaTypes))),"function"==typeof r&&r(o),e.call=o,z(e),J(o),o}function pe(n){if(n.isGuestInvite){X(n);var e=W(n.convId);e&&e.isTemporary&&(v.debug("[CircuitCallControlSvc]: Publish /conversation/temporary/ended event"),R.publish("/conversation/temporary/ended",[e]))}else n.setState(at.CallState.Started),n.activeClient=null,J(n),P.some(function(e,t){if(e.callId===n.callId)return P.splice(t,1),!0})}function Se(e){h.declineRtcCall({convId:e.convId,rtcSessionId:e.sessionId,cause:ot.InviteRejectCause.BUSY,transactionId:e.transactionId})}function Ie(e,t,n){var i=new st(e,{clientId:h.clientId});i.setInstanceId(t.instanceId),i.setTransactionId(t.transactionId),i.setState(at.CallState.Ringing),t.from&&oe(i,t.from.phoneNumber,t.from.fullyQualifiedNumber,t.from.displayName,null,function(){v.debug("atccall/firstcall"),R.publish(n?"/atccall/firstcall":"/atccall/secondcall",[i])})}function fe(e,t,n,i){if(i=i||function(){},X(e=e||y),!e||e.state!==at.CallState.Ringing&&e.state!==at.CallState.Answering)return v.debug("[CircuitCallControlSvc]: call invalid to be declined"),void i("Call Invalid");v.debug("[CircuitCallControlSvc]: decline - rtcSessionId: ",e.callId);var r={convId:e.convId,rtcSessionId:e.callId,cause:t.type,transactionId:e.transactionId},o=[e];t.err&&o.push(t.err),h.declineRtcCall(r,function(e){I.$apply(function(){e?(v.warn("[CircuitCallControlSvc]: Error declining the RTC call. ",e),i(e)):i()})}),e.isDirect||Te(W(e.convId)),v.debug("[CircuitCallControlSvc]: Publish /call/declining event"),R.publish("/call/declining",o),$(e,at.CallClientTerminatedReason.CLIENT_ENDED_PRFX+t.type,n)}function ve(e,t,n,i,r){if(r=r||function(){},!(e=e||y))return v.debug("[CircuitCallControlSvc]: There is no local call"),void(r&&f(r));if(e.terminateTimer)return v.debug("[CircuitCallControlSvc]: Local call is already being terminated. Ignore leave request."),void(r&&f(r));if(e.checkState([at.CallState.Ringing,at.CallState.Answering]))fe(e,{type:t||ot.InviteRejectCause.DECLINE},!1,r);else{var o;if(v.debug("[CircuitCallControlSvc]: leaveCall - rtcSessionId=",e.callId),e.clearAtcHandoverInProgress(),e.activeClient)return Te(o=W(e.convId),e.activeClient,null,null,function(e){y.isTelephonyCall&&(e.atcCallInfo=y.atcCallInfo,e.peerUser=y.peerUser)}),void $(e,n);e.isDirect?h.terminateRtcCall(e.callId,e.disconnectCause,function(e){I.$apply(function(){e&&v.warn("[CircuitCallControlSvc]: Error terminating RTC call. ",e),r&&r(e)})}):(e.isTestCall||(o=W(e.convId))&&(e.participants.length||o.isTemporary)&&Te(o),h.leaveRtcCall(e.callId,e.disconnectCause,function(e){I.$apply(function(){e&&v.warn("[CircuitCallControlSvc]: Error leaving the RTC call. ",e),r&&r(e)})})),n===at.CallClientTerminatedReason.PAGE_UNLOADED&&(e.terminateReason=n,e.qosSubmitted=!0,a.sendQOSData(e,e.mediaType,e.sessionCtrl.getLastSavedStats())),i||(e.directCall?(v.debug("[CircuitCallControlSvc]: Publish /call/terminating event"),R.publish("/call/terminating",[y])):e.conferenceCall?(v.debug("[CircuitCallControlSvc]: Publish /conference/leaving event"),R.publish("/conference/leaving",[e])):(v.debug("[CircuitCallControlSvc]: Publish /group/leaving event"),R.publish("/group/leaving",[e]))),e.outgoingFailed()?(e.terminateTimer=f(function(){e.terminateTimer=null,$(e,n)},S),e.terminateReason=n):$(e,n)}}function Re(e){if(!y.isDirect)if(y.sessionCtrl.hasMaxExtraVideoChannels())v.debug("[CircuitCallControlSvc]: We already have max number of extra video channels");else{var t=e&&e.participants.length;t||(t=y.sessionCtrl.getNumberOfExtraVideoChannels()+2);var n=Math.max(y.participants.length+1,t);y.sessionCtrl.setExtraVideoChannelsForParticipants(n)&&y.isEstablished()&&(v.debug("[CircuitCallControlSvc]: The number of extra channels has increased. Trigger a media renegotiation."),Ee(y.callId,null,y.localMediaType,!1,null,function(e){e&&v.warn("[CircuitCallControlSvc]: Failed to renegotiate the media. Error: ",e)}))}}function ge(t){var n=null;return P.some(function(e){if(e.callId===t)return n=e,!0}),n}function Ae(t){return G.find(function(e){return e.callId===t})||null}function _e(n){P.some(function(e,t){return e===n||e.callId===n.callId&&(P[t]=n,!0)})||P.push(n)}function me(t,n){if(n.streamId){var e=0===t.sessionCtrl.getNumberOfExtraVideoChannels();t.isMocked&&!e||t.participants.forEach(function(e){e.streamId===n.streamId&&e.userId!==n.userId&&(e.streamId="",v.debug("[CircuitCallControlSvc]: The video stream has been re-assigned. Clear the streamId for previous participant. [userId, streamId] = ",[e.userId,n.streamId]),y.setParticipantRemoteVideoStream(e),v.debug("[CircuitCallControlSvc]: Publish /call/participant/updated event. userId =",e.userId),R.publish("/call/participant/updated",[t.callId,e]))})}}function Ne(e,t){var n=W(e.convId);I.isSessionGuest||t.setActions(n,I.localUser)}function he(n,i,e,t){var r=n.addParticipant(i,e,t);return r&&(me(n,r),Ne(n,r),i.noData&&!i.reqPending&&(v.debug("[CircuitCallControlSvc]: Get user data for added participant. userId: ",i.userId),C.getUserById(i.userId,function(e,t){t&&(v.debug("[CircuitCallControlSvc]: Successfully retrieved participant data. userId: ",i.userId),n.isPresent()&&n.hasParticipant(i.userId)&&(i.firstName=t.firstName,i.lastName=t.lastName,v.debug("[CircuitCallControlSvc]: Publish /call/participant/updated event. userId =",i.userId),R.publish("/call/participant/updated",[n.callId,i])))}))),r}function Oe(e,t,n){var i=e.updateParticipant(t,n);return i&&(me(e,i),Ne(e,i)),i}function De(e,t,n){var i=at.ParticipantState.Terminated;switch(n){case ot.RTCSessionParticipantLeftCause.CONNECTION_LOST:case ot.RTCSessionParticipantLeftCause.STREAM_LOST:i=at.ParticipantState.ConnectionLost;break;case ot.RTCSessionParticipantLeftCause.REMOVED:i=at.ParticipantState.Removed;break;case ot.RTCSessionParticipantLeftCause.USER_LEFT_STAGE:i=at.ParticipantState.OffStage}e.setParticipantState(t,i);var r=e.removeParticipant(t);if(!e.hasOtherParticipants()){if(!e.conferenceCall)return v.debug("[CircuitCallControlSvc]: Publish /group/terminated event"),R.publish("/group/terminated",[e]),void ve(e,null,at.CallClientTerminatedReason.NO_USERS_LEFT,!0);e.setState(at.CallState.Waiting)}if(r){e.updateMediaType(),!e.isRemote&&r.isCMP&&r.isMeetingPointInvitee&&(e.setMeetingPointInviteState(!1),N.enableRemoteAudio(e.callId)),e.conferenceCall&&(v.debug("[CircuitCallControlSvc]: Publish /conference/participant/left event"),R.publish("/conference/participant/left",[e,n]));var o=n?{leftCause:n}:null;v.debug("[CircuitCallControlSvc]: Publish /call/participant/removed event"),R.publish("/call/participant/removed",[e.callId,r,o])}J(e)}function ye(e,t){if(!e||!t||!t.state)return null;var n=e.recording;return n.state!==t.state?(n.notifyByCurtain=t.state===ot.RecordingInfoState.START_PENDING||t.state===ot.RecordingInfoState.STARTED&&n.state===ot.RecordingInfoState.START_PENDING,n.notifyByUser=!n.notifyByCurtain||t.state===ot.RecordingInfoState.START_PENDING&&n.state!==ot.RecordingInfoState.STARTED):(n.notifyByCurtain=!1,n.notifyByUser=!1),n.state=t.state,n.duration=t.duration||n.duration,n.reason=t.reason,t.state===ot.RecordingInfoState.STARTED&&(n.resumeTime=Date.now()),t.starter&&t.starter.userId&&t.starter.userId!==n.starter.userId&&(n.starter=t.starter,n.starter.userId===I.localUser.userId?n.starter.res="res_StartedRecording_You":(n.starter.name=n.starter.firstName||n.starter.displayName,n.starter.res=n.starter.name?"res_StartedRecording_Other":"res_StartedRecording")),n}function be(e){y&&void 0!==e&&y.attendeeCount!==e&&(y.attendeeCount=e,y.updateCallState(),v.debug("[CircuitCallControlSvc]: Publish /call/attendeeCountChanged"),R.publish("/call/attendeeCountChanged",[y.callId,y.attendeeCount]))}function Pe(i){return new E(function(t,n){return!i||i.screenShareEventHandler?n("res_ErrorMsgInternal"):i.isVdi?t({}):(i.screenShareEventHandler=It.getScreen(function(e){f(function(){i.screenShareEventHandler=null,i.rejectGetScreenPromise=null,t(e||{})},0)},function(e){f(function(){i.screenShareEventHandler=null,i.rejectGetScreenPromise=null,e===ot.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED?n(e):n("res_AccessToDesktopFailed")},0)}),void(i.rejectGetScreenPromise=function(e){v.warn("[CircuitCallControlSvc]: Cancelling getScreen promise for call ID: ",i.callId),n(e)}))})}function Ue(r){return new E(function(n,t){var e=new Et({disableTrickleIce:!0,isDirectCall:!0,candidatesCollectionTest:!0}),i=function(){v.debug("[CircuitCallControlSvc]: Terminate ICE candidates collection test"),e.onSessionDescription=null,e.onRtcError=null,e.terminate()};r&&(e.setTurnUris(r.turnServer),e.setTurnCredentials(r)),e.disableRemoteVideo(),e.onSessionDescription=function(e){var t=Circuit.sdpParser.getIceCandidates(e.sdp.sdp);v.debug("[CircuitCallControlSvc]: testIceCandidates - candidates: ",t),i(),n({turnServers:r&&r.turnServer||[],candidates:t})},e.onRtcError=function(e){v.error("[CircuitCallControlSvc]: Error collecting candidates. ",e.error),i(),t(e.error)},v.debug("[CircuitCallControlSvc]: testIceCandidates - Start collection"),e.start({audio:!1})})}function Le(e){if(e&&e.replaces){var t=ee(e.replaces.callId);t&&ve(t,null,at.CallClientTerminatedReason.CALL_MOVED_TO_ANOTHER_CONV),v.debug("[CircuitCallControlSvc]: Publish /call/moved event"),R.publish("/call/moved",[e.replaces.callId,e.callId]),e.replaces=null}}function Me(e){var t=e&&e.sessionCtrl;t?(t.onIceCandidate=function(t,e){v.debug("[CircuitCallControlSvc]: RtcSessionController - onIceCandidate");var n={rtcSessionId:t.callId,userId:I.localUser.userId,origin:e.origin,candidates:e.candidates.map(JSON.stringify.bind(JSON))},i=T.createActionInfo(t,ot.RtcDiagnosticsAction.ICE_CANDIDATES);i&&(i.data=n.candidates,i.isEndOfCandidates=e.endOfCandidates),h.sendIceCandidates(n,function(e){T.finishActionInfo(t,i),e&&v.warn("Failed to send ICE candidate: ",e)})}.bind(null,e),t.onSdpConnected=function(t){v.debug("[CircuitCallControlSvc]: RtcSessionController - onSdpConnected"),I.$apply(function(){v.debug("[CircuitCallControlSvc]: Publish /call/sdpConnected event"),R.publish("/call/sdpConnected",[t]);var e=T.createActionInfo(t,ot.RtcDiagnosticsAction.SDP_CONNECTED);T.finishActionInfo(t,e),t.isTelephonyCall?(t.state.established||t.setState(at.CallState.Waiting),t.updateCallState()):t.setState(t.isDirect||t.hasOtherParticipants()?at.CallState.Active:at.CallState.Waiting),J(t),T.finishDeviceDiagnostics(t),T.sendCallConnected(t)})}.bind(null,e),t.onIceConnected=function(e,t){if(v.debug("[CircuitCallControlSvc]: RtcSessionController - onIceConnected. pcType:",t.pcType),"audio/video"===t.pcType&&e.isEstablished()){var n=e.disconnectCause||{};n.cause===ot.DisconnectCause.STREAM_LOST&&(e.disconnectCause=null),i(e,"connected")}}.bind(null,e),t.onIceDisconnected=function(e,t){v.debug("[CircuitCallControlSvc]: RtcSessionController - onIceDisconnected. pcType:",t.pcType),"audio/video"===t.pcType&&e.isEstablished()&&!e.isHeld()&&(e.setDisconnectCause(ot.DisconnectCause.STREAM_LOST),i(e,"disconnected"))}.bind(null,e),t.onRemoteVideoAdded=function(){v.debug("[CircuitCallControlSvc]: RtcSessionController - onRemoteVideoAdded")}.bind(null,e),t.onRemoteVideoRemoved=function(){v.debug("[CircuitCallControlSvc]: RtcSessionController - onRemoteVideoRemoved")}.bind(null,e),t.onRemoteStreamUpdated=function(e){v.debug("[CircuitCallControlSvc]: RtcSessionController - onRemoteStreamUpdated"),I.$apply(function(){v.debug("[CircuitCallControlSvc]: Publish /call/remoteStreamUpdated event"),R.publish("/call/remoteStreamUpdated",[e])})}.bind(null,e),t.onDTMFToneChange=function(e,t){v.debug("[CircuitCallControlSvc]: RtcSessionController - onDTMFToneChange"),t.tone?(v.debug("[CircuitCallControlSvc]: Sent DTMF Digit: "+t.tone),R.publish("/call/singleDigitSent",[e,t.tone])):""===t.tone&&(v.info("[CircuitCallControlSvc]: Digits played completely"),R.publish("/call/digitsSent",[e]))}.bind(null,e),t.onRtcError=we.bind(null,e),t.onRtcWarning=function(e,t){v.debug("[CircuitCallControlSvc]: RtcSessionController - onRtcWarning"),R.publish("/call/rtcWarning",[e,t.warning])}.bind(null,e),t.onLocalStreamEnded=function(t,e){v.debug("[CircuitCallControlSvc]: RtcSessionController - onStreamEnded"),e.isDesktop&&y.hasLocalScreenShare()?(v.debug("[CircuitCallControlSvc]: Screenshare stream ended, remove screenshare or terminate the call"),y.isEstablished()?N.removeScreenShare(y.callId):N.endCall(y.callId)):N.renegotiateMedia(t.callId,function(e){e&&(v.debug("[CircuitCallControlSvc]: Publish /call/localStreamEnded event"),R.publish("/call/localStreamEnded",[t]))})}.bind(null,e),t.onQosAvailable=function(e,t){if(v.debug("[CircuitCallControlSvc]: RtcSessionController - onQosAvailable"),t.renegotiationInProgress&&(e.terminateReason=at.CallClientTerminatedReason.MEDIA_RENEGOTIATION),e.sessionCtrl){if(e.qosSubmitted)return void v.info("[CircuitCallControlSvc]: QoS already submitted for call Id:",e.callId);a.sendQOSData(e,e.lastMediaType,t.qos,t.lastSavedStats)}t.renegotiationInProgress&&(e.terminateReason=null)}.bind(null,e),t.onStatsThresholdExceeded=function(e,t){n||(v.debug("[CircuitCallControlSvc]: RtcSessionController - onStatsThresholdExceeded. Cleared: ",!(!t||!t.cleared)),t&&t.cleared?R.publish("/call/rtp/threshholdExceeded/cleared",[e.callId]):R.publish("/call/rtp/threshholdExceeded/detected",[e.callId]))}.bind(null,e),t.onStatsNoOutgoingPackets=function(e){v.debug("[CircuitCallControlSvc]: RtcSessionController - onStatsNoOutgoingPackets. Publish /call/rtp/noOutgoingPackets event"),R.publish("/call/rtp/noOutgoingPackets",[e.callId])}.bind(null,e),t.onNetworkQuality=function(e,t){if(t&&t.quality){var n=t.quality,i={userId:I.localUser.userId,audio:{qualityLevel:n.qualityLevel.value,currentPlSend:n.currentPlSend,currentPlReceive:n.currentPlReceive,firstTimeLowQuality:n.firstTimeLowQuality}};v.debug("[CircuitCallControlSvc]: Publish /call/network/quality event for quality=",i.audio.qualityLevel),R.publish("/call/network/quality",[i])}}.bind(null,e),t.onGetUserMediaException=function(e,t){v.debug("[CircuitCallControlSvc]: RtcSessionController - onGetUserMediaException. Publish /call/getUserMediaException event"),R.publish("/call/getUserMediaException",[e,t.info])}.bind(null,e)):v.error("[CircuitCallControlSvc]: Failed to get RtcSessionController for given call. ",e)}function we(e,t){v.debug("[CircuitCallControlSvc]: RtcSessionController - onRtcError"),R.publish("/call/rtcError",[e,t.error]),e.checkState([at.CallState.Ringing,at.CallState.Answering])?fe(e,{type:ot.InviteRejectCause.BUSY}):e.sameAs(y)&&("res_CallMediaFailed"===t.error?(e.setDisconnectCause(ot.DisconnectCause.NEGOTIATION_FAILED),N.endCallWithCauseCode(e.callId,at.CallClientTerminatedReason.ICE_TIMED_OUT)):"res_CallMediaDisconnected"===t.error?(e.setDisconnectCause(ot.DisconnectCause.STREAM_LOST),N.endCallWithCauseCode(e.callId,at.CallClientTerminatedReason.LOST_MEDIA_STREAM),h.pingServer()):e.isEstablished()||N.endCall(e.callId))}function Ge(e){try{v.debug("[CircuitCallControlSvc]: Received RTCSession.ACTIVE_SPEAKER");var t=Z(e.sessionId);if(!t)return void v.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call");if(t.isDirect||t.participants.length<2)return void v.debug("[CircuitCallControlSvc]: Ignore RTC.ACTIVE_SPEAKER event for 1-2-1 calls");var n=[];if(e.first&&n.push(e.first),e.second&&n.push(e.second),e.third&&n.push(e.third),!t.setActiveSpeakers(n))return;v.debug("[CircuitCallControlSvc]: Publish /call/participant/activeSpeakers event"),R.publish("/call/participants/activeSpeakers",[t.callId,n])}catch(e){v.error("[CircuitCallControlSvc]: Exception handling RTC.ACTIVE_SPEAKER event. ",e)}}function He(e){try{v.debug("[CircuitCallControlSvc]: Received RTCSession.VIDEO_ACTIVE_SPEAKER");var t=Z(e.sessionId);if(!t)return void v.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call");var n=t.getParticipant(e.userId);if(!n)return void v.debug("[CircuitCallControlSvc]: Participant info not available. Ignoring VIDEO_ACTIVE_SPEAKER. userId=",e.userId);if(n.streamId===e.videoStreamId)return void v.debug("[CircuitCallControlSvc]: Participant is already assigned to the received videoStreamId. Ignoring VIDEO_ACTIVE_SPEAKER");I.$apply(function(){n.streamId=e.videoStreamId,me(t,n),t.setParticipantRemoteVideoStream(n),t.checkForActiveRemoteVideo(),v.debug("[CircuitCallControlSvc]: Publish /call/participant/updated event. userId =",n.userId),R.publish("/call/participant/updated",[t.callId,n])})}catch(e){v.error("[CircuitCallControlSvc]: Exception handling RTCSession.VIDEO_ACTIVE_SPEAKER event.",e)}}function ke(t){if(v.debug("[CircuitCallControlSvc]: Processing active session for convId = ",t.convId),t.participants&&0!==t.participants.length){var e=p.getConversationByRtcSession(t.rtcSessionId);if(e&&(e.hasJoined||e.isTemporary))if(e.call)v.debug("[CircuitCallControlSvc]: Conversation already has an associated call");else if(t.turnServers&&ce(t.rtcSessionId,t.turnServers),!Ae(t.rtcSessionId)){var n,i=!1;if(t.participants.some(function(e){if(e.userId===I.localUser.userId)return(n=e).clientId===h.clientId&&(i=!0),!0}),e.type!==ot.ConversationType.DIRECT||n){if(i){var r=function(e){e&&v.warn("[CircuitCallControlSvc] Lost session could not be terminated. Session Id=",t.rtcSessionId)},o={disconnectCause:ot.DisconnectCause.CONNECTION_LOST,disconnectReason:ot.DisconnectReason.CALL_LOST};if(e.type===ot.ConversationType.DIRECT)return void h.terminateRtcCall(t.rtcSessionId,o,r);h.leaveRtcCall(t.rtcSessionId,o,r)}Te(e,n,t,t.rtcSessionId,function(e){n&&Ve(e,t)})}}}else v.warn("[CircuitCallControlSvc]: The active session does not have participants. rtcSessionId = ",t.rtcSessionId)}function Ve(t,e){t&&t.isTelephonyCall&&e&&e.participants&&e.participants.length<=2&&e.participants.some(function(e){if(e.participantType===ot.RTCParticipantType.TELEPHONY)return oe(t,e.phoneNumber,null,e.userDisplayName),!0})}function Fe(e){var t=!1;return Z(e.rtcSessionId)&&e.participants&&(t=e.participants.some(function(e){return e.userId===I.localUser.userId&&e.clientId===h.clientId})),t}function Be(){return new E(function(s,e){k||I.isSessionGuest?(v.debug("[CircuitCallControlSvc]: Initialize active RTC sessions"),h.getActiveSessions(function(t,a){I.$apply(function(){t&&v.error("[CircuitCallControlSvc]: Error getting active sessions: ",t),a=a||[];for(var e=D.length-1;0<=e;e--)D[e].isRemote&&$(D[e]);P.empty();var n=null,i=!1,r=!1,o=[];a.forEach(function(e){var t=Z(e.rtcSessionId);if(t){if(Fe(e))return i=i||t===y,r=r||t===b,v.info("[CircuitCallControlSvc]: Found localCall in active sessions. Trigger media renegotiation."),void N.renegotiateMedia(t.callId);$(t,at.CallClientTerminatedReason.LOST_WEBSOCKET_CONNECTION)}(n=p.getConversationByRtcSession(e.rtcSessionId))&&n.hasJoined?ke(e):e.invitedGuests&&e.invitedGuests.includes(I.localUser.userId)?(v.info("[CircuitCallControlSvc]: Local user is invited as guest to this session"),o.push(p.createConversationAsGuestFromSummary(e.convId))):n||(v.info("[CircuitCallControlSvc]: Conversation associated with session is not cached. Need to get it."),o.push(p.getConversationPromise(e.convId)))}),R.publish("/activeSessions/received"),b&&!r&&$(b,at.CallClientTerminatedReason.LOST_WEBSOCKET_CONNECTION),y&&!i&&$(y,at.CallClientTerminatedReason.LOST_WEBSOCKET_CONNECTION),0<o.length?(v.info("[CircuitCallControlSvc]: Wait for get conversation promises to be resolved."),E.all(o).then(function(e){var n=e.map(function(e){return e.convId});v.debug("[CircuitCallControlSvc]: Retrieved the missing conversation(s): ",n),v.debug("[CircuitCallControlSvc]: Now that we have all the conversations, check if they still have active RTC sessions."),h.getActiveSessions(function(e,t){I.$apply(function(){e&&(v.error("[CircuitCallControlSvc]: Error getting active sessions: ",e),t=[]),t.forEach(function(e){-1!==n.indexOf(e.convId)&&(Fe(e)||ke(e))}),s()})})}).catch(function(e){v.error("[CircuitCallControlSvc]: Failed to retrieve the conversation(s). ",e)})):s()})})):e("Not ready to initialize active sessions")})}function xe(e,t){var n={rtcSessionId:e,transactionId:t};h.changeMediaReject(n,function(e){e?v.error("[CircuitCallControlSvc]: changeMediaReject sending error"):v.debug("[CircuitCallControlSvc]: changeMediaReject sent")})}function We(e,t){if(v.debug("[CircuitCallControlSvc]: Publish /call/incoming event"),R.publish("/call/incoming",[e.call]),r){var n={type:e.call.isGuestInvite?at.NotificationType.INCOMING_INVITATION_AS_GUEST:e.call.mediaType.video?at.NotificationType.INCOMING_VIDEO_CALL:at.NotificationType.INCOMING_VOICE_CALL,userId:t,extras:{conversation:e,call:e.call}};e.isTelephonyConv&&(n.user=e.call.peerUser),r.show(n)}e.call.startRingingTimer(function(){fe(e.call,{type:ot.InviteRejectCause.TIMEOUT},!1)})}function Ye(r,t){if(r&&t){var n=null,e=!1,i=!1,o=!1;if(r.replaces&&ge(r.replaces))e=!0;else if(y)if(y.callId===r.replaces)i=y.sessionCtrl&&y.sessionCtrl.isMuted(),n=y;else if(y.terminateTimer){if(y.callId===r.sessionId)return v.debug("[CircuitCallControlSvc]: Reject incoming call. Current call still not terminated"),void Se(r);$(y)}else{if(y.callId===r.sessionId)return void(y.isDirect?(v.debug("[CircuitCallControlSvc]: INVITE for same local call. Reject it"),Se(r)):v.warn("[CircuitCallControlSvc]: INVITE for same conversation as local call. Ignore it."));if(!y.isEstablished()&&(!t.isTelephonyConv||re()))return v.debug("[CircuitCallControlSvc]: Reject incoming call. Current call still not established"),void Se(r)}if(t.isTelephonyConv?r.to&&r.to.displayName&&r.to.displayName.startsWith("handover-from")?(v.debug("[CircuitCallControlSvc]: Received handover call"),F?(o=!0,f.cancel(F),F=null):(v.warn("[CircuitCallControlSvc]: INVITE for handover call from another client. Ignore it."),e=!0)):x&&(o=!0,f.cancel(x),x=null):U&&U.callId===r.replaces&&(i=L,n=U,U=null),Ae(r.sessionId))v.warn("[CircuitCallControlSvc]: INVITE for existing ringing call. Ignore it.");else{if(!e&&!n&&1<=G.length&&!o&&(!t.isTelephonyConv||re()))return v.debug("[CircuitCallControlSvc]: Reject second incoming call."),void Se(r);if(t.isTelephonyConv&&!o&&!e){if(I.localUser.selectedRoutingOption===ut.DeskPhone.name)return void Ie(t,r,!0);if(I.localUser.selectedBusyHandlingOption&&I.localUser.selectedBusyHandlingOption!==it.DefaultRouting.name){if(y||1<=G.length||!P.isEmpty()||t.call&&t.call.isAtcRemote)return void Ie(t,r)}else if(y&&y.isPresent()&&b&&b.isPresent())return v.debug("[CircuitCallControlSvc]: Reject incoming call. We cannot handle more than 2 local phone calls"),void Se(r)}var a={isAtcPullCall:t.isTelephonyConv&&o&&"offer"===r.sdp.type,clientId:h.clientId};n&&n.localMediaType.desktop&&(a.reuseDesktopStreamFrom=n.sessionCtrl);var s=new st(t,a);if(s.setCallIdForTelephony(r.sessionId),s.setInstanceId(r.instanceId),s.setTransactionId(r.transactionId),n){var c=(s.replaces=n).sessionCtrl.getLocalStream(Et.LOCAL_STREAMS.DESKTOP);c&&(v.debug("[CircuitCallControlSvc] Reusing desktop stream from call ID=",n.callId),s.sessionCtrl.setLocalStream(Et.LOCAL_STREAMS.DESKTOP,c),n.sessionCtrl.setLocalStream(Et.LOCAL_STREAMS.DESKTOP,null))}M&&(v.info("[CircuitCallControlSvc] Disabling remote video for incoming call"),s.disableRemoteVideo()),s.setState(at.CallState.Ringing),s.direction=at.CallDirection.INCOMING,I.localUser.isATC&&s.isTelephonyCall&&(s.atcCallInfo=new tt);var l=r.mediaType||["AUDIO"];he(s,se({userId:r.userId},l),at.ParticipantState.Calling),s.ringingTimeout=r.ringingTimeout||s.ringingTimeout;var d=ct.getMediaType(l);if((s.mediaType=d).desktop&&v.debug("[CircuitCallControlSvc]: INVITE for a Screen Share"),e)Q(s,!0);else{Q(s);var u,C,E=function(){I.$apply(function(){if(s.state!==at.CallState.Terminated){Me(s),v.debug("[CircuitCallControlSvc]: New alerting call: ",s.callId),t.call&&!t.isTelephonyConv&&(v.debug("[CircuitCallControlSvc]: Terminate the remote call and add the new local call to the conversation"),$(t.call));var e=null;if(t.call&&t.call.isAtcRemote&&(e=t.call.callId),t.call=s,t.isTelephonyConv&&o?(v.debug("[CircuitCallControlSvc]: Publish /atccall/replace event"),R.publish("/atccall/replace",[s,e])):z(t),n)N.answerCall(s.callId,n.localMediaType,function(e){e||i&&y.sessionCtrl&&y.sessionCtrl.mute()});else{if(I.localUser.isCMP&&(o=!0,d.video=!0,d.hdVideo=!0,d.desktop=!1),o)return s.isTelephonyCall&&r.from&&oe(s,r.from.phoneNumber,r.from.fullyQualifiedNumber,r.from.displayName,null,function(){if(r.telephonyInfo&&r.telephonyInfo.redirectingUser){var e=r.telephonyInfo.redirectingUser;ae(s,e.phoneNumber,e.fullyQualifiedNumber,e.displayName,lt.CallForward)}}),void N.answerCall(s.callId,d);h.sendProgress(s.callId,r.userId,I.localUser.userId,function(e){e&&v.error("[CircuitCallControlSvc]: sendProgress error",e)}),s.isTelephonyCall&&r.from?oe(s,r.from.phoneNumber,r.from.fullyQualifiedNumber,r.from.displayName,null,function(){if(t.call===s&&We(t,r.userId),r.telephonyInfo&&r.telephonyInfo.redirectingUser){var e=r.telephonyInfo.redirectingUser;ae(s,e.phoneNumber,e.fullyQualifiedNumber,e.displayName,lt.CallForward)}}):We(t,r.userId)}}else v.debug("[CircuitCallControlSvc]: New alerting call has been terminated already")})},T=function(e){v.warn("[CircuitCallControlSvc]: Warmup failed. Ignore the incoming call: ",e),R.publish("/call/warmupFailed",[e,s]),$(s,null,!0),t.isTemporary&&(v.debug("[CircuitCallControlSvc]: Publish /conversation/temporary/ended event"),R.publish("/conversation/temporary/ended",[t]))},p=s.sessionCtrl,S=(u=t.rtcSessionId,(C=w[u])&&C.turnServers&&C.turnServers.length?C.turnServers:null);if(I.localUser.isCMP&&p.useMaxNumberOfExtraVideoChannels(),!et.WebRTCAdapter.enabled)return v.warn("[CircuitCallControlSvc]: Client does not support WebRTC."),void T("res_NoWebRTC");K(s).then(function(e){if(s.isPresent()){var t;if(S?(v.debug("[CircuitCallControlSvc]: Using TURN servers associated with session: ",S),p.setTurnUris(S)):(v.debug("[CircuitCallControlSvc]: Using retrieved TURN servers"),p.setTurnUris(e.turnServer)),p.setTurnCredentials(e),v.debug("[CircuitCallControlSvc]: Set TURN credentials"),s.replaces)t=s.replaces.localMediaType;else{var n="firefox"===et.WebRTCAdapter.browser,i="android"===et.WebRTCAdapter.browser;t={audio:!(n||i||g||A),video:!1}}je(t,function(e){p.warmup(e,r.sdp,E,T)})}else v.debug("[CircuitCallControlSvc]: There is no incoming call anymore")}).catch(T)}}}else v.error("[CircuitCallControlSvc]: processInvite called without evt or conversation")}function Ke(e,t){e&&t&&(e.hasJoined||e.isTemporary?t.some(function(t){var n;if(e.rtcSessionId===t.rtcSessionId)return v.debug("[CircuitCallControlSvc]: Processing active session for convId = ",e.convId),t.participants&&0!==t.participants.length?(t.participants.some(function(e){if(e.userId===I.localUser.userId)return n=e,!0}),(e.type!==ot.ConversationType.DIRECT||n)&&(e.call?v.debug("[CircuitCallControlSvc]: Conversation already has an associated call"):Te(e,n,t,null,function(e){n?Ve(e,t):e.conferenceCall&&(v.debug("[CircuitCallControlSvc]: Publish /conference/started event"),R.publish("/conference/started",[e]))}))):v.warn("[CircuitCallControlSvc]: The active session does not have participants. rtcSessionId = ",t.rtcSessionId),!0}):v.debug("[CircuitCallControlSvc]: User is not a conversation participant. Ignore active session."))}function qe(n,e,i,r){n.type===ot.ConversationType.LARGE&&I.isSessionGuest&&(e.audio=!1,v.debug("[CircuitCallControlSvc]: Set media type for large conference participant to ",e)),je(e,function(e,t){t&&n.isTelephonyConv?r(t):(i.warning=t,Ce(n,e,i,r))})}function je(n,i){return v.debug("[CircuitCallControlSvc]: Check media sources for mediaType = ",n),!I.browser.msie||I.isSessionGuest||I.localUser.hasPermission(ot.SystemPermission.IE_PLUGIN_SUPPORT)?(n=n||{audio:!0,video:!1},d||g||A||!n.audio&&!n.video?(v.debug("[CircuitCallControlSvc]: Normalized mediaType = ",n),void i(n)):(v.debug("[CircuitCallControlSvc]: Get audio and video media sources"),void et.WebRTCAdapter.getMediaSources(function(e,t){n.video&&(!t||t.length<1)&&(n.video=!1,r="res_AnswerWarnNoCamera"),n.audio&&(!e||e.length<1)&&(n.audio=!1,r="res_AnswerWarnNoCamera"===r?"res_AccessToMediaInputDevicesFailed":"res_AccessToAudioInputDeviceFailed"),v.debug("[CircuitCallControlSvc]: Normalized mediaType = ",n),i(n,r)}))):(v.debug("[CircuitCallControlSvc]: User does not have permission to use IE plugin. Publish /ieplugin/permissionDenied event."),void R.publish("/iePlugin/permissionDenied"));var r}function Qe(e){e&&e.activeNotification&&!e.isHandoverInProgress&&(r&&r.dismiss(e.activeNotification),e.activeNotification=null)}function Xe(e){N.mute(e),N.disableRemoteAudio(e)}function ze(r,e,o){if(o=o||function(){},!r||!e)return v.error("[CircuitCallControlSvc]: addParticipant - Invalid arguments"),void o("Invalid arguments");var t=e.dialOutPhoneNumber,a=t?{userId:"gtc-callout-"+t.replace(/[+ ]+/g,""),phoneNumber:St.cleanPhoneNumber(t),displayName:e.displayName,resolvedUserId:e.userId,isExternal:!0,participantType:ot.RTCParticipantType.TELEPHONY,pstnDialIn:!1}:e;if(!a.userId)return v.warn("[CircuitCallControlSvc]: addParticipant - Participant missing userId"),void o("Missing userId");if(r.hasParticipant(a.userId)||a.resolvedUserId&&r.hasParticipant(a.resolvedUserId))return v.info("[CircuitCallControlSvc]: addParticipantTo - Participant is already in the call"),void o("Participant exists");v.debug("[CircuitCallControlSvc]: Adding participant to existing RTC session. userId =",a.userId);var n=St.shallowCopy(r.mediaType);n.audio=!0;var i={rtcSessionId:r.callId,userId:a.userId,mediaType:n};t&&(i.from={phoneNumber:St.cleanPhoneNumber(I.localUser.callerId),displayName:I.localUser.displayName},i.to={phoneNumber:a.phoneNumber,displayName:a.displayName,resolvedUserId:a.resolvedUserId}),h.addParticipantToRtcSession(i,function(i){I.$apply(function(){if(i){if(i===ot.ErrorCode.PERMISSION_DENIED)return v.info("[CircuitCallControlSvc]: Failed to add participant. Reached conference participants limit"),void o("res_MaxConversationParticipantsLimit");v.warn("[CircuitCallControlSvc]: Failed to add participant"),o("res_AddParticipantToRtcSessionFailed")}else{if(v.debug("[CircuitCallControlSvc]: Add participant request was successful"),r.direction=at.CallDirection.OUTGOING,!r.isRemote){var e=se(a,["AUDIO"]),t=at.ParticipantState.Initiated,n=he(r,e,t);n&&(n.isCMP&&(n.isMeetingPointInvitee=!0,r.setMeetingPointInviteState(!0),Xe(r.callId)),v.debug("[CircuitCallControlSvc]: Publish /call/participant/added event"),R.publish("/call/participant/added",[r.callId,n]))}o()}})})}function Je(e){v.debug("[CircuitCallControlSvc]: Publish /call/localUser/muted event"),R.publish("/call/localUser/muted",[e.callId,e.remotelyMuted,e.locallyMuted])}function $e(e,t,n){if(n=n||function(){},1<=G.length)return n("res_CannotJoinMultipleSessions"),!1;if(y&&y.isPresent())if(y.isTelephonyCall){if(!e.isTelephonyConv||!I.localUser.isATC)return n("res_CannotJoinMultipleSessions"),!1;if(b)return n("res_CannotInitiateThirdPhoneCall"),!1}else if(!t.replaces)return n("res_CannotJoinMultipleSessions"),!1;for(var i=0;i<D.length;i++)if(!D[i].state.established&&D[i].isTelephonyCall)return v.error("[CircuitCallControlSvc]: Cannot initiate second phone call if existing call is not established"),n("res_JoinRTCSessionFailed"),!1;if(e.isTelephonyConv){if(!t.handover&&(t.dialedDn=t.dialedDn?t.dialedDn.trim():null,!t.dialedDn))return n("Missing Dialed DN"),!1;if(!I.localUser.callerId)return n("Missing Caller ID"),!1}return!0}function Ze(e){return(e=e||{}).callOut=!!e.callOut,e.handover=!!e.handover,e}return R.subscribe("/conversation/update",function(t,e){if(e){var n=Z(t.rtcSessionId);n&&!n.isDirect&&(v.debug("[CircuitCallControlSvc]: Received /conversation/update event"),e.addedParticipants&&Re(t),void 0!==e.isModerated&&n.participants.forEach(function(e){e.setActions(t,I.localUser)}))}}),R.subscribe("/conversation/upgrade",function(t,n){if(v.debug("[CircuitCallControlSvc]: Received /conversation/upgrade event. Old convId = "+t.convId+". New convId = ",n.convId),t.call&&n.convId!==t.convId&&(t.call.checkState(at.CallState.Active)||t.type!==ot.ConversationType.DIRECT&&t.call.checkState(at.CallState.Waiting)))if(v.debug("[CircuitCallControlSvc]: Move Session"),t.type===ot.ConversationType.DIRECT&&n.type===ot.ConversationType.GROUP){var e=Ze({callOut:!0,handover:!1,replaces:t.call});ue(n,t.call.localMediaType,e)&&Ce(n,t.call.localMediaType,e,function(e){e||t.call.sessionCtrl&&t.call.sessionCtrl.isMuted()&&n.call.sessionCtrl&&n.call.sessionCtrl.mute()})}else{var i={sessionId:t.rtcSessionId,conversationId:t.convId,newSessionId:n.rtcSessionId,newConversationId:n.convId};h.moveRtcSession(i,function(e){e&&v.warn("[CircuitCallControlSvc]: Error moving RTC Session. ",e)})}}),R.subscribe("/conversation/left",function(e){v.debug("[CircuitCallControlSvc]: Received /conversation/left event. convId = "+e.convId),e&&e.call&&N.hideRemoteCall(e.call.callId)}),R.subscribe("/conversation/participants/add",function(t,e){v.debug("[CircuitCallControlSvc]: Received /conversation/participants/add event."),t&&e&&e.forEach(function(e){ze(t,e)})}),R.subscribe("/csta/handover",function(){v.debug("[CircuitCallControlSvc]: Received /csta/handover event."),F=f(function(){F=null},6e3)}),R.subscribe("/atccall/moveFailed",function(){v.debug("[CircuitCallControlSvc]: Received /atccall/moveFailed event."),F&&(f.cancel(F),F=null)}),R.subscribe("/atccall/pickUpInProgress",function(){v.debug("[CircuitCallControlSvc]: Received /atccall/pickUpInProgress event."),x=f(function(){x=null},3e3)}),R.subscribe("/conversations/loadComplete",function(){v.debug("[CircuitCallControlSvc]: Received /conversations/loadComplete event"),k=!0,Be()}),R.subscribe("/registration/state",function(e){v.debug("[CircuitCallControlSvc]: Received /registration/state event"),e!==RegistrationState.Registered?(y&&y.isTestCall&&$(y,at.CallClientTerminatedReason.LOST_WEBSOCKET_CONNECTION),G.forEach(function(e){v.debug("[CircuitCallControlSvc]: Lost websocket connection, terminate local incoming call"),$(e,at.CallClientTerminatedReason.LOST_WEBSOCKET_CONNECTION)}),e!==RegistrationState.Disconnected&&e!==RegistrationState.Waiting||D.forEach(function(e){$(e,at.CallClientTerminatedReason.LOST_WEBSOCKET_CONNECTION)})):I.isSessionGuest&&y&&Be()}),R.subscribe("/conversation/re-added",function(n){v.debug("[CircuitCallControlSvc]: Received /conversation/re-added event. convId = ",n.convId),h.getSession(n.rtcSessionId,function(e,t){e?v.warn("[CircuitCallControlSvc] Error retrieving session. Err: ",e):t.participants&&0<t.participants.length&&I.$apply(function(){Ke(n,[t])})})}),R.subscribe("/call/meetingPointInvitee",function(e){if(v.debug("[CircuitCallControlSvc]: Received /call/meetingPointInvitee event"),e){var t=Z(e);t&&(t.setMeetingPointInviteState(!0),Xe(e))}}),et.isElectron&&(O.on("DESKTOP_APP.PARTICIPANT_POINTER",function(n,e){try{v.debug("[CircuitCallControlSvc]: Received UserToUser DESKTOP_APP.PARTICIPANT_POINTER"),n.userId=e.srcUserId,C.getUserById(n.userId,function(e,t){e?v.error("[CircuitCallControlSvc]: User not found.",n.userId):y.hasLocalScreenShare()&&(n.name=t.displayName,require("electron").ipcRenderer.send("participant-pointer",n))})}catch(e){v.error("[CircuitCallControlSvc]: Exception handling UserToUser DESKTOP_APP.PARTICIPANT_POINTER event.",e)}}),O.on("DESKTOP_APP.PARTICIPANT_DRAWING",function(n,e){try{v.debug("[CircuitCallControlSvc]: Received UserToUser DESKTOP_APP.PARTICIPANT_DRAWING"),I.circuitLabs.PARTICIPANT_DRAWING&&(n.userId=e.srcUserId,C.getUserById(n.userId,function(e,t){e?v.error("[CircuitCallControlSvc]: User not found.",n.userId):y.hasLocalScreenShare()&&(n.name=t.displayName,require("electron").ipcRenderer.send("participant-drawing",n))}))}catch(e){v.error("[CircuitCallControlSvc]: Exception handling UserToUser DESKTOP_APP.PARTICIPANT_POINTER event.",e)}})),O.on("ATC.ADVANCING",function(e){try{if(e.type===nt.ADVANCING){v.debug("[CircuitCallControlSvc]: Received UserToUser ATC.ADVANCING");var t=Ae(e.rtcSessionId);t&&(t.atcAdvancing=!0,t.sessionCtrl.setIgnoreNextConnection(!0))}}catch(e){v.error("[CircuitCallControlSvc]: Exception handling UserToUser ATC.ADVANCING event. ",e)}}),h.on("RTCCall.SDP_ANSWER",function(e){try{v.debug("[CircuitCallControlSvc]: Received RTCCall.SDP_ANSWER");var i=Z(e.sessionId);if(!i)return void v.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call");if(h.clientId!==e.clientID)return void v.debug("[CircuitCallControlSvc]: Event is not for this client: ",h.clientId);i.isDirect&&T.startJoinDelayTimer(i),I.$apply(function(){var t=e.sdp;if(t){var n=T.createActionInfo(i,ot.RtcDiagnosticsAction.SDP_ANSWER);t.sdp&&"sdp"!==t.sdp&&"data"!==t.sdp||(t.sdp="sdp",v.debug("[CircuitCallControlSvc]: This is a mocked call"),i.setMockedCall()),Le(i),i.setInstanceId(e.instanceId),i.sessionCtrl.setRemoteDescription(t,function(e){i.clearTransactionId(),e&&(i.setDisconnectCause(ot.DisconnectCause.REMOTE_SDP_FAILED,"type="+t.type+" origin="+Tt.getOrigin(t.sdp)),ve(i,null,at.CallClientTerminatedReason.SET_REMOTE_SDP_FAILED),n&&(n.data=e)),T.finishActionInfo(i,n)})}})}catch(e){v.error("[CircuitCallControlSvc]: Exception handling RTCCall.SDP_ANSWER event. ",e)}}),h.on("RTCCall.ICE_CANDIDATES",function(e){try{v.debug("[CircuitCallControlSvc]: Received RTCCall.ICE_CANDIDATES",e);var t=Z(e.sessionId);if(!t)return void v.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call");if(h.clientId!==e.clientId)return void v.debug("[CircuitCallControlSvc]: Event is not for this client: ",h.clientId);t.sessionCtrl.addIceCandidates(e.origin,e.candidates);var n=T.createActionInfo(t,ot.RtcDiagnosticsAction.REMOTE_ICE_CANDIDATES);n&&(n.data=e.candidates,T.finishActionInfo(t,n))}catch(e){v.error("[CircuitCallControlSvc]: Exception handling RTCCall.ICE_CANDIDATES event. ",e)}}),h.on("RTCSession.SESSION_UPDATED",function(T){I.$apply(function(){try{var t,e;v.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_UPDATED"),T.session.participants.some(function(e){if(e.userId===I.localUser.userId)return t=e,!0});var l=Z(T.sessionId);if(t){var n=ge(T.sessionId);if(n)return v.debug("[CircuitCallControlSvc]: Event is for an existing active remote call"),n.mediaType=ct.getMediaType(T.session.mediaTypes),n.setActiveClient(t),void J(n);if(Ae(T.sessionId))return void v.debug("[CircuitCallControlSvc]: Event is for an existing active remote call");if(!l||l.callId!==T.sessionId&&!ne(!0))return(e=p.getConversationByRtcSession(T.sessionId))?t.clientId===h.clientId?void v.warn("[CircuitCallControlSvc]: Event is for a local call that has been terminated. Ignore event."):void Te(e,t,T.session,T.sessionId,function(e){Ve(e,T.session)}):void v.warn("[CircuitCallControlSvc]: Could not find corresponding conversation");if(t.clientId!==h.clientId){e=W(l.convId);var i=null,r=null,o=null;l.isTelephonyCall&&(i=l.peerUser.phoneNumber,r=l.peerUser.displayName,o=l.participants);var a=l.atcCallInfo;return $(l,at.CallClientTerminatedReason.ANOTHER_CLIENT_PULLED_CALL),void Te(e,t,T.session,T.sessionId,function(e){e.atcCallInfo=a,e.isTelephonyCall&&(oe(e,i,null,r),e.participants=o)})}l.remotelyMuted!==t.muted&&(l.remotelyMuted=t.muted,Je(l))}else if(!l||!l.isLarge)return void v.info("[CircuitCallControlSvc]: Not a large conference and local user is not in the participants list. Ignore event. ");l.instanceId||l.setInstanceId(T.session.instanceId),T.session.muted!==l.sessionMuted&&(l.sessionMuted=T.session.muted,v.debug("[CircuitCallControlSvc]: Publish /call/muted event"),R.publish("/call/muted",[l])),T.session.locked!==l.sessionLocked&&(l.sessionLocked=T.session.locked,v.debug("[CircuitCallControlSvc]: Publish /call/locked event"),R.publish("/call/locked",[l])),T.stageAction&&(v.debug("[CircuitCallControlSvc]: Publish /call/raiseHand/stageAction event"),R.publish("/call/raiseHand/stageAction",[T.stageAction])),T.session.curtain&&(l.curtain=T.session.curtain,v.debug("[CircuitCallControlSvc]: Publish /call/curtain event (session updated)"),R.publish("/call/curtain",[l.curtain])),l.whiteboardEnabled=!!T.session.whiteboardEnabled;var d,u=[],C=[],s=T.session.participants||[];if(I.localUser.isCMP||s.some(function(e,t){if(e.userId===I.localUser.userId)return s.splice(t,1),!0}),l.isDirect||l.isAtcConferenceCall()||(d=l.participants.filter(function(e){return e.pcState!==at.ParticipantState.Initiated}).map(function(e){return e.userId})),0<s.length||l.conferenceCall){var c=ct.getMediaType(T.session.mediaTypes);c.audio=c.audio||l.localMediaType.audio,c.video=c.video||l.localMediaType.video,c.desktop=c.desktop||l.localMediaType.desktop,l.mediaType=c,l.activeClient=null,Le(l),l.isAtcConferenceCall()||s.forEach(function(e){var t=!1,n=se(e),i=n.muted?at.ParticipantState.Muted:at.ParticipantState.Active,r=l.getParticipant(e.userId);if(te(n,l),r){St.removeArrayElement(d,e.userId);var o=r.pcState,a=r.videoStream;r.streamId===n.streamId&&r.hasSameMediaType(n)||(t=!0);var s=Oe(l,n,i);s&&(t||s.pcState!==o||s.videoStream!==a)&&C.push(s)}else{var c=he(l,n,i);c&&u.push(c)}})}var E=l.state;be(T.session.attendeeCount),(l.conferenceCall||l.checkState(at.CallState.Answering))&&(l.isEstablished()||l.setState(at.CallState.Waiting),l.updateCallState()),l.checkState(E)||J(l),Re(e=I.isSessionGuest?null:W(l.convId)),l.conferenceCall&&!l.hasOtherParticipants()&&(v.debug("[CircuitCallControlSvc]: Publish /conference/starting event"),R.publish("/conference/starting",[l])),d&&0<d.length&&d.forEach(function(e){var t=l.removeParticipant(e);t&&(v.debug("[CircuitCallControlSvc]: Publish /call/participant/removed event. userId = ",e),R.publish("/call/participant/removed",[l.callId,t]))}),0<C.length&&(v.debug("[CircuitCallControlSvc]: Publish /call/participants/updated event"),R.publish("/call/participants/updated",[l.callId,C])),0<u.length&&(v.debug("[CircuitCallControlSvc]: Publish /call/participants/added event"),R.publish("/call/participants/added",[l.callId,u])),l.isTestCall||T.session.recordingInfo&&T.session.recordingInfo.state!==ot.RecordingInfoState.INITIAL&&ye(l,T.session.recordingInfo)&&(v.debug("[CircuitCallControlSvc]: Publish /call/recording/info event"),R.publish("/call/recording/info",[l])),l.isJoiningGroupCall=!1,j()}catch(e){v.error("[CircuitCallControlSvc]: Exception handling RTCSession.SESSION_UPDATED event. ",e)}})}),h.on("RTCSession.SESSION_STARTED",function(n){if(k)try{v.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_STARTED");var e=Z(n.sessionId);if(e&&e.isTestCall)return void v.debug("[CircuitCallControlSvc]: Received SESSION_STARTED event for echo test call. Just ignore it.");n.session.turnServers&&ce(n.sessionId,n.session.turnServers);var i=W(n.convId);if(!i){if(v.info("[CircuitCallControlSvc]: Could not find corresponding conversation"),n.callOut)return;return v.info("[CircuitCallControlSvc]: Get the conversation from the server"),void p.getConversationById(n.convId,{randomLoaded:!0},function(e,n){e?v.warn("[CircuitCallControlSvc]: Could not retrieve corresponding conversation. Delete Pending Invite"):(v.info("[CircuitCallControlSvc]: Successfully retrieved the conversation. Check if there are any active sessions."),h.getActiveSessions(function(e,t){I.$apply(function(){e&&(v.error("[CircuitCallControlSvc]: Error getting active sessions: ",e),t=[]),Ke(n,t)})}))})}if(!i.hasJoined)return void v.info("[CircuitCallControlSvc]: User is not a conversation participant. Ignore event.");I.$apply(function(){if(e)v.debug("[CircuitCallControlSvc]: Found local call for SESSION_STARTED event"),v.info("[CircuitCallControlSvc]: Ignore SESSION_STARTED. State =",e.state.name);else if(n.callOut)n.session.participants.some(function(e){if(e.userId===I.localUser.userId&&e.clientId!==h.clientId)return Te(i,e,n.rtcSession,n.sessionId,function(e){e.pullNotAllowed=!0}),!0});else if(i.type===ot.ConversationType.GROUP||i.type===ot.ConversationType.LARGE){var t=n.session.participants.find(function(e){return e.userId===I.localUser.userId&&e.clientId!==h.clientId});Te(i,t,n.rtcSession,n.sessionId,function(e){t||(v.debug("[CircuitCallControlSvc]: Publish /conference/started event"),R.publish("/conference/started",[e]))})}be(n.session.attendeeCount)})}catch(e){v.error("[CircuitCallControlSvc]: Exception handling RTCSession.SESSION_STARTED event: ",e)}else v.info("[CircuitCallControlSvc]: Conversations are not loaded. Do not process the SESSION_STARTED event.")}),h.on("RTCSession.PARTICIPANT_JOINED",function(o){try{v.debug("[CircuitCallControlSvc]: Received RTCSession.PARTICIPANT_JOINED");var a=o.participant.userId;if(I.localUser.userId===a)return void v.debug("[CircuitCallControlSvc]: Ignore JOINED event for own user");var e=ge(o.sessionId);if(e)return void I.$apply(function(){e.pullNotAllowed&&(e.pullNotAllowed=!1),e.isTelephonyCall&&!e.atcCallInfo&&oe(e,o.participant.phoneNumber,null,o.participant.userDisplayName)});var s=Z(o.sessionId);if(!s)return void v.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.");if(!s.isEstablished()&&s.direction===at.CallDirection.INCOMING)return void v.info("[CircuitCallControlSvc]: Ignore JOINED event for incoming alerting calls");I.$apply(function(){o.participant.userDisplayName&&o.participant.userDisplayName.startsWith("VoiceMail of")&&s.sessionCtrl.setCallStatsOptions({sendOnlyStream:!0}),s.isTelephonyCall&&!s.atcCallInfo&&oe(s,o.participant.phoneNumber,null,o.participant.userDisplayName),s.checkState([at.CallState.Delivered,at.CallState.Waiting])&&(s.checkState(at.CallState.Delivered)?s.setState(at.CallState.Waiting):s.conferenceCall&&s.sessionCtrl.isConnected()&&s.setState(at.CallState.Active),s.activeClient=null,Le(s));var e=se(o.participant),t=e.muted?at.ParticipantState.Muted:at.ParticipantState.Active;if(te(e,s),s.hasParticipant(a)){var n=Oe(s,e,t);n&&(v.debug("[CircuitCallControlSvc]: Publish /call/participant/updated event"),R.publish("/call/participant/updated",[s.callId,n]))}else{var i=he(s,e,t);i&&(v.debug("[CircuitCallControlSvc]: Publish /call/participant/added event"),R.publish("/call/participant/added",[s.callId,i]))}var r=o.userEnteredStage?{userEnteredStage:o.userEnteredStage}:null;v.debug("[CircuitCallControlSvc]: Publish /call/participant/joined event"),R.publish("/call/participant/joined",[s,s.getParticipant(e.userId),r]),j(),s.updateMediaType(),J(s),Re()})}catch(e){v.error("[CircuitCallControlSvc]: Exception handling RTC.PARTICIPANT_JOINED event. ",e)}}),h.on("RTCSession.SESSION_MOVED",function(e){try{if(v.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_MOVED"),V[e.oldRtcSessionId])return v.info("[CircuitCallControlSvc]: Event is for a pending INVITE. Ignore it."),void delete V[e.oldRtcSessionId];var o=ee(e.oldRtcSessionId);if(!o)return void v.info("[CircuitCallControlSvc]: Event is not for local or remote call. Ignore it.");var a=W(e.oldConversationId),s=W(e.newConversationId);if(!a||!s)return void v.warn("[CircuitCallControlSvc]: Could not find corresponding conversations");I.$apply(function(){var e,t,n,i;if(e=s,t=a,i=(n=o).isRemote?new dt(t):new st(t,{clientId:n.clientId}),(t.call=i).terminate(),v.debug("[CircuitCallControlSvc]: Publish /call/ended event"),R.publish("/call/ended",[i,!0]),t.call=null,z(t),n.updateCall(e),e.call=n,z(e),J(n),v.debug("[CircuitCallControlSvc]: Publish /call/moved event"),R.publish("/call/moved",[i.callId,n.callId]),o.isRemote)v.debug("[CircuitCallControlSvc]: Session Moved for Remote Call");else if("iOS"!==l.navigator.platform&&Re(s),s.creatorId===I.localUser.userId){var r={};a.participants.forEach(function(e){r[e.userId]=!0}),s.participants.forEach(function(e){r[e.userId]||ze(o,e)})}})}catch(e){v.error("[CircuitCallControlSvc]: Exception handling RTC.SESSION_MOVED event. ",e)}}),h.on("RTCCall.INVITE",function(e){if(k){if(I.localUser.isCMP){if(I.localUser.userPresenceState.state===ot.PresenceState.BUSY)return v.info("[CircuitCallControlSvc]: CMP is updating its software. Reject the INVITE with cause BUSY."),void Se(e);if(!I.inviterUserId||I.inviterUserId!==e.userId)return v.info("[CircuitCallControlSvc]: Reject the INVITE with cause BUSY."),void Se(e)}try{v.debug("[CircuitCallControlSvc]: Received RTCCall.INVITE");var t=e.isGuestInvite&&!I.localUser.isCMP,n=W(e.convId);if(!n){v.info("[CircuitCallControlSvc]: Could not find corresponding conversation. Save pending INVITE and retrieve conversation.");var i=e.sessionId;return V[i]=e,void(t?p.createConversationAsGuestFromSummary(e.convId).then(function(e){V[i]&&(v.info("[CircuitCallControlSvc]: Successfully retrieved conversation. Process the pending INVITE message."),Ye(V[i],e),delete V[i])}).catch(function(){v.warn("[CircuitCallControlSvc]: Could not create temporary conversation from summary."),delete V[i]}):p.getConversationById(e.convId,{randomLoaded:!0,sessionId:e.sessionId},function(e,n){e?v.warn("[CircuitCallControlSvc]: Could not retrieve corresponding conversation. Delete Pending Invite"):V[i]?(v.info("[CircuitCallControlSvc]: Successfully retrieved conversation. Process the pending INVITE message."),Ye(V[i],n)):(v.info("[CircuitCallControlSvc]: Successfully retrieved conversation. Check if there are any active sessions."),h.getActiveSessions(function(e,t){I.$apply(function(){e&&(v.error("[CircuitCallControlSvc]: Error getting active sessions: ",e),t=[]),Ke(n,t)})})),delete V[i]}))}if(t&&!n.isTemporary&&(n=p.createConversationAsGuest(n)),!n.hasJoined&&!t)return void v.info("[CircuitCallControlSvc]: User is not a conversation participant. Ignore event.");I.$apply(function(){Ye(e,n)})}catch(e){v.error("[CircuitCallControlSvc]: Exception handling RTCCall.INVITE event. ",e)}}else v.info("[CircuitCallControlSvc]: Conversations are not loaded. Do not process the INVITE event.")}),h.on("RTCSession.PARTICIPANT_LEFT",function(u){I.$apply(function(){try{v.debug("[CircuitCallControlSvc]: Received RTCSession.PARTICIPANT_LEFT");var e=I.localUser.userId===u.userId,n=Z(u.sessionId),t=[ot.RTCSessionParticipantLeftCause.TRANSPORT_NEGOTIATION_FAILED,ot.RTCSessionParticipantLeftCause.NEGOTIATION_FAILED,ot.RTCSessionParticipantLeftCause.SECURITY_NEGOTIATION_FAILED];if(e){if(n&&!n.isDirect&&!n.isEstablished()&&!t.includes(u.cause))return void v.debug("[CircuitCallControlSvc]: Ignore PARTICIPANT_LEFT event for non-established group calls");v.debug("[CircuitCallControlSvc]: Publish /localUser/leftConference event"),R.publish("/localUser/leftConference",[u.sessionId])}var i=ge(u.sessionId);if(i)return v.info("[CircuitCallControlSvc]: Event is for active remote call."),void(e&&pe(i));if(!n){var r=Ae(u.sessionId);if(r&&!r.isDirect&&r.hasParticipant(u.userId)){v.info("[CircuitCallControlSvc]: Event is for an incoming call. Caller has left the conversation."),De(r,u.userId,u.cause);var o=W(r.convId);o&&(Te(o),$(r,at.CallClientTerminatedReason.CALLER_LEFT_CONFERENCE))}else v.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.");return}if(n.isTestCall)return void v.debug("[CircuitCallControlSvc]: Ignore PARTICIPANT_LEFT event for test calls");if(n.isDirect)return void(e||u.cause!==ot.RTCSessionParticipantLeftCause.CONNECTION_LOST&&u.cause!==ot.RTCSessionParticipantLeftCause.STREAM_LOST?v.debug("[CircuitCallControlSvc]: Ignore PARTICIPANT_LEFT event for direct calls"):n.setParticipantState(u.userId,at.ParticipantState.ConnectionLost));var a=u.userId,s=W(n.convId);if(e){if(Te(s),u.cause===ot.RTCSessionParticipantLeftCause.REMOVED){var c=n.getParticipant(u.requesterId);R.publish("/call/droppedRemotely",[n,c])}else if(t.includes(u.cause))return void we(n,{error:"res_CallMediaFailed"});$(n,at.CallServerTerminatedReason.SERVER_ENDED_PRFX+u.cause)}else{if(u.cause===ot.RTCSessionParticipantLeftCause.MAX_PARTICIPANTS_REACHED){var l=s.participants.some(function(e){return e.userId===a}),d=function(e,t){e||(v.debug("[CircuitCallControlSvc]: Publish /call/participant/rejected event"),R.publish("/call/participant/rejected",[n.callId,t]))};return void(l?C.getUserById(a,d):d())}De(n,a,u.cause)}}catch(e){v.error("[CircuitCallControlSvc]: Exception handling RTCSession.PARTICIPANT_LEFT event. ",e)}})}),h.on("RTCCall.SDP_FAILED",function(e){try{v.debug("[CircuitCallControlSvc]: Received RTCCall.SDP_FAILED with cause =",e.cause);var t=Z(e.sessionId);if(!t)return void v.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call");if(h.clientId!==e.clientID)return void v.debug("[CircuitCallControlSvc]: Event is not for this client");if(t.instanceId||t.setInstanceId(e.instanceId),e.cause===ot.SdpFailedCause.SESSION_TERMINATED)return void v.debug("[CircuitCallControlSvc]: SDP_FAILED due to session terminated. Ignore");I.$apply(function(){t.isEstablished()?t.sessionCtrl.renegotiationFailed("SDP failed received"):e.cause===ot.SdpFailedCause.MAX_PARTICIPANTS_REACHED?we(t,{error:"res_JoinRTCSessionFailedPermission"}):t.isDirect&&t.isCallOut||(e.cause===ot.SdpFailedCause.SESSION_STARTED_FAILED?$(t,at.CallServerTerminatedReason.SERVER_ENDED_PRFX+e.cause):ve(t,null,at.CallClientTerminatedReason.REQUEST_TO_SERVER_FAILED))})}catch(e){v.error("[CircuitCallControlSvc]: Exception handling RTCCall.SDP_FAILED event. ",e)}}),h.on("RTCSession.SESSION_TERMINATED",function(t){try{if(v.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_TERMINATED"),w[t.sessionId]&&delete w[t.sessionId],V[t.sessionId])return v.info("[CircuitCallControlSvc]: Event is for a pending INVITE. Ignore it."),void delete V[t.sessionId];var n=ee(t.sessionId);if(!n)return void v.warn("[CircuitCallControlSvc]: Could not find call with rtcSessionId =",t.sessionId);if(n.terminateTimer)return void v.info("[CircuitCallControlSvc]: Call is already being terminated. Ignore event");n.isTelephonyCall&&F&&(v.debug("[CircuitCallControlSvc]: Call is being moved to another device, keep showing"),n.setAtcHandoverInProgress(),f.cancel(F),F=null),I.$apply(function(){var e=t.cause;v.info("[CircuitCallControlSvc]: Publish /call/terminated. cause = ",e),R.publish("/call/terminated",[n,e]),$(n,at.CallServerTerminatedReason.SERVER_ENDED_PRFX+e)})}catch(e){v.error("[CircuitCallControlSvc]: Exception handling RTCSession.SESSION_TERMINATED event. ",e)}}),h.on("RTCCall.INVITE_CANCEL",function(o){try{if(h.clientId===o.clientID)return void v.debug("[CircuitCallControlSvc]: Ignore own INVITE_CANCEL");if(V[o.sessionId])return v.info("[CircuitCallControlSvc]: Event is for a pending INVITE. Ignore it."),void delete V[o.sessionId];I.$apply(function(){v.debug("[CircuitCallControlSvc]: Received RTCCall.INVITE_CANCEL with cause: ",o.cause);var t=Ae(o.sessionId);if(t){if(!t.isDirect||o.cause===ot.InviteCancelCause.ACCEPT){var e=W(t.convId),n=o.cause===ot.InviteCancelCause.ACCEPT?{clientId:o.clientID}:null;Te(e,n,null,o.sessionId,function(e){n&&e.isTelephonyCall&&oe(e,t.peerUser.phoneNumber,null,t.peerUser.displayName)})}var i=at.CallClientTerminatedReason.ANOTHER_CLIENT_REJECTED;o.cause===ot.InviteCancelCause.ACCEPT?i=at.CallClientTerminatedReason.ANOTHER_CLIENT_ANSWERED:o.cause===ot.InviteCancelCause.REVOKED&&(i=at.CallClientTerminatedReason.ENDED_BY_ANOTHER_USER),$(t,i)}else if(v.debug("[CircuitCallControlSvc]: There is no corresponding alerting call"),o.cause===ot.InviteCancelCause.ACCEPT){var r=ee(o.sessionId);r&&r.isRemote&&(v.debug("[CircuitCallControlSvc]: There is a remote call, probably ringing timeout or another client called in"),r.activeClient={clientId:o.clientID},r.setState(at.CallState.ActiveRemote),_e(r),J(r))}})}catch(e){v.error("[CircuitCallControlSvc]: Exception handling RTCCall.INVITE_CANCEL event. ",e)}}),h.on("RTCCall.INVITE_FAILED",function(o){try{v.debug("[CircuitCallControlSvc]: Received RTCCall.INVITE_FAILED");var a=Z(o.sessionId);if(!a)return void v.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call");if(!a.isDirect){var e=a.getParticipant(o.userId);if(o.to){e.displayName=o.to.displayName;var t=Oe(a,e);t&&(v.debug("[CircuitCallControlSvc]: Publish /call/participant/updated event"),R.publish("/call/participant/updated",[a.callId,t]))}if(e&&e.isActive())return void v.debug("[CircuitCallControlSvc]: Unexpected event. participant already connected: ",o.userId)}if(o.clientID&&h.clientId!==o.clientID)return void v.debug("[CircuitCallControlSvc]: Event is not for this client: ",h.clientId);a.isTelephonyCall&&o.to&&oe(a,o.to.phoneNumber,o.to.fullyQualifiedNumber,o.to.displayName,o.to.userId),I.$apply(function(){var e,t=a,n=o.cause,i=o.userId;switch(n){case ot.InviteFailedCause.NOT_REACHABLE:e=at.ParticipantState.Offline,t.isDirect&&t.setState(at.CallState.Failed);break;case ot.InviteFailedCause.BUSY:e=at.ParticipantState.Busy,t.isDirect&&t.setState(at.CallState.Busy);break;case ot.InviteFailedCause.DECLINE:e=at.ParticipantState.Declined,t.isDirect&&t.setState(at.CallState.Declined);break;case ot.InviteFailedCause.TIMEOUT:e=at.ParticipantState.Timeout,t.isDirect&&t.setState(at.CallState.NotAnswered);break;case ot.InviteFailedCause.TEMPORARILY_UNAVAILABLE:case ot.InviteFailedCause.INVALID_NUMBER:e=at.ParticipantState.Busy,t.isDirect&&t.setState(at.CallState.Failed);break;case ot.InviteFailedCause.REVOKED:e=at.ParticipantState.Removed,t.isDirect&&t.setState(at.CallState.Failed);break;default:v.warn("[CircuitCallControlSvc]: Unexpected RTCCall.INVITE_FAILED cause =",o.cause),e=at.ParticipantState.Busy,t.isDirect&&t.setState(at.CallState.Failed)}if(t.isDirect)t.setParticipantState(i,e),J(t),t.hasVideo()&&t.removeParticipant(i),ve(t,null,at.CallServerTerminatedReason.SERVER_ENDED_PRFX+n,!0);else{t.setParticipantState(i,e);var r=t.removeParticipant(i);r&&(v.debug("[CircuitCallControlSvc]: Publish /call/participant/removed event"),R.publish("/call/participant/removed",[t.callId,r]),t.participants.isEmpty()&&(t.conferenceCall?t.checkState(at.CallState.Waiting)||(t.setState(at.CallState.Waiting),J(t)):(t.setState(at.CallState.NotAnswered),J(t),ve(null,null,at.CallServerTerminatedReason.SERVER_ENDED_PRFX+n,!0))))}})}catch(e){v.error("[CircuitCallControlSvc]: Exception handling RTC.INVITE_FAILED event. ",e)}}),h.on("RTCSession.ACTIVE_SPEAKER",Ge),h.on("RTCSession.VIDEO_ACTIVE_SPEAKER",He),h.on("RTCCall.CHANGE_MEDIA_TYPE_REQUESTED",function(i){try{if(v.debug("[CircuitCallControlSvc]: Received RTCSession.CHANGE_MEDIA_TYPE_REQUESTED"),Ae(i.sessionId))return void xe(i.sessionId,i.transactionId);var r=Z(i.sessionId);if(!r||r.isRemote)return void v.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.");if(i.clientID&&h.clientId!==i.clientID)return void v.debug("[CircuitCallControlSvc]: Event is not for this client: ",h.clientId);if(r.activeClient)return void v.debug("[CircuitCallControlSvc]: Pull in progress. leave it for active client to handle");if(!r.isEstablished()&&r.direction===at.CallDirection.INCOMING||!r.isDirect)return void xe(r.callId,i.transactionId);I.$apply(function(){if(i.sdp){var n=r.sessionCtrl;if(!n.isConnStable())return void xe(r.callId,i.transactionId);r.setTransactionId(i.transactionId),r.isTelephonyCall&&r.atcAdvancing&&"nooffer"!==i.sdp.type&&r.sessionCtrl.setIgnoreTurnOnNextPC();var t=function(e){n.onSessionDescription=null;var t={rtcSessionId:r.callId,sdp:e.sdp,transactionId:r.transactionId};h.changeMediaAccept(t,function(e){I.$apply(function(){r.clearTransactionId(),e?v.error("[CircuitCallControlSvc]: changeMediaAccept sdp answer sending error"):v.debug("[CircuitCallControlSvc]: changeMediaAccept sdp answer sent")})})};r.atcAdvancing=!1,K(r).then(function(e){n.setTurnCredentials(e),Tt.isNoOfferSdp(i.sdp)?Ee(r.callId,r.transactionId,r.localMediaType,!1,null,function(e){e&&v.warn("[CircuitCallControlSvc]: Failed to renegotiate the media")}):(r.lastMediaType=r.mediaType,n.onSessionDescription=t,n.setRemoteDescription(i.sdp,function(e){e&&(n.onSessionDescription=null,r.transactionId===i.transactionId?xe(r.callId,i.transactionId):v.warn("[CircuitCallControlSvc]: TransactionId: "+i.transactionId+" has already been completed."))}))}).catch(function(){xe(r.callId,i.transactionId)})}else xe(r.callId,i.transactionId)})}catch(e){v.error("[CircuitCallControlSvc]: Exception handling RTCSession.CHANGE_MEDIA_REQUESTED event. ",e)}}),h.on("RTCCall.CHANGE_MEDIA_TYPE_FORCED",function(e){try{v.debug("[CircuitCallControlSvc]: Received RTCSession.CHANGE_MEDIA_TYPE_FORCED");var t=Z(e.sessionId);if(!t)return void v.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.");if(t.isDirect)return void v.debug("[CircuitCallControlSvc]: Event is not applicable for direct calls. Ignore it.");if(e.clientID&&h.clientId!==e.clientID)return void v.debug("[CircuitCallControlSvc]: Event is not for this client: ",h.clientId);if(t.activeClient)return void v.debug("[CircuitCallControlSvc]: Pull in progress. leave it for active client to handle");e.removeMediaTypes&&(t.localMediaType.desktop&&e.removeMediaTypes.includes(ot.RealtimeMediaType.DESKTOP_SHARING)&&I.$apply(function(){!function(e,t){if(e&&e.hasLocalScreenShare()&&e.checkState([at.CallState.Active,at.CallState.Waiting])){var n=t&&e.getParticipant(t),i=n&&n.displayName;v.debug("[CircuitCallControlSvc]: Publish /screenshare/forceStop/started event"),R.publish("/screenshare/forceStop/started",[t]),N.removeScreenShare(e.callId,function(e){v.debug("[CircuitCallControlSvc]: Publish /screenshare/forceStop/ended event"),R.publish("/screenshare/forceStop/ended",[e])}),r&&r.show({type:at.NotificationType.HIGH_PRIORITY,user:I.localUser,extras:{title:I.i18n.map.res_ScreenShareNotificationTitle,text:i?I.i18n.localize("res_ScreenShareRemotelyDisabledByUser",[i]):I.i18n.map.res_ScreenShareRemotelyDisabled}})}}(t,e.userId)}),e.removeMediaTypes.includes(ot.RealtimeMediaType.AUDIO)&&I.$apply(function(){N.removeAudio(t.callId)}))}catch(e){v.error("[CircuitCallControlSvc]: Exception handling RTCSession.CHANGE_MEDIA_TYPE_FORCED event. ",e)}}),h.on("RTCCall.RTC_QUALITY_RATING_EVENT",function(e){v.debug("[CircuitCallControlSvc]: Received RTCCall.RTC_QUALITY_RATING_EVENT"),y||b?v.info("[CircuitCallControlSvc]: Ignore call quality rating during call."):I.$apply(function(){v.debug("[CircuitCallControlSvc]: Publish /call/showRatingDialog event"),R.publish("/call/showRatingDialog",[e])})}),h.on("RTCCall.IFRAME_STATISTICS",function(e){v.debug("[CircuitCallControlSvc]: Received RTCCall.IFRAME_STATISTICS"),I.$apply(function(){r&&r.show({type:at.NotificationType.HIGH_PRIORITY,user:I.localUser,extras:{title:I.i18n.map.res_ScreenShareNotificationTitle,text:I.i18n.localize("res_ScreenShareIFrameDelay",[Math.round(e.receiveDuration/1e3)])}})})}),h.on("RTCSession.PARTICIPANT_UPDATED",function(c){try{v.debug("[CircuitCallControlSvc]: Received RTCSession.PARTICIPANT_UPDATED");var l=Z(c.sessionId),e=ge(c.sessionId)||l;if(e&&e.callId===c.sessionId&&e.isTelephonyCall&&!e.atcCallInfo&&I.localUser.userId!==c.participant.userId&&oe(e,c.participant.phoneNumber,null,c.participant.userDisplayName),!l)return void v.info("[CircuitCallControlSvc]: Event is not for local call. Ignore it.");I.$apply(function(){var e=c.participant.userId,t=c.participant.muted;if(I.localUser.userId!==e)if(l.isEstablished()||l.direction!==at.CallDirection.INCOMING){var n=l.getParticipant(c.participant.userId);if(n){var i=se(c.participant),r=i.muted?at.ParticipantState.Muted:at.ParticipantState.Active,o=n.muted!==i.muted,a=!n.hasSameMediaType(i)||n.streamId!==i.streamId,s=Oe(l,i,r);s&&(te(s,l),a&&l.updateMediaType(),(a||o)&&(v.debug("[CircuitCallControlSvc]: Publish /call/participant/updated event"),R.publish("/call/participant/updated",[l.callId,s]))),J(l)}else v.debug("[CircuitCallControlSvc]: Ignore UPDATED event, can not find participant to update for userId: ",e)}else v.debug("[CircuitCallControlSvc]: Ignore UPDATED event for incoming alerting calls");else l.remotelyMuted!==t&&(l.remotelyMuted=t,Je(l))})}catch(e){v.error("[CircuitCallControlSvc]: Exception handling RTCSession.PARTICIPANT_UPDATED event. ",e)}}),h.on("RTCSession.SESSION_RECORDING_INFO",function(e){v.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_RECORDING_INFO");var t=Z(e.sessionId);t?I.$apply(function(){ye(t,e.recordingInfo)&&(v.debug("[CircuitCallControlSvc]: Publish /call/recording/info event"),R.publish("/call/recording/info",[t]))}):v.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")}),h.on("RTCSession.SESSION_TERMINATION_TIMER_STARTED",function(e){v.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_TERMINATION_TIMER_STARTED");var t=Z(e.sessionId);t?I.$apply(function(){v.debug("[CircuitCallControlSvc]: Publish /call/sessionTerminateTimerChanged (started)"),R.publish("/call/sessionTerminateTimerChanged",[t.callId,e.endTime])}):v.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")}),h.on("RTCSession.SESSION_TERMINATION_TIMER_CANCELLED",function(e){v.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_TERMINATION_TIMER_CANCELLED");var t=Z(e.sessionId);t?I.$apply(function(){v.debug("[CircuitCallControlSvc]: Publish /call/sessionTerminateTimerChanged (cancelled)"),R.publish("/call/sessionTerminateTimerChanged",[t.callId,null])}):v.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")}),h.on("RTCSession.SESSION_ATTRIBUTES_CHANGED_EVENT",function(e){v.debug("[CircuitCallControlSvc]: Received RTCSession.SESSION_ATTRIBUTES_CHANGED_EVENT");var t=Z(e.sessionId);t?void 0!==e.attendeeCount&&t.attendeeCount!==e.attendeeCount?I.$apply(function(){be(e.attendeeCount)}):v.debug("[CircuitCallControlSvc]: No changes"):v.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")}),h.on("RTCCall.PROGRESS",function(t){v.debug("[CircuitCallControlSvc]: Received RTCCall.PROGRESS");var n=Z(t.sessionId);if(n)if(n.isDirect&&(t.sdp||t.progressType!==ot.RTCProgressType.ALERTING?t.sdp&&n.receivedAlerting&&(v.debug("[CircuitCallControlSvc]: Publish /sound/call/alerting/stopped, call ID: ",n.callId),R.publish("/sound/call/alerting/stopped",[n])):(n.receivedAlerting=!0,v.debug("[CircuitCallControlSvc]: Publish /sound/call/alerting/started, call ID: ",n.callId),R.publish("/sound/call/alerting/started",[n]))),n.checkState([at.CallState.Initiated,at.CallState.Delivered])){t.to&&n.isTelephonyCall&&!I.localUser.isATC&&oe(n,t.to.phoneNumber,t.to.fullyQualifiedNumber,t.to.displayName,t.to.userId);try{I.$apply(function(){!t.sdp||"answer"!==t.sdp.type&&"pranswer"!==t.sdp.type||(t.sdp.type="pranswer",n.isPranswer=!0,n.sessionCtrl.setRemoteDescription(t.sdp,function(e){e&&(n.setDisconnectCause(ot.DisconnectCause.REMOTE_SDP_FAILED,"type="+t.sdp.type+" origin="+Tt.getOrigin(t.sdp.sdp)),ve(n,null,at.CallClientTerminatedReason.SET_REMOTE_SDP_FAILED))})),n.setState(at.CallState.Delivered),J(n)})}catch(e){v.error("[CircuitCallControlSvc]: Exception handling RTCCall.PROGRESS event.",e)}}else v.info("[CircuitCallControlSvc]: Ignore PROGRESS. Call state =",n.state.name);else v.info("[CircuitCallControlSvc]: Event is not for local or remote call. Ignore it.")}),h.on("RTCSession.INVITE_TO_STAGE_EVENT",function(t){v.debug("[CircuitCallControlSvc]: Received RTCSession.INVITE_TO_STAGE_EVENT"),Z(t.sessionId)?I.$apply(function(){var e={invitedByUserId:t.invitedByUserId,allowedMediaTypes:t.allowedMediaTypes,expirationTime:St.delayOrTimestamp(t.expirationDelay,t.expirationTime)};v.debug("[CircuitCallControlSvc]: Publish /call/raiseHand/invite, questionNumber: ",t.questionNumber),R.publish("/call/raiseHand/invite",[t.questionNumber,e])}):v.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")}),h.on("RTCSession.INVITE_TO_STAGE_CANCEL_EVENT",function(e){v.debug("[CircuitCallControlSvc]: Received RTCSession.INVITE_TO_STAGE_CANCEL_EVENT"),Z(e.sessionId)?I.$apply(function(){v.debug("[CircuitCallControlSvc]: Publish /call/raiseHand/invite (cancel), questionNumber: ",e.questionNumber),R.publish("/call/raiseHand/invite",[e.questionNumber,null])}):v.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")}),h.on("RTCSession.QUESTION_EVENT",function(e){v.debug("[CircuitCallControlSvc]: Received RTCSession.QUESTION_EVENT"),Z(e.sessionId)?I.$apply(function(){v.debug("[CircuitCallControlSvc]: Publish /call/raiseHand/question, questionNumber: ",e.question.questionNumber),R.publish("/call/raiseHand/question",[e.question,e.subType])}):v.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")}),h.on("RTCSession.CURTAIN_EVENT",function(e){v.debug("[CircuitCallControlSvc]: Received RTCSession.CURTAIN_EVENT"),Z(e.sessionId)?I.$apply(function(){y.curtain=e.curtain,v.debug("[CircuitCallControlSvc]: Publish /call/curtain event"),R.publish("/call/curtain",[y.curtain])}):v.warn("[CircuitCallControlSvc]: Unexpected event. There is no local call")}),this.initActiveSessionsForSdk=function(){return k=!0,Be()},this.initForUnitTests=function(){k=!0},this.setDisableRemoteVideoByDefault=function(e){v.info("[CircuitCallControlSvc] Setting _disableRemoteVideoByDefault to ",!!e),M=!!e},this.getDisableRemoteVideoByDefault=function(){return M},this.setClientDiagnosticsDisabled=function(e){n=e},this.getCalls=function(){return D},this.getPhoneCalls=function(t){return D.filter(function(e){return e.isTelephonyCall&&(!t||!e.isRemote)})},this.getEstablishedLocalPhoneCalls=function(){return D.filter(function(e){return e.isTelephonyCall&&e.state.established&&!e.isRemote})},this.getActiveCall=function(e){return e?Z(e):y&&y.replaces?y.replaces:y||null},this.isConnectionInProgress=function(e){var t=N.getActiveCall(e);return!!t&&!t.sessionCtrl.isConnStable()},this.getIncomingCall=function(){return G[0]||null},this.getActiveRemoteCall=function(){return P},this.joinGroupCall=function(e,t,n){if(n=n||function(){},!e)return v.warn("[CircuitCallControlSvc]: joinGroupCall - Invalid Call Id"),void n("Missing callId");var i=ee(e);if(!i||!i.isRemote||i.state.name!==at.CallState.Started.name||i.activeClient)return v.warn("[CircuitCallControlSvc]: joinGroupCall invoked without a valid call"),void n("Invalid call");var r=W(i.convId);if(!r||!r.call||r.call.callId!==i.callId)return v.warn("[CircuitCallControlSvc]: joinGroupCall - Cannot find valid conversation"),void n("Invalid conversation");var o=Ze({callOut:!1,handover:!1,joiningGroupCall:!0});ue(r,t,o,n)&&qe(r,t,o,n)},this.makeCall=function(e,t,n){if(n=n||function(){},!e)return v.warn("[CircuitCallControlSvc]: makeCall - Invalid Conversation Id"),void n("Missing convId");var i=W(e);if(!i)return v.warn("[CircuitCallControlSvc]: makeCall - Cannot find conversation with id ",e),void n("Conversation not found");var r=Ze({callOut:!0,handover:!1});ue(i,t,r,n)&&qe(i,t,r,n)},this.makeEchoTestCall=function(t,e,n){e=e||function(){},n=n||function(){};var i=I.isSessionGuest&&I.localUser.conversationId||"echo_"+I.localUser.clientId,r={creatorId:I.localUser.userId,convId:i,rtcSessionId:"echo_"+I.localUser.clientId,participants:[{userId:I.localUser.userId}],testCall:!0};e((r=o.extend(r)).rtcSessionId),f(function(){var e=Ze({callOut:!1,handover:!1});ue(r,t,e,n)&&Ce(r,t,e,n)},200)},this.dialNumber=function(i,r,o,a){a=a||function(){},p.getTelephonyConversation(function(e,t){if(e||!t)a(e);else{var n=Ze({callOut:!0,handover:!1,dialedDn:i,toName:r});ue(t,o,n,a)&&qe(t,o,n,a)}})},this.dialPhoneNumber=function(i,r){r=r||function(){},i=i||{},p.getTelephonyConversation(function(e,t){if(e||!t)r(e);else{var n=Ze({callOut:!0,handover:!1,dialedDn:i.dialedDn,toName:i.toName,userId:i.userId,dtmfDigits:i.dtmfDigits});if(!$e(t,n,r))return;if(y&&y.isTelephonyCall&&!y.isHolding())return void N.holdCall(y.callId,function(e){e?r&&r(e):ue(t,i.mediaType,n,r)&&qe(t,i.mediaType,n,r)});ue(t,i.mediaType,n,r)&&qe(t,i.mediaType,n,r)}})},this.startConference=function(e,t,n){if(t=t||{audio:!0,video:!1},n=n||function(){},!e)return v.warn("[CircuitCallControlSvc]: startConference - Invalid Conversation Id"),void n("Missing convId");var i=W(e);if(!i)return v.warn("[CircuitCallControlSvc]: startConference - Cannot find conversation with id ",e),void n("Conversation not found");if(i.type!==ot.ConversationType.GROUP&&i.type!==ot.ConversationType.LARGE)return v.warn("[CircuitCallControlSvc]: startConference - Invalid conversation type"),void n("Invalid conversation type");var r=Ze({callOut:!1,handover:!1});ue(i,t,r,n)&&qe(i,t,r,n)},this.answerCall=function(n,e,l){l=l||function(){};var i,r=null;if(G.some(function(e,t){if(n===e.callId)return r=e,i=t,!0}),!r)return v.warn("[CircuitCallControlSvc]: answerCall - There is no alerting call"),void l("No alerting call");function t(){b=y,y=r,j(),G.splice(i,1),Qe(y),y.stopRingingTimer(),y.setState(y.isATCCall?at.CallState.Waiting:at.CallState.Answering);var n=W(y.convId);if(!n||!n.call||n.call.callId!==y.callId)return v.warn("[CircuitCallControlSvc]: joinCall - Cannot find valid conversation"),fe(y,{type:ot.InviteRejectCause.BUSY},!1),void l("Conversation not found");J(y),je(e,function(e,t){var i,r,o,a,s,c;i=n,r=e,o={warning:t},a=l,c=(s=y).sessionCtrl,o=o||{},c.onSessionDescription=function(e){c.onSessionDescription=null;var t={convId:i.convId,rtcSessionId:s.callId||i.rtcSessionId,ownerId:i.creatorId,sdp:e.sdp,mediaType:r,callOut:!1,handover:!1,sendInviteCancel:!0,isTelephonyConversation:i.isTelephonyConv,displayName:I.localUser.displayName,transactionId:s.transactionId};function n(e){I.$apply(function(){s.clearTransactionId(),e?($(s,le(e)),a(q(e))):(v.debug("[CircuitCallControlSvc]: Join/Answer RTC session was successful."),a(null,o.warning))})}t.sdp&&"offer"===t.sdp.type?h.joinRtcCall(t,n):(T.startJoinDelayTimer(s),h.answerRtcCall(t,n))},c.start(r,null)||($(s,at.CallClientTerminatedReason.RTC_SESSION_START_FAILED),a(q()))})}if(y&&y.isPresent()&&(!y.isTelephonyCall||!r.isTelephonyCall||d&&!u)&&!r.replaces||!I.localUser.isATC)ve(y,null,at.CallClientTerminatedReason.USER_ENDED),b&&ve(b,null,at.CallClientTerminatedReason.USER_ENDED);else if(y&&y.isTelephonyCall&&I.localUser.isATC&&!y.isHolding())return void N.holdCall(y.callId,function(e){e?l&&l(e):t()});t()},this.endCall=function(e,t){var n=ot.InviteRejectCause.DECLINE,i=N.getActiveCall();i&&i.callId===e&&(i.isEstablished()||i.direction===at.CallDirection.OUTGOING)&&(n=null),N.endCallWithCauseCode(e,n,t)},this.endCallWithCauseCode=function(e,t,n){var i=at.CallClientTerminatedReason.USER_ENDED,r=ot.InviteRejectCause.DECLINE;t&&(at.CallClientTerminatedReason[t]?i=t:(i=at.CallClientTerminatedReason.CLIENT_ENDED_PRFX+t,ot.InviteRejectCause[t]&&(r=t)));var o=Z(e);if(o)o.replaces&&o.checkState(at.CallState.Answering)?n("Auto answer in progress"):o.terminateTimer?($(o,i),n&&f(n)):ve(o,r,i,!1,n);else if(y&&y.replaces&&y.replaces.callId===e)ve(y.replaces,r,i,!1,n);else{var a=ee(e);if(a)return void(a.terminateTimer?($(a),n&&f(n)):ve(a,r,i,!1,n));var s=Ae(e);if(s)fe(s,{type:r},!1,n);else{v.warn("[CircuitCallControlSvc]: endCall - There is no local or alerting call");var c=p.getConversationByRtcSession(e);c&&c.call&&(c.call=null,z(c)),n&&n("Call not found")}}},this.endConference=function(e,t){var n=ee(e);n?I.isSessionGuest||n.isGuestInvite?t&&t("Not allowed"):function(n,i){if(i=i||function(){},n.isDirect)return v.debug("[CircuitCallControlSvc]: Direct call. Ignore terminate conference request."),f(i);v.debug("[CircuitCallControlSvc]: terminateConference - rtcSessionId=",n.callId),h.terminateRtcCall(n.callId,n.disconnectCause,function(t){I.$apply(function(){if(t&&(v.warn("[CircuitCallControlSvc]: Error terminating the RTC call. ",t),n===y)){var e=W(n.convId);e&&n.isEstablished()&&Te(e)}i&&i(t)})}),n===y&&$(n,at.CallClientTerminatedReason.USER_ENDED)}(n,t):t&&t("Call not found")},this.startScreenShare=function(e,t,n){if(n=n||function(){},!e)return v.warn("[CircuitCallControlSvc]: startScreenShare - Invalid Conversation Id"),void n("Invalid convId");var i=W(e);if(!i)return v.warn("[CircuitCallControlSvc]: startScreenShare - Cannot find conversation with id ",e),void n("Conversation not found");var r={audio:!0,video:!1,desktop:!0},o=Ze({callOut:!0,handover:!1,screenConstraint:t});ue(i,r,o,n)&&Ce(i,r,o,function(e){e||(v.debug("[CircuitCallControlSvc]: Publish /screenshare/started event"),R.publish("/screenshare/started")),n(e)})},this.addScreenShare=function(n,i,r){r=r||function(){};var e=Z(n);if(!e)return v.warn("[CircuitCallControlSvc]: addScreenShare - There is no local call"),void r("No active call");var o={audio:e.localMediaType.audio,video:!1,desktop:!0};Pe(e).then(function(e){var t={streamId:e.streamId,screenType:i,pointer:e.pointer};Ee(n,null,o,!1,null,function(e){if(e)return v.warn("[CircuitCallControlSvc]: AddScreenShare failed: ",e),void r(e);v.debug("[CircuitCallControlSvc]: Publish /screenshare/started event"),R.publish("/screenshare/started"),r()},t)}).catch(function(e){r(e)})},this.addMediaStream=function(e,t,n){n=n||function(){};var i=Z(e);if(!i)return v.warn("[CircuitCallControlSvc]: addMediaStream - There is no local call"),void n("No active call");Ee(e,null,{audio:i.localMediaType.audio,video:!1,desktop:!0},!1,null,function(e){e?(v.warn("[CircuitCallControlSvc]: addMediaStream failed: ",e),n("res_AddMediaStreamFailed")):n()},{mediaStream:t})},this.removeMediaStream=function(e,t){t=t||function(){};var n=Z(e);if(!n)return v.warn("[CircuitCallControlSvc]: removeMediaStream - There is no local call"),void t("No active call");v.debug("[CircuitCallControlSvc]: removeMediaStream..."),Ee(e,null,{audio:n.localMediaType.audio,video:n.localMediaType.video,desktop:!1},!1,null,function(e){e?(v.warn("[CircuitCallControlSvc]: removeMediaStream failed: ",e),t("res_RemoveMediaStreamFailed")):t()})},this.selectMediaToShare=function(n,i,r){r=r||function(){};var e=Z(n);if(!e)return v.warn("[CircuitCallControlSvc]: selectMediaToShare - There is no local call"),void r("No active call");v.debug("[CircuitCallControlSvc]: selectMediaToShare...");var o={audio:e.localMediaType.audio,video:!1,desktop:!0};Pe(e).then(function(e){var t={streamId:e.streamId,screenType:i,pointer:e.pointer};Ee(n,null,o,!0,null,r,t)}).catch(function(e){r(e)}),R.publish("/screenshare/changed")},this.removeScreenShare=function(e,t){t=t||function(){};var n=Z(e);if(!n)return v.warn("[CircuitCallControlSvc]: removeScreenShare - There is no local call"),void t("No active call");v.debug("[CircuitCallControlSvc]: removeScreenShare..."),Ee(e,null,{audio:n.localMediaType.audio,video:n.localMediaType.video,desktop:!1},!1,null,function(e){e?(v.warn("[CircuitCallControlSvc]: removeScreenShare failed: ",e),t("res_RemoveScreenShareFailed")):t()})},this.addAudio=function(e,t){t=t||function(){};var n=Z(e);if(!n)return v.warn("[CircuitCallControlSvc]: addAudio - There is no local call"),void t("No active call");Ee(e,null,{audio:!0,video:n.localMediaType.video,desktop:n.localMediaType.desktop},!1,null,function(e){e?(v.warn("[CircuitCallControlSvc]: addAudio -> Failed to renegotiate the media. ",e),t("Renegotiate for receive-only media failed")):(v.debug("[CircuitCallControlSvc]: addAudio -> Media renegotiation was successful"),t())})},this.removeAudio=function(e,t){t=t||function(){};var n=Z(e);if(!n)return v.warn("[CircuitCallControlSvc]: removeAudio - There is no local call"),void t("No active call");v.debug("[CircuitCallControlSvc]: removeAudio..."),Ee(e,null,{audio:!1,video:n.localMediaType.video,desktop:n.localMediaType.desktop},!1,null,function(e){e?(v.warn("[CircuitCallControlSvc]: removeAudio -> Failed to renegotiate the media. ",e),t("Renegotiate for receive-only media failed")):(v.debug("[CircuitCallControlSvc]: removeAudio -> Media renegotiation was successful"),t())})},this.enableRemoteAudio=function(e){var t=Z(e);t?t.remoteAudioDisabled&&(t.enableRemoteAudio(),v.debug("[CircuitCallControlSvc]: Publish /call/remoteStreamUpdated event"),R.publish("/call/remoteStreamUpdated",[t])):v.warn("[CircuitCallControlSvc]: enableRemoteAudio - There is no local call")},this.disableRemoteAudio=function(e){var t=Z(e);t?t.remoteAudioDisabled||(t.disableRemoteAudio(),v.debug("[CircuitCallControlSvc]: Publish /call/remoteStreamUpdated event"),R.publish("/call/remoteStreamUpdated",[t])):v.warn("[CircuitCallControlSvc]: disableRemoteAudio - There is no local call")},this.addVideo=function(e,t){t=t||function(){};var n=Z(e);if(!n)return v.warn("[CircuitCallControlSvc]: addVideo - There is no local call"),void t("No active call");Ee(e,null,{audio:n.localMediaType.audio,video:!0,desktop:!1},!1,null,function(e){e?(v.warn("[CircuitCallControlSvc]: addVideo failed: ",e),t("res_AddVideoFailed")):t()})},this.removeVideo=function(e,t){t=t||function(){};var n=Z(e);if(!n)return v.warn("[CircuitCallControlSvc]: removeVideo - There is no local call"),void t("No active call");v.debug("[CircuitCallControlSvc]: removeVideo..."),Ee(e,null,{audio:n.localMediaType.audio,video:!1,desktop:n.localMediaType.desktop},!1,null,function(e){e?(v.warn("[CircuitCallControlSvc]: removeVideo failed: ",e),t("res_RemoveVideoFailed")):t()})},this.toggleRemoteVideo=function(e,t){t=t||function(){};var n=Z(e);if(!n)return v.warn("[CircuitCallControlSvc]: toggleRemoteVideo - There is no local call"),void t("No active call");v.debug("[CircuitCallControlSvc]: toggleRemoteVideo..."),n.sessionCtrl.isConnStable()?(n.remoteVideoDisabled?n.enableRemoteVideo():(n.disableRemoteVideo(),R.publish("/call/toggleRemoteVideo")),Ee(e,null,n.localMediaType,!1,null,function(e){e?(n.remoteVideoDisabled?n.enableRemoteVideo():n.disableRemoteVideo(),v.warn("[CircuitCallControlSvc]: toggleRemoteVideo failed: ",e),t("res_ToggleVideoFailed")):(t(),!n.remoteVideoDisabled&&R.publish("/call/toggleRemoteVideo"))})):t("Connection not stable")},this.changeHDVideo=function(e,t,n){n=n||function(){};var i=Z(e);return i?i.mediaType.video?(t=!!t,void(i.localMediaType.hdVideo!==t?(v.debug("[CircuitCallControlSvc]: changeHDVideo..."),Ee(e,null,{audio:y.localMediaType.audio,video:!0,hdVideo:t,desktop:!1},!1,null,function(e){e?(v.warn("[CircuitCallControlSvc]: changeHDVideo failed: ",e),n("res_ToggleVideoFailed")):n()})):n())):(v.warn("[CircuitCallControlSvc]: changeHDVideo - Local call has no video"),void n("No video")):(v.warn("[CircuitCallControlSvc]: changeHDVideo - There is no local call"),void n("No active call"))},this.toggleVideo=function(e,t){t=t||function(){};var n=Z(e);if(!n)return v.warn("[CircuitCallControlSvc]: toggleVideo - There is no local call"),void t("No active call");v.debug("[CircuitCallControlSvc]: toggleVideo...");var i={audio:n.localMediaType.audio,video:!n.localMediaType.video,desktop:n.localMediaType.desktop};i.video&&(i.desktop=!1),Ee(e,null,i,!1,null,function(e){e?(v.warn("[CircuitCallControlSvc]: toggleVideo failed: ",e),t("res_ToggleVideoFailed")):t()})},this.renegotiateMedia=function(e,t){t=t||function(){};var n=Z(e);if(!n)return v.warn("[CircuitCallControlSvc]: renegotiateMedia - There is no local call"),void t("No active call");v.debug("[CircuitCallControlSvc]: renegotiateMedia..."),Ee(e,null,n.localMediaType,!1,null,function(e){e?(v.warn("[CircuitCallControlSvc]: Failed to renegotiate the media"),t("Renegotiate media failed")):t()})},this.setMediaType=function(e,t,n){if(n=n||function(){},!Z(e))return v.warn("[CircuitCallControlSvc]: setMediaType - There is no local call"),void n("No active call");v.debug("[CircuitCallControlSvc]: setMediaType..."),Ee(e,null,t,!1,null,function(e){e?(v.warn("[CircuitCallControlSvc]: Failed to renegotiate the media"),n("Renegotiate media failed")):n()})},this.holdCall=function(e,t){t=t||function(){};var n=Z(e);return n?n.isHolding()||n.isHoldInProgress()?(v.debug("[CircuitCallControlSvc]: holdCall - The call is already held"),void t()):(v.debug("[CircuitCallControlSvc]: holdCall..."),n.setHoldInProgress(),void Ee(e,null,n.localMediaType,!1,!0,function(e){n.clearHoldInProgress(),e?(v.warn("[CircuitCallControlSvc]: Failed to hold the call"),t("res_HoldCallFailed")):t()})):(v.warn("[CircuitCallControlSvc]: holdCall - There is no call"),void t("No active call"))},this.retrieveCall=function(e,n){n=n||function(){};var i=Z(e);if(!i.isHolding())return v.debug("[CircuitCallControlSvc]: retrieveCall - There is no held local call"),void n();v.debug("[CircuitCallControlSvc]: retrieveCall..."),i.setRetrieveInProgress(),Ee(e,null,i.localMediaType,!1,!1,function(e){if(i.clearRetrieveInProgress(),e)v.warn("[CircuitCallControlSvc]: Failed to retrieve the call"),n("res_RetrieveCallFailed");else{i===b&&(b=y,y=i);var t=W(y.convId);t.call=y,z(t),n()}})},this.swapCall=function(e,t){if(t=t||function(){},!(b=1<N.getPhoneCalls(!0).length?ie(!0):null)||!y)return v.warn("[CircuitCallControlSvc]: swapCall - There are no held and active local calls"),void t("No calls to swap");if(b&&b.callId!==e)return v.warn("[CircuitCallControlSvc]: swapCall - Wrong callId of the held call"),void t("Wrong callId");var n=b.callId,i=y.callId;N.holdCall(i,function(e){e?t&&t(e):N.retrieveCall(n,t)})},this.pullRemoteCall=function(i,r,o){o=o||function(){};var a=ge(i);if(!a)return v.warn("[CircuitCallControlSvc]: pullRemoteCall invoked without a valid call"),void o("No active remote call");if(a.pullNotAllowed)o("res_PullCallNotAllowed");else{var s=W(a.convId);if(!s||!s.isTelephonyConv&&s.call.callId!==i)return v.warn("[CircuitCallControlSvc]: pullRemoteCall - Cannot find valid conversation"),void o("Conversation not found");y&&y.isTelephonyCall?N.holdCall(y.callId,function(e){e?o&&o(e):t()}):t()}function t(){var e=a.activeClient||{},t={audio:!0,video:!(!e.mediaType||!e.mediaType.video)};r&&(t.video=!1);var n=Ze({callOut:!1,handover:!0,callId:i});ue(s,t,n,o)&&qe(s,t,n,o)}},this.endRemoteCall=function(e,t){t=t||function(){};var n=ge(e);if(!n)return v.warn("[CircuitCallControlSvc]: endRemoteCall invoked without a valid call"),void t("No active remote call");var i,r,o=W(n.convId);if(!o||o.call.callId!==e)return v.warn("[CircuitCallControlSvc]: endRemoteCall - Cannot find valid conversation"),void t("Conversation not found");i=n,r=function(e){e?t("res_EndRemoteCallFailed"):(pe(n),t())},v.debug("[CircuitCallControlSvc]: endRemoteCall - rtcSessionId=",i.callId),i.isDirect?h.terminateRtcCall(i.callId,i.disconnectCause,function(e){I.$apply(function(){e&&v.warn("[CircuitCallControlSvc]: Error terminating remote RTC call. ",e),r(e)})}):h.leaveRtcCall(i.callId,i.disconnectCause,function(e){I.$apply(function(){e&&v.warn("[CircuitCallControlSvc]: Error leaving remote RTC call. ",e),r(e)})})},this.hideRemoteCall=function(e){var t=ee(e);t?$(t):v.warn("[CircuitCallControlSvc]: hideRemoteCall invoked without a valid call")},this.dropParticipant=function(e,t,n){n=n||function(){};var i=Z(e);return!i||i.isDirect?(v.warn("[CircuitCallControlSvc]: dropParticipant - invalid call"),void n("Call invalid")):t&&t.userId?(t.isCMP&&t.isMeetingPointInvitee&&(i.setMeetingPointInviteState(!1),N.enableRemoteAudio(e)),v.debug("[CircuitCallControlSvc]: Dropping participant in existing RTC session. userId =",t.userId),void function(e,t){if(t=t||function(){},y){var n=y.getParticipant(e);if(n)if(n.actions.includes(at.ParticipantAction.Drop)){var i={rtcSessionId:y.callId,userId:e};h.removeSessionParticipant(i,function(e){I.$apply(function(){e?(v.warn("[CircuitCallControlSvc]: Failed to remove participant"),t("res_RemoveParticipantFailed")):t()})})}else v.warn("[CircuitCallControlSvc]: remove call participant, unsupported pcState: ",n.pcState.name),t("Participant not active");else v.error("[CircuitCallControlSvc]: call participant not found: ",e),t("Participant not found")}else t("No active call")}(t.userId,n)):(v.warn("[CircuitCallControlSvc]: dropParticipant - Invalid participant"),void n("Participant invalid"))},this.addParticipantToCall=function(e,t,n){var i=Z(e);i?ze(i,t,n):(v.warn("[CircuitCallControlSvc]: addParticipantToCall - There is no local call"),n&&n("Invalid callId"))},this.addParticipantToRtcSession=function(e,t,n){var i=ee(e);i?ze(i,t):(v.warn("[CircuitCallControlSvc]: addParticipantToRtcSession - Call not found"),n&&n("Invalid callId"))},this.mute=function(e,t){t=t||function(){};var n=Z(e);if(!n||e!==n.callId)return v.warn("[CircuitCallControlSvc]: mute - There is no local call"),void t("Call not valid");n.locallyMuted?t("Call already muted"):(v.debug("[CircuitCallControlSvc]: Mute the local call"),n.mute(function(){I.$apply(function(){v.debug("[CircuitCallControlSvc]: Publish /call/localUser/mutedSelf event"),R.publish("/call/localUser/mutedSelf",[e,!0]),t()})}))},this.unmuteLocally=function(e){y&&y.locallyMuted&&(v.debug("[CircuitCallControlSvc]: Unmute the local call"),y.unmute(function(){I.$apply(function(){v.debug("[CircuitCallControlSvc]: Publish /call/localUser/mutedSelf event"),R.publish("/call/localUser/mutedSelf",[y.callId,!1]),e&&e()})}))},this.unmute=function(e,t){t=t||function(){};var n=Z(e);if(n)if(n.isMuted()){var i=n.remotelyMuted;N.unmuteLocally(i?null:t),i&&N.unmuteParticipant(n.callId,I.localUser,t)}else t("Call not muted");else v.warn("[CircuitCallControlSvc]: unmute - There is no local call")},this.toggleMute=function(e,t){t=t||function(){};var n=Z(e);return n?n.isLocalMuteAllowed()?void(n.isMuted()?N.unmute(n.callId,t):N.mute(n.callId,t)):(v.warn("[CircuitCallControlSvc]: toggleMute - Local Mute is not allowed"),void t()):(v.warn("[CircuitCallControlSvc]: toggleMute - There is no local call"),void t("Call not valid"))},this.muteParticipant=function(e,t,n){n=n||function(){};var i=Z(e);if(!i)return v.warn("[CircuitCallControlSvc]: muteParticipant - There is no local call"),void n("Call invalid");var r=t&&t.userId;if(!r)return v.warn("[CircuitCallControlSvc]: muteParticipant - Invalid participant ID"),void n("Participant invalid");v.debug("[CircuitCallControlSvc]: Mute participant in existing RTC session. participantId =",r);var o={rtcSessionId:i.callId,usersIds:[r],muted:!0};h.muteParticipant(o,function(e){I.$apply(function(){e?(v.warn("[CircuitCallControlSvc]: Failed to mute participant"),n("res_MuteParticipantFailed")):n()})})},this.hasUnmutedParticipants=function(e){var t=Z(e);return t&&e===t.callId?t.hasUnmutedParticipants():(v.warn("[CircuitCallControlSvc]: hasUnmutedParticipants - There is no local call"),!1)},this.muteRtcSession=function(e,t){t=t||function(){};var n=Z(e);if(!n||e!==n.callId)return v.warn("[CircuitCallControlSvc]: muteRtcSession - There is no local call"),void t("Call invalid");if(n.hasUnmutedParticipants()){v.debug("[CircuitCallControlSvc]: Mute RTC session (all other participants)");var i={rtcSessionId:n.callId,muted:!0,excludedUserIds:[I.localUser.userId]};h.muteRtcSession(i,function(e){I.$apply(function(){e?(v.warn("[CircuitCallControlSvc]: Failed to mute RTC session"),t("res_MuteAllOtherParticipantsFailed")):t()})})}},this.unmuteParticipant=function(e,t,n){n=n||function(){};var i=Z(e);if(!i)return v.warn("[CircuitCallControlSvc]: unmuteParticipant - There is no local call"),void n("Call invalid");var r=t&&t.userId;if(!r)return v.warn("[CircuitCallControlSvc]: unmuteParticipant - Invalid participant ID"),void n("Participant invalid");if(r!==I.localUser.userId)return v.warn("[CircuitCallControlSvc]: Cannot unmute remote participant"),void n("Cannot unmute others");v.debug("[CircuitCallControlSvc]: Unmute participant in existing RTC session. userId =",r);var o={rtcSessionId:i.callId,usersIds:[r],muted:!1};h.muteParticipant(o,function(e){I.$apply(function(){e?(v.warn("[CircuitCallControlSvc]: Failed to unmute participant"),n("res_UnmuteParticipantFailed")):(i.remotelyMuted=!1,Je(i),n())})})},this.toggleMuteParticipant=function(e,t,n){return n=n||function(){},Z(e)?t&&t.userId?t.muted?N.unmuteParticipant(e,t,n):N.muteParticipant(e,t,n):(v.warn("[CircuitCallControlSvc]: unmuteParticipant - Invalid participant ID"),void n("Participant invalid")):(v.warn("[CircuitCallControlSvc]: toggleMuteParticipant - There is no local call"),void n("Call invalid"))},this.stopRingingTone=function(e){var t=Ae(e);t?(t.ringToneStopped=!0,v.debug("[CircuitCallControlSvc]: stopRingingTone for call with callId = ",e),R.publish("/call/ringingTone/stop",[e])):v.warn("[CircuitCallControlSvc]: stopRingingTone - incoming call not found: ",e)},this.endActiveCall=function(e){e=e||function(){},y?N.endCall(y.callId,e):e("No active call")},this.startRecording=function(t,e){if(!y)return v.warn("[CircuitCallControlSvc]: startRecording - There is no local call"),void t("No active call");var n={audio:!0,video:!1,desktop:!!e},i={convId:y.convId,rtcSessionId:y.callId,mediaTypes:n};h.startRecording(i,function(e){I.$apply(function(){t&&t(e)})})},this.stopRecording=function(t){if(!y)return v.warn("[CircuitCallControlSvc]: stopRecording - There is no local event call"),void t("No active call");var e={convId:y.convId,rtcSessionId:y.callId};h.stopRecording(e,function(e){I.$apply(function(){t&&t(e)})})},this.submitCallQualityRating=function(e,t,n){if(!e||!e.hasOwnProperty("rating")||!t)return v.warn("[CircuitCallControlSvc]: submitCallQualityRating - Missing rating or call data"),void(n&&n("No rating data"));Object.assign(e,t),h.submitCallQualityRating([e],function(e){I.$apply(function(){n&&n(e),e||(v.debug("[CircuitCallControlSvc]: Publish /call/rated event"),R.publish("/call/rated"))})})},this.raiseQuestion=function(e,t,n){if(!y||!y.isLarge)return v.warn("[CircuitCallControlSvc]: raiseQuestion - There is no local event call"),void n("No active event");var i={convId:y.convId,rtcSessionId:y.callId,question:e,displayName:I.localUser.displayName,isAnonymous:!!t};h.raiseQuestion(i,function(e,t){I.$apply(function(){n&&n(e,t)})})},this.inviteToStage=function(e,t){if(!y||!y.isLarge)return v.warn("[CircuitCallControlSvc]: inviteToStage - There is no local event call"),void t("No active event");var n={convId:y.convId,rtcSessionId:y.callId,questionNumber:e};h.inviteToStage(n,function(e){I.$apply(function(){t&&t(e)})})},this.inviteToStageAnswer=function(e,t,n){if(!y||!y.isLarge)return v.warn("[CircuitCallControlSvc]: inviteToStageAnswer - There is no local event call"),void n("No active event");var i={convId:y.convId,rtcSessionId:y.callId,questionNumber:e,isAccepted:!!t};t&&B&&(v.debug("[CircuitCallControlSvc]: inviteToStageAnswer - force renewal of turn credentials"),B.expirationTimestamp=0),h.inviteToStageAnswer(i,function(e){I.$apply(function(){!e&&t?N.addAudio(y.callId,function(e){e||N.unmuteLocally(),n&&n(e)}):n&&n(e)})})},this.inviteToStageCancel=function(e,t){if(!y||!y.isLarge)return v.warn("[CircuitCallControlSvc]: inviteToStageCancel - There is no local event call"),void t("No active event");var n={convId:y.convId,rtcSessionId:y.callId,questionNumber:e};h.inviteToStageCancel(n,function(e){I.$apply(function(){t&&t(e)})})},this.removeFromStage=function(e,t){if(!y||!y.isLarge)return v.warn("[CircuitCallControlSvc]: removeFromStage - There is no local event call"),void t("No active event");var n={convId:y.convId,rtcSessionId:y.callId,userToRemoveId:e||I.localUser.userId};h.removeFromStage(n,function(e){I.$apply(function(){t&&t(e)})})},this.getQuestions=function(e,t,n){if(!y||!y.isLarge)return v.warn("[CircuitCallControlSvc]: getQuestions - There is no local event call"),void n("No active event");var i={convId:y.convId,rtcSessionId:y.callId,startQuestionNumber:e,numberOfQuestions:t};h.getQuestions(i,function(e,t){I.$apply(function(){n&&n(e,t)})})},this.updateQuestionState=function(e,t,n){if(!y||!y.isLarge)return v.warn("[CircuitCallControlSvc]: updateQuestionState - There is no local event call"),void n("No active event");var i={convId:y.convId,rtcSessionId:y.callId,questionNumber:e,newQuestionState:t};h.updateQuestionState(i,function(e,t){I.$apply(function(){n&&n(e,t)})})},this.openCurtain=function(t){if(!y||!y.isLarge)return v.warn("[CircuitCallControlSvc]: openCurtain - There is no local event call"),void t("No active event");var e={convId:y.convId,rtcSessionId:y.callId};h.openCurtain(e,function(e){I.$apply(function(){t&&t(e)})})},this.closeCurtain=function(e,t,n,i){if(!y||!y.isLarge)return v.warn("[CircuitCallControlSvc]: closeCurtain - There is no local event call"),void i("No active event");var r={curtainState:e};t&&(r.message=t),n&&(r.pauseDuration=n);var o={convId:y.convId,rtcSessionId:y.callId,curtain:r};h.closeCurtain(o,function(e){I.$apply(function(){i&&i(e)})})},this.getNodeState=function(e,t,n){var i={convId:"noCall",nodeType:e,tenantId:t||""};h.getNodeState(i,function(e,t){I.$apply(function(){e&&v.error("[CircuitCallControlSvc]: Failed to get node(s). ",e),n&&n(e,t)})})},this.canSendWebRTCDigits=function(){return y&&y.sessionCtrl.canSendDTMFDigits()},this.sendDigits=function(e,t,n){return n=n||function(){},Z(e)?t?/^[\d#\*,]+$/.exec(t)?void function(e,t,n){var i=Z(e);if(!i)return v.info("[CircuitCallControlSvc]: sendDTMFDigits - The given call ID does not match the local call"),n("Invalid callId");v.info("[CircuitCallControlSvc]: Sending DTMF Digits=",t),i.sessionCtrl.sendDTMFDigits(t)||(v.error("[CircuitCallControlSvc]: Cannot send DTMF digits"),n("res_CannotSendDTMF"))}(e,t,n):(v.error("[CircuitCallControlSvc]: Digits cannot be sent: "+t+" (Allowed: 0-9,#,*)"),void n("res_InvalidDtmf")):void n("res_InvalidDtmf"):(v.warn("[CircuitCallControlSvc]: sendDigits - There is no local call"),void n("Call not valid"))},this.disableIncomingVideo=function(e){y&&y.sameAs(e)&&(v.debug("[CircuitCallControlSvc]: Disabling remote incoming video. Call ID=",y.callId),y.sessionCtrl.disableIncomingVideo())},this.enableIncomingVideo=function(e){y&&y.sameAs(e)&&(v.debug("[CircuitCallControlSvc]: Enabling remote incoming video. Call ID=",y.callId),y.sessionCtrl.enableIncomingVideo())},this.toggleParticipantPointer=function(e){var t=Z(e);t?t.pointer&&t.pointer.isSupported?(t.pointer.isEnabled=!t.pointer.isEnabled,Ee(t.callId,t.transactionId,t.localMediaType,!1,null,null,null)):v.warn("[CircuitCallControlSvc]: toggleParticipantPointer - Local call does not support participant pointer"):v.warn("[CircuitCallControlSvc]: toggleParticipantPointer - There is no local call")},this.findCall=ee,this.findLocalCallByCallId=Z,this.findActivePhoneCall=ne,this.findHeldPhoneCall=ie,this.sendParticipantPointer=function(e,t,n){var i={content:{type:"PARTICIPANT_POINTER",x:t,y:n,userId:I.localUser.userId},destUserId:e};O.sendDesktopAppRequest(i,function(e){e?v.error("[CircuitCallControlSvc]: Error sending participant pointer coordinates: ",e):v.info("[CircuitCallControlSvc]: Successfully sent participant pointer coordinates.")})},this.sendParticipantDrawing=function(e,t,n){var i={content:{type:"PARTICIPANT_DRAWING",points:t,options:n||{},userId:I.localUser.userId},destUserId:e};O.sendDesktopAppRequest(i,function(e){e?v.error("[CircuitCallControlSvc]: Error sending participant drawing coordinates: ",e):v.info("[CircuitCallControlSvc]: Successfully sent participant drawing coordinates.")})},this.removeCallFromList=X,this.isSecondCall=function(){return y||1<=G.length||!P.isEmpty()},this.updateActiveCallMediaDevices=function(){y&&y.updateMediaDevices()},this.addSimulatedParticipants=function(){var r=5e4,o=N.getActiveCall();if(o&&!o.isDirect&&o.isMocked&&!(0<o.participants.length)){var a=function(){o.isPresent()&&0!==o.participants.length&&(De(o,o.participants[0].userId),0<o.participants.length&&f(a,2500))},s=function(e){var t,n=se((t={isSimulated:!0,userId:(r+e).toString(),mediaTypes:[ot.RealtimeMediaType.AUDIO],muted:!1},0<e&&!(e%6)?(t.participantType=ot.RTCParticipantType.MEETING_POINT,t.userDisplayName="CMR ("+e+")"):(t.participantType=ot.RTCParticipantType.SESSION_GUEST,t.userDisplayName=[Math.floor(e/10),e%10].join(" "),e%9||t.mediaTypes.push(ot.RealtimeMediaType.VIDEO)),t));!o.isMeetingPointInvited&&n.isCMP&&(n.isMeetingPointInvitee=!0,o.setMeetingPointInviteState(!0),Xe(o.callId));var i=he(o,n,at.ParticipantState.Active);R.publish("/call/participant/added",[o.callId,i]),R.publish("/call/participant/joined",[o,i]),j(),e<19?f(function(){o.isPresent()&&s(e+1)},2500):f(a,12e4)};s(0),o.setState(at.CallState.Active),J(o)}},this.canStartScreenShare=function(e){var t=Z(e);if(!t)return v.warn("[CircuitCallControlSvc]: canStartScreenShare - There is no local call"),!1;if(!t.hasRemoteScreenShare())return!0;if(!t.participants.some(function(e){return e.isModerator&&e.mediaType&&e.mediaType.desktop}))return!0;if(I.isSessionGuest||t.isGuestInvite)return!1;var n=p.getConversationFromCache(t.convId);return!!n&&n.userIsModerator(I.localUser)},this.addConferenceAsGuest=function(e){var t=W(e);if(t&&t.isTemporary&&t.guestToken){v.debug("[CircuitCallControlSvc]: Create placeholder remote call for temporary guest conversation with convId = ",t.convId);var n=new dt(t);n.setState(at.CallState.NotStarted),n.guestToken=t.guestToken,Q(n),t.call=n,z(t),J(n)}else v.warn("[CircuitCallControlSvc]: addConferenceAsGuest - No temporary conversation or guest token is missing")},this.removeConferenceAsGuest=function(e){var t=ee(e);if(!t)return v.warn("[CircuitCallControlSvc]: removeConferenceAsGuest - Could not find call"),!1;if(!t.isRemote)return v.warn("[CircuitCallControlSvc]: removeConferenceAsGuest - Cannot remove temporary conversation with active call"),!1;var n=W(t.convId);if(!n||!n.isTemporary)return v.warn("[CircuitCallControlSvc]: removeConferenceAsGuest - No temporary conversation"),!1;$(t),v.debug("[CircuitCallControlSvc]: Publish /conversation/temporary/ended event"),R.publish("/conversation/temporary/ended",[n])},this.testCandidatesCollection=function(e){return e?(v.debug("[CircuitCallControlSvc]: Test ICE candidates collection with TURN..."),new E(function(i,r){var o="echo_"+I.localUser.clientId,e={convId:I.isSessionGuest&&I.localUser.conversationId||o,rtcSessionId:o,ownerId:I.localUser.userId,isTelephonyConversation:!1,mediaNode:Et.mediaNode};v.debug("[CircuitCallControlSvc]: testIceCandidates - Get TURN servers"),h.prepareSession(e,function(e,t){if(e)return v.error("[CircuitCallControlSvc]: Failed to prepare session data. ",e),void r(e);if(!t||!t.length)return h.terminateRtcCall(o,ot.DisconnectCause.HANGUP),v.error("[CircuitCallControlSvc]: Failed to prepare session data. No TURN servers."),void r("No TURN servers");var n=t[0];v.debug("[CircuitCallControlSvc]: testIceCandidates - TURN servers: ",n.turnServer),Ue(n).then(function(e){h.terminateRtcCall(o,ot.DisconnectCause.HANGUP,function(){i(e)})}).catch(function(e){h.terminateRtcCall(o,ot.DisconnectCause.HANGUP,function(){r(e)})})})})):(v.debug("[CircuitCallControlSvc]: Test ICE candidates collection without TURN..."),Ue())},this},et}(Circuit=function(e){"use strict";var f=e.ClientApiHandlerSingleton,v=e.Constants,R=e.Proto,g=e.Utils;return e.DeviceDiagnosticSvcImpl=function(i,n,o,e,a){o.debug("New Service: DeviceDiagnosticSvc");var r=3e3,t=6e4,s=5e4,c=f.getInstance(),l=[],d=!(!a||i.isSessionGuest);function u(){if(d)if(0!==l.length){var n=JSON.stringify(l);if(n.length>t){o.warn("[DeviceDiagnosticSvc]: Stored device diagnostics exceeded max size. Discard old data.");var i="",r=n.length-s;l.some(function(e,t){if((i+=JSON.stringify(e)).length>r)return o.warn("[DeviceDiagnosticSvc]: Number of discarded records: ",t+1),l.splice(0,t+1),n=JSON.stringify(l),!0})}a.setString(a.keys.RTC_CLIENT_INFOS,n)}else a.removeItem(a.keys.RTC_CLIENT_INFOS)}function C(e){e&&e.joinDelayTimer&&(n.cancel(e.joinDelayTimer),e.joinDelayTimer=null)}function E(e){return!(!e||!e.deviceDiagnostics)&&(e.deviceDiagnostics.data.actionInfo.some(function(e){return!e.complete})||!e.deviceDiagnostics.iceGatheringFinished)}function T(e){if(e&&e.deviceDiagnostics){o.debug("[DeviceDiagnosticSvc]: Force finish device diagnostics");var t=e.deviceDiagnostics;C(t),t.joinDelayed&&I(e),p(e)}}function p(e){e&&e.deviceDiagnostics&&(o.debug("[DeviceDiagnosticSvc]: Clear device diagnostics"),C(e.deviceDiagnostics),delete e.deviceDiagnostics)}function S(e){d&&(o.debug("[DeviceDiagnosticSvc]: Store device diagnostics to send when client reconnects"),l.push(e),u())}function I(e){if(e&&e.deviceDiagnostics){var t={userId:i.localUser.userId,convId:e.convId,clientInfoType:v.RtcClientInfoType.DEVICE_DIAGNOSTICS,reason:v.RtcClientInfoReason.JOIN_DELAY,timestamp:Date.now(),sessionId:e.callId,deviceDiagnostics:g.shallowCopy(e.deviceDiagnostics.data)};e.instanceId&&(t.instanceId=e.instanceId),p(e),o.debug("[DeviceDiagnosticSvc]: Sending device diagnostics..."),c.sendClientInfo([t],function(e){e&&(o.debug("[DeviceDiagnosticSvc]: Failed to send device diagnostics. ",e),R.isOfflineFailure(e)&&S(t))})}else o.debug("[DeviceDiagnosticSvc]: sendDeviceDiagnostics - Nothing to send")}return d&&e.subscribe("/conversations/loadComplete",function(){o.debug("[DeviceDiagnosticSvc]: Received /conversations/loadComplete event"),function(){if(0<l.length){var t=l;l=[],a.removeItem(a.keys.RTC_CLIENT_INFOS),o.info("[DeviceDiagnosticSvc]: Send offline join failures to backend"),c.sendClientInfo(t,function(e){e?(o.error("[DeviceDiagnosticSvc]: Failed to send offline join failures. ",e),R.isOfflineFailure(e)&&(Array.prototype.unshift.apply(l,t),u())):o.debug("[DeviceDiagnosticSvc]: Sent offline join failures")})}}()}),this.startDiagnostics=function(e){e&&!e.isRemote&&(o.info("[DeviceDiagnosticSvc]: Start diagnostics collection for callId = ",e.callId),e.deviceDiagnostics=e.deviceDiagnostics||{data:{actionInfo:[]}})},this.startJoinDelayTimer=function(e){if(e&&e.deviceDiagnostics){o.debug("[DeviceDiagnosticSvc]: Start join delay timer for callId = ",e.callId);var t=e.deviceDiagnostics;C(t),t.joinDelayTimer=n(function(){t.joinDelayTimer=null,function(e){if(e&&e.deviceDiagnostics){var t=e.deviceDiagnostics;if(o.debug("[DeviceDiagnosticSvc]: Join action delayed, preparing device diagnostics"),C(t),t.joinDelayed=!0,"undefined"!=typeof DeviceStatistics){var n=DeviceStatistics.getStatistics();o.info("[DeviceDiagnosticSvc]: Received native device diagnostics: ",n),t.data.usedRAMApp=n.usedRAMApp,t.data.availableRAMApp=n.availableRAMApp,t.data.usedRAMDevice=n.usedRAMDevice,t.data.availableRAMDevice=n.availableRAMDevice,t.data.virtualMemory=n.virtualMemory,t.data.usagePerCore=n.usagePerCore,t.data.numberOfCores=n.numberOfCores,t.data.networkType=n.networkType}}}(e)},r),t.joinDelayed=!1,t.waitingToSend=!1,t.iceGatheringFinished=!1,e.deviceDiagnostics=t}},this.createActionInfo=function(e,t){if(o.debug("[DeviceDiagnosticSvc]: Create action info ",t),e&&e.deviceDiagnostics&&t){var n={actionType:t};switch(t){case v.RtcDiagnosticsAction.SDP_ANSWER:case v.RtcDiagnosticsAction.SDP_CONNECTED:case v.RtcDiagnosticsAction.REMOTE_ICE_CANDIDATES:n.type=v.RtcActionInfoType.EVENT,n.timestampEvent=Date.now();break;default:n.type=v.RtcActionInfoType.REQUEST_RESPONSE,n.timestampRequest=Date.now()}return e.deviceDiagnostics.data.actionInfo.push(n),n}},this.finishActionInfo=function(e,t){t&&(o.debug("[DeviceDiagnosticSvc]: Finish action info ",t.actionType),t.complete=!0,t.type===v.RtcActionInfoType.REQUEST_RESPONSE&&(t.timestampResponse=Date.now()),e&&e.deviceDiagnostics&&(t.isEndOfCandidates&&(e.deviceDiagnostics.iceGatheringFinished=!0,o.debug("[DeviceDiagnosticSvc]: Ice gathering finished")),e.deviceDiagnostics.waitingToSend&&!E(e)&&T(e)))},this.finishDeviceDiagnostics=function(e){if(e&&e.deviceDiagnostics){o.debug("[DeviceDiagnosticSvc]: Finish device diagnostics");var t=e.deviceDiagnostics;C(t),t.joinDelayed?E(e)?(t.waitingToSend=!0,o.debug("[DeviceDiagnosticSvc]: Send device diagnostic delayed")):I(e):p(e)}},this.forceFinishDeviceDiagnostics=T,this.storeClientInfo=S,this.sendCallConnected=function(e){if(c.isCallConnectedInfoSupported()){o.debug("[DeviceDiagnosticSvc]: Send call connected event to backend");var t=("undefined"!=typeof DeviceStatistics?DeviceStatistics.getStatistics():null)||{};t.recordingDevice=e.recordingDevice,t.playbackDevice=e.playbackDevice,t.negotiationInfos=[];var n={userId:i.localUser.userId,convId:e.convId,clientInfoType:v.RtcClientInfoType.CALL_CONNECTED,reason:v.RtcClientInfoReason.CALL_CONNECTED,timestamp:Date.now(),sessionId:e.callId,deviceDiagnostics:t};c.sendClientInfo([n],function(e){e&&o.debug("[DeviceDiagnosticSvc]: Failed to send call connected event. ",e)})}},d&&(l=a.getObjectSync(a.keys.RTC_CLIENT_INFOS)||[],Array.isArray(l)||(l=[]),u()),this},e}(Circuit=function(e){"use strict";var G=e.Enums.AtcInfoMessage,H=e.Enums.AtcMessage,k=e.Enums.AtcRegistrationState,V=e.ClientApiHandlerSingleton,F=e.Constants,B=e.DefaultAvatars,x=e.PhoneNumberFormatter,W=e.RoutingOptions,Y=e.UserToUserHandlerSingleton,K=e.Utils;return e.AtcRegistrationSvcImpl=function(r,n,o,t,i,a){o.debug("New Service: AtcRegistrationSvc");var s=64,c=8,l=8,d=V.getInstance(),u=Y.getInstance(),C={},E=k.Disconnected,T=!1,p=null,S=null,I={},f=null,v=c,R={state:F.TrunkState.DOWN},g=null,A=!1,_=null,m=K.isMobile()?F.DeviceType.MOBILE:e.isElectron?F.DeviceType.APPLICATION:F.DeviceType.WEB;function N(e){e!==E&&(E=e,o.info("[AtcRegistrationSvc]: Publish /atcRegistration/state event. State =",e),t.publish("/atcRegistration/state",[e]),r.localUser.isATC&&e!==k.Registering&&L(R))}function h(e){return e.state!==F.TrunkState.DOWN&&p!==F.TrunkState.DOWN}function O(){return!!r.localUser.telephonyAvailable!=(!!r.localUser.callerId||!!r.localUser.phoneNumber)}function D(e){var t;(t=e)&&(t===F.ReturnCode.FAILED_TO_SEND||t===F.ReturnCode.REQUEST_TIMEOUT||503===t.code||408===t.code)&&i.isRegistered()&&E===k.Registering&&(o.info("[AtcRegistrationSvc]: Retry ATC registration in "+v+" seconds"),f=n(function(){f=null,v<s&&(v=Math.min(2*v,s)),y()},1e3*v)),N(k.Unregistered)}function y(){var e={content:{type:"REGISTER",phoneNumber:r.localUser.cstaNumber,reroutingPhoneNumber:K.cleanPhoneNumber(r.localUser.reroutingPhoneNumber),onsHash:r.localUser.onsSipAuthenticationHash||void 0,ondHash:r.localUser.ondSipAuthenticationHash||void 0,routeToDesk:r.localUser.selectedRoutingOption===W.DeskPhone.name,tcPool:r.localUser.associatedTelephonyTrunkGroupId,pbxCallLog:!0,deviceType:m,userId:r.localUser.userId,conversationId:g.convId,rtcSessionId:g.rtcSessionId,lastItemTime:g.lastItemModificationTime},destUserId:r.localUser.associatedTelephonyUserID,keysToOmitFromLogging:["content.onsHash","content.ondHash"]};n.cancel(f),f=null,C.phoneNumber=r.localUser.cstaNumber,C.associatedTelephonyUserID=r.localUser.associatedTelephonyUserID,C.associatedTelephonyTrunkGroupId=r.localUser.associatedTelephonyTrunkGroupId,C.reroutingPhoneNumber=K.cleanPhoneNumber(r.localUser.reroutingPhoneNumber),C.onsSipAuthenticationHash=r.localUser.onsSipAuthenticationHash,C.ondSipAuthenticationHash=r.localUser.ondSipAuthenticationHash,_=r.localUser.selectedRoutingOption,r.localUser.noCallLog=!1,N(k.Registering),o.info("[AtcRegistrationSvc]: Registering with ATC, phoneNumber: "+C.phoneNumber+", associatedTelephonyUserID: "+C.associatedTelephonyUserID),u.sendAtcRequest(e,function(n,i){r.$apply(function(){return T&&!g.call?(o.info("[AtcRegistrationSvc]: There was a configuration update while registering. Need to register again"),T=!1,void(n||!i||i.err?y():(A=!0,b()))):n||i&&i.err?(n=n||i.err,o.error("[AtcRegistrationSvc]: Register with ATC failed with error: ",n),void D(n)):void(i&&i.configurationData?(o.info("[AtcRegistrationSvc]: Received ATC configuration data: ",i.configurationData),v=c,C.configurationData=i.configurationData,C.reroutingPhoneNumber=i.configurationData.cell,C.capabilities=i.capabilities,r.localUser.reroutingPhoneNumber=x.format(i.configurationData.cell),r.localUser.vmNumber=i.configurationData.vm,r.localUser.isOSV=i.configurationData.pbx&&"OSV"===i.configurationData.pbx,r.localUser.PBXCallLogSupported=C.capabilities&&C.capabilities.includes(F.AtcCapabilities.PBX_CALL_LOG),N(k.Registered),r.localUser.PBXCallLogSupported&&!r.localUser.noCallLog&&(e=!0,t={content:{type:H.INFO,phoneNumber:r.localUser.cstaNumber,info:{type:G.ENABLE_PBX_CALL_LOG,status:e}},destUserId:r.localUser.associatedTelephonyUserID},u.sendAtcRequest(t)),P(F.TrunkState.UP),o.debug("[AtcRegistrationSvc]: Registration refresh will be handled by access server")):N(k.Unregistered));var e,t})})}function b(){if(o.info("[AtcRegistrationSvc]: Unregister with ATC"),E!==k.Unregistered&&E!==k.Disconnected){var e={content:{type:"UNREGISTER",phoneNumber:C.phoneNumber},destUserId:C.associatedTelephonyUserID};N(k.Unregistered),C.associatedTelephonyUserID="",u.sendAtcRequest(e,function(e){r.$apply(function(){e?o.error("[AtcRegistrationSvc]: Unregister with ATC failed with: ",e):o.info("[AtcRegistrationSvc]: Unregistered successfully with ATC"),A&&(y(),A=!1)})})}else o.debug("[AtcRegistrationSvc]: The client is not registered with ATC")}function P(t){t!==p&&r.$apply(function(){p=t,o.debug("[AtcRegistrationSvc]: Set trunk state to ",p);var e=K.shallowCopy(R);e.state=t,U(e)})}function U(e){if(e){if(r.localUser.isATC)if(e.state===F.TrunkState.DOWN)b();else if(R.state===F.TrunkState.DOWN&&e.state===F.TrunkState.UP)return R=e,E===k.Registering?(o.debug("[AtcRegistrationSvc]: Client is registering and configuration has changed. Wait..."),void(T=!0)):void function(){n.cancel(f),f=null;var e=K.randomNumber(0,l);o.info("[AtcRegistrationSvc]: Delay ATC registration by "+e+" seconds"),f=n(function(){f=null,R.state===F.TrunkState.UP&&E===k.Unregistered&&y()},1e3*e)}();L(e)}}function L(e){e&&(R=e,r.localUser.isATC?(R.state=E===k.Registered?F.TrunkState.UP:F.TrunkState.DOWN,R.defaultCallerId=null,R.isGTCEnabled=!0):R.defaultCallerId=R.defaultCallerId||null,R.telephonyAvailableForTenant=!!e.isGTCEnabled,R.telephonyAvailableForUser=!(!e.isGTCEnabled||!r.localUser.callerId&&!R.defaultCallerId),R.conferenceDialOutAvailable=R.telephonyAvailableForTenant&&h(R),R.phoneCallsAvailable=R.telephonyAvailableForUser&&h(R),o.info("[AtcRegistrationSvc]: Publish /telephony/data event. data = ",R),t.publish("/telephony/data",[R]),R.state!==F.TrunkState.DOWN&&R.state!==F.TrunkState.UP||a.getTelephonyConversationPromise().then(function(e){e&&(h(R)?e.avatar=B.TELEPHONY:e.avatar=B.TELEPHONY_DISABLED,g=e)}).catch(function(){o.debug("[AtcRegistrationSvc]: No telephony conversation found")}))}function M(n){o.info("[AtcRegistrationSvc]: Getting telephony data"),r.telephonyEnabled?d.getTelephonyData(function(e,t){r.$apply(function(){e?e!==F.ReturnCode.NO_RESULT&&(o.error("[AtcRegistrationSvc]: Error getting telephony data: ",e),n&&n(e)):(U(t),n&&n(null,R))})}):(L({state:F.TrunkState.DOWN}),n&&n(null,R))}function w(e){if(S&&S!==r.localUser.associatedTelephonyUserID&&(I[S]||d.unsubscribePresence([S]),S=null),r.localUser.associatedTelephonyUserID&&S!==r.localUser.associatedTelephonyUserID&&(S=r.localUser.associatedTelephonyUserID,r.localUser.isATC&&I[S]||d.subscribePresence([r.localUser.associatedTelephonyUserID],function(e,t){if(e)return o.error("[AtcRegistrationSvc]: Unable to subscribe to associated TC presence"),void(S=null);t&&0<t.length&&!r.localUser.isATC&&P(t[0].state===F.PresenceState.AVAILABLE?F.TrunkState.UP:F.TrunkState.DOWN)})),!r.localUser.isATC||!r.localUser.cstaNumber)return E===k.Registered?(o.debug("[AtcRegistrationSvc]: Cannot register without an associated ATC or assigned phoneNumber"),b(),M()):(e||O())&&M(),void N(k.Disconnected);if(r.localUser.associatedTelephonyUserID!==C.associatedTelephonyUserID||r.localUser.cstaNumber!==C.phoneNumber||K.cleanPhoneNumber(r.localUser.reroutingPhoneNumber)!==C.reroutingPhoneNumber||r.localUser.onsSipAuthenticationHash!==C.onsSipAuthenticationHash||r.localUser.ondSipAuthenticationHash!==C.ondSipAuthenticationHash||E!==k.Registered&&E!==k.Registering){if(E===k.Registering)return o.debug("[AtcRegistrationSvc]: Client is registering and configuration has changed. Wait..."),void(T=!0);if(E===k.Registered){if(o.debug("[AtcRegistrationSvc]: Client is already registered and configuration has changed."),g.call)return o.debug("[AtcRegistrationSvc]: There is an active telephony call, wait..."),void(T=!0);A=!0,b()}if(!A){if(!g)return o.debug("[AtcRegistrationSvc]: Get telephony conversation before proceeding with ATC register"),a.getTelephonyConversationPromise().then(function(e){g=e,o.debug("[AtcRegistrationSvc]: Got telephony conversation. Proceed with ATC register."),w()}),void(!e&&O()&&M());y()}}else o.debug("[AtcRegistrationSvc]: Client is already registered or registering with ATC and the associatedTelephonyUserID is the same")}return t.subscribe("/localUser/update",function(){i.isRegistered()&&a.isConversationsLoadComplete()&&(o.debug("[AtcRegistrationSvc]: Received /localUser/update event"),w())}),t.subscribe("/conversations/loadComplete",function(){o.debug("[AtcRegistrationSvc]: Received /conversations/loadComplete event"),w(!0)}),t.subscribe("/registration/state",function(e){a.isConversationsLoadComplete()&&(o.debug("[AtcRegistrationSvc]: Received /registration/state event"),e!==RegistrationState.LoggingOut&&e!==RegistrationState.Reconnecting&&e!==RegistrationState.Disconnected||(n.cancel(f),f=null,n(r.localUser.isATC?b:function(){R.state=F.TrunkState.DOWN,S=null,L(R)})))}),t.subscribe("/conversation/update",function(e){if(e.isTelephonyConv){if(o.debug("[AtcRegistrationSvc]: Received /conversation/update event"),g=e,!T)return;e.call?o.debug("[AtcRegistrationSvc]: There is still an active telephony call, wait..."):E!==k.Registering&&(A=!(T=!1),b())}}),t.subscribe("/user/settings/update",function(){a.isConversationsLoadComplete()&&(o.debug("[AtcRegistrationSvc]: Received /user/settings/update event"),_!==r.localUser.selectedRoutingOption&&(_=r.localUser.selectedRoutingOption,function(){if(E===k.Registered){var e=r.localUser.selectedRoutingOption===W.DeskPhone.name;o.debug("[AtcRegistrationSvc]: Send SET_ROUTE_TO_DESK event to ATC. status = ");var t={content:{type:H.INFO,phoneNumber:r.localUser.cstaNumber,info:{type:G.SET_ROUTE_TO_DESK,status:e}},destUserId:r.localUser.associatedTelephonyUserID};u.sendAtcRequest(t)}}()))}),d.on("User.TELEPHONY_DATA",function(e){r.$apply(function(){try{o.debug("[AtcRegistrationSvc]: Received User.TELEPHONY_DATA with data: ",e.data),e.data&&(e.data.isGTCEnabled=!0,U(e.data))}catch(e){o.error("[AtcRegistrationSvc]: Exception handling User.TELEPHONY_DATA event.",e)}})}),d.on("User.USER_PRESENCE_CHANGE",function(e){e.userId&&(e.userId===S&&(o.debug("[AtcRegistrationSvc]: Received User.USER_PRESENCE_CHANGE for associated TC. newState = ",e.newState),P(e.newState.state===F.PresenceState.AVAILABLE?F.TrunkState.UP:F.TrunkState.DOWN)),I[e.userId]&&(o.info("[AtcRegistrationSvc]: Publish /trunk/update event. newState = ",e.newState),t.publish("/trunk/update",[e.newState])))}),d.on("User.ATC_REFRESH_FAILED",function(){o.error("[AtcRegistrationSvc]: Received User.ATC_REFRESH_FAILED event."),E===k.Registered?g.call&&!g.call.isRemote?o.info("[AtcRegistrationSvc]: There is an active telephony call, ignoring ATC re-register for now. If error persists on server another event will come later."):r.$apply(function(){o.info("[AtcRegistrationSvc]: New registration must be triggered."),A=!0,b()}):o.info("[AtcRegistrationSvc]: Client is not registered, ignoring failed refresh on server.")}),u.on("ATC.INFO",function(e){o.debug("[AtcRegistrationSvc]: Received ATC.INFO with data = ",e),r.localUser&&e.hasOwnProperty("pbxCallLogStatus")&&(r.localUser.noCallLog=!!e.pbxCallLogStatus)}),u.on("ATC.START_REASSIGNMENT",function(){o.debug("[AtcRegistrationSvc]: Received ATC.START_REASSIGNMENT event"),d.renewAssociatedTelephonyUser(r.localUser.associatedTelephonyUserID,function(e){e&&o.error("[AtcRegistrationSvc]: Failed to reassign telephony user. ",e)})}),this.initAtcForSdk=function(){o.debug("[AtcRegistrationSvc]: initAtcForSdk"),m=F.DeviceType.SDK,w(!0)},this.atcState=function(){return E},this.getAtcRegistrationData=function(){return C.configurationData},this.atcUnregister=b,this.getTelephonyData=function(e){e=e||function(){},E!==k.Registering?K.isEmptyObject(R)?M(e):e(null,R):e("ATC Registering")},this.isExtendedAlertingSupported=function(){return!(!C||!C.capabilities)&&C.capabilities.includes(F.AtcCapabilities.EXTENDED_ALERTING)},this.isClearConnectionBusySupported=function(){if(C&&C.capabilities)return C.capabilities.includes(F.AtcCapabilities.CLEAR_CONNECTION_BUSY)},this.subscribeConnectorPresence=function(e,n){(e=e.filter(function(e){return!I[e]})).length&&(o.debug("[AtcRegistrationSvc]: Subscribe for connectors presence. ",e),d.subscribePresence(e,function(e,t){e?(o.error("[AtcRegistrationSvc]: Failed to subscribe to connectors presence. ",e),n&&n(e)):t&&(o.debug("[AtcRegistrationSvc]: Successfully subscribed for connectors presence"),t.forEach(function(e){I[e.userId]=!0}),n&&n(null,t))}))},this.unsubscribeConnectorPresence=function(e,t){e?e=e.filter(function(e){if(I[e])return delete I[e],e!==S}):(e=Object.keys(I).filter(function(e){return e!==S}),I={}),e.length&&(o.debug("[AtcRegistrationSvc]: Unsubscribe for connectors presence. ",e),d.unsubscribePresence(e,t))},this.isPBXCallLogSupported=function(){return!(!C||!C.capabilities)&&C.capabilities.includes(F.AtcCapabilities.PBX_CALL_LOG)},this},e}(Circuit=function(D){"use strict";var y=D.ChromeExtension,b=D.ExtensionConnHandlerSingleton,P=D.ScreenSharingController,U=D.Utils;return D.ExtensionSvcImpl=function(r,i,o,e,a,s,c){a.debug("New Service: ExtensionSvc");var t="circuitsandbox.net",n="beta.circuit.com",l="de.circuit.com",d="tandi.circuitsandbox.net",u="circuit.uni-heidelberg.de",C="1.2.1600",E=U.convertVersionToNumber(C),T="electron",p=Object.freeze({UNSUPPORTED_BROWSER:"UNSUPPORTED_BROWSER",INSTALL_ALREADY_IN_PROGRESS:"INSTALL_ALREADY_IN_PROGRESS",UNSUPPORTED_EXT_VERSION:"UNSUPPORTED_EXT_VERSION",USER_CANCELLED_INSTALL:"USER_CANCELLED_INSTALL",INSTALL_FAILED:"INSTALL_FAILED",INTERNAL_ERROR:"INTERNAL_ERROR"}),S=this,I="object"==typeof b?b.getInstance():null,f="",v=!0,R="",g=!1,A=!1,_=!1,m=D.isElectron?require("electron").ipcRenderer:null;function N(e,t,n){return a.debug("[ExtensionSvc]: Invoke ExtensionConnHandler API: ",e),I?I.isExtensionRunning()?(n&&(t=t||[]).push(function(e,t){r.$apply(function(){n(e,t)})}),I[e].apply(I,t)):(a.debug("[ExtensionSvc]: Chrome extension is not running"),void(n&&i(function(){n("Extension not running")},0))):(a.debug("[ExtensionSvc]: ExtensionConnHandler is not loaded"),void(n&&i(function(){n("No ExtensionConnHandler")},0)))}function h(e){return r.browser&&r.browser.chrome?A||_?(a.warn("[ExtensionSvc]: The first extension installation attempt failed. Redirect the user to web store page. Url: ",R),e&&c&&c.error({message:"res_ExtensionCannotBeInstalled",messageParams:[R]}),A?p.INSTALL_ALREADY_IN_PROGRESS:p.INSTALL_FAILED):v?null:(a.warn("[ExtensionSvc]: We are running an outdated extension:",f),e&&c&&c.error({message:"res_UnsupportedExtensionVersion"}),p.UNSUPPORTED_EXT_VERSION):p.UNSUPPORTED_BROWSER}if(P&&P.injectExtensionSvc(this,I),I){I.addEventListener("extensionInitialized",function(e){r.$apply(function(){f=e.data.version,a.info("[ExtensionSvc]: Validate the installed extension version: ",f),f!==T&&((v=U.convertVersionToNumber(f)>=E)||a.warn("[ExtensionSvc]: The installed extension version ("+f+") is not supported. Minimum version is "+C)),v&&(A=!1,r.isChromeExtRunning=!0,a.setExtensionVersion(f),a.debug("[ExtensionSvc]: Publish /chromeExt/initialized event"),s.publish("/chromeExt/initialized"))})}),I.addEventListener("extensionUnregistered",function(){r.$apply(function(){r.isChromeExtRunning=!1,a.debug("[ExtensionSvc]: Publish /chromeExt/unregistered event"),s.publish("/chromeExt/unregistered")})});var O=function(t,n){r.$apply(function(){var e=n.data&&n.data.data;a.debug("[ExtensionSvc]: Publish "+t+" event: ",e),s.publish(t,[e])})};I.addEventListener("headsetAppLaunched",O.bind(null,"/chromeExt/headsetAppLaunched")),I.addEventListener("headsetAppUninstalled",O.bind(null,"/chromeExt/headsetAppUninstalled")),I.addEventListener("webRTCIPHandlingPolicyChanged",O.bind(null,"/chromeExt/webRTCIPHandlingPolicyChanged"))}return this.isExtensionRunning=function(){return I&&I.isExtensionRunning()&&v},this.getExtensionVersion=function(){return f},this.isExtensionVersionSupported=function(){return v},this.installExtension=function(i){return new e(function(e,t){if(S.isExtensionRunning())e();else{if(!c)return a.error("[ExtensionSvc]: installExtension API requires PopupSvc"),void t(p.INTERNAL_ERROR);var n=h(i);n?t(n):c.confirm({message:"res_ActionInstallExtensionText",controller:"ChromeExtensionInstallDialogCtrl",title:"res_ActionInstallExtensionTitle",yesLabel:"res_ActionInstall",noLabel:"res_Close",backdrop:!0}).result.then(e).catch(function(e){i&&e===p.INSTALL_FAILED&&(a.warn("[ExtensionSvc]: The extension installation failed. Redirect the user to web store page. Url: ",R),c.error({message:"res_ExtensionCannotBeInstalled",messageParams:[R]})),t(e||p.USER_CANCELLED_INSTALL)})}})},this.inlineInstallation=function(i){return new e(function(e,t){try{var n=h(i);if(n)return void t(n);if(a.debug("[ExtensionSvc]: Extension URL = ",R),!g)return a.debug("[ExtensionSvc]: Extension does not support inline installation. Open store link."),o.open(R),void e();chrome.webstore.install(R,function(){r.$apply(function(){a.debug("[ExtensionSvc]: Circuit extension was successfully installed"),A=!0,e()})},function(e){a.error("[ExtensionSvc]: There was an error installing the Circuit extension. ",e),r.$apply(function(){"User cancelled install"!==e?(_=!0,i&&(a.warn("[ExtensionSvc]: The extension installation failed. Redirect the user to web store page. Url: ",R),c.error({message:"res_ExtensionCannotBeInstalled",messageParams:[R]})),t(p.INSTALL_FAILED)):t(p.USER_CANCELLED_INSTALL)})})}catch(e){a.error("[ExtensionSvc]: There was an exception installing the Circuit extension. ",e),_=!0,t(p.INSTALL_FAILED)}})},this.addEventListener=function(e,t){I&&I.addEventListener(e,t)},this.exchangeGetConnectionStatus=function(e,t){return N("exchangeGetConnectionStatus",[e],t)},this.exchangeConnect=function(e,t){return N("exchangeConnect",[e],t)},this.exchangeSearchContacts=function(e,t,n,i){return N("exchangeSearchContacts",[e,t,n],i)},this.exchangeGetCapabilities=function(e){return N("exchangeGetCapabilities",[],e)},this.exchangeAutodiscoverGetServer=function(e,t){return N("exchangeAutodiscoverGetServer",[e],t)},this.exchangeResolveContact=function(e,t,n){return N("exchangeResolveContact",[e,t],n)},this.exchangeGetContact=function(e,t,n){return N("exchangeGetContact",[e,t],n)},this.exchangeDisconnect=function(e){return N("exchangeDisconnect",[],e)},this.exchangeOnRenewedToken=function(e,t,n,i){return N("exchangeOnRenewedToken",[e,t,n],i)},this.storeExchCredentials=function(e,t){return N("exchangeStoreCredentials",[e],t)},this.getStoredCredentials=function(e,t){return N("getStoredCredentials",[e],t)},this.getAllPersonalContacts=function(e,t){return N("getAllPersonalContacts",[e],t)},this.syncAllPersonalContacts=function(e,t,n){return N("syncAllPersonalContacts",[e,t],n)},this.exchangeCancelReqCallback=function(e){return N("exchangeCancelReqCallback",[e])},this.getAppointments=function(e,t,n,i,r){return N("getAppointments",[e,t,n,i],r)},this.supportsGetAppointments=function(){return!!S.isExtensionRunning()||!(!r.browser||!r.browser.chrome)},this.supportsExchangeAutodiscover=function(){return S.isExtensionRunning()},this.supportsExchangeAutodiscoverSvc=function(){return S.isExtensionRunning()},this.supportsExchangeAutodiscoverGetServer=function(){return f===T||1023300<=U.convertVersionToNumber(f)},this.supportsOOO=function(){return f===T||1022800<=U.convertVersionToNumber(f)},this.getOooMsg=function(e,t,n,i){if(S.supportsOOO())return N("getOooMsg",[e,t,n],i);i&&i(null,{response:y.ExchangeConnResponse.UNSUPPORTED_METHOD})},this.launchHeadsetIntegrationApp=function(e,t,n){return N("launchHeadsetIntegrationApp",[e,t],n)},this.getHeadsetIntegrationAppStatus=function(e,t){return N("getHeadsetIntegrationAppStatus",[e],t)},this.restartHeadsetApp=function(e,t){return N("restartHeadsetApp",[e],t)},this.supportsPolicySettings=function(){return f===T||1023300<=U.convertVersionToNumber(f)},this.setIPHandlingPolicy=function(e,t,n){if(!D.isElectron)return N("setIPHandlingPolicy",[e,t],n);m.send("set-ip-handling-policy",e),n&&n(null)},this.getIPHandlingPolicy=function(n){if("function"==typeof n)return D.isElectron?(m.send("get-ip-handling-policy"),void m.once("get-ip-handling-policy-response",function(e,t){r.$apply(function(){n(null,{value:t||null})})})):N("getIPHandlingPolicy",[],n)},this.bringToFront=function(e){if(!D.isElectron)return N("bringToFront",[],e);m.send("focus-window")},this.getFileFromExtension=function(e,t,n){return N("getFile",[e,t],n)},r.isChromeExtRunning=S.isExtensionRunning(),function(){if(r.browser&&r.browser.chrome){if(R="https://chrome.google.com/webstore/detail/",r.siemensAGUser)return g=!1,R+="siemens-circuit-by-unify/mnkbplodbhpkiphfeldjmaoickanlanc",a.info("[ExtensionSvc]: Set URL to Siemens AG Circuit extension webstore link");switch(g=!0,o.location.hostname){case n:R+="jafbhekoolndfieffjkikfbmekjppnec",a.info("[ExtensionSvc]: Set URL to Beta-Circuit extension. ",R);break;case t:R+="ogdfpjnhdggplglemglldmioiblhkadm",a.info("[ExtensionSvc]: Set URL to Sandbox-Circuit extension. ",R);break;case d:R+="gdgfgnopapmocggkadgfkjekdlcohmdl",a.info("[ExtensionSvc]: Set URL to T&I-Circuit extension. ",R);break;case l:R+="mdgbjijndgkkllljdaoohenhhaenilam",a.info("[ExtensionSvc]: Set URL to T-Systems extension. ",R);break;case u:return g=!1,R+="universit%C3%A4t-heidelberg-ci/nnlgegdgijgicheaipembfeaggifmalb",a.info("[ExtensionSvc]: Set URL to Heidelberg Univerity extension webstore link ",R);default:R+="mhkbaognlahkdimlfcfhbeihldmjofgg",a.info("[ExtensionSvc]: Set URL to Circuit extension. ",R)}}}(),this},D}(Circuit=function(e){"use strict";var E=e.BaseCall,T=e.Utils;return e.PubSubSvcImpl=function(a){a.debug("New Service: PubSubSvc");var s={},c={},l={},d=[];function u(e,t){try{t=null!=t?Array.isArray(t)?t:[t]:[],e.apply(null,t)}catch(e){a.error(e)}}function C(e,t,n){e[t]&&e[t].slice(0).forEach(function(e){u(e,n)})}function n(e,t,n){e[t]?e[t].includes(n)||e[t].push(n):e[t]=[n]}function i(e,t,n){if(e[t]){var i=e[t].indexOf(n);0<=i&&e[t].splice(i,1)}}return this.publish=function(e,t){var n,i,r,o;(s[e]||c[e]||l[e]||d.length)&&(a.debug("[PubSubSvc]: Publishing "+e+" event"),C(s,e,t),i=t,c[n=e]&&(i=(i=null!=i?Array.isArray(i)?i:[i]:[]).map(function(e){if(e&&"object"==typeof e){if(e.isConversationObject)return T.trimConvForMobile(e);if(e instanceof E)return T.trimCallForMobile(e)}return e}),c[n].slice(0).forEach(function(e){u(e,i)})),C(l,e,t),r=e,(o=(o=t)?Array.prototype.slice.call(o):[]).unshift(r),d.slice(0).forEach(function(e){u(e,o)}),delete l[e])},this.subscribe=function(e,t){n(s,e,t)},this.unsubscribe=function(e,t){i(s,e,t)},this.subscribeOnce=function(e,t){n(l,e,t)},this.unsubscribeOnce=function(e,t){i(l,e,t)},this.subscribeMobile=function(e,t){n(c,e,t)},this.unsubscribeMobile=function(e,t){i(c,e,t)},this.subscribeAll=function(e){var t;t=e,d.includes(t)||d.push(t)},this.unsubscribeAll=function(e){var t,n;t=e,0<=(n=d.indexOf(t))&&d.splice(n,1)},this.resetSubscriptions=function(){s={},c={},l={},d=[]},this},e}(Circuit=function(e){"use strict";var t=e.Utils;return e.UtilSvcImpl=function(n,i,r,o){o.debug("New Service: UtilSvc");var a=this;return this.promisify=function(t,r){return function(){var e=Array.prototype.slice.call(arguments);return new i(function(n,i){e.push(function(e){if(e)return i(e);var t=Array.prototype.slice.call(arguments);switch(t.shift(),t.length){case 0:n();break;case 1:n(t[0]);break;default:n(t)}}),t.apply(r,e)})}},this.getFaqUrl=function(e){return n.localUser&&n.localUser.helpUrl&&t.DEFAULT_HELP_URL!==n.localUser.helpUrl?n.localUser.helpUrl:"https://www.circuit.com/unifyportalfaqdetail"+(e?"?articleId="+e:"")},this.isPartnerAdmin=function(e){return!(!n.localUser||!n.localUser.isPartnerAdmin)||(o.debug("[UtilSvc]: Cannot invoke request. Local user is not a partner admin."),e&&r(function(){e("Not partner admin")}),!1)},this.isTenantAdmin=function(e,t){return!!n.localUser&&(t&&t.tenantId!==n.localUser.tenantId?a.isPartnerAdmin(e):!!n.localUser.isTenantAdmin||(o.warn("[UtilSvc]: Cannot invoke request. Local user is not a tenant admin."),e&&r(function(){e("Not tenant admin")}),!1))},this},e.Enums=e.Enums||{},e.Enums.FaqArticle={AGC:"89415",DEVICE_ACCESS:"48742",JABRA:"112718",LOGIN:"37428",MODERATION:"93154",PLANTRONICS:"115017",TELEPHONY:"103733"},e}(Circuit=function(v){"use strict";var R=Object.freeze({Idle:"Idle",Active:"Active"});return v.Enums=v.Enums||{},v.Enums.IdleState=R,v.SdkHelperSvcImpl=function(i,e,r,o){var a,t=v.Enums.ConnectionState,s=v.Constants,c=v.Conversation,n=v.UserProfile,l=v.Utils,d=this,u={},C=null,E=v.ClientApiHandlerSingleton.getInstance(),T=[];function p(){return null}function S(){if(!i.localUser||!i.localUser.accounts||!i.localUser.accounts[0])return!1;var e=i.localUser,t=i.localUser.accounts[0],n=e.callerId;return t.telephonyConfiguration?(e.phoneNumber=t.telephonyConfiguration.phoneNumber||null,t.telephonyConfiguration.associatedTelephonyUserType===s.GtcTrunkType.ATC_TRUNK_TYPE?(e.callerId=t.telephonyConfiguration.phoneNumber,e.cstaNumber=l.cleanPhoneNumber(t.telephonyConfiguration.phoneNumber)):(e.callerId=t.telephonyConfiguration.callerId||e.phoneNumber||C,e.cstaNumber=null)):(e.phoneNumber=null,e.callerId=C,e.cstaNumber=null),n!==e.callerId}function I(){return new Promise(function(n,i){E.getTelephonyData(function(e,t){e?i(e):(C=t.defaultCallerId||null,n(t))})})}function f(){return new Promise(function(n,i){E.getTelephonyConversationId(function(e,t){e||!t?i("Telephony conversation not found"):d.getConversationById(t,null,function(e,t){e||!t?i(e||"Error retrieving telephony conversation"):((a=t).isTelephonyConv=!0,n(t))})})})}return o.subscribe("/telephony/data",function(e){var t=!1;C!==e.defaultCallerId&&(C=e.defaultCallerId,l.updateTelephonyNumbers(i.localUser,e.defaultCallerId)&&(t=!0)),i.localUser.telephonyAvailable!==e.telephonyAvailableForUser&&(i.localUser.telephonyAvailable=e.telephonyAvailableForUser,t=!0),t&&o.publish("/localUser/update",[i.localUser])}),E.on("Account.TELEPHONY_CONFIGURATION_UPDATED",function(e){if(e.configuration&&i.localUser){var t=i.localUser.accounts&&i.localUser.accounts[0];t&&(t.telephonyConfiguration=e.configuration,d.telephonyConfigChanged(),o.publish("/localUser/update",[i.localUser]))}}),this.addConversationToCache=function(e){e&&e.convId&&(u[e.convId]=c.extend(e))},this.setLocalUser=function(e){e&&(i.localUser=e,S(),n.syncTelephonyConfig(e))},this.telephonyConfigChanged=function(){S(),n.syncTelephonyConfig(i.localUser)},this.getConversationPromise=function(t){return new Promise(function(n,i){if(t){var e=u[t];e?n(e):d.getConversationById(t,null,function(e,t){e||!t?i("Conversation not found"):n(t)})}else i()})},this.getConversationById=function(e,t,i){"function"==typeof i&&E.getConversationById(e,function(e,t){var n=c.extend(t);n&&(u[t.convId]=n),i(e,n)})},this.getConversationByRtcSession=function(e){for(var t in r.debug("[SdkHelperSvc]: getConversationByRtcSession - rtcSessionId = ",e),u)if(u.hasOwnProperty(t)&&u[t].rtcSessionId===e)return u[t];return null},this.getConversationFromCache=function(e){return r.debug("[SdkHelperSvc]: getConversationFromCache - convId = ",e),u[e]||null},this.getConversationAsGuestById=function(t){return T.find(function(e){return e.convId===t})},this.getTelephonyData=I,this.getTelephonyConversationPromise=function(){return a?Promise.resolve(a):f()},this.getTelephonyConversation=function(t){if("function"==typeof t){if(a)return void window.setTimeout(function(){t(null,a)});I().then(S).then(f).then(function(e){t(null,e)}).catch(t)}},this.getCachedTelephonyConversation=function(){return a},this.isConversationsLoadComplete=function(){return!!i.localUser},this.updateLastCallTime=function(){},this.createConversationAsGuest=function(n){var e=c.extend({convId:n.convId,type:n.type,topic:n.topic,rtcSessionId:n.rtcSessionId,creatorId:n.creatorId,participants:[{userId:i.localUser.userId}],creatorTenantId:n.creatorTenantId||i.localUser.tenantId,isTemporary:!0,creationTime:n.creationTime||Date.now()});return T.some(function(e,t){if(e.convId===n.convId)return T.splice(t,1),!0}),T.push(e),r.debug("[SDK]: Created temporary (as guest) conversation for session:",e.rtcSessionId),setTimeout(function(){n.isExtended?(r.debug("[SDK]: Publish /conversation/navigate/reload event"),o.publish("/conversation/navigate/reload",[e])):(r.debug("[SDK]: Publish /conversation/new event"),o.publish("/conversation/new",[e]))}),e},this.createConversationAsGuestFromSummary=function(e){return new Promise(function(n,i){e?E.getConversationSummary(e,null,function(e,t){e?i("[SDK] getConversationSummary request failed"):n(d.createConversationAsGuest(t))}):i("convId is required")})},this.sendQOSData=function(e,t,n){r.debug("[SdkHelperSvc]: sendQOSData - call stats: ",n)},this.state=function(){switch(E.getConnState()){case t.Disconnected:return"Disconnected";case t.Connecting:return"Connecting";case t.Reconnecting:return"Reconnecting";case t.Connected:return"Registered";default:return""}},this.isRegistered=function(){return E.getConnState()===t.Connected},this.getSetting=function(){return null},this.getUserIdleState=function(){return R.Active},this.isAutoSnoozeOn=!1,this.setPresenceWithLocation=function(){},this.startAutoSnooze=function(){},this.cancelAutoSnooze=function(){},this.getUserFromCache=p,this.getUser=p,this.getUserById=function(e,t){t&&t(s.ReturnCode.NO_RESULT)},this.addUsersToCache=function(){},this.startReverseLookUp=function(e,t){t&&t(null)},this},v}(Circuit=function(t){"use strict";return t.Enums.SystemPermission=t.Constants.SystemPermission,t.Enums.DeviceType=t.Constants.DeviceType,t.Enums.CallStateName={},Object.getOwnPropertyNames(t.Enums.CallState).forEach(function(e){t.Enums.CallStateName[e]=e}),t.Enums.ConversationItemType=t.Constants.ConversationItemType,t.Enums.ConversationType={DIRECT:"DIRECT",GROUP:"GROUP",LARGE:"LARGE",COMMUNITY:"COMMUNITY"},t.Enums.PresenceState=t.Constants.PresenceState,t.Enums.RTCItemType=t.Constants.RTCItemType,t.Enums.RTCParticipantType=t.Constants.RTCParticipantType,t.Enums.SystemItemType=t.Constants.SystemItemType,t.Enums.TextItemContentType=t.Constants.TextItemContentType,t.Enums.UserType=t.Constants.UserType,t.Enums.UserState=t.Constants.UserState,t.Enums.SearchDirection=t.Constants.SearchDirection,t.Enums.ParticipantCriteria=t.Constants.GetConversationParticipantCriteria,t.Enums.ConversationParticipantType=t.Constants.ConversationParticipantType,t.Enums.RetrieveAction=t.Constants.RetrieveAction,t.Enums.RecordingInfoState=t.Constants.RecordingInfoState,t.Enums.RecordingInfoState=t.Constants.RecordingInfoState,t.Enums.SearchScope=t.Constants.SearchScope,t.Enums.SearchStatusCode=t.Constants.SearchStatusCode,t.Enums.SessionClosedReason=t.Constants.SessionClosedReason,t.Enums.GetAccountsFilterCriteria=t.Constants.GetAccountsFilterCriteria,t.Enums.AccountStatus=t.Constants.AccountStatus,t.Enums.GetAccountsSorting=t.Constants.GetAccountsSorting,t.Enums.GetAccountsOrdering=t.Constants.GetAccountsOrdering,t.Enums.VideoResolution={VGA:"VGA",HD:"HD",FHD:"FHD",NONE:"NONE"},t}((Circuit=function(e){"use strict";var t;return e.ExtensionConnHandlerSingleton={getInstance:function(){return t||(t=new e.ExtensionConnHandler),t}},e}(Circuit=function(p){"use strict";var e=p.BaseEventTarget,S=p.ChromeExtension,I=p.logger,f=p.Utils;function v(){v.parent.constructor.call(this,I);var o,a,s=5e3,c=65e3,r=this,l={},d=0,n=!1,e=window.BgExchangeConnectorHandler;if(p.isElectron){if(e){a=e.getInstance();var u=function(e){e.data&&e.data.keysToOmitFromLogging&&(e.keysToOmitFromLogging=e.data.keysToOmitFromLogging.map(function(e){return"data."+e}),delete e.data.keysToOmitFromLogging),t(e)};o=Object.create(I,{sendResponse:{value:function(e,t,n){var i={type:S.BgMsgType.RESPONSE,reqId:e,suppressLog:!!n,data:t};u(i)}},sendInternalEvent:{value:function(e){I.error("[ExtensionConnHandler]: Unexpected internal event: ",e)}},sendExchangeConnEvent:{value:function(e,t){var n={type:S.BgMsgType.EVENT,target:S.BgTarget.EXCHANGE_CONNECTOR,suppressLog:!!t,data:e};u(n)}}});var i="exchange";window.chrome={storage:{local:{set:function(e,t){window.localStorage.setItem(i,JSON.stringify(e,function(e,t){var n=t;return"string"==typeof e&&"$"===e.charAt(0)&&(n=void 0),n})),t&&t()},get:function(e,t){t&&t(JSON.parse(window.localStorage.getItem(i)))},clear:function(e){window.localStorage.removeItem(i),e&&e()}}},runtime:{},windows:{create:function(){}},permissions:{contains:function(e,t){t(!0)}}}}setTimeout(function(){I.info("[ExtensionConnHandler]: Raise extensionInitialized"),n=!0;var e=r.createEvent("extensionInitialized");e.data={version:"electron"},r.dispatch(e)},1e3)}function C(e,t){I.info("[ExtensionConnHandler]: Dispatching event: ",e);var n=r.createEvent(e);n.data=t,r.dispatch(n)}function E(e,t,n,i){return e?r.isExtensionRunning()?function(e,t,n,i){e.type===S.BgMsgType.REQUEST&&(e.reqId=function(e,t){e=e||function(){};var n=++d,i=window.setTimeout(function(){l[n]&&(I.error("[ExtensionConnHandler]: Timeout waiting for response. reqId:",n),delete l[n],e(S.ResponseError.TIMEOUT))},t||s);return l[n]={cb:e,timer:i},n}(t,n));i||I.msgSend("[ExtensionConnHandler]: ",e);if(e.suppressLog=i,p.isElectron&&a&&e.type===S.BgMsgType.REQUEST&&e.target===S.BgTarget.EXCHANGE_CONNECTOR)return window.setTimeout(function(){a.onWebClientMsg(o,e,p.__server)},0),e.reqId;var r=new CustomEvent(S.DOMEvent.TO_EXTENSION,{detail:JSON.stringify(e)});try{document&&document.dispatchEvent(r)}catch(e){return I.warning("[ExtensionConnHandler]: Error sending message: "+r,e),!1}return e.reqId}(e,t,n,i):(I.info("[ExtensionConnHandler]: Chrome extension is not running"),t&&window.setTimeout(function(){t("Extension not running")},0),!1):(I.error("[ExtensionConnHandler]: Cannot send message. Invalid message."),t&&window.setTimeout(function(){t("Invalid message")},0),!1)}function T(){I.warning("[ExtensionConnHandler]: The content script has unregistered itself. Chrome extension is no longer running."),n=!1,I.info("[ExtensionConnHandler]: Dispatching event: extensionUnregistered");var e=r.createEvent("extensionUnregistered");r.dispatch(e)}function t(e){if(e.target!==S.BgTarget.LOG)switch(e.suppressLog||I.msgRcvd("[ExtensionConnHandler]: ",e),e.type){case S.BgMsgType.REQUEST:case S.BgMsgType.EVENT:!function(e){switch(e.target){case S.BgTarget.INTERNAL:switch(e.data.type){case S.BgInternalMsgType.INIT_MSG:I.info("[ExtensionConnHandler]: Received INIT_MSG. Send an INIT_MSG_ACK to the extension."),n=!0,E({target:S.BgTarget.INTERNAL,data:{type:S.BgInternalMsgType.INIT_MSG_ACK}}),C("extensionInitialized",e.data);break;case S.BgInternalMsgType.EXTENSION_DISCONNECTED:I.warning("[ExtensionConnHandler]: Received EXTENSION_DISCONNECTED from ansible-content"),T();break;default:I.warning("[ExtensionConnHandler]: Received unknown INTERNAL msg type:",e.data.type)}break;case S.BgTarget.HEADSET_APP:switch(e.data.type){case S.BgHeadsetAppMsgType.HEADSET_APP_LAUNCHED:C("headsetAppLaunched",e.data);break;case S.BgHeadsetAppMsgType.HEADSET_APP_UNINSTALLED:C("headsetAppUninstalled",e.data);break;default:I.warning("[ExtensionConnHandler]: Received unknown HEADSET_APP msg type:",e.data.type)}break;case S.BgTarget.PRIVACY_SETTINGS:switch(e.data.type){case S.BgPrivacySettingsMsgType.IP_HANDLING_POLICY_CHANGED:C("webRTCIPHandlingPolicyChanged",e.data);break;default:I.warning("[ExtensionConnHandler]: Received unknown PRIVACY_SETTINGS msg type:",e.data.type)}break;default:e.suppressLog||I.info("[ExtensionConnHandler]: Dispatching event:",e.target);var t=r.createEvent(e.target);t.data=e.data,t.suppressLog=e.suppressLog,e.reqId&&e.type===S.BgMsgType.REQUEST&&(t.reqId=e.reqId),r.dispatch(t)}}(e);break;case S.BgMsgType.RESPONSE:!function(e){if(l[e.reqId]){var t=l[e.reqId];t.timer&&window.clearTimeout(t.timer),delete l[e.reqId],e.data&&e.data.error?(t.cb(e.data.error),e.data.error===S.ResponseError.UNREGISTERED&&T()):t.cb(null,e.data),e.suppressLog||I.debug("[ExtensionConnHandler]: Remaining callbacks pending:",Object.keys(l).length)}else I.info("[ExtensionConnHandler]: No registered callback for reqId =",e.reqId)}(e);break;default:I.msgRcvd("[ExtensionConnHandler]: Unexpected message type: ",e.type)}else I.logMsg(e.data.log.level,e.data.log.messages)}this.isExtensionRunning=function(){return n},this.getScreenShareUserMedia=function(e){E({target:S.BgTarget.SCREEN_SHARE,type:S.BgMsgType.REQUEST,data:{type:S.BgScreenShareMsgType.CHOOSE_DESKTOP_MEDIA}},e)},this.exchangeConnect=function(e,t){E({target:S.BgTarget.EXCHANGE_CONNECTOR,type:S.BgMsgType.REQUEST,data:{method:S.BgExchangeMsgType.CONNECT,object:{settings:e}},keysToOmitFromLogging:["data.object.settings.exchInfo"]},t,18e4)},this.exchangeDisconnect=function(e){E({target:S.BgTarget.EXCHANGE_CONNECTOR,type:S.BgMsgType.REQUEST,data:{method:S.BgExchangeMsgType.DISCONNECT,object:{}}},e,c)},this.exchangeGetConnectionStatus=function(e,t){E({target:S.BgTarget.EXCHANGE_CONNECTOR,type:S.BgMsgType.REQUEST,data:{key:e,method:S.BgExchangeMsgType.GET_CONNECTION_STATUS},keysToOmitFromLogging:["data.key"]},t,c)},this.exchangeGetCapabilities=function(e){E({target:S.BgTarget.EXCHANGE_CONNECTOR,type:S.BgMsgType.REQUEST,data:{method:S.BgExchangeMsgType.GET_CAPABILITIES}},e,c)},this.exchangeAutodiscoverGetServer=function(e,t){E({target:S.BgTarget.EXCHANGE_CONNECTOR,type:S.BgMsgType.REQUEST,data:{method:S.BgExchangeMsgType.AUTODISCOVER_GET_SERVER,object:{settings:e}},keysToOmitFromLogging:["data.object.settings.exchInfo"]},t,c)},this.exchangeCancelReqCallback=function(e){return I.debug("[ExtensionConnHandler]: Unregistering callback for reqId:",e),!(!(t=e)||!l[t]||(delete l[t],0));var t},this.exchangeSearchContacts=function(e,t,n,i){return E({target:S.BgTarget.EXCHANGE_CONNECTOR,type:S.BgMsgType.REQUEST,data:{key:e,method:S.BgExchangeMsgType.SEARCH_CONTACTS,object:{searchString:t,resultCount:n}},keysToOmitFromLogging:["data.key"]},i,c)},this.exchangeResolveContact=function(e,t,n){E({target:S.BgTarget.EXCHANGE_CONNECTOR,type:S.BgMsgType.REQUEST,data:{key:e,method:S.BgExchangeMsgType.RESOLVE_CONTACT,object:t},keysToOmitFromLogging:["data.key"]},n,c)},this.exchangeGetContact=function(e,t,n){E({target:S.BgTarget.EXCHANGE_CONNECTOR,type:S.BgMsgType.REQUEST,data:{key:e,method:S.BgExchangeMsgType.GET_CONTACT,object:{email:t}},keysToOmitFromLogging:["data.key"]},n,c)},this.exchangeOnRenewedToken=function(e,t,n,i){E({target:S.BgTarget.EXCHANGE_CONNECTOR,type:S.BgMsgType.RESPONSE,data:{key:e,method:S.BgExchangeMsgType.ON_RENEWED_TOKEN,object:{reqId:t,token:n}},keysToOmitFromLogging:["data.key","data.object.token"]},i,c)},this.exchangeStoreCredentials=function(e,t){E({target:S.BgTarget.EXCHANGE_CONNECTOR,type:S.BgMsgType.REQUEST,data:{method:S.BgExchangeMsgType.STORE_EXCH_CREDENTIALS,object:e},keysToOmitFromLogging:["data.object"]},t,c)},this.getAllPersonalContacts=function(e,t){E({target:S.BgTarget.EXCHANGE_CONNECTOR,type:S.BgMsgType.REQUEST,data:{key:e,method:S.BgExchangeMsgType.GET_ALL_PERSONAL_CONTACTS},keysToOmitFromLogging:["data.key"]},t,c)},this.getAppointments=function(e,t,n,i,r){E({target:S.BgTarget.EXCHANGE_CONNECTOR,type:S.BgMsgType.REQUEST,data:{key:e,method:S.BgExchangeMsgType.GET_APPOINTMENTS,startDate:t,endDate:n,resCount:i},keysToOmitFromLogging:["data.key"]},r,c)},this.syncAllPersonalContacts=function(e,t,n){E({target:S.BgTarget.EXCHANGE_CONNECTOR,type:S.BgMsgType.REQUEST,data:{key:e,method:S.BgExchangeMsgType.SYNC_ALL_PERSONAL_CONTACTS,syncState:t},keysToOmitFromLogging:["data.key","data.syncState"]},n,c)},this.getStoredCredentials=function(e,t){E({target:S.BgTarget.EXCHANGE_CONNECTOR,type:S.BgMsgType.REQUEST,data:{key:e,method:S.BgExchangeMsgType.GET_STORED_CREDENTIALS},keysToOmitFromLogging:["data.key"]},t,c)},this.getOooMsg=function(e,t,n,i){E({target:S.BgTarget.EXCHANGE_CONNECTOR,type:S.BgMsgType.REQUEST,data:{key:e,method:S.BgExchangeMsgType.GET_OOO_MSG,fromEmail:t,email:n},keysToOmitFromLogging:["data.key"]},i,c)},this.getHeadsetIntegrationAppStatus=function(e,t){"function"==typeof t&&(p.isElectron?window.setTimeout(function(){I.debug("[ExtensionConnHandler]: Return status INSTALLED for desktop app"),t(null,{status:S.HeadsetAppStatus.INSTALLED})},0):E({target:S.BgTarget.HEADSET_APP,type:S.BgMsgType.REQUEST,data:{type:S.BgHeadsetAppMsgType.GET_HEADSET_APP_STATUS,appId:e}},t))},this.launchHeadsetIntegrationApp=function(e,t,n){E({target:S.BgTarget.HEADSET_APP,type:S.BgMsgType.REQUEST,data:{type:S.BgHeadsetAppMsgType.LAUNCH_HEADSET_APP,appId:e,localizedStrings:t}},n,18e4)},this.restartHeadsetApp=function(e,t){E({target:S.BgTarget.HEADSET_APP,type:S.BgMsgType.REQUEST,data:{type:S.BgHeadsetAppMsgType.RESTART_HEADSET_APP,appId:e}},t)},this.setIPHandlingPolicy=function(e,t,n){E({target:S.BgTarget.PRIVACY_SETTINGS,type:S.BgMsgType.REQUEST,data:{type:S.BgPrivacySettingsMsgType.SET_IP_HANDLING_POLICY,policy:e,localizedStrings:t}},n,18e4)},this.getIPHandlingPolicy=function(e){E({target:S.BgTarget.PRIVACY_SETTINGS,type:S.BgMsgType.REQUEST,data:{type:S.BgPrivacySettingsMsgType.GET_IP_HANDLING_POLICY}},e)},this.bringToFront=function(e){E({target:S.BgTarget.INTERNAL,type:S.BgMsgType.REQUEST,data:{type:S.BgInternalMsgType.BRING_TO_FRONT}},e)},this.getFile=function(e,t,n){E({target:S.BgTarget.INTERNAL,type:S.BgMsgType.REQUEST,data:{type:S.BgInternalMsgType.GET_FILE,name:e,lang:t}},n)},f.getBrowserInfo().chrome&&document&&document.addEventListener(S.DOMEvent.FROM_EXTENSION,function(e){if(e&&e.detail)try{t(JSON.parse(e.detail))}catch(e){return void I.error("[ExtensionConnHandler]: Error parsing JSON object. ",e)}})}return f.inherit(v,e),v.prototype.name="ExtensionConnHandler",p.ExtensionConnHandler=v,p}(Circuit=function(e){"use strict";var W=Circuit.logger;return e.CstaParser=function(){function D(e){return{connectionId:e.cIr,localCallState:e.lCS.cCSe&&e.lCS.cCSe.lCSe}}function y(e){return{deviceOnCall:e.dOC.dIr||"",callIdentifier:e.cI,localConnectionState:e.lCI,servicesPermitted:B(e)}}function F(e){var t=null;return e&&e.extn&&e.extn.pDa&&e.extn.pDa.prvt&&(t=e.extn.pDa.prvt.zEpid),t}function n(t){t&&Object.keys(t).forEach(function(e){t[e]=""===t[e]||"true"===t[e]})}function B(e){if(!e)return{};var t={};return e.sP&&(t.rSP=e.sP,n(t.rSP.cCSs)),e.extn&&e.extn.pDa&&e.extn.pDa.prvt&&void 0!==e.extn.pDa.prvt.zxSP&&(t.eSP=e.extn.pDa.prvt.zxSP,n(t.eSP)),t}function b(e){return{forwardingType:e.fTe,forwardStatus:"true"===e.fS,forwardDN:e.fDNN}}function x(e){return{recordId:e.rID,callID:e.cID,recordType:e.rTp,createdTime:e.cTm,result:e.res,callDuration:e.cDr,callingDevice:e.clDv||"",calledDevice:e.cldDv||"",answeringDevice:e.aDv||""}}this.genCstaRequest=function(e){try{switch(e.request){case"AlternateCall":return{ACl:{hC:{cID:(h=e).heldCall.cID,dID:h.heldCall.dID},atC:{cID:h.activeCall.cID,dID:h.activeCall.dID}}};case"ConferenceCall":return{CoC:{hC:{cID:(N=e).heldCall.cID,dID:N.heldCall.dID},atC:{cID:N.activeCall.cID,dID:N.activeCall.dID}}};case"AnswerCall":return{AnC:{cTBAd:{cID:(m=e).callToBeAnswered.cID,dID:m.callToBeAnswered.dID}}};case"CallBackCallRelated":return{CB:{cC:{cID:(_=e).callBackConnection.cID,dID:_.callBackConnection.dID}}};case"CallBackNonCallRelated":return{CBNC:{orD:(A=e).orD,tD:A.tD}};case"CancelCallBack":return{CCB:{orD:(g=e).orD,tD:g.tD}};case"ClearConnection":return{CCn:{coTBC:{cID:(R=e).connectionToBeCleared.cID,dID:R.connectionToBeCleared.dID},rsn:R.reason}};case"ConsultationCall":return{CnC:{cnD:(v=e).consultedDevice,eCl:{cID:v.existingCall.cID,dID:v.existingCall.dID}}};case"DeflectCall":return s={cTBD:{cID:(a=e).callToBeDiverted.cID,dID:a.callToBeDiverted.dID},nD:a.newDestination},a.autoAnswer&&(s.extn={pDa:{prvt:{zdT:"Auto-Answer"}}}),{DCl:s};case"GenerateDigits":return{GD:{cTSD:{cID:(f=e).connectionToSendDigits.cID,dID:f.connectionToSendDigits.dID},cTS:f.charactersToSend}};case"GetDoNotDisturb":return{GDND:{dvc:e.device}};case"GetForwarding":return{GF:{dvc:e.device}};case"GetMessageWaitingIndicator":return{GMWI:{dvc:e.device}};case"HoldCall":return{HC:{cTBH:{cID:(I=e).callToBeHeld.cID,dID:I.callToBeHeld.dID}}};case"ReconnectCall":return{RC:{hC:{cID:(S=e).heldCall.cID,dID:S.heldCall.dID},atC:{cID:S.activeCall.cID,dID:S.activeCall.dID}}};case"RetrieveCall":return{RCl:{cTBRd:{cID:(p=e).callToBeRetrieved.cID,dID:p.callToBeRetrieved.dID}}};case"SetDoNotDisturb":return{SDND:{dvc:(T=e).device,dNDO:T.doNotDisturbOn}};case"SetForwarding":return r={SF:{dvc:(i=e).device,aF:i.activateForward,fDNN:i.forwardDN,fTe:i.forwardingType,riC:i.ringCount}},o={},void 0!==i.staticOndActive?o={zsOA:!0===i.staticOndActive?"true":"false",zsOD:i.staticOndDN||""}:void 0!==i.voicemailActive||void 0!==i.voicemailRingDuration?o={zvMA:!0===i.voicemailActive?"true":!1===i.voicemailActive?"false":void 0,zvMRD:i.voicemailRingDuration?i.voicemailRingDuration.toString():void 0}:(void 0!==i.mainRingDuration&&(o.zmRD=i.mainRingDuration.toString()||""),void 0!==i.clientRingDuration&&(o.zcRD=i.clientRingDuration.toString()||""),void 0!==i.cellRingDuration&&(o.zcpRD=i.cellRingDuration.toString()||""),void 0!==i.alternativeNumber&&(o.zcPN=i.alternativeNumber),void 0!==i.routeToCell&&(o.zrTCN=i.routeToCell?"true":"false")),0<Object.keys(o).length&&(r.SF.extn={pDa:{prvt:o}}),r;case"SingleStepTransferCall":return function(e){var t={atC:{cID:e.activeCall.cID,dID:e.activeCall.dID},tTo:e.transferredTo};if(e.autoAnswer||e.seamlessHandover){var n={};e.autoAnswer&&(n.ztTgt="Auto-Answer"),e.seamlessHandover&&(n.zseHo="true"),t.extn={pDa:{prvt:n}}}return{SSTC:t}}(e);case"SnapshotCall":return{SC:{sO:{cID:(E=e).snapshotObject.cID,dID:E.snapshotObject.dID}}};case"SnapshotDevice":return n={sO:(t=e).snapshotObject},t.osmo&&(n.extn={pDa:{prvt:{zxsm:t.osmo}}}),{SDe:n};case"TransferCall":return{TC:{hC:{cID:(C=e).heldCall.cID,dID:C.heldCall.dID},atC:{cID:C.activeCall.cID,dID:C.activeCall.dID}}};case"GenGetConfiguration":return{zGCD:{zcCA:"Internet",zdMO:"Chrome",zdOS:"WebRTC"}};case"SetMicrophoneMute":return{SMM:{dvc:(u=e).device,mMO:u.mute}};case"GetMicrophoneMute":return{GMM:{dvc:e.device}};case"MakeCall":return{MC:{caD:(d=e).callingDevice,cDN:d.calledDirectoryNumber,aOe:d.autoOriginate}};case"CallLogSnapShot":return{CLS:{sub:e.device}};case"AcceptCall":return{AC:{cTBA:{cID:(l=e).callToBeAccepted.cID,dID:l.callToBeAccepted.dID}}};case"GetAgentState":return{GAS:{dvc:e.device}};case"SetAgentState":return{SAS:{dvc:(c=e).device,rAS:c.state}};case"GroupPickupCall":return{GPC:{nD:e.newDestination}}}W.error("CSTA: Unsupported CSTA request: "+e.request)}catch(e){W.error(e)}var t,n,i,r,o,a,s,c,l,d,u,C,E,T,p,S,I,f,v,R,g,A,_,m,N,h;return null},this.parseEvent=function(e){try{if(!e)return W.error("[CstaParser]: Invalid event"),null;var t=JSON.parse(e);if(!t||t.parsererror)return W.error("[CstaParser]: Error parsing CSTA event: ",e),t&&t.parsererror.div&&W.error("[CstaParser]: "+t.parsererror.div),null;var n=Object.keys(t)[0];switch(n){case"CBE":return{category:"LogicalDeviceFeature",name:"CallBackEvent",originatingDevice:(V=t.CBE).orD.dIr,targetDevice:V.tD.dIr,callBackSetCanceled:V.cBSC};case"CIE":return H=t.CIE,(k={category:"CallAssociatedFeature",name:"CallInformationEvent",connection:H.cnncn,device:H.dvc.dIr||"",callingDevice:H.caD&&H.caD.dIr||"",servicesPermitted:{}}).servicesPermitted=B(H),k.epid=F(H),k;case"CoE":return w=t.CoE,G={category:"CallControl",name:"ConferencedEvent",primaryOldCall:w.pOC,secondaryOldCall:w.sOC,conferencingDevice:w.coD.dIr||"",addedParty:w.aPy.dIr||"",conferenceConnections:[],localConnectionInfo:w.lCI,cause:w.cs,servicesPermitted:{}},w.cnC.cLI.forEach(function(e){var t={connection:e.nCn,endpoint:e.endp&&(e.endp.dID||e.endp.endp)};G.conferenceConnections.push(t)}),G.servicesPermitted=B(w),G.epid=F(w),G;case"CCEt":return L=t.CCEt,(M={category:"CallControl",name:"ConnectionClearedEvent",droppedConnection:L.drC,releasingDevice:L.rD.dIr||"",localConnectionInfo:L.lCI,cause:L.cs,servicesPermitted:{}}).servicesPermitted=B(L),M.epid=F(L),M;case"DE":return P=t.DE,(U={category:"CallControl",name:"DeliveredEvent",connection:P.cnncn,alertingDevice:P.aDe.dIr||"",callingDevice:P.caD.dIr||"",calledDevice:P.cDe.dIr||"",localConnectionInfo:P.lCI,cause:P.cs}).servicesPermitted=B(P),U.epid=F(P),U;case"DGE":return{category:"CallAssociatedFeature",name:"DigitsGeneratedEvent",connection:(b=t.DGE).cnncn,digitGeneratedList:b.dGL};case"DEt":return D=t.DEt,(y={category:"CallControl",name:"DivertedEvent",connection:D.cnncn,divertingDevice:D.dvD.dIr||"",newDestination:D.nD.dIr||"",callingDevice:D.caD.dIr||"",lastRedirectionDevice:D.lRD&&D.lRD.nDd||"",localConnectionInfo:D.lCI,cause:D.cs}).servicesPermitted=B(D),y.epid=F(D),y;case"DNDE":return{category:"LogicalDeviceFeature",name:"DoNotDisturbEvent",device:(O=t.DNDE).dvc.dIr||"",doNotDisturbOn:"true"===O.dNDO};case"EEt":return N=t.EEt,(h={category:"CallControl",name:"EstablishedEvent",establishedConnection:N.eCn,answeringDevice:N.anD.dIr||"",callingDevice:N.caD.dIr||"",calledDevice:N.cDe.dIr||"",lastRedirectionDevice:N.lRD&&N.lRD.nDd||"",localConnectionInfo:N.lCI,cause:N.cs,servicesPermitted:{}}).servicesPermitted=B(N),h.epid=F(N),h;case"FE":return _=t.FE,(m={category:"CallControl",name:"FailedEvent",failedConnection:_.fC,failingDevice:_.fD.dIr||"",callingDevice:_.caD.dIr||"",localConnectionInfo:_.lCI,calledDevice:_.cDe.dIr,cause:_.cs,servicesPermitted:{}}).servicesPermitted=B(_),m.epid=F(_),m;case"FEt":return d=t.FEt,u={category:"LogicalDeviceFeature",name:"ForwardingEvent",device:d.dvc.dIr||"",forwardingType:d.fTe,forwardStatus:"true"===d.fS,forwardTo:d.fTo},d.extn&&d.extn.pDa&&d.extn.pDa.prvt&&(d.extn.pDa.prvt.zsOD&&(u.staticOndDN=d.extn.pDa.prvt.zsOD,u.staticOndActive="true"===d.extn.pDa.prvt.zsOA),d.extn.pDa.prvt.zvMA&&(u.voicemailActive="true"===d.extn.pDa.prvt.zvMA),d.extn.pDa.prvt.zoP&&(u.overrideProfile="true"===d.extn.pDa.prvt.zoP),d.extn.pDa.prvt.zvMRD&&(u.voicemailRingDuration=parseInt(d.extn.pDa.prvt.zvMRD,10)),d.extn.pDa.prvt.zmRD&&(u.mainRingDuration=parseInt(d.extn.pDa.prvt.zmRD,10)),d.extn.pDa.prvt.zcRD&&(u.clientRingDuration=parseInt(d.extn.pDa.prvt.zcRD,10)),d.extn.pDa.prvt.zcpRD&&(u.cellRingDuration=parseInt(d.extn.pDa.prvt.zcpRD,10)),d.extn.pDa.prvt.hasOwnProperty("zcPN")&&(u.alternativeNumber=d.extn.pDa.prvt.zcPN),d.extn.pDa.prvt.hasOwnProperty("zrTCN")&&(u.routeToCell="true"===d.extn.pDa.prvt.zrTCN)),u;case"HE":return g=t.HE,(A={category:"CallControl",name:"HeldEvent",heldConnection:g.hCn,holdingDevice:g.hD.dIr||"",localConnectionInfo:g.lCI,servicesPermitted:{}}).servicesPermitted=B(g),A.epid=F(g),A;case"MWE":return{category:"PhysicalDeviceFeature",name:"MessageWaitingEvent",device:(R=t.MWE).tD.dIr||"",messageWaitingOn:"true"===R.mWO};case"OE":return f=t.OE,(v={category:"CallControl",name:"OfferedEvent",offeredConnection:f.oCn,offeredDevice:f.oDe.dIr||"",callingDevice:f.caD.dIr||"",calledDevice:f.cDe.dIr||"",localConnectionInfo:f.lCI,lastRedirectionDevice:f.lRD&&f.lRD.nDd||"",cause:f.cs}).servicesPermitted=B(f),v.epid=F(f),v;case"QE":return S=t.QE,(I={category:"CallControl",name:"QueuedEvent",queuedConnection:S.qC,queue:S.q.dIr||"",callingDevice:S.caD.dIr||"",localConnectionInfo:S.lCI,cause:S.cs}).servicesPermitted=B(S),I.epid=F(S),I;case"ReE":return T=t.ReE,(p={category:"CallControl",name:"RetrievedEvent",retrievedConnection:T.rCn,retrievingDevice:T.reD.dIr||"",localConnectionInfo:T.lCI,servicesPermitted:{}}).servicesPermitted=B(T),p.epid=F(T),p;case"SCFE":return c=t.SCFE,l={category:"CallAssociatedFeature",name:"ServiceCompletionFailureEvent",primaryCall:{connectionID:c.prC.cIDD,localConnectionState:c.prC.lCSe},cause:c.cs},c.sC&&(l.secondaryCall={connectionID:c.sC.cIDD,localConnectionState:c.sC.lCSe}),l;case"SIE":return C=t.SIE,(E={category:"CallControl",name:"ServiceInitiatedEvent",initiatedConnection:C.iCn,initiatingDevice:C.iD.dIr||"",cause:C.cs}).servicesPermitted=B(C),E.epid=F(C),E;case"TE":return o=t.TE,a={category:"CallControl",name:"TransferredEvent",primaryOldCall:o.pOC,secondaryOldCall:o.sOC,transferringDevice:o.tDe.dIr||"",transferredToDevice:o.tTDe.dIr||"",transferredConnections:[],localConnectionInfo:o.lCI,cause:o.cs,servicesPermitted:{}},s=o.tCs.cLI,Array.isArray(s)||(s=[s]),a.transferredConnections=s.map(function(e){return{connection:e.nCn,endpoint:e.endp&&(e.endp.dID||e.endp.endp)}}),a.servicesPermitted=B(o),a.epid=F(o),a;case"CLE":return i=t.CLE,r={category:"LogicalDeviceFeature",name:"CallLogEvent",callLogList:[]},i.cLL&&i.cLL.cLE&&(i.cLL.cLE.rID?r.callLogList.push(x(i.cLL.cLE)):i.cLL.cLE.forEach(function(e){r.callLogList.push(x(e))})),r;case"BISE":return{category:"DeviceMaintenance",name:"BackInServiceEvent",backInService:!0,device:t.BISE.dvc};case"OOSE":return{category:"DeviceMaintenance",name:"OutOfServiceEvent",outOfService:!0,device:t.OOSE.dvc};case"ARE":return{category:"LogicalDeviceFeature",name:"AgentReadyEvent",agentReady:!0};case"ANRE":return{category:"LogicalDeviceFeature",name:"AgentNotReadyEvent",agentReady:!1};case"ABE":return{category:"LogicalDeviceFeature",name:"AgentBusyEvent",agentReady:!1}}W.info("[CstaParser]: Unsupported CSTA event: ",n)}catch(e){W.error("[CstaParser]: Error parsing CSTA event: ",e)}var i,r,o,a,s,c,l,d,u,C,E,T,p,S,I,f,v,R,g,A,_,m,N,h,O,D,y,b,P,U,L,M,w,G,H,k,V;return null},this.parseResponse=function(e,t){try{if(!e||!t)return W.error("[CstaParser]: Invalid response"),null;var n=JSON.parse(t);if(!n||n.parsererror)return W.error("[CstaParser]: Error parsing CSTA response: ",t),n&&n.parsererror.div&&W.error("[CstaParser]: "+n.parsererror.div),null;if(n.CSTA&&(n.CSTAErrorCode=n.CSTA),n.CSTAErrorCode)return W.debug("[CstaParser]: Received error response for: ",e),function(e){if(!e.CSTAErrorCode)return W.error("[CstaParser]: The given response is not an error code: ",e),null;var t=null,n=Object.keys(e.CSTAErrorCode)[0];switch(n){case"oprt":case"operation":t="Operation Error";break;case"scrt":case"security":t="Security Error";break;case"sIy":case"stateIncompatibility":t="State Incompatibility Error";break;case"sRAy":case"systemResourceAvailability":t="System Resource Availability Error";break;case"sRA":case"subscribedResourceAvailability":t="Subscribed Resource Availability Error";break;case"pM":case"performanceManagement":t="Performance Management Error";break;case"pDa":case"privateDataInformation":t="Private Data Information Error"}return t?{error:!0,errorCategory:t,errorValue:e.CSTAErrorCode[n]}:(W.error("[CstaParser]: Unrecognized Error Category"),{error:!0,category:"Unknown",value:"Unknown"})}(n);if(n.ISEC)return W.debug("[CstaParser]: Received internal service error response for: ",e),function(e){if(!e.ISEC)return W.error("[CstaParser]: The given response is not an internal service error code: ",e),null;var t=null,n=Object.keys(e.ISEC)[0];switch(n){case"code":t="Code"}return t?{error:!0,errorCategory:t,errorValue:e.ISEC[n]}:(W.error("[CstaParser]: Unrecognized Internal Service Error Category"),{error:!0,category:"Unknown",value:"Unknown"})}(n);switch(e){case"AlternateCall":return O=n,W.debug("[CstaParser]: Received CSTA Alternate Call response: ",O),O.ACRe;case"ConferenceCall":return h=n,W.debug("[CstaParser]: Received CSTA Conference Call response: ",h),{conferenceCall:h.CoCR.coC};case"AnswerCall":return N=n,W.debug("[CstaParser]: Received CSTA Answer Call response: ",N),N.AnCR;case"CallBackCallRelated":return m=n,W.debug("[CstaParser]: Received CSTA Call Back call related response: ",m),m.CBR;case"CallBackNonCallRelated":return _=n,W.debug("[CstaParser]: Received CSTA Call Back non call related response: ",_),_.CBNCe;case"CancelCallBack":return A=n,W.debug("[CstaParser]: Received CSTA Cancel Call Back response: ",A),A.CCBR;case"ClearConnection":return g=n,W.debug("[CstaParser]: Received CSTA Clear Connection response: ",g),g.ClCR;case"ConsultationCall":return R=n,W.debug("[CstaParser]: Received CSTA Consultation Call response: ",R),R.CnCR;case"DeflectCall":return v=n,W.debug("[CstaParser]: Received CSTA Deflect Call response: ",v),v.DCRe;case"GenerateDigits":return f=n,W.debug("[CstaParser]: Received CSTA Generate Digits response: ",f),f.GDR;case"GetDoNotDisturb":return I=n,W.debug("[CstaParser]: Received CSTA Get Do Not Disturb response: ",I),{doNotDisturbOn:"true"===I.GDNDe.dNDO};case"GetForwarding":return function(e){if(W.debug("[CstaParser]: Received CSTA Get Forwarding response: ",e),e.GetForwardingResponse)return t=e.GetForwardingResponse,n={forwardList:[]},t.forwardingList.forwardListItem.forwardStatus?(t.forwardingList.forwardListItem.forwardStatus="true"===t.forwardingList.forwardListItem.forwardStatus,n.forwardList.push(t.forwardingList.forwardListItem)):t.forwardingList.forwardListItem.forEach(function(e){e.forwardStatus="true"===e.forwardStatus,n.forwardList.push(e)}),t.extensions&&t.extensions.privateData&&t.extensions.privateData.private&&(n.staticOndDN=t.extensions.privateData.private.staticOndDN,n.staticOndActive="true"===t.extensions.privateData.private.staticOndActive),n;var t,n,i=e.GFR,r={forwardList:[]};return i.fL.fLI.fS?r.forwardList.push(b(i.fL.fLI)):i.fL.fLI.forEach(function(e){r.forwardList.push(b(e))}),i.extn&&i.extn.pDa&&i.extn.pDa.prvt&&(r.staticOndDN=i.extn.pDa.prvt.zsOD,r.staticOndActive="true"===i.extn.pDa.prvt.zsOA,r.voicemailActive="true"===i.extn.pDa.prvt.zvMA,i.extn.pDa.prvt.zoP&&(r.overrideProfile="true"===i.extn.pDa.prvt.zoP),i.extn.pDa.prvt.zvMRD&&(r.voicemailRingDuration=parseInt(i.extn.pDa.prvt.zvMRD,10)),i.extn.pDa.prvt.zmRD&&(r.mainRingDuration=parseInt(i.extn.pDa.prvt.zmRD,10)),i.extn.pDa.prvt.zcRD&&(r.clientRingDuration=parseInt(i.extn.pDa.prvt.zcRD,10)),i.extn.pDa.prvt.zcpRD&&(r.cellRingDuration=parseInt(i.extn.pDa.prvt.zcpRD,10)),i.extn.pDa.prvt.hasOwnProperty("zcPN")&&(r.alternativeNumber=i.extn.pDa.prvt.zcPN),i.extn.pDa.prvt.hasOwnProperty("zrTCN")&&(r.routeToCell="true"===i.extn.pDa.prvt.zrTCN)),r}(n);case"GetMessageWaitingIndicator":return S=n,W.debug("[CstaParser]: Received CSTA Get Message Waiting response: ",S),{messageWaitingOn:"true"===S.GMWIe.mWO};case"HoldCall":return p=n,W.debug("[CstaParser]: Received CSTA Hold Call response: ",p),p.HCR;case"ReconnectCall":return T=n,W.debug("[CstaParser]: Received CSTA Reconnect Call response: ",T),T.RCR;case"RetrieveCall":return E=n,W.debug("[CstaParser]: Received CSTA Retrieve Call response: ",E),E.RCRe;case"SetDoNotDisturb":return C=n,W.debug("[CstaParser]: Received CSTA Set Do Not Disturb response: ",C),C.SDNDe;case"SetForwarding":return u=n,W.debug("[CstaParser]: Received CSTA Set Forwarding response: ",u),u.hasOwnProperty("SFR")?u.SFR:u.SetForwardingResponse;case"SingleStepTransferCall":return function(e){W.debug("[CstaParser]: Received CSTA SST Call response: ",e);var t=e.SSTCe,n={transferredCall:t.trC};return t.extn&&t.extn.pDa&&t.extn.pDa.prvt&&(n.seamlessHandover="true"===t.extn.pDa.prvt.zseHo),n}(n);case"SnapshotCall":return function(e){W.debug("[CstaParser]: Received CSTA Snapshot Call response: ",e);var t=e.SCR,n={endpoints:[],callingDevice:t.caD&&t.caD.dIR||"",calledDevice:t.cDe&&t.cDe.dIR||"",servicesPermitted:{}};return t.cRID.sDa.sCRIo&&(t.cRID.sDa.sCRIo.dOC?n.endpoints.push(y(t.cRID.sDa.sCRIo)):t.cRID.sDa.sCRIo.forEach(function(e){n.endpoints.push(y(e))})),n.servicesPermitted=B(t),n.epid=F(t),n}(n);case"SnapshotDevice":return function(e){W.debug("[CstaParser]: Received CSTA Snapshot Device response: ",e);var t=e.SnDR,n={activeCalls:[]};return t.cRID.sDa.sDRI&&(t.cRID.sDa.sDRI.cIr?n.activeCalls.push(D(t.cRID.sDa.sDRI)):t.cRID.sDa.sDRI.forEach(function(e){n.activeCalls.push(D(e))})),n}(n);case"TransferCall":return d=n,W.debug("[CstaParser]: Received CSTA TransferCall response: ",d),{transferredCall:d.TCR.trC};case"SetMicrophoneMute":return l=n,W.debug("[CstaParser]: Received CSTA SetMicrophoneMute response",l),{mute:"true"===l.SMMR.mML.mMI.mMO};case"GetMicrophoneMute":return c=n,W.debug("[CstaParser]: Received CSTA GetMicrophoneMute response",c),{mute:"true"===c.GMMR.mML.mMI.mMO};case"MakeCall":return s=n,W.debug("[CstaParser]: Received CSTA MakeCall response",s),s.MCR;case"CallLogSnapShot":return a=n,W.debug("[CstaParser]: Received CSTA Call Log Snap Shot response: ",a),a.CLSR;case"AcceptCall":return o=n,W.debug("[CstaParser]: Received CSTA Accept Call response: ",o),o.ACR;case"GetAgentState":return function(e){W.debug("[CstaParser]: Received CSTA GetAgentState response",e);var t=e.GASR;return{loggedOnState:t.aSL&&t.aSL.aSE&&"true"===t.aSL.aSE.lOS,agentState:t.aSL&&t.aSL.aSE&&t.aSL.aSE.aIo&&"agentReady"===t.aSL.aSE.aIo.aII.aS?"ready":"notReady"}}(n);case"SetAgentState":return r=n,W.debug("[CstaParser]: Received CSTA SetAgentState response",r),r.SASR;case"GroupPickupCall":return i=n,W.debug("[CstaParser]: Received CSTA GroupPickupCall response",i),i.GPCRe}W.error("CSTA: Unsupported CSTA response for request: ",e)}catch(e){W.error(e)}var i,r,o,a,s,c,l,d,u,C,E,T,p,S,I,f,v,R,g,A,_,m,N,h,O;return null}},e}(Circuit=function(e){"use strict";var t;return e.UserToUserHandlerSingleton={getInstance:function(){return t||(t=new e.UserToUserHandler),t}},e}(Circuit=function(e){"use strict";var i=e.ClientApiHandlerSingleton,l=e.Constants,d=e.logger,u=e.Utils,t=Object.freeze({CSTA:"CSTA",PRIMARYCLIENT:"PRIMARYCLIENT",INFO:"INFO",SETTINGS:"SETTINGS",ADVANCING:"ADVANCING"}),n=Object.freeze({GET_GTC_VERSION_REQUEST:"GET_GTC_VERSION_REQUEST",GET_GTC_VERSION_RESPONSE:"GET_GTC_VERSION_RESPONSE",SET_ROUTE_TO_DESK:"SET_ROUTE_TO_DESK",ENABLE_PBX_CALL_LOG:"ENABLE_PBX_CALL_LOG"}),r=Object.freeze({CLICK_TO_CALL_REQUEST:"CLICK_TO_CALL_REQUEST",CLICK_TO_CALL_RESPONSE:"CLICK_TO_CALL_RESPONSE",MUTE_DEVICE_REQUEST:"MUTE_DEVICE_REQUEST",MUTE_DEVICE_RESPONSE:"MUTE_DEVICE_RESPONSE",JOIN_CONFERENCE_REQUEST:"JOIN_CONFERENCE_REQUEST",JOIN_CONFERENCE_RESPONSE:"JOIN_CONFERENCE_RESPONSE",CLICK_TO_ANSWER_REQUEST:"CLICK_TO_ANSWER_REQUEST",CLICK_TO_ANSWER_RESPONSE:"CLICK_TO_ANSWER_RESPONSE"}),o=Object.freeze({OK:"OK",BUSY:"BUSY",TELEPHONY_NOT_AVAILABLE:"TELEPHONY_NOT_AVAILABLE",USER_NOT_FOUND:"USER_NOT_FOUND",CONVERSATION_NOT_FOUND:"CONVERSATION_NOT_FOUND",CALL_DECLINED:"CALL_DECLINED",CALL_FAILED:"CALL_FAILED",CALL_NOT_FOUND:"CALL_NOT_FOUND",MUTE_DEVICE_FAILED:"MUTE_DEVICE_FAILED",JOIN_CONFERENCE_FAILED:"JOIN_CONFERENCE_FAILED"}),a=Object.freeze({INVITE_REQUEST:"INVITE_REQUEST",INVITE_RESPONSE:"INVITE_RESPONSE",MUTE_REQUEST:"MUTE_REQUEST",MUTE_RESPONSE:"MUTE_RESPONSE",UNMUTE_REQUEST:"UNMUTE_REQUEST",UNMUTE_RESPONSE:"UNMUTE_RESPONSE",GET_MEETINGPOINT_INVITER_REQUEST:"GET_MEETINGPOINT_INVITER_REQUEST",GET_MEETINGPOINT_INVITER_RESPONSE:"GET_MEETINGPOINT_INVITER_RESPONSE",TOGGLE_VIDEO_REQUEST:"TOGGLE_VIDEO_REQUEST",TOGGLE_VIDEO_RESPONSE:"TOGGLE_VIDEO_RESPONSE",START_HD_VIDEO_REQUEST:"START_HD_VIDEO_REQUEST",START_HD_VIDEO_RESPONSE:"START_HD_VIDEO_RESPONSE"}),s=Object.freeze({OK:"OK",FAILED:"FAILED",MISSING_REQUIRED_PARAMETER:"MISSING_REQUIRED_PARAMETER",NOT_FOUND:"NOT_FOUND",NOT_CMP_USER:"NOT_CMP_USER",NOT_SUPPORTED:"NOT_SUPPORTED",INVITE_FAILED:"INVITE_FAILED",MUTE_FAILED:"MUTE_FAILED",UNMUTE_FAILED:"UNMUTE_FAILED",INVALID_PIN:"INVALID_PIN",MEETINGPOINT_BUSY:"MEETINGPOINT_BUSY",TOGGLE_VIDEO_FAILED:"START_VIDEO_FAILED"}),c=Object.freeze({DIAL:"DIAL"});function C(e){var r=2e4,a={},s={},c=e||i.getInstance();function o(e){e&&window.setTimeout(function(){e(l.ReturnCode.INVALID_MESSAGE)},0)}function n(t,n,i){return n&&n.content&&n.content.type?(d.debug("[UserToUserHandler]: Sending request "+t+"."+n.content.type),n.content.requestId=n.content.requestId||u.createTransactionId(),a[n.content.requestId]?(d.error("[UserToUserHandler]: UserToUser request has duplicate requestId"),void o(i)):void c.sendUserToUserRequest(t,n,function(e){if(e)return d.error("[UserToUserHandler]: Failed to send request: ",e),void(i&&i(e));t===l.UserRoutingMessageType.SDK?i&&i():function(e,t){if(t){var n=window.setTimeout(function(e){d.error("[UserToUserHandler]: Timeout waiting for response. RequestId:",e),a[e]&&(delete a[e],t(l.ReturnCode.REQUEST_TIMEOUT),d.debug("[UserToUserHandler]: Remaining callbacks pending:",Object.keys(a).length))},r,e);a[e]={cb:t,timer:n}}}(n.content.requestId,i)})):(d.error("[UserToUserHandler]: Invalid UserToUser request data - ",n),void o(i))}function t(e,t){try{if(t.routing&&t.routing.srcClientId===c.clientId)return void d.info("[UserToUserHandler]: Ignore own UserToUser event");var n;try{n=JSON.parse(t.data)}catch(e){return void d.error("[UserToUserHandler]: Event discarded (Cannot Parse)")}if(n.requestId){var i=a[n.requestId];if(i)return i.timer&&window.clearTimeout(i.timer),delete a[n.requestId],i.cb&&i.cb(null,n),void d.debug("[UserToUserHandler]: Remaining callbacks pending:",Object.keys(a).length)}var r=e+"."+n.type,o=s[r];o&&0!==o.length?(e===l.UserRoutingMessageType.SDK&&(n=n.message),o.forEach(function(e){e.cb(n,t.routing)})):d.info("[UserToUserHandler]: There is no registered event handler for ",r)}catch(e){d.error("[UserToUserHandler]: Exception handling UserToUser event. ",e)}}c.on("UserToUser.ATC",function(e){d.debug("[UserToUserHandler]: Received UserToUser.ATC event: ",e.data),t(l.UserRoutingMessageType.ATC,e)}),c.on("UserToUser.DESKTOP_APP",function(e){d.debug("[UserToUserHandler]: Received UserToUser.DESKTOP_APP event: ",e.data),t(l.UserRoutingMessageType.DESKTOP_APP,e)}),c.on("UserToUser.CONTACT_CARD",function(e){d.debug("[UserToUserHandler]: Received UserToUser.CONTACT_CARD event: ",e.data),t(l.UserRoutingMessageType.CONTACT_CARD,e)}),c.on("UserToUser.CMP",function(e){d.debug("[UserToUserHandler]: Received UserToUser.CMP event: ",e.data),t(l.UserRoutingMessageType.CMP,e)}),c.on("UserToUser.MOBILE_BREAKOUT",function(e){d.debug("[UserToUserHandler]: Received UserToUser.MOBILE_BREAKOUT event: ",e.data),t(l.UserRoutingMessageType.MOBILE_BREAKOUT,e)}),c.on("UserToUser.SDK",function(e){d.debug("[UserToUserHandler]: Received UserToUser.SDK event: ",e.data),t(l.UserRoutingMessageType.SDK,e)}),this.cancelReqCallback=function(e){var t=a[e];t&&(t.cb=null)},this.sendAtcRequest=function(e,t){n(l.UserRoutingMessageType.ATC,e,t)},this.sendContactCardRequest=function(e,t){n(l.UserRoutingMessageType.CONTACT_CARD,e,t)},this.sendDesktopAppRequest=function(e,t){n(l.UserRoutingMessageType.DESKTOP_APP,e,t)},this.sendMeetingPointRequest=function(e,t){n(l.UserRoutingMessageType.CMP,e,t)},this.sendMobileBreakoutEvent=function(e,t){n(l.UserRoutingMessageType.MOBILE_BREAKOUT,e,t)},this.sendSdkRequest=function(e,t){e&&e.content&&delete e.content.requestId,n(l.UserRoutingMessageType.SDK,e,t)},this.on=function(e,t){e&&"function"==typeof t&&(s[e]=s[e]||[],s[e].some(function(e){return e.cb===t})||s[e].push({cb:t}))},this.off=function(e,n){if(e||n)if(n){if(e&&"function"==typeof n){var i=s[e];i&&i.some(function(e,t){if(e.cb===n)return i.splice(t,1),!0})}}else delete s[e];else s={}}}return(C.prototype.constructor=C).prototype.name="UserToUserHandler",e.UserToUserHandler=C,e.Enums=e.Enums||{},e.Enums.AtcInfoMessage=n,e.Enums.AtcMessage=t,e.Enums.ContactCardMessage=r,e.Enums.ContactCardResponseCode=o,e.Enums.MeetingPointMessage=a,e.Enums.MeetingPointResponseCode=s,e.Enums.MobileBreakoutMessage=c,e}(Circuit=function(e){"use strict";var t;return e.ClientApiHandlerSingleton={getInstance:function(){return t||(t=new e.ClientApiHandler),t}},e}(Circuit=function(_){"use strict";var m=_.ConnectionHandler,N=_.Constants,h=_.PrivateData,O=_.Proto,D=_.Utils;function e(e){var a,o,s,r,c=_.logger,l=2090075,d=function(){},n=this,u=new m(e),C=!1,E=0;function T(e,t,n,i,r,o){var a=O.Request(e,t,o);return C?r=null:i&&(a.keysToOmitFromLogging=i),u.sendMessage(a,function(e,t){try{n(e,t)}catch(e){c.error("[ClientApiHandler]: Exception: ",e)}},r),a.request.requestId}function p(e,t){Circuit.Error&&(a=new Circuit.Error(e),t&&(a.errObj=t,a.message=t.info))}function S(e,t,n,i){if(a=null,e)return p(e),n(e),!1;if(t.code===N.ReturnCode.NO_RESULT)return i?n(null,[]):(p(N.ReturnCode.NO_RESULT),n(N.ReturnCode.NO_RESULT)),!1;var r,o=t.code;switch(t.code){case N.ReturnCode.OK:case N.ReturnCode.ENTITY_ALREADY_EXISTS:return!0;case N.ReturnCode.CLOUD_TELEPHONY_EXCEPTION:case N.ReturnCode.SERVICE_EXCEPTION:t.errorInfo&&t.errorInfo.errorCode&&((o=t.errorInfo.errorCode)===N.ErrorCode.THIRDPARTY_ERROR&&t.errorInfo.thirdpartyError&&(o=t.errorInfo.thirdpartyError.type),r=t.errorInfo)}return p(o=o||N.ReturnCode.UNEXPECTED_RESPONSE,r),n(o),!1}function I(e,t,n){t&&p(t),e&&e!==d&&window.setTimeout(function(){e(t,n)},0)}function i(e){var t=[];return e?(e.audio&&t.push(N.RealtimeMediaType.AUDIO),e.video&&t.push(N.RealtimeMediaType.VIDEO),e.desktop&&t.push(N.RealtimeMediaType.DESKTOP_SHARING)):t.push(N.RealtimeMediaType.AUDIO),t}function t(e){return e&&{fileId:e.fileId,fileName:e.fileName,mimeType:e.mimeType,size:e.size,itemId:e.itemId}}function f(e){return e&&e.map(t)}function v(e){return e&&{attachment:t(e.attachment),type:e.type,downloadLocation:e.downloadLocation,previewLocation:e.previewLocation,shareLinkToken:e.shareLinkToken}}function R(e){return e&&e.map(v)}function g(e){return{convId:e.convId,rtcSessionId:e.rtcSessionId,ownerId:e.ownerId,sdp:e.sdp,mediaType:i(e.mediaType),callOut:!!e.callOut,handover:!!e.handover,sendInviteCancel:!!e.sendInviteCancel,peerUserId:e.peerUserId||void 0,replaces:e.replaces,from:e.fromDn||e.fromName?{phoneNumber:e.fromDn,displayName:e.fromName,resolvedUserId:e.fromUserId}:void 0,to:e.dialedDn?{phoneNumber:e.dialedDn,displayName:e.toName,resolvedUserId:e.toUserId}:void 0,isTelephonyConversation:!!e.isTelephonyConversation,displayName:e.displayName,transactionId:e.transactionId,screenSharePointerSupported:e.screenSharePointerSupported,asyncSupported:!0,noCallLog:e.noCallLog||void 0,guestToken:e.guestToken||void 0}}function A(e,t){return!!n.isScreenTakeOverSupported()||(c.warn("[ClientApiHandler]: The "+e+" operation is not supported by the backend"),I(t,N.ReturnCode.OPERATION_NOT_SUPPORTED),!1)}Object.defineProperties(this,{clientId:{enumerable:!0,get:function(){return o},set:function(e){"simulatedDirect"===e&&(o=e)}},clientApiVersion:{enumerable:!0,get:function(){return E}}}),this.getLastError=function(){return a},this.connect=function(e,t,n){n&&u.setTarget(n),u.connect(e,t)},this.getConnState=u.getState.bind(u),this.disconnect=u.disconnect.bind(u),this.reconnect=u.reconnect.bind(u),this.pingServer=u.pingServer.bind(u),this.setPingInterval=u.setPingInterval.bind(u),this.setTarget=u.setTarget.bind(u),this.setClientInfo=u.setClientInfo.bind(u),this.setToken=u.setToken.bind(u),this.setRelativeUrl=u.setRelativeUrl.bind(u),this.addEventListener=u.addEventListener.bind(u),this.removeEventListener=u.removeEventListener.bind(u),this.onMessage=u.onMessage.bind(u),this.setDevelopmentMode=function(e){C=!!e,u.ommitKeysFromLog=!e},this.on=function(e,t){var n;switch(e){case"Account.TELEPHONY_CONFIGURATION_UPDATED":n=["event.account.telephonyConfigurationUpdated.configuration.onsSipAuthenticationHash","event.account.telephonyConfigurationUpdated.configuration.ondSipAuthenticationHash"];break;case"Conversation.ADD_ITEM":n=["event.conversation.addItem.item.text","event.conversation.addItem.item.system.renamedConversation"];break;case"Conversation.UPDATE_ITEM":n=["event.conversation.updateItem.item.text"];break;case"Conversation.CREATE":n=["event.conversation.create.conversation.topic","event.conversation.create.conversation.description"];break;case"Conversation.UPDATE":n=["event.conversation.update.conversation","event.conversation.update.topic","event.conversation.update.description"];break;case"RTCSession.QUESTION_EVENT":n=["event.rtcSession.questionEvent.question.questionText"];break;case"Search.BASIC_SEARCH_RESULT":n=["event.search.basicSearchResult.searchResults"];break;case"System.BROADCAST":n=["event.system.systemNotificationEvent.broadcastText"];break;case"User.USER_PRESENCE_CHANGE":n="*";break;case"ThirdParty.CONNECTED_TO_THIRDPARTY":n=["event.thirdParty.oAuthData"]}u.on(e,t,n)},this.isEnhancedNotificationSupported=function(){return 2090069<E},this.isClientCapabilitiesSupported=function(){return 2090069<E},this.isHuntGroupsSupported=function(){return l<E},this.isSystemNotificationsSupported=function(){return l<E},this.isSubscribeTenantPresenceSupported=function(){return l<=E},this.isModerationTakeOverSupported=function(){return l<E},this.isScreenTakeOverSupported=function(){return 2090076<E},this.isCallConnectedInfoSupported=function(){return 2090076<E},this.logout=function(n){n=n||d,c.debug("[ClientApiHandler]: logout...");var e={type:N.UserActionType.LOGOUT,logoff:{invalidate:!0}};T(N.ContentType.USER,e,function(e,t){S(e,t,n)&&n(null)})},this.getUser=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getUser...");var t={type:N.UserActionType.GET_USER_BY_ID,getById:{userId:e}};T(N.ContentType.USER,t,function(e,t){S(e,t,n)&&n(null,t.user.getById.user)})},this.updateUser=function(e,n){n=n||d,c.debug("[ClientApiHandler]: updateUser...");var t={type:N.UserActionType.UPDATE,update:e};T(N.ContentType.USER,t,function(e,t){S(e,t,n)&&n(null,t.user.updateResult.user)})},this.getLoggedOnUser=function(r){r=r||d,c.debug("[ClientApiHandler]: getLoggedOnUser...");var e={type:N.UserActionType.GET_LOGGED_ON};T(N.ContentType.USER,e,function(e,t){var n,i;S(e,t,r)&&(n=(i=t.user.getLoggedOn).user,i.userPresenceState=i.userPresenceState||n.userPresenceState,n.userPresenceState=i.userPresenceState,n.accounts=i.accounts||[],E=D.convertVersionToNumber(n.apiVersion),o=n.clientId,s=n.userId,r(null,i))},null,["response.user.getLoggedOn.user.userPresenceState.longitude","response.user.getLoggedOn.user.userPresenceState.latitude","response.user.getLoggedOn.user.userPresenceState.locationText","response.user.getLoggedOn.user.userPresenceState.statusMessage","response.user.getLoggedOn.userPresenceState.longitude","response.user.getLoggedOn.userPresenceState.latitude","response.user.getLoggedOn.userPresenceState.locationText","response.user.getLoggedOn.userPresenceState.statusMessage"])},this.getStuff=function(e,t){!function(i){i=i||d,c.debug("[ClientApiHandler]: getApiVersion...");var e={type:N.VersionActionType.GET_VERSION};T(N.ContentType.VERSION,e,function(e,t){if(e||t.code!==N.ReturnCode.OK)E=0;else{var n=t.version.getVersion.version;c.info("[ClientApiHandler]: Setting client API version to ",n),E=D.convertVersionToNumber(n)}i()})}(function(i,r){r=r||d,c.debug("[ClientApiHandler]: getStuff..."),i&&i.length||(i=[N.GetStuffType.USER,N.GetStuffType.ACCOUNTS,N.GetStuffType.FIRST_WEB_LOGIN,N.GetStuffType.PRESENCE_STATE,N.GetStuffType.RECENT_SEARCHES,N.GetStuffType.SETTINGS,N.GetStuffType.SUPPORT_CONVERSATION_ID,N.GetStuffType.TELEPHONY_CONVERSATION_ID,N.GetStuffType.GLOBAL_PROPERTIES,N.GetStuffType.TENANT,N.GetStuffType.NOTIFICATION_SUBSCRIPTIONS,N.GetStuffType.PENDING_SYSTEM_NOTIFICATIONS]);var e={type:N.UserActionType.GET_STUFF,getStuff:{types:i}};T(N.ContentType.USER,e,function(e,t){if(S(e,t,r)){var n=t.user.getStuff;i.includes(N.GetStuffType.USER)&&(n.user.userPresenceState=n.userPresenceState,n.user.accounts=n.accounts||[],E=D.convertVersionToNumber(n.user.apiVersion),o=n.user.clientId,s=n.user.userId),r(null,n)}},null,["response.user.getStuff.accounts.[].telephonyConfiguration.onsSipAuthenticationHash","response.user.getStuff.accounts.[].telephonyConfiguration.ondSipAuthenticationHash","response.user.getStuff.pendingSystemNotifications.[].systemNotificationEvent.broadcastText","response.user.getStuff.recentSearches","response.user.getStuff.userPresenceState.longitude","response.user.getStuff.userPresenceState.latitude","response.user.getStuff.userPresenceState.locationText","response.user.getStuff.userPresenceState.statusMessage"])}.bind(this,e,t))},this.setPresence=function(e,n){n=n||d,c.debug("[ClientApiHandler]: setPresence...");var t={type:N.UserActionType.SET_PRESENCE,presence:{state:e.state,inTransit:e.inTransit,longitude:e.longitude,latitude:e.latitude,locationText:e.locationText,isAccurate:e.isAccurate,timeZoneOffset:e.timeZoneOffset,mobile:e.mobile,dndUntil:e.dndUntil,statusMessage:e.statusMessage||""}};T(N.ContentType.USER,t,function(e,t){S(e,t,n)&&n(null,t.user.setPresence.state)},["request.user.presence.longitude","request.user.presence.latitude","request.user.presence.locationText","request.user.presence.statusMessage"],["response.user.setPresence.state.longitude","response.user.setPresence.state.latitude","response.user.setPresence.state.locationText","response.user.setPresence.state.statusMessage"])},this.getPresence=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: getPresence...");var i={type:N.UserActionType.GET_PRESENCE,getPresence:{userIds:e,full:!!t}};T(N.ContentType.USER,i,function(e,t){S(e,t,n)&&n(null,t.user.getPresence.states)},null,["response.user.getPresence.states.[].longitude","response.user.getPresence.states.[].latitude","response.user.getPresence.states.[].locationText","response.user.getPresence.states.[].statusMessage"])},this.subscribePresence=function(e,i){i=i||d,c.debug("[ClientApiHandler]: subscribePresence...");var t={type:N.UserActionType.SUBSCRIBE_PRESENCE,subscribePresence:{userIds:e}};T(N.ContentType.USER,t,function(e,t){if(S(e,t,i)){var n=t.user&&t.user.subscribePresence&&t.user.subscribePresence.states;i(null,n)}},null,["response.user.subscribePresence.states.[].longitude","response.user.subscribePresence.states.[].latitude","response.user.subscribePresence.states.[].locationText","response.user.subscribePresence.states.[].statusMessage"])},this.unsubscribePresence=function(e,n){n=n||d,c.debug("[ClientApiHandler]: unsubscribePresence...");var t={type:N.UserActionType.UNSUBSCRIBE_PRESENCE,unsubscribePresence:{userIds:e}};T(N.ContentType.USER,t,function(e,t){S(e,t,n)&&n(null)})},this.subscribeTenantPresence=function(e,n){if(n=n||d,c.debug("[ClientApiHandler]: subscribeTenantPresence..."),!this.isSubscribeTenantPresenceSupported())return c.warn("[ClientApiHandler]: The subscribeTenantPresence operation is not supported by the backend"),void I(n,N.ReturnCode.OPERATION_NOT_SUPPORTED);var t={type:N.UserActionType.SUBSCRIBE_TENANT_PRESENCE,subscribeTenantPresence:{tenantId:e}};T(N.ContentType.USER,t,function(e,t){S(e,t,n)&&n(null)})},this.unsubscribeTenantPresence=function(e,n){if(n=n||d,c.debug("[ClientApiHandler]: unsubscribeTenantPresence..."),!this.isSubscribeTenantPresenceSupported())return c.warn("[ClientApiHandler]: The unsubscribeTenantPresence operation is not supported by the backend"),void I(n,N.ReturnCode.OPERATION_NOT_SUPPORTED);var t={type:N.UserActionType.UNSUBSCRIBE_TENANT_PRESENCE,unsubscribeTenantPresence:{tenantId:e}};T(N.ContentType.USER,t,function(e,t){S(e,t,n)&&n(null)})},this.updateStatusSubscription=function(e,t,n){var i;n=n||d,c.debug("[ClientApiHandler]: updateStatusSubscription - subscribe = ",t),i=t?{type:N.UserActionType.SUBSCRIBE_PRESENCE,subscribePresence:{userIds:e,notificationSubscriptionType:N.NotificationSubscriptionType.ONLINE_STATUS}}:{type:N.UserActionType.UNSUBSCRIBE_PRESENCE,unsubscribePresence:{userIds:e,notificationSubscriptionType:N.NotificationSubscriptionType.ONLINE_STATUS}},T(N.ContentType.USER,i,function(e,t){S(e,t,n)&&n(null)})},this.changePassword=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: changePassword...");var i={type:N.UserActionType.CHANGE_PASSWORD,changePassword:{oldPassword:e,newPassword:t}};T(N.ContentType.USER,i,function(e,t){S(e,t,n)&&n(null,t.user.changePasswordResult.changeResult)},["request.user.changePassword.oldPassword","request.user.changePassword.newPassword"])},this.setPassword=function(e,n){n=n||d,c.debug("[ClientApiHandler]: setPassword...");var t={type:N.UserActionType.SET_PASSWORD,setPassword:{password:e}};T(N.ContentType.USER,t,function(e,t){S(e,t,n)&&n(null,t.user.setPasswordResult.resultSetPassword)},["request.user.setPassword.password"])},this.getLdapTechnicalUserPresence=function(n){n=n||d,c.debug("[ClientApiHandler]: getLdapTechnicalUserPresence...");var e={type:N.UserActionType.GET_LDAP_TECHNICAL_USER_PRESENCE};T(N.ContentType.USER,e,function(e,t){S(e,t,n)&&n(null,t.user.getLdapTechnicalUserPresenceResult.state)})},this.subscribeDevices=function(i){i=i||d,c.debug("[ClientApiHandler]: subscribeDevices...");var e={type:N.UserActionType.SUBSCRIBE_DEVICES};T(N.ContentType.USER,e,function(e,t){if(S(e,t,i)){var n=t.user&&t.user.subscribeDevices&&t.user.subscribeDevices.devices;i(null,n)}})},this.unsubscribeDevices=function(n){n=n||d,c.debug("[ClientApiHandler]: unsubscribeDevices...");var e={type:N.UserActionType.UNSUBSCRIBE_DEVICES};T(N.ContentType.USER,e,function(e,t){S(e,t,n)&&n(null)})},this.requestEmailChange=function(e,t,n){c.debug("[ClientApiHandler]: requestEmailChange");var i={type:N.UserActionType.GENERATE_EMAIL_UPDATE_TOKEN,generateEmailUpdateToken:{userId:e,emailAddress:t}};T(N.ContentType.USER,i,function(e,t){S(e,t,n)&&n(null)})},this.getUsersByIds=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getUsersByIds...");var t={type:N.UserActionType.GET_USERS_BY_IDS,usersByIds:{userIds:e,complete:!0}};T(N.ContentType.USER,t,function(e,t){S(e,t,n)&&n(null,t.user.usersByIds.user)})},this.getPartialUsersByIds=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getPartialUsersByIds...");var t={type:N.UserActionType.GET_USERS_BY_IDS,usersByIds:{userIds:e,complete:!1}};T(N.ContentType.USER,t,function(e,t){S(e,t,n)&&n(null,t.user.usersByIds.user)})},this.renewToken=function(e,n){n=n||function(e){e?c.error("[ClientApiHandler]: Error renewing token. This client will be automatically logged out",e):c.debug("[ClientApiHandler]: Successfully renewed token.")},c.debug("[ClientApiHandler]: renewToken");var t={type:N.UserActionType.RENEW_TOKEN};T(N.ContentType.USER,t,function(e,t){S(e,t,n)&&n(null,t.user.renewToken)})},this.getUserSettings=function(e,n){n=n||d,e=e||N.UserSettingArea.ALL,c.debug("[ClientApiHandler]: getUserSettings...");var t={type:N.UserActionType.GET_USER_SETTINGS,getUserSettings:{areas:e}};T(N.ContentType.USER,t,function(e,t){S(e,t,n)&&n(null,t.user.getUserSettings.settings)})},this.setUserSettings=function(e,n){if(n=n||d,c.debug("[ClientApiHandler]: setUserSettings..."),!e||Array.isArray(e)&&!e.length)return c.warn("[ClientApiHandler]: No settings were provided"),void I(n,N.ReturnCode.INVALID_MESSAGE);if(Array.isArray(e)||(e=[e]),this.isEnhancedNotificationSupported()||(e=e.filter(function(e){switch(e.key){case N.UserSettingKey.ENHANCED_DESKTOP_MESSAGE_NOTIFICATION:case N.UserSettingKey.ENHANCED_MOBILE_MESSAGE_NOTIFICATION:return c.warn("[ClientApiHandler]: Requested setting is not supported by backend: ",e),!1;default:return!0}})).length){var t={type:N.UserActionType.SET_USER_SETTINGS,setUserSettings:{settings:e}};T(N.ContentType.USER,t,function(e,t){S(e,t,n)&&n(null)})}else I(n,N.ReturnCode.OPERATION_NOT_SUPPORTED)},this.getUserByEmail=function(e,n){n=n||d;var t={type:N.UserActionType.GET_USER_BY_MAIL,getUserByMail:{emailAddress:e,excludeRoles:[N.UserRole.SUPPORT,N.UserRole.SYSTEM_ADMIN]}};T(N.ContentType.USER,t,function(e,t){S(e,t,n)&&n(null,t.user.getUserByMail.user)})},this.getUsersByEmails=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getUsersByEmails...");var t={type:N.UserActionType.GET_USERS_BY_MAILS,getUsersByMails:{emailAddresses:e.emailAddresses,xmppLookup:!!e.xmppLookup,excludeRoles:[N.UserRole.SUPPORT,N.UserRole.SYSTEM_ADMIN]}};T(N.ContentType.USER,t,function(e,t){S(e,t,n,!0)&&n(null,t.user.getUsersByMails.users)})},this.changeUserEmail=function(e,t,n,i){n=n||d;var r={type:N.UserActionType.EMAIL_UPDATE,emailUpdate:{userId:e,emailAddress:t}};T(N.ContentType.USER,r,function(e,t){S(e,t,n)&&n(null,t.user.emailUpdate)},null,null,i)},this.goToSleep=function(e,n){n=n||d,c.debug("[ClientApiHandler]: goToSleep...");var t={type:N.UserActionType.GO_TO_SLEEP,userId:e};T(N.ContentType.USER,t,function(e,t){S(e,t,n)&&n(null)})},this.wakeUp=function(n){n=n||d,c.debug("[ClientApiHandler]: wakeUp...");var e={type:N.UserActionType.WAKE_UP};T(N.ContentType.USER,e,function(e,t){S(e,t,n)&&n(null)})},this.getDevices=function(n){n=n||d,c.debug("[ClientApiHandler]: getDevices...");var e={type:N.UserActionType.GET_DEVICES};T(N.ContentType.USER,e,function(e,t){S(e,t,n)&&n(null,t.user.getDevices.devices)})},this.getTelephonyData=function(n){n=n||d,c.debug("[ClientApiHandler]: getTelephonyData...");var e={type:N.UserActionType.GET_TELEPHONY_DATA};T(N.ContentType.USER,e,function(e,t){S(e,t,n)&&n(null,t.user.getTelephonyData.data)})},this.getConnectedApps=function(n){n=n||d,c.debug("[ClientApiHandler]: getConnectedApps...");var e={type:N.UserActionType.OAUTH_GET_GRANTED_ACCESS_TOKENS};T(N.ContentType.USER,e,function(e,t){S(e,t,n,!0)&&n(null,t.user.oAuthGetGrantedAccessTokens.oAuthGrantedAccess)})},this.revokeAccessToken=function(e,n){n=n||d,c.debug("[ClientApiHandler]: revokeAccessToken...");var t={type:N.UserActionType.OAUTH_REVOKE_ACCESS_TOKEN,oAuthRevokeGrantedAccessToken:{tokenId:e}};T(N.ContentType.USER,t,function(e,t){S(e,t,n)&&n(null)})},this.revokeAllManagedDevices=function(n){n=n||d,c.debug("[ClientApiHandler]: revokeAllManagedDevices...");var e={type:N.UserActionType.REVOKE_MANAGED_DEVICES};T(N.ContentType.USER,e,function(e,t){S(e,t,n)&&n(null)})},this.getSecurityTokenInfo=function(n){n=n||d,c.debug("[ClientApiHandler]: getSecurityTokenInfo...");var e={type:N.UserActionType.GET_SECURITY_TOKEN_INFO};T(N.ContentType.USER,e,function(e,t){S(e,t,n,!0)&&n(null,t.user.getSecurityTokenInfoResult.securityTokenInfo)})},this.revokeSecurityToken=function(e,n){n=n||d,c.debug("[ClientApiHandler]: revokeSecurityToken...");var t={type:N.UserActionType.REVOKE_SECURITY_TOKEN,revokeSecurityToken:{tokenIdHash:e}};T(N.ContentType.USER,t,function(e,t){S(e,t,n)&&n(null)})},this.getUserTenantSettings=function(n,e){n=n||d,c.debug("[ClientApiHandler]: getUserTenantSettings...");var t={type:N.UserActionType.GET_TENANT_SETTINGS};T(N.ContentType.USER,t,function(e,t){S(e,t,n,!0)&&n(null,t.user.getTenantSettings.tenantSettings)},null,null,e)},this.resetOpenScapeDevicePins=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: resetOpenScapeDevicePins...");var i={type:N.UserActionType.RESET_OPENSCAPE_DEVICE_PINS,resetOpenScapeDevicePins:{circuitUserId:e,directoryNumber:t}};T(N.ContentType.USER,i,function(e,t){S(e,t,n)&&n(null,t.user.resetOpenScapeDevicePins.openScapeDevicePins)},null,["response.user.resetOpenScapeDevicePins.openScapeDevicePins"])},this.setClientCapabilities=function(e,n){if(n=n||d,c.debug("[ClientApiHandler]: setClientCapabilities..."),!this.isClientCapabilitiesSupported())return c.warn("[ClientApiHandler]: The setClientCapabilities operation is not supported by the backend"),void I(n,N.ReturnCode.OPERATION_NOT_SUPPORTED);var t={type:N.UserActionType.SET_CLIENT_CAPABILITIES,setClientCapabilities:{capabilities:e}};T(N.ContentType.USER,t,function(e,t){S(e,t,n)&&n(null)})},this.startBasicSearch=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: startBasicSearch...");var i={type:N.SearchActionType.START_BASIC_SEARCH,startBasicSearch:{searchTerm:e,priorizedConvs:t||void 0,newSearch:!0}};T(N.ContentType.SEARCH,i,function(e,t){S(e,t,n)&&n(null,t.search.startSearchResult.searchId)})},this.startDetailSearch=function(e,t,n,i,r){r=r||d,c.debug("[ClientApiHandler]: startDetailSearch...");var o={type:N.SearchActionType.START_DETAIL_SEARCH,startDetailSearch:{searchTerm:e,convId:t,searchId:n||void 0,resultSetLimit:i||0}};T(N.ContentType.SEARCH,o,function(e,t){S(e,t,r)&&r(null,t.search.startSearchResult.searchId)})},this.cancelSearch=function(e,n){n=n||d,c.debug("[ClientApiHandler]: cancelSearch...");var t={type:N.SearchActionType.CANCEL_SEARCH,cancelSearch:{searchId:e}};T(N.ContentType.SEARCH,t,function(e,t){S(e,t,n)&&n(null)})},this.getRecentSearches=function(n){n=n||d;var e={type:N.SearchActionType.GET_RECENT_SEARCHES};T(N.ContentType.SEARCH,e,function(e,t){S(e,t,n,!0)&&n(null,t.search.getRecentSearch.recentSearches)})},this.addRecentSearch=function(e,n){n=n||d;var t={type:N.SearchActionType.ADD_RECENT_SEARCH,addRecentSearch:{searchTerm:e}};T(N.ContentType.SEARCH,t,function(e,t){S(e,t,n)&&n(null)})},this.startUserSearch=function(e,n){n=n||d;var t={type:N.SearchActionType.START_USER_SEARCH,startUserSearch:{query:e.query,reversePhoneNumberLookup:!!e.reversePhoneNumberLookup}};T(N.ContentType.SEARCH,t,function(e,t){S(e,t,n)&&n(null,t.search.startSearchResult.searchId)})},this.searchConversationParticipants=function(e,t,n){n=n||d;var i={type:N.SearchActionType.SEARCH_CONVERSATION_PARTICIPANTS,searchConversationParticipants:{displayName:e,convId:t}};T(N.ContentType.SEARCH,i,function(e,t){S(e,t,n,!0)&&n(null,t.search.searchConversationParticipantsResult.participants||[])})},this.createConversation=function(e,n){n=n||d,c.debug("[ClientApiHandler]: createConversation...");var t=e.type;t||(t=2<e.participants.length?N.ConversationType.GROUP:N.ConversationType.DIRECT);var i={type:N.ConversationActionType.CREATE,create:{type:t,topic:e.topic,description:e.description||void 0,participants:e.participants,invitations:e.emailAddresses,locale:e.locale}};T(N.ContentType.CONVERSATION,i,function(e,t){S(e,t,n)&&n(null,t.conversation.create.conversation,t.code===N.ReturnCode.ENTITY_ALREADY_EXISTS)},["request.conversation.create.topic","request.conversation.create.description"],["response.conversation.create.conversation.topic","response.conversation.create.conversation.description","response.conversation.create.conversation.topLevelItem"])},this.updateConversation=function(e,n){n=n||d,c.debug("[ClientApiHandler]: updateConversation...");var t={type:N.ConversationActionType.UPDATE,update:{convId:e.conversationId,topic:e.topic,description:e.description}};T(N.ContentType.CONVERSATION,t,function(e,t){S(e,t,n)&&n(null,t.conversation.update.conversation)},["request.conversation.update.topic","request.conversation.update.description"],["response.conversation.update.conversation.participants","response.conversation.update.conversation.topic","response.conversation.update.conversation.description","response.conversation.update.conversation.topLevelItem"])},this.addTextItem=function(e,n){n=n||d,c.debug("[ClientApiHandler]: addTextItem...");var t=e.content&&D.sanitize(e.content)&&D.sanitizeSymbols(e.content)||"";t=h.convertPrivateDataToContent(e)+t;var i={type:N.ConversationActionType.ADD_TEXT_ITEM,addTextItem:{convId:e.convId,parentId:e.parentId,contentType:e.contentType,subject:e.subject,content:t,attachmentMetaData:f(e.attachmentMetaData),externalAttachmentMetaData:R(e.externalAttachmentMetaData),preview:e.preview,mentionedUsers:e.mentionedUsers}};i.addTextItem.preview&&i.addTextItem.preview.description&&(i.addTextItem.preview.description=i.addTextItem.preview.description.substr(0,255));T(N.ContentType.CONVERSATION,i,function(e,t){S(e,t,n)&&n(null,t.conversation.addTextItem.item)},["request.conversation.addTextItem.subject","request.conversation.addTextItem.content"],["response.conversation.addTextItem.item.text"])},this.updateTextItem=function(e,n){n=n||d,c.debug("[ClientApiHandler]: updateTextItem...");var t=e.content&&D.sanitize(e.content)&&D.sanitizeSymbols(e.content)||"";t=h.convertPrivateDataToContent(e)+t;var i={itemId:e.itemId,convId:e.convId,parentId:e.parentId,contentType:N.TextItemContentType.RICH,subject:e.subject,content:t,attachmentMetaData:f(e.attachmentMetaData),preview:e.preview||{},clustered:e.clustered,externalAttachmentMetaData:R(e.externalAttachmentMetaData),mentionedUsers:e.mentionedUsers};i.preview.description&&(i.preview.description=i.preview.description.substr(0,255)),i.externalAttachmentMetaData&&0!==i.externalAttachmentMetaData.length||(i.externalAttachmentMetaData=[{type:"BOX",downloadLocation:"",previewLocation:"",attachment:{}}]),i.attachmentMetaData&&0!==i.attachmentMetaData.length||(i.attachmentMetaData=[{}]);var r={type:N.ConversationActionType.UPDATE_TEXT_ITEM,updateTextItem:i};T(N.ContentType.CONVERSATION,r,function(e,t){S(e,t,n)&&n(null,t.conversation.updateTextItem.item)},["request.conversation.updateTextItem.subject","request.conversation.updateTextItem.content"],["response.conversation.updateTextItem.item.text"])},this.deleteTextItem=function(e,n){if(n=n||d,!e||!e.itemId)return c.warn("[ClientApiHandler]: No request parameters were provided"),void I(n,N.ReturnCode.INVALID_MESSAGE);c.debug("[ClientApiHandler]: deleteTextItem...");var t={type:N.ConversationActionType.DELETE_TEXT_ITEM,deleteTextItem:{itemId:e.itemId}};T(N.ContentType.CONVERSATION,t,function(e,t){S(e,t,n)&&n(null,t.conversation.deleteTextItem.item)})},this.deleteRecording=function(e,n){n=n||d,c.debug("[ClientApiHandler]: deleteRecording...");var t={type:N.ConversationActionType.DELETE_RECORDING,deleteRecording:{itemId:e}};T(N.ContentType.CONVERSATION,t,function(e,t){S(e,t,n)&&n(null,t.conversation.deleteRecording.item)})},this.updateRtcItemAttachments=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: updateRtcItemAttachments...");var i={type:N.ConversationActionType.UPDATE_RTC_ITEM_ATTACHMENTS,updateRtcItemAttachments:{itemId:e,attachments:f(t)}};T(N.ContentType.CONVERSATION,i,function(e,t){S(e,t,n)&&n(null,t.conversation.updateRtcItemAttachmentsResult.item)})},this.getOpenConversations=function(e,t,i){i=i||d,c.debug("[ClientApiHandler]: getOpenConversations...");var n={type:N.ConversationActionType.GET_OPEN_CONVERSATIONS,getOpenConversations:{startIndex:e,numberOfItems:t}};T(N.ContentType.CONVERSATION,n,function(e,t){if(S(e,t,i,!0)){var n=t.conversation.getOpenConversations;i(null,n.conversations,n.lastItemIndex)}},null,["response.conversation.getOpenConversations.conversations"])},this.getAllOpenConversations=function(e,t,n,i){i=i||d,c.debug("[ClientApiHandler]: getAllOpenConversations...");var r={type:N.ConversationActionType.GET_OPEN_CONVERSATIONS,getOpenConversations:{startIndex:e,numberOfItems:t,ownIncluded:!0,sorting:n}};T(N.ContentType.CONVERSATION,r,function(e,t){if(S(e,t,i,!0)){var n=t.conversation.getOpenConversations;i(null,n.conversations,n.lastItemIndex)}},null,["response.conversation.getOpenConversations.conversations"])},this.joinOpenConversation=function(e,n){n=n||d,c.debug("[ClientApiHandler]: JoinOpenConversation...");var t={type:N.ConversationActionType.JOIN_OPEN_CONVERSATION,joinOpenConversation:{convId:e}};T(N.ContentType.CONVERSATION,t,function(e,t){S(e,t,n)&&n(null,t.conversation.joinOpenConversation.conv)})},this.getConversationFeed=function(e,t,n,i,r,o,a){a=a||d,c.debug("[ClientApiHandler]: getConversationFeed...");var s={type:N.ConversationActionType.GET_CONVERSATION_FEED,getConversationFeed:{convId:e,timestamp:t||void 0,minTotalItems:n||void 0,maxTotalUnread:i||void 0,commentsPerThread:r||void 0,maxUnreadPerThread:o||void 0}};T(N.ContentType.CONVERSATION,s,function(e,t){if(S(e,t,a,!0)){var n=t.conversation.getConversationFeedResult;a(null,n.conversationThreads,n.hasOlderThreads)}},null,["response.conversation.getConversationFeedResult.conversationThreads.[].parentItem.attachments","response.conversation.getConversationFeedResult.conversationThreads.[].parentItem.externalAttachments","response.conversation.getConversationFeedResult.conversationThreads.[].parentItem.rtc","response.conversation.getConversationFeedResult.conversationThreads.[].parentItem.text","response.conversation.getConversationFeedResult.conversationThreads.[].parentItem.system","response.conversation.getConversationFeedResult.conversationThreads.[].comments.[].attachments","response.conversation.getConversationFeedResult.conversationThreads.[].comments.[].externalAttachments","response.conversation.getConversationFeedResult.conversationThreads.[].comments.[].text"])},this.getThreadComments=function(e,t,n,i,r,o,a){a=a||d,c.debug("[ClientApiHandler]: getThreadComments...");var s={type:N.ConversationActionType.GET_THREAD_COMMENTS,getThreadComments:{convId:e,threadId:t,timestamp:n||void 0,timestampFilter:i||N.TimestampFilter.CREATION,direction:r||void 0,totalComments:o||void 0}};T(N.ContentType.CONVERSATION,s,function(e,t){if(S(e,t,a,!0)){var n=t.conversation.getThreadCommentsResult;a(null,n.comments,n.hasMoreComments)}},null,["response.conversation.getThreadCommentsResult.comments.[].attachments","response.conversation.getThreadCommentsResult.comments.[].externalAttachments","response.conversation.getThreadCommentsResult.comments.[].text"])},this.getThreadsByItemIds=function(e,i){if(c.debug("[ClientApiHandler]: getThreadsByItemIds..."),i=i||d,!e)return c.warn("[ClientApiHandler]: No request parameters were provided"),void I(i,N.ReturnCode.INVALID_MESSAGE);if(!e.convId)return c.warn("[ClientApiHandler]: No conversation id was provided"),void I(i,N.ReturnCode.INVALID_MESSAGE);if(!e.threadParams)return c.warn("[ClientApiHandler]: No thread parameters were provided (item ids were not provided)"),void I(i,N.ReturnCode.INVALID_MESSAGE);var t={type:N.ConversationActionType.GET_THREADS_BY_ITEM_IDS,getThreadsByItemIds:{convId:e.convId,threadParams:e.threadParams,timestampFilter:e.timestampFilter||void 0,orderBy:e.orderBy||void 0}};T(N.ContentType.CONVERSATION,t,function(e,t){if(S(e,t,i,!0)){var n=t.conversation.getThreadsByItemIdsResult;i(null,n&&n.conversationThreadContext)}},null,["response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].parentItem.attachments","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].parentItem.externalAttachments","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].parentItem.rtc","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].parentItem.text","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].parentItem.system","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].comments.[].item.attachments","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].comments.[].item.externalAttachments","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].comments.[].item.text","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].lastComments.[].attachments","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].lastComments.[].externalAttachments","response.conversation.getThreadsByItemIdsResult.conversationThreadContext.[].lastComments.[].text"])},this.getThreadsByIds=function(e,i){if(c.debug("[ClientApiHandler]: getThreadsByIds..."),i=i||d,!e)return c.warn("[ClientApiHandler]: No request parameters were provided"),void I(i,N.ReturnCode.INVALID_MESSAGE);if(!e.convId)return c.warn("[ClientApiHandler]: No conversation id was provided"),void I(i,N.ReturnCode.INVALID_MESSAGE);if(!(e.threadIds instanceof Array&&0<e.threadIds.length))return c.warn("[ClientApiHandler]: No thread parameters were provided (thread ids were not provided)"),void I(i,N.ReturnCode.INVALID_MESSAGE);var t={type:N.ConversationActionType.GET_THREADS_BY_IDS,getThreadsByIds:{convId:e.convId,threadIds:e.threadIds,orderBy:e.orderBy||N.SortingType.TIMESTAMP_ASC,commentsPerThread:e.commentsPerThread||void 0}};T(N.ContentType.CONVERSATION,t,function(e,t){if(S(e,t,i,!0)){var n=t.conversation.getThreadsByIdsResult;i(null,n&&n.conversationThreads)}},null,["response.conversation.getThreadsByIdsResult.conversationThreads.[].parentItem.attachments","response.conversation.getThreadsByIdsResult.conversationThreads.[].parentItem.externalAttachments","response.conversation.getThreadsByIdsResult.conversationThreads.[].parentItem.rtc","response.conversation.getThreadsByIdsResult.conversationThreads.[].parentItem.text","response.conversation.getThreadsByIdsResult.conversationThreads.[].parentItem.system","response.conversation.getThreadsByIdsResult.conversationThreads.[].comments.[].attachments","response.conversation.getThreadsByIdsResult.conversationThreads.[].comments.[].externalAttachments","response.conversation.getThreadsByIdsResult.conversationThreads.[].comments.[].text"])},this.getConversations=function(e,t,n,i,r,o){o=o||d,c.debug("[ClientApiHandler]: getConversations...");var a=n?N.SearchDirection.BEFORE:N.SearchDirection.AFTER,s={type:N.ConversationActionType.GET_CONVERSATIONS,getConversations:{userId:e,modificationDate:t||void 0,direction:a,number:i||void 0,filter:r||N.ConversationFilter.ALL,sortByLastItem:!!n}};T(N.ContentType.CONVERSATION,s,function(e,t){S(e,t,o,!0)&&o(null,t.conversation.getConversations.conversations)},null,["response.conversation.getConversations.conversations"])},this.getSupportConversation=function(n){n=n||d,c.debug("[ClientApiHandler]: getSupportConversation...");var e={type:N.ConversationActionType.GET_SUPPORT_CONVERSATION};T(N.ContentType.CONVERSATION,e,function(e,t){S(e,t,n)&&n(null,t.conversation.getSupportConversation.conversation)})},this.getSupportConversationId=function(n){n=n||d,c.debug("[ClientApiHandler]: getSupportConversationId...");var e={type:N.ConversationActionType.GET_SUPPORT_CONVERSATION_ID};T(N.ContentType.CONVERSATION,e,function(e,t){S(e,t,n)&&n(null,t.conversation.getSupportConversationId.conversationId)})},this.getTelephonyConversationId=function(n){n=n||d,c.debug("[ClientApiHandler]: getTelephonyConversationId...");var e={type:N.ConversationActionType.GET_TELEPHONY_CONVERSATION_ID};T(N.ContentType.CONVERSATION,e,function(e,t){S(e,t,n)&&n(null,t.conversation.getTelephonyConversationId.conversationId)})},this.getMarkedConversationsList=function(n){n=n||d,c.debug("[ClientApiHandler]: getMarkedConversationsList...");var e={type:N.ConversationActionType.GET_MARKED_CONVERSATIONS_LIST};T(N.ContentType.CONVERSATION,e,function(e,t){S(e,t,n)&&n(null,t.conversation.getMarkedConversationsList)})},this.getFavoriteConversationIds=function(n){n=n||d,c.debug("[ClientApiHandler]: getFavoriteConversationIds...");var e={type:N.ConversationActionType.GET_FAVORITE_CONVERSATION_IDS};T(N.ContentType.CONVERSATION,e,function(e,t){S(e,t,n,!0)&&n(null,t.conversation.getFavoriteConversationIdResult.favoriteConversationIds)})},this.markConversation=function(e,n){n=n||d;var t={type:N.ConversationActionType.MARK_CONVERSATION,markConversation:{convId:e.convId,filter:e.markType}};T(N.ContentType.CONVERSATION,t,function(e,t){S(e,t,n)&&n(null)})},this.unmarkConversation=function(e,n){n=n||d;var t={type:N.ConversationActionType.UNMARK_CONVERSATION,unmarkConversation:{convId:e.convId,filter:e.markType}};T(N.ContentType.CONVERSATION,t,function(e,t){S(e,t,n)&&n(null)})},this.getConversationUserData=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: getConversationUserData..."),e instanceof Array||(e=[e]);var i={type:N.ConversationActionType.GET_CONVERSATION_USER_DATA,getConversationUserData:{conversationId:e,userDataToInclude:t||void 0}};T(N.ContentType.CONVERSATION,i,function(e,t){S(e,t,n)&&n(null,t.conversation.getConversationUserData.userData)})},this.getConversationItems=function(e,t,n,i,r,o){o=o||d,c.debug("[ClientApiHandler]: getConversationItems...");var a={type:N.ConversationActionType.GET_ITEMS_BY_CONVERSATION,getItemsByConversation:{convId:e,modificationDate:t||void 0,creationDate:n||void 0,direction:i||void 0,number:r||void 0}};T(N.ContentType.CONVERSATION,a,function(e,t){S(e,t,o,!0)&&o(null,t.conversation.getItemsByConversation.items)},null,["response.conversation.getItemsByConversation.items.[].attachments","response.conversation.getItemsByConversation.items.[].externalAttachments","response.conversation.getItemsByConversation.items.[].rtc","response.conversation.getItemsByConversation.items.[].text","response.conversation.getItemsByConversation.items.[].system"])},this.getConversationAttachments=function(e,t,r){r=r||d,c.debug("[ClientApiHandler]: getConversationAttachments...");var n={type:N.ConversationActionType.GET_ATTACHMENTS,getAttachments:{conversationId:e,startPage:t.page||void 0,pageSize:t.size||void 0,orderType:t.type||void 0,orderDirection:t.direction||void 0}};T(N.ContentType.CONVERSATION,n,function(e,t){if(S(e,t,r)){var n=t.conversation.getAttachments.attachments||[],i=t.conversation.getAttachments.nextPage.hasMoreAttachments?t.conversation.getAttachments.nextPage.lastIndex:null;r(null,n,i)}})},this.getItemsByConversationItemId=function(e,t,n,i,r,o){o=o||d,c.debug("[ClientApiHandler]: getItemsByConversationItemId...");var a={type:N.ConversationActionType.GET_ITEMS_BY_CONVERSATION_ITEM_ID,getItemsByConversationItemId:{convId:e,itemId:t,direction:n||void 0,number:i||void 0,orderType:r||void 0}};T(N.ContentType.CONVERSATION,a,function(e,t){S(e,t,o,!0)&&o(null,t.conversation.getItemsByConversationItemId.items)},null,["response.conversation.getItemsByConversationItemId.items.[].attachments","response.conversation.getItemsByConversationItemId.items.[].externalAttachments","response.conversation.getItemsByConversationItemId.items.[].rtc","response.conversation.getItemsByConversationItemId.items.[].text","response.conversation.getItemsByConversationItemId.items.[].system"])},this.getConversationById=function(e,i){i=i||d,c.debug("[ClientApiHandler]: getConversationById...");var t={type:N.ConversationActionType.GET_CONVERSATION_BY_ID,getConversationById:{convId:e}};T(N.ContentType.CONVERSATION,t,function(e,t){if(S(e,t,i)){var n=t.conversation.getConversationById.conversation;n&&n.participants&&c.info("[ClientApiHandler]: Retrieved conversation has "+n.participants.length+" participant(s)"),i(null,n)}},null,["response.conversation.getConversationById.conversation.participants","response.conversation.getConversationById.conversation.topic","response.conversation.getConversationById.conversation.description","response.conversation.getConversationById.conversation.topLevelItem"])},this.getConversationsByIds=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getConversationsByIds...");var t={type:N.ConversationActionType.GET_CONVERSATIONS_BY_IDS,getConversationsByIds:{conversationId:e}};T(N.ContentType.CONVERSATION,t,function(e,t){S(e,t,n,!0)&&n(null,t.conversation.getConversationsByIdsResult.conversations)},null,["response.conversation.getConversationsByIdsResult.conversations"])},this.getItemById=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getItemById...");var t={type:N.ConversationActionType.GET_ITEM_BY_ID,getItemById:{itemId:e}};T(N.ContentType.CONVERSATION,t,function(e,t){S(e,t,n)&&n(null,t.conversation.getItemById.item)},null,["response.conversation.getItemById.item.attachments","response.conversation.getItemById.item.externalAttachments","response.conversation.getItemById.item.rtc","response.conversation.getItemById.item.text","response.conversation.getItemById.item.system"])},this.getItemsByIds=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getItemsByIds...");var t={type:N.ConversationActionType.GET_ITEMS_BY_IDS,getItemsByIds:{itemIds:e}};T(N.ContentType.CONVERSATION,t,function(e,t){S(e,t,n,!0)&&n(null,t.conversation.getItemsByIds.items)},null,["response.conversation.getItemsByIds.items.[].attachments","response.conversation.getItemsByIds.items.[].externalAttachments","response.conversation.getItemsByIds.items.[].rtc","response.conversation.getItemsByIds.items.[].text","response.conversation.getItemsByIds.items.[].system"])},this.setReadPointer=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: setReadPointer...");var i={type:N.ConversationActionType.SET_READ_POINTER,setReadPointer:{convId:e,lastReadTimestamp:t}};T(N.ContentType.CONVERSATION,i,function(e,t){S(e,t,n)&&n(null)})},this.getConversationByUser=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getConversationByUser...");var t={type:N.ConversationActionType.GET_CONVERSATION_BY_USER,getConversationByUser:{userId:e}};T(N.ContentType.CONVERSATION,t,function(e,t){S(e,t,n)&&n(null,t.conversation.getConversationByUser.conversation)},null,["response.conversation.getConversationByUser.conversation.topic","response.conversation.getConversationByUser.conversation.description","response.conversation.getConversationByUser.conversation.topLevelItem"])},this.getConversationsByFilter=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getConversationsByFilter...");var t={type:N.ConversationActionType.GET_CONVERSATIONS_BY_FILTER,getConversationsByFilter:{conversationsFilter:e.filterConnector,timestamp:e.timestamp||void 0,number:e.number,numberOfParticipants:e.numberOfParticipants,retrieveAction:e.retrieveAction||void 0}};T(N.ContentType.CONVERSATION,t,function(e,t){S(e,t,n)&&n(null,t.conversation.getConversationsByFilterResult||{})},null,["response.conversation.getConversationsByFilterResult.conversations"])},this.subscribe=function(e,n){n=n||d,c.debug("[ClientApiHandler]: subscribe...");var t={type:N.ConversationActionType.SUBSCRIBE,subscribe:{conversationId:e}};T(N.ContentType.CONVERSATION,t,function(e,t){S(e,t,n)&&n(null)})},this.unsubscribe=function(e,n){n=n||d,c.debug("[ClientApiHandler]: unsubscribe...");var t={type:N.ConversationActionType.UNSUBSCRIBE,unsubscribe:{conversationId:e}};T(N.ContentType.CONVERSATION,t,function(e,t){S(e,t,n)&&n(null)})},this.typing=function(e,t,n,i){i=i||d,c.debug("[ClientApiHandler]: typing...");var r={type:N.ConversationActionType.TYPING,typing:{conversationId:e,isTyping:t,parentItemId:n}};T(N.ContentType.CONVERSATION,r,function(e,t){S(e,t,i)&&i(null)})},this.addParticipant=function(e,n){n=n||d,c.debug("[ClientApiHandler]: addParticipant...");var t={type:N.ConversationActionType.ADD_PARTICIPANT,addParticipant:{convId:e.convId,userId:e.userId,invitations:e.emailAddresses,locale:e.locale}};T(N.ContentType.CONVERSATION,t,function(e,t){S(e,t,n)&&n(null,t.conversation.addParticipant)})},this.removeParticipant=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: removeParticipant..."),!t||t instanceof Array||(t=[t]);var i={type:N.ConversationActionType.REMOVE_PARTICIPANT,removeParticipant:{convId:e,userId:t}};T(N.ContentType.CONVERSATION,i,function(e,t){S(e,t,n)&&n(null,t.conversation.removeParticipant.conversation)})},this.getConversationParticipants=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: getConversationParticipants..."),t=t||{};var i={type:N.ConversationActionType.GET_CONVERSATION_PARTICIPANTS,getConversationParticipants:{convId:e,searchCriterias:t.searchCriterias||void 0,searchPointer:t.searchPointer||void 0,pageSize:t.pageSize||25,includePresence:!!t.includePresence}};T(N.ContentType.CONVERSATION,i,function(e,t){S(e,t,n)&&n(null,t.conversation.getConversationParticipantsResult)})},this.getJoinDetails=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: getJoinDetails...");var i={type:N.ConversationActionType.GET_JOIN_DETAILS,getJoinDetails:{conversationId:e,recreate:!!t}};T(N.ContentType.CONVERSATION,i,function(e,t){S(e,t,n)&&n(null,t.conversation.getJoinDetails)},null,["response.conversation.getJoinDetails.tenantPIN","response.conversation.getJoinDetails.sessionPIN"])},this.setFlagItem=function(e,n){if(n=n||d,c.debug("[ClientApiHandler]: setFlagItem..."),!e)return c.warn("[ClientApiHandler]: No request parameters were provided"),void I(n,N.ReturnCode.INVALID_MESSAGE);var t={type:N.ConversationActionType.SET_FLAG_ITEM,setFlagItem:{conversationId:e.convId,conversationItemId:e.itemId,conversationItemCreationTime:e.creationTime,conversationParentId:e.parentId}};T(N.ContentType.CONVERSATION,t,function(e,t){S(e,t,n)&&n(null)})},this.clearFlagItem=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: clearFlagItem...");var i={type:N.ConversationActionType.CLEAR_FLAG_ITEM,clearFlagItem:{conversationId:e,conversationItemId:t}};T(N.ContentType.CONVERSATION,i,function(e,t){S(e,t,n)&&n(null)})},this.getFlaggedItems=function(n){n=n||d,c.debug("[ClientApiHandler]: getFlaggedItems...");var e={type:N.ConversationActionType.GET_FLAGGED_ITEMS};T(N.ContentType.CONVERSATION,e,function(e,t){S(e,t,n,!0)&&n(null,t.conversation.getFlaggedItem.flaggedItems)})},this.likeTextItem=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: likeTextItem...");var i={type:N.ConversationActionType.LIKE_TEXT_ITEM,likeTextItem:{conversationItemId:e,userId:t}};T(N.ContentType.CONVERSATION,i,function(e,t){S(e,t,n)&&n(null)})},this.unlikeTextItem=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: unlikeTextItem...");var i={type:N.ConversationActionType.UNLIKE_TEXT_ITEM,unlikeTextItem:{conversationItemId:e,userId:t}};T(N.ContentType.CONVERSATION,i,function(e,t){S(e,t,n)&&n(null)})},this.setConvAvatar=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: setConvAvatar...");var i={type:N.ConversationActionType.SET_CONVERSATION_AVATAR,setConversationAvatar:{convId:e,imageS:t.s,imageL:t.b}};T(N.ContentType.CONVERSATION,i,function(e,t){S(e,t,n)&&n(null,t.conversation.setConversationAvatar.conversation)})},this.deleteConvAvatar=function(e,n){n=n||d,c.debug("[ClientApiHandler]: deleteConvAvatar...");var t={type:N.ConversationActionType.SET_CONVERSATION_AVATAR,setConversationAvatar:{convId:e,imageS:"",imageL:""}};T(N.ContentType.CONVERSATION,t,function(e,t){S(e,t,n)&&n(null,t.conversation.setConversationAvatar.conversation)})},this.moderateConversation=function(e,n){n=n||d,c.debug("[ClientApiHandler]: moderateConversation...");var t={type:N.ConversationActionType.MODERATE_CONVERSATION,moderateConversation:{convId:e}};T(N.ContentType.CONVERSATION,t,function(e,t){S(e,t,n)&&n(null,t.conversation.moderateResult)})},this.unmoderateConversation=function(e,n){n=n||d,c.debug("[ClientApiHandler]: unmoderateConversation...");var t={type:N.ConversationActionType.UNMODERATE_CONVERSATION,unmoderateConversation:{convId:e}};T(N.ContentType.CONVERSATION,t,function(e,t){S(e,t,n)&&n(null,t.conversation.moderateResult)})},this.updateGuestAccess=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: updateGuestAccess...");var i={type:N.ConversationActionType.UPDATE_GUEST_ACCESS,updateGuestAccess:{convId:e,guestAccessDisabled:!!t}};T(N.ContentType.CONVERSATION,i,function(e,t){S(e,t,n)&&n(null,t.conversation.updateGuestAccessResult)})},this.getConversationSummary=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: getConversationSummary...");var i={type:N.ConversationActionType.GET_CONVERSATION_SUMMARY,getConversationSummary:{convId:e}};t&&(l<E?i.getConversationSummary.inviteToken={token:t}:c.warn("[ClientApiHandler]: Backend does not support the guestToken parameter")),T(N.ContentType.CONVERSATION,i,function(e,t){S(e,t,n)&&n(null,t.conversation.getConversationSummary.conversationSummary)})},this.grantModeratorRights=function(e,t,n){n=n||d,t instanceof Array||(t=[t]),c.debug("[ClientApiHandler]: grantModeratorRights...");var i={type:N.ConversationActionType.GRANT_MODERATOR_RIGHTS,grantModeratorRights:{convId:e,userId:t}};T(N.ContentType.CONVERSATION,i,function(e,t){S(e,t,n)&&n(null,t.conversation.grantModeratorRightsResult)})},this.dropModeratorRights=function(e,t,n){n=n||d,t instanceof Array||(t=[t]),c.debug("[ClientApiHandler]: dropModeratorRights...");var i={type:N.ConversationActionType.DROP_MODERATOR_RIGHTS,dropModeratorRights:{convId:e,userId:t}};T(N.ContentType.CONVERSATION,i,function(e,t){S(e,t,n)&&n(null,t.conversation.dropModeratorRightsResult)})},this.takeModerationRight=function(e,n){if(n=n||d,c.debug("[ClientApiHandler]: takeModerationRight..."),!this.isModerationTakeOverSupported())return c.warn("[ClientApiHandler]: The takeModerationRight operation is not supported by the backend"),void I(n,N.ReturnCode.OPERATION_NOT_SUPPORTED);var t={type:N.ConversationActionType.TAKE_MODERATION_RIGHT,takeModerationRight:{convId:e}};T(N.ContentType.CONVERSATION,t,function(e,t){S(e,t,n)&&n(null,t.conversation.takeModerationRightResult.moderationTakenResult)})},this.addJournalEntry=function(e,n){n=n||d,c.debug("[ClientApiHandler]: addJournalEntry...");var t={type:N.ConversationActionType.ADD_JOURNAL_ENTRY,addJournalEntry:{convId:e.convId,starter:e.starter,source:e.source,destination:e.destination,startTime:e.startTime,duration:e.duration,type:e.type,participants:e.participants,missedReason:e.missedReason}};T(N.ContentType.CONVERSATION,t,function(e,t){S(e,t,n)&&n(null)})},this.setFavoritePosition=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: setFavoritePosition...");var i={type:N.ConversationActionType.SET_FAVORITE_POSITION,setFavoritePosition:{convId:e,position:t}};T(N.ContentType.CONVERSATION,i,function(e,t){S(e,t,n)&&n(null,t)})},this.addLabels=function(e,n){n=n||d,c.debug("[ClientApiHandler]: addLabels...");var t={type:N.ConversationActionType.ADD_LABELS,addLabels:{labels:e}};T(N.ContentType.CONVERSATION,t,function(e,t){S(e,t,n)&&n(null,t.conversation.addLabelsResult.labels)})},this.assignLabels=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: assignLabels...");var i={type:N.ConversationActionType.ASSIGN_LABELS,assignLabels:{convId:e,labelIds:t}};T(N.ContentType.CONVERSATION,i,function(e,t){S(e,t,n)&&n(null,t.conversation.assignLabelsResult.labelIds)})},this.unassignLabels=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: unassignLabels...");var i={type:N.ConversationActionType.UNASSIGN_LABELS,unassignLabels:{convId:e,labelIds:t}};T(N.ContentType.CONVERSATION,i,function(e,t){S(e,t,n,!0)&&n(null,t.conversation.unassignLabelsResult.labelIds)})},this.getAllLabels=function(n){n=n||d,c.debug("[ClientApiHandler]: getAllLabels...");var e={type:N.ConversationActionType.GET_LABELS};T(N.ContentType.CONVERSATION,e,function(e,t){S(e,t,n,!0)&&n(null,t.conversation.getLabelsResult.labels)})},this.removeLabels=function(e,n){n=n||d,c.debug("[ClientApiHandler]: removeLabels...");var t={type:N.ConversationActionType.REMOVE_LABELS,removeLabels:{labelIds:e}};T(N.ContentType.CONVERSATION,t,function(e,t){S(e,t,n,!0)&&n(null,t.conversation.removeLabelsResult.labelIds)})},this.editLabel=function(e,n){n=n||d,c.debug("[ClientApiHandler]: editLabel...");var t={type:N.ConversationActionType.EDIT_LABEL,editLabel:{label:e}};T(N.ContentType.CONVERSATION,t,function(e,t){S(e,t,n)&&n(null,t.conversation.editLabelResult.label)})},this.addFilter=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: addFilter...");var i={type:N.ConversationActionType.ADD_FILTER,addFilter:{filterName:e,root:t}};T(N.ContentType.CONVERSATION,i,function(e,t){S(e,t,n)&&n(null,t.conversation.addFilterResult)})},this.removeFilter=function(e,n){n=n||d,c.debug("[ClientApiHandler]: removeFilters...");var t={type:N.ConversationActionType.REMOVE_FILTERS,removeFilters:{filterIds:e}};T(N.ContentType.CONVERSATION,t,function(e,t){S(e,t,n,!0)&&n(null,t.conversation.removeFiltersResult.filterIds)})},this.getAllFilters=function(n){n=n||d,c.debug("[ClientApiHandler]: getAllFilters...");var e={type:N.ConversationActionType.GET_FILTERS,getFilters:{}};T(N.ContentType.CONVERSATION,e,function(e,t){S(e,t,n,!0)&&n(null,t.conversation.getFiltersResult.filters)})},this.editFilter=function(e,n){n=n||d,c.debug("[ClientApiHandler]: editFilter...");var t={type:N.ConversationActionType.EDIT_FILTER,editFilter:{filter:e}};T(N.ContentType.CONVERSATION,t,function(e,t){S(e,t,n)&&n(null,t.conversation.editFilterResult)})},this.getUserDataSince=function(e,i){i=i||d,c.debug("[ClientApiHandler]: getUserDataSince...");var t={type:N.ConversationActionType.GET_USER_DATA_SINCE,getUserDataSince:{sinceTime:e}};T(N.ContentType.CONVERSATION,t,function(e,t){if(S(e,t,i,!0)){var n=t.conversation.getUserDataSinceResult&&t.conversation.getUserDataSinceResult.changedUserData||[];i(null,n)}})},this.getConferenceInvitationText=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: getConferenceInvitationText...");var i={type:N.ConversationActionType.GET_CONFERENCE_INVITATION_TEXT,getConferenceInvitationText:{conversationId:t,language:e}};T(N.ContentType.CONVERSATION,i,function(e,t){S(e,t,n)&&n(null,t.conversation.getConferenceInvitationResult.invitationMessage)},null,["response.conversation.getConferenceInvitationResult.invitationMessage"])},this.getConferenceInvitationExample=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: getConferenceInvitationExample...");var i={type:N.ConversationActionType.GET_CONFERENCE_INVITATION_EXAMPLE,getConferenceInvitationExample:{language:e}};T(N.ContentType.CONVERSATION,i,function(e,t){S(e,t,n)&&n(null,t.conversation.getConferenceInvitationResult.invitationMessage)},null,null,t)},this.joinRtcCall=function(e,n){n=n||d,c.debug("[ClientApiHandler]: joinRtcCall...");var t={type:N.RTCCallActionType.JOIN,join:g(e)};T(N.ContentType.RTC_CALL,t,function(e,t){S(e,t,n)&&n(null)})},this.answerRtcCall=function(e,n){n=n||d,c.debug("[ClientApiHandler]: answerRtcCall...");var t={type:N.RTCCallActionType.ANSWER,answer:g(e)};T(N.ContentType.RTC_CALL,t,function(e,t){S(e,t,n)&&n(null)})},this.sendIceCandidates=function(e,n){n=n||d,c.debug("[ClientApiHandler]: sendIceCandidates...");var t={type:N.RTCCallActionType.ICE_CANDIDATES,iceCandidates:{rtcSessionId:e.rtcSessionId,userId:e.userId,origin:e.origin,candidates:e.candidates}};T(N.ContentType.RTC_CALL,t,function(e,t){S(e,t,n)&&n(null)})},this.leaveRtcCall=function(e,t,n){t=t||{},n=n||d,c.debug("[ClientApiHandler]: leaveRtcCall...");var i={type:N.RTCCallActionType.LEAVE,leave:{rtcSessionId:e,disconnectCause:t.cause,disconnectReason:t.reason}};T(N.ContentType.RTC_CALL,i,function(e,t){S(e,t,n)&&n(null)})},this.terminateRtcCall=function(e,t,n){t=t||{},n=n||d,c.debug("[ClientApiHandler]: terminateRtcCall...");var i={type:N.RTCCallActionType.TERMINATE,terminate:{rtcSessionId:e,disconnectCause:t.cause,disconnectReason:t.reason}};T(N.ContentType.RTC_CALL,i,function(e,t){S(e,t,n)&&n(null)})},this.declineRtcCall=function(e,n){n=n||d,c.debug("[ClientApiHandler]: declineRtcCall...");var t={type:N.RTCCallActionType.INVITE_REJECT,inviteReject:{convId:e.convId,rtcSessionId:e.rtcSessionId,cause:e.cause,transactionId:e.transactionId}};T(N.ContentType.RTC_CALL,t,function(e,t){S(e,t,n)&&n(null)})},this.changeMediaType=function(e,n){n=n||d,c.debug("[ClientApiHandler]: changeMediaType...");var t={type:N.RTCCallActionType.CHANGE_MEDIA_TYPE,changeMediaType:{rtcSessionId:e.rtcSessionId,sdp:e.sdp,mediaTypes:i(e.mediaType),transactionId:e.transactionId,screenSharePointerSupported:e.screenSharePointerSupported}};T(N.ContentType.RTC_CALL,t,function(e,t){S(e,t,n)&&n(null)})},this.changeMediaAccept=function(e,n){n=n||d,c.debug("[ClientApiHandler]: changeMediaAccept...");var t={type:N.RTCCallActionType.CHANGE_MEDIA_ACCEPT,changeMediaAccept:{rtcSessionId:e.rtcSessionId,sdp:e.sdp,transactionId:e.transactionId}};T(N.ContentType.RTC_CALL,t,function(e,t){S(e,t,n)&&n(null)})},this.changeMediaReject=function(e,n){n=n||d,c.debug("[ClientApiHandler]: changeMediaReject...");var t={type:N.RTCCallActionType.CHANGE_MEDIA_REJECT,changeMediaReject:{rtcSessionId:e.rtcSessionId,transactionId:e.transactionId}};T(N.ContentType.RTC_CALL,t,function(e,t){S(e,t,n)&&n(null)})},this.prepareSession=function(e,n){n=n||d,c.debug("[ClientApiHandler]: prepareSession... ");var t={type:N.RTCCallActionType.PREPARE,prepare:{convId:e.convId,rtcSessionId:e.rtcSessionId,ownerId:e.ownerId,mediaNode:e.mediaNode,desiredRegion:e.desiredRegion||"",isTelephonyConversation:e.isTelephonyConversation,replaces:e.replaces}};T(N.ContentType.RTC_CALL,t,function(e,t){S(e,t,n)&&n(null,t.rtcCall.prepare.servers,t.rtcCall.prepare.newRtcSessionId)},null,["response.rtcCall.prepare.servers.[].password"])},this.renewTurnCredentials=function(e,n){n=n||d,c.debug("[ClientApiHandler]: renewTurnCredentials... ");var t={type:N.RTCCallActionType.RENEW_TURN_CREDENTIALS,renewTurnCredentials:{rtcSessionId:e}};T(N.ContentType.RTC_CALL,t,function(e,t){S(e,t,n)&&n(null,t.rtcCall.renewTurnCredentials.servers)},null,["response.rtcCall.renewTurnCredentials.servers.[].password"])},this.sendProgress=function(e,t,n,i){i=i||d,c.debug("[ClientApiHandler]: sendProgress... ");var r={type:N.RTCCallActionType.SEND_PROGRESS,sendProgress:{rtcSessionId:e,userId:n,invitingUser:t||"",type:N.RTCProgressType.ALERTING}};T(N.ContentType.RTC_CALL,r,function(e,t){S(e,t,i)&&i(null)})},this.submitCallQualityRating=function(e,n){n=n||d,c.debug("[ClientApiHandler]: submitCallQualityRating...");var t={type:N.RTCCallActionType.SUBMIT_RTC_QUALITY_RATING,submitRtcQualityRating:{rating:e}};T(N.ContentType.RTC_CALL,t,function(e,t){S(e,t,n)&&n(null)})},this.requestScreenControl=function(e,n){if(n=n||d,c.debug("[ClientApiHandler]: requestScreenControl ..."),A("requestScreenControl",n)){var t={type:N.RTCSessionActionType.REQUEST_SCREEN_CONTROL,requestScreenControl:{rtcSessionId:e.rtcSessionId,ownerId:e.ownerId}};T(N.ContentType.RTC_SESSION,t,function(e,t){S(e,t,n)&&n(null)})}},this.offerScreenControl=function(e,n){if(n=n||d,c.debug("[ClientApiHandler]: offerScreenControl ..."),A("offerScreenControl",n)){var t={type:N.RTCSessionActionType.OFFER_SCREEN_CONTROL,offerScreenControl:{sdp:e.sdp,rtcSessionId:e.rtcSessionId,controllerId:e.controllerId||void 0}};T(N.ContentType.RTC_SESSION,t,function(e,t){S(e,t,n)&&n(null)})}},this.acceptScreenControl=function(e,n){if(n=n||d,c.debug("[ClientApiHandler]: acceptScreenControl ..."),A("acceptScreenControl",n)){var t={type:N.RTCSessionActionType.ACCEPT_SCREEN_CONTROL,acceptScreenControl:{sdp:e.sdp,rtcSessionId:e.rtcSessionId}};T(N.ContentType.RTC_SESSION,t,function(e,t){S(e,t,n)&&n(null)})}},this.rejectScreenControl=function(e,n){if(n=n||d,c.debug("[ClientApiHandler]: rejectScreenControl ..."),A("rejectScreenControl",n)){var t={type:N.RTCSessionActionType.REJECT_SCREEN_CONTROL,rejectScreenControl:{rtcSessionId:e.rtcSessionId}};T(N.ContentType.RTC_SESSION,t,function(e,t){S(e,t,n)&&n(null)})}},this.rejectScreenControlRequest=function(e,n){if(n=n||d,c.debug("[ClientApiHandler]: rejectScreenControlRequest ..."),A("rejectScreenControlRequest",n)){var t={type:N.RTCSessionActionType.REJECT_SCREEN_CONTROL_REQUEST,rejectScreenControlRequest:{rtcSessionId:e.rtcSessionId,controllerId:e.controllerId}};T(N.ContentType.RTC_SESSION,t,function(e,t){S(e,t,n)&&n(null)})}},this.stopScreenControl=function(e,n){if(n=n||d,c.debug("[ClientApiHandler]: stopScreenControl ..."),A("stopScreenControl",n)){var t={type:N.RTCSessionActionType.STOP_SCREEN_CONTROL,stopScreenControl:{rtcSessionId:e.rtcSessionId}};T(N.ContentType.RTC_SESSION,t,function(e,t){S(e,t,n)&&n(null)})}},this.lockRtcSession=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: lockRtcSession...");var i={type:N.RTCSessionActionType.LOCK,lock:{rtcSessionId:e,locked:!!t}};T(N.ContentType.RTC_SESSION,i,function(e,t){S(e,t,n)&&n(null)})},this.muteRtcSession=function(e,n){n=n||d,c.debug("[ClientApiHandler]: muteRtcSession...");var t={type:N.RTCSessionActionType.MUTE_SESSION,muteSession:{rtcSessionId:e.rtcSessionId,muted:!!e.muted,excludedUserIds:e.excludedUserIds||void 0}};T(N.ContentType.RTC_SESSION,t,function(e,t){S(e,t,n)&&n(null)})},this.muteParticipant=function(e,n){n=n||d,c.debug("[ClientApiHandler]: muteParticipant...");var t={type:N.RTCSessionActionType.MUTE,mute:{rtcSessionId:e.rtcSessionId,muted:!!e.muted,userIds:e.usersIds||void 0}};T(N.ContentType.RTC_SESSION,t,function(e,t){S(e,t,n)&&n(null)})},this.addParticipantToRtcSession=function(e,n){n=n||d,c.debug("[ClientApiHandler]: addParticipantToRtcCall...");var t={type:N.RTCSessionActionType.ADD_PARTICIPANT,addParticipant:{rtcSessionId:e.rtcSessionId,userId:e.userId,from:e.from,to:e.to,mediaType:i(e.mediaType)}};T(N.ContentType.RTC_SESSION,t,function(e,t){S(e,t,n)&&n(null)})},this.removeSessionParticipant=function(e,n){n=n||d,c.debug("[ClientApiHandler]: removeSessionParticipant...");var t={type:N.RTCSessionActionType.REMOVE_PARTICIPANT,removeParticipant:{rtcSessionId:e.rtcSessionId,userId:e.userId}};T(N.ContentType.RTC_SESSION,t,function(e,t){S(e,t,n)&&n(null)})},this.getActiveSessions=function(n){n=n||d,c.debug("[ClientApiHandler]: getActiveSessions...");var e={type:N.RTCSessionActionType.GET_ACTIVE_SESSIONS};T(N.ContentType.RTC_SESSION,e,function(e,t){S(e,t,n,!0)&&n(null,t.rtcSession.activeSessions.session)})},this.getSession=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getSession...");var t={type:N.RTCSessionActionType.GET_SESSION,getSession:{rtcSessionId:e}};T(N.ContentType.RTC_SESSION,t,function(e,t){S(e,t,n)&&n(null,t.rtcSession.getSession.session)})},this.moveRtcSession=function(e,n){n=n||d,c.debug("[ClientApiHandler]: moveRtcSession...");var t={type:N.RTCSessionActionType.MOVE,move:{oldRtcSessionId:e.sessionId,oldConversationId:e.conversationId,newConversationId:e.newConversationId,newRtcSessionId:e.newSessionId}};T(N.ContentType.RTC_SESSION,t,function(e,t){S(e,t,n)&&n(null)})},this.startRecording=function(e,n){n=n||d,c.debug("[ClientApiHandler]: startRecording...");var t={type:N.RTCSessionActionType.START_RECORDING,startRecording:{convId:e.convId,rtcSessionId:e.rtcSessionId,mediaTypes:i(e.mediaTypes)}};T(N.ContentType.RTC_SESSION,t,function(e,t){S(e,t,n)&&n(null)})},this.stopRecording=function(e,n){n=n||d,c.debug("[ClientApiHandler]: stopRecording...");var t={type:N.RTCSessionActionType.STOP_RECORDING,stopRecording:{convId:e.convId,rtcSessionId:e.rtcSessionId}};T(N.ContentType.RTC_SESSION,t,function(e,t){S(e,t,n)&&n(null)})},this.raiseQuestion=function(e,n){n=n||d,c.debug("[ClientApiHandler]: raiseQuestion...");var t={type:N.RTCSessionActionType.RAISE_QUESTION,raiseQuestion:e};T(N.ContentType.RTC_SESSION,t,function(e,t){S(e,t,n)&&n(null,t.rtcSession.raiseQuestion.questionNumber)},["request.rtcSession.raiseQuestion.question"])},this.inviteToStage=function(e,n){n=n||d,c.debug("[ClientApiHandler]: inviteToStage..."),e.allowedMediaTypes=i();var t={type:N.RTCSessionActionType.INVITE_TO_STAGE,inviteToStage:e};T(N.ContentType.RTC_SESSION,t,function(e,t){S(e,t,n)&&n(null)})},this.inviteToStageAnswer=function(e,n){n=n||d,c.debug("[ClientApiHandler]: inviteToStageAnswer...");var t={type:N.RTCSessionActionType.INVITE_TO_STAGE_ANSWER,inviteToStageAnswer:e};T(N.ContentType.RTC_SESSION,t,function(e,t){S(e,t,n)&&n(null)})},this.inviteToStageCancel=function(e,n){n=n||d,c.debug("[ClientApiHandler]: inviteToStageCancel...");var t={type:N.RTCSessionActionType.INVITE_TO_STAGE_CANCEL,inviteToStageCancel:e};T(N.ContentType.RTC_SESSION,t,function(e,t){S(e,t,n)&&n(null)})},this.removeFromStage=function(e,n){n=n||d,c.debug("[ClientApiHandler]: removeFromStage...");var t={type:N.RTCSessionActionType.REMOVE_FROM_STAGE,removeFromStage:e};T(N.ContentType.RTC_SESSION,t,function(e,t){S(e,t,n)&&n(null)})},this.getQuestions=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getQuestions...");var t={type:N.RTCSessionActionType.GET_QUESTIONS,getQuestions:e};T(N.ContentType.RTC_SESSION,t,function(e,t){S(e,t,n)&&n(null,t.rtcSession.getQuestions.questions)})},this.updateQuestionState=function(e,n){n=n||d,c.debug("[ClientApiHandler]: updateQuestionState...");var t={type:N.RTCSessionActionType.UPDATE_QUESTION_STATE,updateQuestionState:e};T(N.ContentType.RTC_SESSION,t,function(e,t){S(e,t,n)&&n(null)})},this.openCurtain=function(e,n){n=n||d,c.debug("[ClientApiHandler]: openCurtain...");var t={type:N.RTCSessionActionType.OPEN_CURTAIN,openCurtain:e};T(N.ContentType.RTC_SESSION,t,function(e,t){S(e,t,n)&&n(null)})},this.closeCurtain=function(e,n){n=n||d,c.debug("[ClientApiHandler]: closeCurtain...");var t={type:N.RTCSessionActionType.CLOSE_CURTAIN,closeCurtain:e};T(N.ContentType.RTC_SESSION,t,function(e,t){S(e,t,n)&&n(null)})},this.getNodeState=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getNodeState...");var t={type:N.RTCSessionActionType.GET_NODE_STATE,getNodeState:e};T(N.ContentType.RTC_SESSION,t,function(e,t){S(e,t,n,!0)&&n(null,t.rtcSession.getNodeState.nodeData)})},this.enableWhiteboard=function(e,n){n=n||d,c.debug("[ClientApiHandler]: enableWhiteboard...");var t={type:N.RTCSessionActionType.ENABLE_WHITEBOARD,enableWhiteboard:{rtcSessionId:e.rtcSessionId,viewbox:e.viewbox}};T(N.ContentType.RTC_SESSION,t,function(e,t){S(e,t,n,!0)&&n(null)})},this.disableWhiteboard=function(e,n){n=n||d,c.debug("[ClientApiHandler]: disableWhiteboard...");var t={type:N.RTCSessionActionType.DISABLE_WHITEBOARD,disableWhiteboard:e};T(N.ContentType.RTC_SESSION,t,function(e,t){S(e,t,n,!0)&&n(null)})},this.addWhiteboardElement=function(e,n){n=n||d,c.debug("[ClientApiHandler]: addWhiteboardElement...");var t={type:N.RTCSessionActionType.ADD_WHITEBOARD_ELEMENT,addWhiteboardElement:e};T(N.ContentType.RTC_SESSION,t,function(e,t){S(e,t,n,!0)&&n(null)})},this.removeWhiteboardElement=function(e,n){n=n||d,c.debug("[ClientApiHandler]: removeWhiteboardElement...");var t={type:N.RTCSessionActionType.REMOVE_WHITEBOARD_ELEMENT,removeWhiteboardElement:e};T(N.ContentType.RTC_SESSION,t,function(e,t){S(e,t,n,!0)&&n(null)})},this.updateWhiteboardElement=function(e,n){n=n||d,c.debug("[ClientApiHandler]: updateWhiteboardElement...");var t={type:N.RTCSessionActionType.UPDATE_WHITEBOARD_ELEMENT,updateWhiteboardElement:e};T(N.ContentType.RTC_SESSION,t,function(e,t){S(e,t,n,!0)&&n(null)})},this.clearWhiteboard=function(e,n){n=n||d,c.debug("[ClientApiHandler]: clearWhiteboard...");var t={type:N.RTCSessionActionType.CLEAR_WHITEBOARD,clearWhiteboard:e};T(N.ContentType.RTC_SESSION,t,function(e,t){S(e,t,n,!0)&&n(null)})},this.getWhiteboard=function(e,i){i=i||d,c.debug("[ClientApiHandler]: getWhiteboard...");var t={type:N.RTCSessionActionType.GET_WHITEBOARD,getWhiteboard:e};T(N.ContentType.RTC_SESSION,t,function(e,t){if(S(e,t,i)){var n=t.rtcSession.getWhiteboard.whiteboard;i(null,n)}})},this.setWhiteboardBackground=function(e,n){n=n||d,c.debug("[ClientApiHandler]: setWhiteboardBackground...");var t={type:N.RTCSessionActionType.SET_WHITEBOARD_BACKGROUND,setWhiteboardBackground:e};T(N.ContentType.RTC_SESSION,t,function(e,t){S(e,t,n)&&n(null)})},this.clearWhiteboardBackground=function(e,n){n=n||d,c.debug("[ClientApiHandler]: clearWhiteboardBackground...");var t={type:N.RTCSessionActionType.CLEAR_WHITEBOARD_BACKGROUND,clearWhiteboardBackground:e};T(N.ContentType.RTC_SESSION,t,function(e,t){S(e,t,n)&&n(null)})},this.toggleWhiteboardOverlay=function(e,n){n=n||d,c.debug("[ClientApiHandler]: toggleWhiteboardOverlay...");var t={type:N.RTCSessionActionType.TOGGLE_WHITEBOARD_OVERLAY,toggleWhiteboardOverlay:e};T(N.ContentType.RTC_SESSION,t,function(e,t){S(e,t,n)&&n(null)})},this.undoWhiteboard=function(e,n){n=n||d,c.debug("[ClientApiHandler]: undoWhiteboard...");var t={type:N.RTCSessionActionType.UNDO_WHITEBOARD,undoWhiteboard:e};T(N.ContentType.RTC_SESSION,t,function(e,t){S(e,t,n)&&n(null)})},this.sendClientInfo=function(e,n){n=n||d,c.debug("[ClientApiHandler]: sendClientInfo...");var t={type:N.RTCSessionActionType.SEND_CLIENT_INFO,sendClientInfo:{clientInfo:e}};T(N.ContentType.RTC_SESSION,t,function(e,t){S(e,t,n)&&n(null)})},this.submitClientData=function(e,i){i=i||d,c.debug("[ClientApiHandler]: submitClientData...");var t={type:N.InstrumentationActionType.SUBMIT_CLIENT_DATA,submitClientData:{instrumentationData:e}};T(N.ContentType.INSTRUMENTATION,t,function(e,t){if(S(e,t,i)){var n=t.instrumentation&&t.instrumentation.submitClientData&&t.instrumentation.submitClientData.submitDataResult;i(null,n||N.SubmitDataResult.OK)}})},this.submitQOSData=function(e,n){n=n||d,c.debug("[ClientApiHandler]: submitQOSData...");var t={type:N.InstrumentationActionType.SUBMIT_QOS_DATA,submitQOSData:{clientTime:Date.now(),dataSets:e}};T(N.ContentType.INSTRUMENTATION,t,function(e,t){S(e,t,n)&&n(null)})},this.getNotifications=function(e,t,i){i=i||d,c.debug("[ClientApiHandler]: getNotifications...");var n={type:N.ActivityStreamActionType.GET_ACTIVITIES_BY_USER,getActivitiesByUser:{timestamp:e,numberOfItems:t}};T(N.ContentType.ACTIVITYSTREAM,n,function(e,t){if(S(e,t,i,!0)){var n=t.activityStream.getActivitiesByUserResult;i(null,n)}})},this.toggleReadUnread=function(e,t,i){i=i||d,c.debug("[ClientApiHandler]: toggleReadUnread...");var n={type:N.ActivityStreamActionType.UPDATE_ACTIVITY_READ,updateActivityReadState:{activityId:e,read:t}};T(N.ContentType.ACTIVITYSTREAM,n,function(e,t){if(S(e,t,i)){var n=t.activityStream.updateResult;i(null,n.updatedItem)}})},this.markAllNotificationsAsRead=function(i){i=i||d,c.debug("[ClientApiHandler]: markAllNotificationsAsRead...");var e={type:N.ActivityStreamActionType.MARK_ALL_READ};T(N.ContentType.ACTIVITYSTREAM,e,function(e,t){if(S(e,t,i)){var n=t.activityStream.markAllReadResult;i(null,n)}})},this.getTenant=function(n){n=n||d,c.debug("[ClientApiHandler]: getTenant...");var e={type:N.AdministrationActionType.GET_TENANT};T(N.ContentType.ADMINISTRATION,e,function(e,t){S(e,t,n)&&n(null,t.administration.getTenant.tenant)})},this.addUser=function(e,n){n=n||d,c.debug("[ClientApiHandler]: addUser...");var t={type:N.AdministrationActionType.ADD_USER,addUser:{userAttributes:{emailAddress:e.emailAddress,lastName:e.lastName,firstName:e.firstName,locale:e.locale},password:e.password,packageId:e.packageId,accountTemplateId:e.accountTemplateId}};T(N.ContentType.ADMINISTRATION,t,function(e,t){S(e,t,n)&&n(null,t.administration.addUserResult.user)},["request.administration.addUser.password"])},this.addMeetingPointV2=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: addMeetingPointV2...");var i={type:N.AdministrationActionType.ADD_MEETING_POINT_V2,addMeetingPoint:{userAttributes:{emailAddress:e.emailAddress,lastName:e.lastName,firstName:e.firstName,locale:e.locale,location:e.location,registrationCodeTtl:e.timeout},packageId:e.packageId}};T(N.ContentType.ADMINISTRATION,i,function(e,t){S(e,t,n)&&n(null,t.administration.addMeetingPointV2Result)},null,["response.administration.addMeetingPointV2Result.registrationCode"],t)},this.updateMeetingPointV2=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: updateMeetingPointV2...");var i={type:N.AdministrationActionType.UPDATE_MEETING_POINT_V2,updateMeetingPoint:{userId:e.id,registrationCodeTtl:e.timeout}};T(N.ContentType.ADMINISTRATION,i,function(e,t){S(e,t,n)&&n(null,t.administration.updateMeetingPointV2Result.registrationCode)},null,["response.administration.updateMeetingPointV2Result.registrationCode"],t)},this.regenerateApiKey=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: regenerateApiKey...");var i={type:N.AdministrationActionType.REGENERATE_API_KEY,regenerateApiKey:{userId:e}};T(N.ContentType.ADMINISTRATION,i,function(e,t){S(e,t,n)&&n(null,t.administration.regenerateApiKey.apiKey)},null,["response.administration.regenerateApiKey.apiKey"],t)},this.deleteUser=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: deleteUser...");var i={type:N.AdministrationActionType.DELETE_USER,deleteUser:{userId:e}};T(N.ContentType.ADMINISTRATION,i,function(e,t){S(e,t,n)&&n(null)},null,null,t)},this.inviteUser=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: inviteUser...");var i={type:N.AdministrationActionType.INVITE_USER,inviteUser:{userAttributes:{emailAddress:e.userAttributes.emailAddress,lastName:e.userAttributes.lastName,firstName:e.userAttributes.firstName},packageId:e.packageId,accountTemplateId:e.accountTemplateId}};T(N.ContentType.ADMINISTRATION,i,function(e,t){S(e,t,n)&&n(null,t.administration.inviteUser.resultType)},null,null,t)},this.inviteMultipleUsers=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: inviteMultipleUsers...");var i={type:N.AdministrationActionType.INVITE_MULTIPLE_USERS,inviteMultipleUsers:e};T(N.ContentType.ADMINISTRATION,i,function(e,t){S(e,t,n)&&n(null)},null,null,t)},this.invitePartnerUsers=function(e,n){n=n||d,c.debug("[ClientApiHandler]: invitePartnerUsers...");var t={type:N.AdministrationActionType.INVITE_MULTIPLE_PARTNER_USERS,inviteMultiplePartnerUsers:{userAttributes:e}};T(N.ContentType.ADMINISTRATION,t,function(e,t){S(e,t,n)&&n(null)})},this.resendInvite=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: resendInvite...");var i={type:N.AdministrationActionType.RESEND_USER_INVITATION,resendUserInvitation:{userId:e}};T(N.ContentType.ADMINISTRATION,i,function(e,t){S(e,t,n)&&n(null,t.administration.resendUserInvitation.resultType)},null,null,t)},this.checkInvalidTenant=function(e,n){n=n||d,c.debug("[ClientApiHandler]: checkInvalidTenant...");var t={type:N.AdministrationActionType.CHECK_INVALID_TENANTS,checkInvalidTenants:{tenantIds:e}};T(N.ContentType.ADMINISTRATION,t,function(e,t){S(e,t,n,!0)&&n(null,t.administration.checkInvalidTenants.tenantIds)})},this.setTelephonyTrunkData=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: setTelephonyTrunkData...");var i={type:N.AdministrationActionType.SET_TELEPHONY_TRUNK_DATA,setTelephonyTrunkData:{defaultCallerId:e}};T(N.ContentType.ADMINISTRATION,i,function(e,t){S(e,t,n)&&n()},null,null,t)},this.getTelephonyTrunkStatus=function(n,e){n=n||d,c.debug("[ClientApiHandler]: getTelephonyTrunkStatus...");var t={type:N.AdministrationActionType.GET_TELEPHONY_TRUNK_STATUS};T(N.ContentType.ADMINISTRATION,t,function(e,t){S(e,t,n)&&n(null,t.administration.getTelephonyTrunkStatus)},null,null,e)},this.getTelephonyTrunkGroups=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: getTelephonyTrunkGroups..."),!e)return c.warn("[ClientApiHandler]: No query data provided"),void I(n,N.ReturnCode.INVALID_MESSAGE);var i={type:N.AdministrationActionType.GET_TELEPHONY_TRUNK_GROUPS,getTelephonyTrunkGroups:{pageSize:e.pageSize,pagePointer:e.pagePointer||void 0}};T(N.ContentType.ADMINISTRATION,i,function(e,t){S(e,t,n)&&n(null,t.administration.getTelephonyTrunkGroupsResult)},null,null,t)},this.getTelephonyTrunkGroup=function(e,n){if(n=n||d,c.debug("[ClientApiHandler]: getTelephonyTrunkGroup..."),!e)return c.warn("[ClientApiHandler]: No trunk group id provided"),void I(n,N.ReturnCode.INVALID_MESSAGE);var t={type:N.AdministrationActionType.GET_TELEPHONY_TRUNK_GROUP,getTelephonyTrunkGroup:{telephonyTrunkGroupId:e}};T(N.ContentType.ADMINISTRATION,t,function(e,t){S(e,t,n)&&n(null,t.administration.getTelephonyTrunkGroupResult)})},this.addTelephonyTrunkGroup=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: addTelephonyTrunkGroup..."),!e)return c.warn("[ClientApiHandler]: No trunk group data provided"),void I(n,N.ReturnCode.INVALID_MESSAGE);var i={type:N.AdministrationActionType.ADD_TELEPHONY_TRUNK_GROUP,addTelephonyTrunkGroup:{telephonyTrunkGroupName:e.telephonyTrunkGroupName,telephonyTrunkId:e.telephonyTrunkIds}};T(N.ContentType.ADMINISTRATION,i,function(e,t){S(e,t,n)&&n(null,t.administration.addTelephonyTrunkGroupResult)},null,null,t)},this.removeTelephonyTrunkGroup=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: removeTelephonyTrunkGroup..."),!e)return c.warn("[ClientApiHandler]: No trunk group id provided"),void I(n,N.ReturnCode.INVALID_MESSAGE);var i={type:N.AdministrationActionType.REMOVE_TELEPHONY_TRUNK_GROUP,removeTelephonyTrunkGroup:{telephonyTrunkGroupId:e}};T(N.ContentType.ADMINISTRATION,i,function(e,t){S(e,t,n)&&n(null,t.administration.removeTelephonyTrunkGroupResult.responseCode)},null,null,t)},this.updateTelephonyTrunkGroup=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: updateTelephonyTrunkGroup..."),!e)return c.warn("[ClientApiHandler]: No trunk group data provided"),void I(n,N.ReturnCode.INVALID_MESSAGE);var i={type:N.AdministrationActionType.UPDATE_TELEPHONY_TRUNK_GROUP,updateTelephonyTrunkGroup:{telephonyTrunkGroupId:e.telephonyTrunkGroupId,telephonyTrunkGroupName:e.telephonyTrunkGroupName,telephonyTrunkId:e.telephonyTrunkIds}};T(N.ContentType.ADMINISTRATION,i,function(e,t){S(e,t,n)&&n(null,t.administration.updateTelephonyTrunkGroupResult)},null,null,t)},this.getTenantBridgeNumbers=function(i,e){i=i||d,c.debug("[ClientApiHandler]: getTenantBridgeNumbers...");var t={type:N.AdministrationActionType.GET_TENANT_BRIDGE_NUMBERS};T(N.ContentType.ADMINISTRATION,t,function(e,t){if(S(e,t,i)){var n=t.administration.getTenantBridgeNumbers;i(null,n&&n.bridgeNumbers||[])}},null,null,e)},this.setTenantBridgeNumbers=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: setTenantBridgeNumbers...");var i={type:N.AdministrationActionType.SET_TENANT_BRIDGE_NUMBERS,setTenantBridgeNumbers:{bridgeNumbers:e}};T(N.ContentType.ADMINISTRATION,i,function(e,t){S(e,t,n)&&n()},null,null,t)},this.getTenantVoicemailNumbers=function(i,e){i=i||d,c.debug("[ClientApiHandler]: getTenantVoicemailNumbers...");var t={type:N.AdministrationActionType.GET_TENANT_VOICEMAIL_NUMBERS};T(N.ContentType.ADMINISTRATION,t,function(e,t){if(S(e,t,i,!0)){var n=t.administration.getTenantVoicemailNumbersResult;i(null,n&&n.voicemailNumber||[])}},null,null,e)},this.setTenantVoicemailNumbers=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: setTenantVoicemailNumbers...");var i={type:N.AdministrationActionType.SET_TENANT_VOICEMAIL_NUMBERS,setTenantVoicemailNumbers:{voicemailNumber:e}};T(N.ContentType.ADMINISTRATION,i,function(e,t){S(e,t,n)&&n()},null,null,t)},this.exportUserList=function(e,n){n=n||d,c.debug("[ClientApiHandler]: exportUserList..."),e&&!Array.isArray(e)&&(e=[e]);var t={type:N.AdministrationActionType.EXPORT_TENANT,exportTenant:{exportFormats:e}};T(N.ContentType.ADMINISTRATION,t,function(e,t){S(e,t,n)&&n(null)})},this.addAutoConfigurableTrunk=function(n,e){n=n||d,c.debug("[ClientApiHandler]: addAutoConfigurableTrunk...");var t={type:N.AdministrationActionType.ADD_TRUNK_WITHOUT_PARAMETERS};T(N.ContentType.ADMINISTRATION,t,function(e,t){S(e,t,n)&&n(null,t.administration.addTrunk.configuration)},null,null,e)},this.getTenantTelephonyConfiguration=function(n,e){n=n||d,c.debug("[ClientApiHandler]: getTenantTelephonyConfiguration...");var t={type:N.AdministrationActionType.GET_TENANT_TELEPHONY_CONFIGURATION};T(N.ContentType.ADMINISTRATION,t,function(e,t){S(e,t,n)&&n(null,t.administration.getTenantTelephonyConfiguration.configuration)},null,["response.administration.getTenantTelephonyConfiguration.configuration.apiKey"],e)},this.getTelephonyRoutingRules=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: getTelephonyRoutingRules...");var i={type:N.AdministrationActionType.GET_TELEPHONY_ROUTING_RULES,getTelephonyRoutingRules:{pageSize:e.pageSize,pagePointer:e.pagePointer}};T(N.ContentType.ADMINISTRATION,i,function(e,t){S(e,t,n)&&n(null,t.administration.getTelephonyRoutingRulesResult)},null,null,t)},this.addTelephonyRoutingRule=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: addTelephonyRoutingRule...");var i={type:N.AdministrationActionType.ADD_TELEPHONY_ROUTING_RULE,addTelephonyRoutingRule:{telephonyRoutingRule:{routePosition:e.routePosition,condition1:e.condition1,gtcUserId:e.gtcUserId,gtcUserGroupId:e.gtcUserGroupId,operator:e.operator||void 0,condition2:e.condition2||void 0,application:e.application||void 0}}};T(N.ContentType.ADMINISTRATION,i,function(e,t){S(e,t,n)&&n(null)},null,null,t)},this.updateTelephonyRoutingRule=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: updateTelephonyRoutingRule...");var i={type:N.AdministrationActionType.UPDATE_TELEPHONY_ROUTING_RULE,updateTelephonyRoutingRule:{telephonyRoutingRule:{routePosition:e.routePosition,condition1:e.condition1,gtcUserId:e.gtcUserId,gtcUserGroupId:e.gtcUserGroupId,routeId:e.routeId||void 0,operator:e.operator||void 0,condition2:e.condition2||void 0,application:e.application||void 0}}};T(N.ContentType.ADMINISTRATION,i,function(e,t){S(e,t,n)&&n(null)},null,null,t)},this.removeTelephonyRoutingRule=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: removeTelephonyRoutingRule...");var i={type:N.AdministrationActionType.REMOVE_TELEPHONY_ROUTING_RULE,removeTelephonyRoutingRule:{telephonyRoutingRuleId:e}};T(N.ContentType.ADMINISTRATION,i,function(e,t){S(e,t,n)&&n(null)},null,null,t)},this.testTelephonyRoutingRules=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: testTelephonyRoutingRule...");var i={type:N.AdministrationActionType.TEST_TELEPHONY_ROUTING_RULES,testTelephonyRoutingRules:{destination:e.destination,origin:e.origin||void 0,application:e.application||void 0,considerTelephonyConnectorsStates:!!e.considerTelephonyConnectorsStates}};T(N.ContentType.ADMINISTRATION,i,function(e,t){S(e,t,n)&&n(null,t.administration.testTelephonyRoutingRulesResult)},null,null,t)},this.updateTenantTelephonyConfiguration=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: updateTenantTelephonyConfiguration...");var i={type:N.AdministrationActionType.UPDATE_TENANT_TELEPHONY_CONFIGURATION,updateTenantTelephonyConfiguration:{defaultRouting:e}};T(N.ContentType.ADMINISTRATION,i,function(e,t){S(e,t,n)&&n(null)},null,null,t)},this.setTrunkPassword=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: setTrunkPassword...");var i={type:N.AdministrationActionType.SET_TRUNK_PASSWORD,setTrunkPassword:{trunkId:e,password:t}};T(N.ContentType.ADMINISTRATION,i,function(e,t){S(e,t,n)&&n(null)},["request.administration.setTrunkPassword.password"])},this.updateTrunk=function(e,n){n=n||d,c.debug("[ClientApiHandler]: updateTrunk...");var t={type:N.AdministrationActionType.UPDATE_TRUNK,updateTrunk:{trunkId:e.gtcUserId,displayName:e.gtcTrunkName,defaultCallerId:e.defaultCallerId}};T(N.ContentType.ADMINISTRATION,t,function(e,t){S(e,t,n)&&n(null)})},this.setTenantSettings=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: setTenantSettings...");var i={type:N.AdministrationActionType.SET_TENANT_SETTINGS,setTenantSettings:{tenantSettings:e}};T(N.ContentType.ADMINISTRATION,i,function(e,t){S(e,t,n)&&n(null)},null,null,t)},this.updateTenantName=function(e,n){n=n||d,c.debug("[ClientApiHandler]: updateTenantName...");var t={type:N.AdministrationActionType.UPDATE_TENANT,updateTenant:{companyName:e}};T(N.ContentType.ADMINISTRATION,t,function(e,t){S(e,t,n)&&n(null)})},this.getTenantLoginProviders=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getTenantLoginProviders...");var t={type:N.AdministrationActionType.GET_ALL_TENANT_LOGIN_PROVIDERS,getAllTenantLoginProviders:{tenantId:e}};T(N.ContentType.ADMINISTRATION,t,function(e,t){S(e,t,n,!0)&&n(null,t.administration.getAllTenantLoginProvidersResult.tenantLoginProvidersList||[])})},this.addTenantLoginProvider=function(e,n){n=n||d,c.debug("[ClientApiHandler]: addTenantLoginProvider...");var t={type:N.AdministrationActionType.SAVE_TENANT_LOGIN_PROVIDER,saveTenantLoginProvider:{loginProvider:e}};T(N.ContentType.ADMINISTRATION,t,function(e,t){S(e,t,n)&&n(null,t.administration.saveTenantLoginProviderResult.storedProvider)})},this.updateTenantLoginProvider=function(e,n){n=n||d,c.debug("[ClientApiHandler]: updateTenantLoginProvider...");var t={type:N.AdministrationActionType.UPDATE_TENANT_LOGIN_PROVIDER,updateTenantLoginProvider:{loginProvider:e}};T(N.ContentType.ADMINISTRATION,t,function(e,t){S(e,t,n)&&n(null,t.administration.updateTenantLoginProviderResult.updatedLoginProvider)})},this.deleteTenantLoginProvider=function(e,n){n=n||d,c.debug("[ClientApiHandler]: deleteTenantLoginProvider...");var t={type:N.AdministrationActionType.DELETE_TENANT_LOGIN_PROVIDER,deleteTenantLoginProvider:{providerId:e.providerId,tenantId:e.tenantId}};T(N.ContentType.ADMINISTRATION,t,function(e,t){S(e,t,n)&&n(null,t.administration.deleteTenantLoginProviderResult)})},this.getOpenScapeUser=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: getOpenScapeUser..."),!e)return c.warn("[ClientApiHandler]: No dn was provided"),void I(n,N.ReturnCode.INVALID_MESSAGE);var i={type:N.AdministrationActionType.GET_OPENSCAPE_USER,getOpenScapeUser:{directoryNumber:e}};T(N.ContentType.ADMINISTRATION,i,function(e,t){S(e,t,n)&&n(null,t.administration.getOpenScapeUserResult)},null,["response.administration.getOpenScapeUserResult.user.cloudPin","response.administration.getOpenScapeUserResult.user.securityPin"],t)},this.getOpenScapeUserV2=function(e,t,n,i){if(n=n||d,c.debug("[ClientApiHandler]: getOpenScapeUserV2..."),!e)return c.warn("[ClientApiHandler]: No dn was provided"),void I(n,N.ReturnCode.INVALID_MESSAGE);if(!t)return c.warn("[ClientApiHandler]: No circuitUserId was provided"),void I(n,N.ReturnCode.INVALID_MESSAGE);var r={type:N.AdministrationActionType.GET_OPENSCAPE_USER_V2,getV2OpenScapeUser:{directoryNumber:e,circuitUserId:t}};T(N.ContentType.ADMINISTRATION,r,function(e,t){S(e,t,n)&&n(null,t.administration.getOpenScapeUserResult)},null,["response.administration.getOpenScapeUserResult.user.cloudPin","response.administration.getOpenScapeUserResult.user.securityPin"],i)},this.getVacantHomeDirectoryNumbers=function(n,e){n=n||d,c.debug("[ClientApiHandler]: getVacantHomeDirectoryNumbers...");var t={type:N.AdministrationActionType.GET_VACANT_HOME_DIRECTORY_NUMBERS,getVacantHomeDirectoryNumbers:{}};T(N.ContentType.ADMINISTRATION,t,function(e,t){S(e,t,n)&&n(null,t.administration.getVacantHomeDirectoryNumbersResult.directoryNumbers)},null,null,e)},this.createOpenScapeUser=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: createOpenScapeUser..."),!e)return c.warn("[ClientApiHandler]: No user data were provided"),void I(n,N.ReturnCode.INVALID_MESSAGE);var i={type:N.AdministrationActionType.CREATE_OPENSCAPE_USER,createOpenScapeUser:{circuitUserId:e.circuitUserId,directoryNumber:e.directoryNumber,extension:e.extension,dialingPermission:e.dialingPermission,announcementsLanguage:e.announcementsLanguage,deviceDisplayLanguage:e.deviceDisplayLanguage,timeZone:e.timeZone,hasDevice:e.hasDevice}};T(N.ContentType.ADMINISTRATION,i,function(e,t){S(e,t,n)&&n(null,t.administration.createOpenScapeUserResult)},null,null,t)},this.updateOpenScapeUser=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: updateOpenScapeUser..."),!e)return c.warn("[ClientApiHandler]: No user data were provided"),void I(n,N.ReturnCode.INVALID_MESSAGE);var i={type:N.AdministrationActionType.UPDATE_OPENSCAPE_USER,updateOpenScapeUser:{directoryNumber:e.directoryNumber,extension:e.extension,dialingPermission:e.dialingPermission,announcementsLanguage:e.announcementsLanguage,deviceDisplayLanguage:e.deviceDisplayLanguage,timeZone:e.timeZone,hasDevice:e.hasDevice,circuitUserId:e.circuitUserId}};T(N.ContentType.ADMINISTRATION,i,function(e,t){S(e,t,n)&&n(null,t.administration.updateOpenScapeUserResult)},null,null,t)},this.deleteOpenScapeUser=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: deleteOpenScapeUser..."),!e||!e.userId||!e.dn)return c.warn("[ClientApiHandler]: User id or dn was not provided"),void I(n,N.ReturnCode.INVALID_MESSAGE);var i={type:N.AdministrationActionType.DELETE_OPENSCAPE_USER,deleteOpenScapeUser:{userId:e.userId,directoryNumber:e.dn}};T(N.ContentType.ADMINISTRATION,i,function(e,t){S(e,t,n)&&n(null,t.administration.deleteOpenScapeUserResult)},null,null,t)},this.createOpenScapeSite=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: createOpenScapeSite..."),!e)return c.warn("[ClientApiHandler]: No site data were provided"),void I(n,N.ReturnCode.INVALID_MESSAGE);var i={type:N.AdministrationActionType.CREATE_OPENSCAPE_SITE,createOpenScapeSite:{site:e}};T(N.ContentType.ADMINISTRATION,i,function(e,t){S(e,t,n)&&n(null,t.administration.createOpenScapeSiteResult.site)},null,null,t)},this.getOpenScapeSite=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: getOpenScapeSite..."),!e)return c.warn("[ClientApiHandler]: No siteId was provided"),void I(n,N.ReturnCode.INVALID_MESSAGE);var i={type:N.AdministrationActionType.GET_OPENSCAPE_SITE,getOpenScapeSite:{siteId:e}};T(N.ContentType.ADMINISTRATION,i,function(e,t){S(e,t,n)&&n(null,t.administration.getOpenScapeSiteResult.site)},null,null,t)},this.updateOpenScapeSite=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: updateOpenScapeSite..."),!e)return c.warn("[ClientApiHandler]: No site data were provided"),void I(n,N.ReturnCode.INVALID_MESSAGE);var i={type:N.AdministrationActionType.UPDATE_OPENSCAPE_SITE,updateOpenScapeSite:{site:e}};T(N.ContentType.ADMINISTRATION,i,function(e,t){S(e,t,n)&&n(null,t.administration.updateOpenScapeSiteResult.site)},null,null,t)},this.deleteOpenScapeSites=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: deleteOpenScapeSites...");var i={type:N.AdministrationActionType.DELETE_OPENSCAPE_SITES,deleteOpenScapeSites:{sites:e}};T(N.ContentType.ADMINISTRATION,i,function(e,t){S(e,t,n)&&n(null)},null,null,t)},this.deleteOpenScapePublicRange=function(e,t,n,i){n=n||d,c.debug("[ClientApiHandler]: deleteOpenScapePublicRange...");var r={type:N.AdministrationActionType.DELETE_PUBLIC_NUMBER_RANGE,deletePublicNumberRange:{siteId:e,rangeId:t}};T(N.ContentType.ADMINISTRATION,r,function(e,t){S(e,t,n)&&n(null)},null,null,i)},this.deleteOpenScapePrivateRange=function(e,t,n,i){n=n||d,c.debug("[ClientApiHandler]: deleteOpenScapePrivateRange...");var r={type:N.AdministrationActionType.DELETE_PRIVATE_NUMBER_RANGE,deletePrivateNumberRange:{siteId:e,rangeId:t}};T(N.ContentType.ADMINISTRATION,r,function(e,t){S(e,t,n)&&n(null)},null,null,i)},this.getOpenScapeTenant=function(n,e){n=n||d,c.debug("[ClientApiHandler]: getOpenScapeTenant...");var t={type:N.AdministrationActionType.GET_OPENSCAPE_TENANT,getOpenScapeTenant:{}};T(N.ContentType.ADMINISTRATION,t,function(e,t){S(e,t,n)&&n(null,t.administration.getOpenScapeTenantResult.tenant)},null,null,e)},this.getAutomatedAttendantConfiguration=function(i,e){i=i||d,c.debug("[ClientApiHandler]: getAutomatedAttendantConfiguration...");var t={type:N.AdministrationActionType.GET_AUTOMATEDATTENDANT_CONFIGURATION};T(N.ContentType.ADMINISTRATION,t,function(e,t){if(S(e,t,i,!0)){var n=t.administration.getAutomatedAttendantConfigurationResult;i(null,n.configuration||[])}},null,null,e)},this.setAutomatedAttendantConfiguration=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: setAutomatedAttendantConfiguration..."),!e)return c.warn("[ClientApiHandler]: No configuration were provided"),void I(n,N.ReturnCode.INVALID_MESSAGE);var i={type:N.AdministrationActionType.SET_AUTOMATEDATTENDANT_CONFIGURATION,setAutomatedAttendantConfiguration:{configuration:e}};T(N.ContentType.ADMINISTRATION,i,function(e,t){S(e,t,n)&&n(null)},null,null,t)},this.getManageableTenants=function(n){n=n||d,c.debug("[ClientApiHandler]: getManageableTenants...");var e={type:N.AdministrationActionType.GET_PARTNER_MANAGEABLE_TENANTS};T(N.ContentType.ADMINISTRATION,e,function(e,t){S(e,t,n,!0)&&n(null,t.administration.getPartnerManageableTenantResult.tenants)})},this.getCMRSettings=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getCMRSettings...");var t={type:N.AdministrationActionType.GET_CMR_SETTINGS,getCMRSettings:{userId:e}};T(N.ContentType.ADMINISTRATION,t,function(e,t){S(e,t,n,!0)&&n(e,t.administration.getCMRSettingsResult.settings)})},this.setCMRSettings=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: setCMRSettings...");var i={type:N.AdministrationActionType.SET_CMR_SETTINGS,setCMRSettings:{userId:e,settings:t}};T(N.ContentType.ADMINISTRATION,i,function(e,t){S(e,t,n)&&n(null)})},this.getHuntGroups=function(n,e){if(n=n||d,c.debug("[ClientApiHandler]: getHuntGroups..."),!this.isHuntGroupsSupported())return c.warn("[ClientApiHandler]: The getHuntGroups operation is not supported by the backend"),void I(n,N.ReturnCode.OPERATION_NOT_SUPPORTED);var t={type:N.AdministrationActionType.GET_TENANT_HUNT_GROUPS,getTenantHuntGroups:{}};T(N.ContentType.ADMINISTRATION,t,function(e,t){S(e,t,n,!0)&&n(null,t.administration.getTenantHuntGroupsResult.queryHuntGroupResponse||[])},null,null,e)},this.createHuntGroup=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: createHuntGroup..."),!this.isHuntGroupsSupported())return c.warn("[ClientApiHandler]: The createHuntGroup operation is not supported by the backend"),void I(n,N.ReturnCode.OPERATION_NOT_SUPPORTED);if(!e)return c.warn("[ClientApiHandler]: No hunt group data were provided"),void I(n,N.ReturnCode.INVALID_MESSAGE);var i={type:N.AdministrationActionType.CREATE_HUNT_GROUP,createHuntGroup:{huntGroup:e}};T(N.ContentType.ADMINISTRATION,i,function(e,t){S(e,t,n)&&n(null,t.administration.createHuntGroupResult.huntGroup)},null,null,t)},this.deleteHuntGroup=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: deleteHuntGroup..."),!this.isHuntGroupsSupported())return c.warn("[ClientApiHandler]: The deleteHuntGroup operation is not supported by the backend"),void I(n,N.ReturnCode.OPERATION_NOT_SUPPORTED);if(!e||!e.length)return c.warn("[ClientApiHandler]: No hunt group pilot DNs were provided"),void I(n,N.ReturnCode.INVALID_MESSAGE);var i={type:N.AdministrationActionType.DELETE_HUNT_GROUP,deleteHuntGroup:{huntGroupPilots:e}};T(N.ContentType.ADMINISTRATION,i,function(e,t){S(e,t,n)&&n(null)},null,null,t)},this.getHuntGroupPilotDNs=function(n,e){if(n=n||d,c.debug("[ClientApiHandler]: getHuntGroupPilotDNs..."),!this.isHuntGroupsSupported())return c.warn("[ClientApiHandler]: The getHuntGroupPilotDNs operation is not supported by the backend"),void I(n,N.ReturnCode.OPERATION_NOT_SUPPORTED);var t={type:N.AdministrationActionType.GET_HUNT_GROUP_PILOT_CANDIDATES,getHuntGroupPilotCandidates:{}};T(N.ContentType.ADMINISTRATION,t,function(e,t){S(e,t,n,!0)&&n(null,t.administration.getHuntGroupPilotCandidatesResult.huntGroupUsers||[])},null,null,e)},this.getHuntGroupMemberDNs=function(n,e){if(n=n||d,c.debug("[ClientApiHandler]: getHuntGroupMemberDNs..."),!this.isHuntGroupsSupported())return c.warn("[ClientApiHandler]: The getHuntGroupMemberDNs operation is not supported by the backend"),void I(n,N.ReturnCode.OPERATION_NOT_SUPPORTED);var t={type:N.AdministrationActionType.GET_HUNT_GROUP_MEMBER_CANDIDATES,getHuntGroupMemberCandidates:{}};T(N.ContentType.ADMINISTRATION,t,function(e,t){S(e,t,n,!0)&&n(null,t.administration.getHuntGroupMemberCandidatesResult.huntGroupUsers||[])},null,null,e)},this.getHuntGroup=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: getHuntGroup..."),!this.isHuntGroupsSupported())return c.warn("[ClientApiHandler]: The getHuntGroup operation is not supported by the backend"),void I(n,N.ReturnCode.OPERATION_NOT_SUPPORTED);if(!e)return c.warn("[ClientApiHandler]: Hunt group pilot DN was not provided"),void I(n,N.ReturnCode.INVALID_MESSAGE);var i={type:N.AdministrationActionType.GET_HUNT_GROUP,getHuntGroup:{pilotDn:e}};T(N.ContentType.ADMINISTRATION,i,function(e,t){S(e,t,n)&&n(null,t.administration.getHuntGroupResult.huntGroup)},null,null,t)},this.updateHuntGroup=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: updateHuntGroup..."),!this.isHuntGroupsSupported())return c.warn("[ClientApiHandler]: The updateHuntGroup operation is not supported by the backend"),void I(n,N.ReturnCode.OPERATION_NOT_SUPPORTED);if(!e)return c.warn("[ClientApiHandler]: No hunt group data were provided"),void I(n,N.ReturnCode.INVALID_MESSAGE);var i={type:N.AdministrationActionType.UPDATE_HUNT_GROUP,updateHuntGroup:{updatedHuntGroup:e}};T(N.ContentType.ADMINISTRATION,i,function(e,t){S(e,t,n)&&n(null,t.administration.updateHuntGroupResult.huntGroup)},null,null,t)},this.getSystemNotifications=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: getSystemNotifications..."),!this.isSystemNotificationsSupported())return c.warn("[ClientApiHandler]: The getSystemNotifications operation is not supported by the backend"),void I(n,N.ReturnCode.OPERATION_NOT_SUPPORTED);var i={type:N.AdministrationActionType.GET_SYSTEM_NOTIFICATIONS,getSystemNotifications:{systemNotificationType:e}};T(N.ContentType.ADMINISTRATION,i,function(e,t){S(e,t,n,!0)&&n(null,t.administration.getSystemNotificationsResult.systemNotifications||[])},null,["response.administration.getSystemNotificationsResult.systemNotifications.[].broadcastText"],t)},this.addSystemNotification=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: addSystemNotification..."),!this.isSystemNotificationsSupported())return c.warn("[ClientApiHandler]: The addSystemNotification operation is not supported by the backend"),void I(n,N.ReturnCode.OPERATION_NOT_SUPPORTED);var i={type:N.AdministrationActionType.ADD_SYSTEM_NOTIFICATION,addSystemNotification:{type:e.type,startTime:e.startTime,endTime:e.endTime,broadcastText:e.broadcastText}};T(N.ContentType.ADMINISTRATION,i,function(e,t){S(e,t,n)&&n(null,t.administration.addSystemNotificationResult.systemNotification)},["request.administration.addSystemNotification.broadcastText"],["response.administration.addSystemNotificationResult.systemNotification.broadcastText"],t)},this.removeSystemNotification=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: removeSystemNotification..."),!this.isSystemNotificationsSupported())return c.warn("[ClientApiHandler]: The removeSystemNotification operation is not supported by the backend"),void I(n,N.ReturnCode.OPERATION_NOT_SUPPORTED);var i={type:N.AdministrationActionType.REMOVE_SYSTEM_NOTIFICATION,removeSystemNotification:{id:e}};T(N.ContentType.ADMINISTRATION,i,function(e,t){S(e,t,n)&&n(null)},null,null,t)},this.updateSystemNotification=function(e,n,t){if(n=n||d,c.debug("[ClientApiHandler]: updateSystemNotification..."),!this.isSystemNotificationsSupported())return c.warn("[ClientApiHandler]: The updateSystemNotification operation is not supported by the backend"),void I(n,N.ReturnCode.OPERATION_NOT_SUPPORTED);var i={type:N.AdministrationActionType.UPDATE_SYSTEM_NOTIFICATION,updateSystemNotification:{id:e.id,startTime:e.startTime,endTime:e.endTime,broadcastText:e.broadcastText}};T(N.ContentType.ADMINISTRATION,i,function(e,t){S(e,t,n)&&n(null,t.administration.updateSystemNotificationResult.systemNotification)},["request.administration.updateSystemNotification.broadcastText"],["response.administration.updateSystemNotificationResult.systemNotification.broadcastText"],t)},this.getApplicationsList=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getApplicationsList...");var t={type:N.AdministrationActionType.GET_CUSTOM_APPS,getCustomApps:{tenantId:e}};T(N.ContentType.ADMINISTRATION,t,function(e,t){S(e,t,n,!0)&&n(null,t.administration.getCustomApps.customApps)})},this.createApplication=function(e,t,n,i){if(i=i||d,c.debug("[ClientApiHandler]: createApplication..."),!e)return c.warn("[ClientApiHandler]: No application data were provided"),void I(i,N.ReturnCode.INVALID_MESSAGE);var r={type:N.AdministrationActionType.ADD_CUSTOM_APP,addCustomApp:{customApp:e,smallLogo:t,largeLogo:n}};T(N.ContentType.ADMINISTRATION,r,function(e,t){S(e,t,i)&&i(null,t.administration.addCustomAppResult)})},this.getExchangeSettings=function(n){n=n||d,c.debug("[ClientApiHandler]: getExchangeSettings...");var e={type:N.ThirdPartyConnectorsActionType.GET_SETTINGS,getSettings:{type:N.ThirdPartyConnectorType.EXCHANGE_CONNECTOR}};T(N.ContentType.THIRDPARTYCONNECTORS,e,function(e,t){S(e,t,n)&&n(null,t.thirdpartyconnectors.getSettings.exchange)},null,["response.thirdpartyconnectors.getSettings.exchange"])},this.saveExchangeSettings=function(e,n){n=n||d,c.debug("[ClientApiHandler]: saveExchangeSettings..."),C&&(e.encryptionKey=String(Date.now()));var t={type:N.ThirdPartyConnectorsActionType.SAVE_SETTINGS,saveSettings:{type:N.ThirdPartyConnectorType.EXCHANGE_CONNECTOR,exchange:e}};T(N.ContentType.THIRDPARTYCONNECTORS,t,function(e,t){S(e,t,n)&&n(null,t.thirdpartyconnectors.saveSettings.exchange)},["request.thirdpartyconnectors.saveSettings.exchange"],["response.thirdpartyconnectors.saveSettings.exchange"])},this.saveOpenXchangeSettings=function(e,n){n=n||d,c.debug("[ClientApiHandler]: saveOpenXchangeSettings...");var t={type:N.ThirdPartyConnectorsActionType.SAVE_SETTINGS,saveSettings:{type:N.ThirdPartyConnectorType.OPEN_XCHANGE,openXchange:e}};T(N.ContentType.THIRDPARTYCONNECTORS,t,function(e,t){S(e,t,n)&&n(null,t.thirdpartyconnectors.saveSettings.openXchange)},["request.thirdpartyconnectors.saveSettings.openXchange"],["response.thirdpartyconnectors.saveSettings.openXchange"])},this.getThirdpartyProviderSettings=function(e,n){if(n=n||d,e=e||{},c.debug("[ClientApiHandler]: getThirdpartyProviderSettings..."),C)I(n,null,{encryptionKey:e.emailAddress});else{var t={type:N.ThirdPartyConnectorsActionType.GET_SETTINGS,getSettings:{type:N.ThirdPartyConnectorType.CLIENT_THIRDPARTY}};T(N.ContentType.THIRDPARTYCONNECTORS,t,function(e,t){S(e,t,n)&&n(null,t.thirdpartyconnectors.getSettings.clientThirdparty)},null,["response.thirdpartyconnectors.getSettings.clientThirdparty"])}},this.saveThirdpartyProviderSettings=function(e,n){if(n=n||d,e=e||{},c.debug("[ClientApiHandler]: saveThirdpartyProviderSettings..."),C)I(n,null,{encryptionKey:e.emailAddress});else{var t={type:N.ThirdPartyConnectorsActionType.SAVE_SETTINGS,saveSettings:{type:N.ThirdPartyConnectorType.CLIENT_THIRDPARTY,clientThirdparty:{encryptionKey:""}}};T(N.ContentType.THIRDPARTYCONNECTORS,t,function(e,t){S(e,t,n)&&n(null,t.thirdpartyconnectors.saveSettings.clientThirdparty)},["request.thirdpartyconnectors.saveSettings.clientThirdparty.encryptionKey"],["response.thirdpartyconnectors.saveSettings.clientThirdparty.encryptionKey"])}},this.connectToThirdParty=function(e,n){var t;switch(n=n||d,c.debug("[ClientApiHandler]: connectToThirdParty "+e+"..."),e){case N.ThirdPartyConnectorType.BOX:case N.ThirdPartyConnectorType.SYNCPLICITY:case N.ThirdPartyConnectorType.GOOGLE_DRIVE:case N.ThirdPartyConnectorType.ONE_DRIVE:t={type:N.ThirdPartyConnectorsActionType.CONNECT,connect:{type:e}};break;default:return void I(n,N.ThirdPartyError.UNSUPPORTED_PROVIDER)}T(N.ContentType.THIRDPARTYCONNECTORS,t,function(e,t){S(e,t,n)&&(t.thirdpartyconnectors.connect?n(null,t.thirdpartyconnectors.connect.authorizeUrl):n(N.ThirdPartyError.UNSUPPORTED_PROVIDER))},null,["response.thirdpartyconnectors.connect.authorizeUrl"])},this.refreshConnectionToThirdParty=function(e,t,n){var i;switch(n=n||d,c.debug("[ClientApiHandler]: refreshConnectionToThirdParty "+e+"..."),e){case N.ThirdPartyConnectorType.SYNCPLICITY:i={type:N.ThirdPartyConnectorsActionType.REFRESH_CONNECTION,refreshConnection:{type:e,refreshToken:t}};break;default:return void I(n,N.ThirdPartyError.UNSUPPORTED_PROVIDER)}T(N.ContentType.THIRDPARTYCONNECTORS,i,function(e,t){S(e,t,n)&&(t.thirdpartyconnectors.refreshConnectionResult?n(null,t.thirdpartyconnectors.refreshConnectionResult):n(N.ThirdPartyError.UNSUPPORTED_PROVIDER))},["request.thirdpartyconnectors.refreshConnection.refreshToken"],["response.thirdpartyconnectors.refreshConnection.accessToken","response.thirdpartyconnectors.refreshConnection.refreshToken"])},this.getFolderItems=function(n,i){var e;switch(i=i||d,c.debug("[ClientApiHandler]: getFolderItems for ",n.provider),n.provider){case N.ThirdPartyConnectorType.BOX:case N.ThirdPartyConnectorType.OPEN_XCHANGE:e={type:N.ThirdPartyConnectorsActionType.GET_FOLDER_ITEMS,getFolderItems:{type:n.provider,id:n.folderId,index:n.indexCursor,pageSize:n.pageSize}};break;case N.ThirdPartyConnectorType.GOOGLE_DRIVE:case N.ThirdPartyConnectorType.ONE_DRIVE:case N.ThirdPartyConnectorType.SYNCPLICITY:e={type:N.ThirdPartyConnectorsActionType.GET_FOLDER_ITEMS_WITH_CURSOR,getFolderItemsWithCursor:{type:n.provider,syncpointId:n.syncpointId||void 0,id:n.folderId,cursor:n.indexCursor,pageSize:n.pageSize,accessToken:n.accessToken||void 0}};break;default:return void I(i,N.ThirdPartyError.UNSUPPORTED_PROVIDER)}T(N.ContentType.THIRDPARTYCONNECTORS,e,function(e,t){S(e,t,i)&&i(null,{folder:n.folderId,items:t.thirdpartyconnectors.getFolderItemsResult})},["request.thirdpartyconnectors.getFolderItemsWithCursor.accessToken"])},this.getConnectionStatus=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getConnectionStatus "+e+"...");var t={type:N.ThirdPartyConnectorsActionType.GET_CONNECTION_STATUS,getConnectionStatus:{type:e}};T(N.ContentType.THIRDPARTYCONNECTORS,t,function(e,t){S(e,t,n)&&n(null,t.thirdpartyconnectors.getConnectionStatus.connected)})},this.disconnectFromThirdParty=function(e,t,n){var i;switch(n=n||d,c.debug("[ClientApiHandler]: disconnectFromThirdParty "+e+"..."),e){case N.ThirdPartyConnectorType.BOX:case N.ThirdPartyConnectorType.OPEN_XCHANGE:case N.ThirdPartyConnectorType.SYNCPLICITY:case N.ThirdPartyConnectorType.GOOGLE_DRIVE:case N.ThirdPartyConnectorType.ONE_DRIVE:i={type:N.ThirdPartyConnectorsActionType.DISCONNECT,disconnect:{type:e,accessToken:t||void 0}};break;default:return void I(n,N.ThirdPartyError.UNSUPPORTED_PROVIDER)}T(N.ContentType.THIRDPARTYCONNECTORS,i,function(e,t){S(e,t,n)&&n(null)},["request.thirdpartyconnectors.disconnect.accessToken"])},this.shareFolderItems=function(e,n){if(n=n||d,e){var t,i=e.provider,r=e.itemsData;switch(c.debug("[ClientApiHandler]: shareFolderItems "+i+"..."),i){case N.ThirdPartyConnectorType.BOX:case N.ThirdPartyConnectorType.OPEN_XCHANGE:case N.ThirdPartyConnectorType.GOOGLE_DRIVE:case N.ThirdPartyConnectorType.ONE_DRIVE:case N.ThirdPartyConnectorType.SYNCPLICITY:t={type:N.ThirdPartyConnectorsActionType.SHARE_FOLDER_ITEMS,shareFolderItems:{type:i,shareItems:r,conversationId:e.convId,accessToken:e.accessToken||void 0}};break;default:return void I(n,N.ThirdPartyError.UNSUPPORTED_PROVIDER)}T(N.ContentType.THIRDPARTYCONNECTORS,t,function(e,t){S(e,t,n)&&n(null,t.thirdpartyconnectors.shareFolderItems)},["request.thirdpartyconnectors.shareFolderItems.accessToken"],["response.thirdpartyconnectors.shareFolderItems.items.[].shareLinkPassword","response.thirdpartyconnectors.shareFolderItems.items.[].downloadUrl","response.thirdpartyconnectors.shareFolderItems.items.[].previewUrl","response.thirdpartyconnectors.shareFolderItems.appKey","response.thirdpartyconnectors.shareFolderItems.accessToken"])}else I(n,N.ReturnCode.MISSING_REQUIRED_PARAMETER)},this.unshareItems=function(e,n){var t;switch(n=n||d,c.debug("[ClientApiHandler]: ushareItems "+e.provider+"..."),e.provider){case N.ThirdPartyConnectorType.OPEN_XCHANGE:case N.ThirdPartyConnectorType.SYNCPLICITY:t={type:N.ThirdPartyConnectorsActionType.UNSHARE_FOLDER_ITEMS,unshareFolderItems:{type:e.provider,fileId:e.itemIds,accessToken:e.accessToken||void 0}};break;default:return void I(n,N.ThirdPartyError.UNSUPPORTED_PROVIDER)}T(N.ContentType.THIRDPARTYCONNECTORS,t,function(e,t){S(e,t,n)&&n(null)},["request.thirdpartyconnectors.unshareFolderItems.accessToken"])},this.getEditUrl=function(e,n){var t;switch(c.debug("[ClientApiHandler]: getEditUrl "+e.provider),e.provider){case N.ThirdPartyConnectorType.OPEN_XCHANGE:t={type:N.ThirdPartyConnectorsActionType.GET_EDIT_URL,getEditUrl:{externalAttachment:{type:e.provider,downloadLocation:e.uri,previewLocation:e.uri,attachment:{fileId:e.fileId,fileName:e.fileName,size:e.size,mimeType:e.mimeType}}}};break;default:return void I(n,N.ThirdPartyError.UNSUPPORTED_PROVIDER)}T(N.ContentType.THIRDPARTYCONNECTORS,t,function(e,t){S(e,t,n)&&n(null,t.thirdpartyconnectors.getEditUrlResult.url)})},this.getStorageAuthenticationData=function(e,t,n){if(n=n||d,c.debug("[ClientApiHandler]: getStorageAuthenticationData..."),e===N.ThirdPartyConnectorType.SYNCPLICITY){var i={type:N.ThirdPartyConnectorsActionType.CONNECT_STORAGE,connectStorage:{type:N.ThirdPartyConnectorType.SYNCPLICITY,endpointUrls:t}};T(N.ContentType.THIRDPARTYCONNECTORS,i,function(e,t){S(e,t,n)&&n(null,t.thirdpartyconnectors.connectStorageResult.storageAuthenticationData)})}else I(n,N.ThirdPartyError.UNSUPPORTED_PROVIDER)},this.getGlobalProperty=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getGlobalProperty...");var t={type:N.SystemActionType.GET_GLOBAL_PROPERTY,getGlobalProperty:{globalPropertyName:e}};T(N.ContentType.SYSTEM,t,function(e,t){S(e,t,n)&&n(null,t.system.getGlobalPropertyResult.property)})},this.getGlobalProperties=function(e,n){n=n||d,e instanceof Array||(e=[e]),c.debug("[ClientApiHandler]: getGlobalProperties...");var t={type:N.SystemActionType.GET_GLOBAL_PROPERTIES,getGlobalProperties:{globalPropertyNames:e}};T(N.ContentType.SYSTEM,t,function(e,t){S(e,t,n)&&n(null,t.system.getGlobalPropertiesResult.property)})},this.validateSessionInvite=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: validateSessionInvite...");var i={type:N.GuestActionType.VALIDATE_SESSION_INVITE_TOKEN,validateSessionInviteToken:{token:{token:e},configurableTextsLanguage:t||void 0}};T(N.ContentType.GUEST,i,function(e,t){S(e,t,n)&&n(null,t.guest.validateSessionInviteToken)},null,["response.guest.validateSessionInviteToken.convTopic"])},this.getRegions=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getRegions ...");var t={type:N.GuestActionType.GET_REGIONS,getRegions:{token:{token:e}}};T(N.ContentType.GUEST,t,function(e,t){S(e,t,n)&&n(null,t.guest.getRegions)},null,["response.guest.getRegions.convTopic"])},this.registerSessionGuest=function(e,i){i=i||d,c.debug("[ClientApiHandler]: registerSessionGuest...");var t={type:N.GuestActionType.REGISTER_SESSION_GUEST,registerSessionGuest:{token:{token:e.token},firstName:e.firstName,lastName:e.lastName,forTestCall:e.testCall,locale:e.locale,userId:s||void 0,oldClientId:o||void 0,previousServer:r||void 0}};T(N.ContentType.GUEST,t,function(e,t){if(S(e,t,i)){var n=t.guest.registerSessionGuestResult;E=D.convertVersionToNumber(n.apiVersion),r=n.connectedBackend,o=n.clientId,s=n.userId,i(null,n)}},null,["response.guest.registerSessionGuestResult.guestContext"])},this.sendUserToUserRequest=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: sendUserToUserRequest, type: "+e+", data: ",t);var i={type:N.ContentType.USER_TO_USER,userToUser:{type:e,routing:{destUserId:t.destUserId,srcUserId:s,destClientId:t.destClientId,srcClientId:o},data:JSON.stringify(t.content)}};T(N.ContentType.USER_TO_USER,i,function(e,t){S(e,t,n)&&n(null,t.userToUser)},["request.userToUser.userToUser.data"])},this.getPackages=function(n,e){n=n||d,c.debug("[ClientApiHandler]: getPackages...");var t={type:N.AccountActionType.GET_ASSIGNED_PACKAGES};T(N.ContentType.ACCOUNT,t,function(e,t){S(e,t,n)&&n(null,t.account.getAssignedPackages.packages||[])},null,null,e)},this.getAccounts=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: getAccounts...");var i={type:N.AccountActionType.GET_ACCOUNTS,getAccounts:{searchCriterias:e.searchCriterias,sorting:e.sorting,ordering:e.ordering,searchPointer:e.searchPointer,pageSize:e.pageSize,excludedTags:e.excludedTags}};T(N.ContentType.ACCOUNT,i,function(e,t){S(e,t,n)&&n(null,t.account.getAccounts)},null,["response.account.getAccounts.accounts"],t)},this.getAccountByUserId=function(e,n){n=n||d,c.debug("[ClientApiHandler]: getAccountByUserId...");var t={type:N.AccountActionType.GET_ACCOUNT_BY_USER_ID,getAccountByUserId:{userId:e}};T(N.ContentType.ACCOUNT,t,function(e,t){S(e,t,n)&&n(null,t.account.getAccountByUserId.account)})},this.migrateAccount=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: migrateAccount...");var i={type:N.AccountActionType.MIGRATE_ACCOUNT,migrateAccount:{accountId:e.accountId,accountTemplateId:e.accountTemplateId}};T(N.ContentType.ACCOUNT,i,function(e,t){S(e,t,n)&&n(null,t.account.migrateAccount)},null,null,t)},this.migrateMultipleUsers=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: migrateMultipleUsers...");var i={type:N.AccountActionType.MIGRATE_MULTIPLE_USERS,migrateMultipleUsers:{accountIds:e.accountIds,accountTemplateId:e.accountTemplateId}};T(N.ContentType.ACCOUNT,i,function(e,t){S(e,t,n)&&n(null,t)},null,null,t)},this.suspendAccount=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: suspendAccount...");var i={type:N.AccountActionType.SUSPEND_ACCOUNT,suspendAccount:{accountId:e}};T(N.ContentType.ACCOUNT,i,function(e,t){S(e,t,n)&&n(null)},null,null,t)},this.unsuspendAccount=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: unsuspendAccount...");var i={type:N.AccountActionType.UNSUSPEND_ACCOUNT,unsuspendAccount:{accountId:e}};T(N.ContentType.ACCOUNT,i,function(e,t){S(e,t,n)&&n(null)},null,null,t)},this.suspendUser=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: suspendUser...");var i={type:N.AdministrationActionType.SUSPEND_USER,suspendUser:{userId:e}};T(N.ContentType.ADMINISTRATION,i,function(e,t){S(e,t,n)&&n(null)},null,null,t)},this.unsuspendUser=function(e,n,t){n=n||d,c.debug("[ClientApiHandler]: unsuspendUser...");var i={type:N.AdministrationActionType.UNSUSPEND_USER,unsuspendUser:{userId:e}};T(N.ContentType.ADMINISTRATION,i,function(e,t){S(e,t,n)&&n(null)},null,null,t)},this.assignTelephonyConfiguration=function(e,t,n,i){n=n||d,c.debug("[ClientApiHandler]: assignTelephonyConfiguration...");var r={type:N.AccountActionType.ASSIGN_TELEPHONY_CONFIGURATION,assignTelephonyConfiguration:{accountId:e,configuration:{phoneNumber:D.cleanPhoneNumber(t.phoneNumber),callerId:D.cleanPhoneNumber(t.callerId),reroutingPhoneNumber:D.cleanPhoneNumber(t.reroutingPhoneNumber),onsSipAuthenticationHash:t.onsSipAuthenticationHash||"",ondSipAuthenticationHash:t.ondSipAuthenticationHash||"",associatedTelephonyUserID:t.associatedTelephonyUserID||"",associatedTelephonyTrunkGroupId:t.associatedTelephonyTrunkGroupId||"",associatedTelephonyUserType:t.associatedTelephonyUserType||void 0}}};T(N.ContentType.ACCOUNT,r,function(e,t){S(e,t,n)&&n(null)},["request.account.assignTelephonyConfiguration.configuration.onsSipAuthenticationHash","request.account.assignTelephonyConfiguration.configuration.ondSipAuthenticationHash"],null,i)},this.renewAssociatedTelephonyUser=function(e,n){n=n||d,c.debug("[ClientApiHandler]: renewAssociatedTelephonyUser...");var t={type:N.AccountActionType.RENEW_ASSOCIATED_TELEPHONY_USER,renewAssociatedTelephonyUser:{currentAssociatedTelephonyUserId:e}};T(N.ContentType.ACCOUNT,t,function(e,t){S(e,t,n)&&n(null)})},this.getTechnicalAdminUserId=function(n,e){n=n||d,c.debug("[ClientApiHandler]: getTechnicalAdminUserId...");var t={type:N.AccountActionType.GET_TECHNICAL_ADMIN_USER_ID};T(N.ContentType.ACCOUNT,t,function(e,t){S(e,t,n)&&n(null,t.account.getTechnicalAdminUserIdResult.technicalAdminUserId)},null,null,e)},this.addAccountPermission=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: addAccountPermission...");var i={type:N.AccountActionType.ADD_ACCOUNT_PERMISSION,addAccountPermission:{accountId:e,permissionName:t}};T(N.ContentType.ACCOUNT,i,function(e,t){S(e,t,n)&&n(null)})},this.removeAccountPermission=function(e,t,n){n=n||d,c.debug("[ClientApiHandler]: removeAccountPermission...");var i={type:N.AccountActionType.REMOVE_ACCOUNT_PERMISSION,removeAccountPermission:{accountId:e,permissionName:t}};T(N.ContentType.ACCOUNT,i,function(e,t){S(e,t,n)&&n(null)})},this.getUserData=function(n){n=n||d,c.debug("[ClientApiHandler]: getUserData...");var e={type:N.UserDataActionType.GET_USER_DATA};T(N.ContentType.USER_DATA,e,function(e,t){S(e,t,n)&&n(null,t.userData.getUserData)})}}return(e.prototype.constructor=e).prototype.name="ClientApiHandler",_.ClientApiHandler=e,_}(Circuit=function(_){"use strict";var e=_.BaseEventTarget,m=_.Enums.ConnectionState,N=_.Constants,h=_.Proto,O=_.Utils;function D(e){var r=_.logger;e=e||{},D.parent.constructor.call(this,r);var o=6e4,i=500,a=this,s={},c={},l=[],t="/api",n=window.location.host,d=null,u=null,C=Object.keys(N.DeviceType),E={deviceType:!0,deviceSubtype:!0,manufacturer:!0,osVersion:!0,clientVersion:!0,hardwareModel:!0,capabilities:!0},T=0,p=e.disablePing||O.isMobile()?-1:3e5,S=null,I=!1,f=new _.ConnectionController(e);function v(){var e={};return d&&(e.accessToken=d),u?Object.assign(e,u):"undefined"!=typeof __clientVersion&&(e.clientVersion=__clientVersion),"wss://"+n+t+(Object.keys(e).length?"?"+O.toQS(e):"")}function R(t){r.debug("[ConnectionHandler]: Raising event",t.name),t.cbList.forEach(function(e){try{e(t.data)}catch(e){r.error("[ConnectionHandler]: Error raising event. ",e)}})}function g(){0<l.length&&(r.debug("[ConnectionHandler]: Raise all delayed events"),l.forEach(function(e){window.clearTimeout(e.timeoutId),R(e)}),l=[])}function A(e){!T&&e.apiVersion&&(T=O.convertVersionToNumber(e.apiVersion));var t=function(e){var t;switch(e.msgType){case N.WSMessageType.RESPONSE:if(!e.response||!e.response.code)return null;var n;if(e.response.user&&("GET_STUFF"===e.response.user.type?n=e.response.user.getStuff.user:"GET_LOGGED_ON"===e.response.user.type&&(n=e.response.user.getLoggedOn.user),n&&(n.clientId=e.clientId,n.apiVersion=e.apiVersion)),c[e.response.requestId])return t=c[e.response.requestId],delete c[e.response.requestId],t.timer&&window.clearTimeout(t.timer),t.keysToOmitFromResponse&&(e.keysToOmitFromLogging=t.keysToOmitFromResponse),{type:"ack",cb:t.cb,data:e.response};r.debug("[ConnectionHandler]: No callback for response with requestId=",e.response.requestId);break;case N.WSMessageType.EVENT:var i=h.ParseEvent(e.event);if(i&&i.name){if(s[i.name])return t=s[i.name],r.debug("[ConnectionHandler]: Parsed event: ",i.name),a.ommitKeysFromLog&&t.keysToOmitFromEvent&&(e.keysToOmitFromLogging=t.keysToOmitFromEvent),{type:"evt",cbList:t.cbList,name:i.name,data:i.data,suppressLog:t.suppressLog};r.debug("[ConnectionHandler]: No registered callback for event ",i.name)}else r.error("[ConnectionHandler]: Failed to parse event: ",e.event);break;default:r.error("[ConnectionHandler]: Unexpected message type: ",e.msgType)}return null}(e);if(t)if(t.suppressLog||r.msgRcvd("[ConnectionHandler]: ",e),"evt"===t.type)0<Object.keys(c).length&&/^(?:User|Conversation|Search)\./.test(t.name)?(r.debug("[ConnectionHandler]: Delay event:",t.name),t.timeoutId=window.setTimeout(function(){R(t);var e=l.indexOf(t);-1!==e&&l.splice(e,1)},i),l.push(t)):R(t);else{var n=Object.keys(c).length;r.debug("[ConnectionHandler]: Remaining callbacks pending: ",n),t.cb(null,t.data),0===n&&g()}}f.onStateChange=function(e){if(r.debug("[ConnectionHandler]: WebSocket connection state changed to ",e.newState),r.debug("[ConnectionHandler]: Raising connectionStateChange event"),e.newState===m.Connected)T=0,!S&&0<p&&(S=window.setInterval(function(){a.pingServer()},p));else if(S&&(window.clearInterval(S),S=null),Object.keys(c).length){var n=c;c={},window.setTimeout(function(){Object.keys(n).forEach(function(e){var t=n[e];t.timer&&window.clearTimeout(t.timer),t.cb(N.ReturnCode.DISCONNECTED)}),g()},0)}var t=a.createEvent("connectionStateChange");t.newState=e.newState,t.oldState=e.oldState,a.dispatch(t)},f.onReconnectFailed=function(){r.debug("[ConnectionHandler]: WebSocket failed to reconnect. Raising reconnectFailed event");var e=a.createEvent("reconnectFailed");a.dispatch(e)},f.onMessage=A,this.ommitKeysFromLog=!0,this.onMessage=A,this.setRelativeUrl=function(e){t=e,r.debug("[ConnectionHandler]: Set relative URL to ",t)},this.setTarget=function(e){n=e||window.location.host,r.debug("[ConnectionHandler]: Set target to ",n)},this.setClientInfo=function(t){if(t){if(!t.deviceSubtype||-1===C.indexOf(t.deviceType))return void r.warn("[ConnectionHandler]: Attempted to set invalid clientInfo: ",t);u={},Object.keys(t).forEach(function(e){E[e]&&(u[e]=t[e])}),r.debug("[ConnectionHandler]: Set clientInfo to ",u)}else r.debug("[ConnectionHandler]: Clear clientInfo"),u=null},this.setToken=function(e){d=e},this.getUrl=v,this.getState=function(){return f.getState()},this.connect=function(e,t){r.debug("[ConnectionHandler]: Connect WebSocket to Access Server"),f.connect(v(),e,t)},this.disconnect=function(){r.debug("[ConnectionHandler]: Disconnect WebSocket from Access Server"),f.disconnect()},this.reconnect=function(e){r.debug("[ConnectionHandler]: Reconnect WebSocket to Access Server."),f.reconnect(v(),e)},this.sendMessage=function(e,t,n){return e&&e.request&&e.request.requestId?(r.debug("[ConnectionHandler]: Sending "+e.request.type+" request"),f.sendMessage(e)?(t&&function(e,n,t){if(n){var i=window.setTimeout(function(e){if(r.error("[ConnectionHandler]: Timeout waiting for response. RequestId:",e),c[e]){delete c[e],n(N.ReturnCode.REQUEST_TIMEOUT);var t=Object.keys(c).length;r.debug("[ConnectionHandler]: Remaining callbacks pending: ",t),0===t&&g(),a.pingServer()}},o,e);Array.isArray(t)||(t=null),c[e]={cb:n,timer:i,keysToOmitFromResponse:t}}}(e.request.requestId,t,n),!0):(r.error("[ConnectionHandler]: Failed to send message"),t&&window.setTimeout(function(){t(N.ReturnCode.FAILED_TO_SEND)},0),!1)):(r.error("[ConnectionHandler]: Cannot send message. Invalid message: ",e),t&&window.setTimeout(function(){t(N.ReturnCode.INVALID_MESSAGE)},0),!1)},this.pingServer=function(){if(f.isConnected()&&!I){var e,t="PING";if(O.isMobile()||(t+="|"+(e=++h.requestNr)),f.sendMessage(t),e){I=!0;var n=window.setTimeout(function(){I=!1,r.error("[ConnectionHandler]: Timed out waiting for ping response. RequestId:",e),delete c[e],f.reconnect(v())},1e4);c[e]={cb:function(){I=!1},timer:n}}}},this.setPingInterval=function(e){"number"==typeof e&&(e=e<0?-1:Math.max(Math.floor(e),3e4),p!==e&&(p=e,S&&(window.clearInterval(S),S=null),p<0?r.info("[ConnectionHandler]: Disable ping"):(r.info("[ConnectionHandler]: Set ping interval time to ",p),f.isConnected()&&(r.info("[ConnectionHandler]: Restart ping interval"),S=window.setInterval(function(){a.pingServer()},p)))))},this.on=function(e,t,n){if(e&&t){var i=s[e]||{cbList:[]};i.cbList.push(t),n&&(Array.isArray(n)?i.keysToOmitFromEvent=n:"*"===n&&(i.suppressLog=!0)),s[e]=i}}}return O.inherit(D,e),D.prototype.name="ConnectionHandler",_.ConnectionHandler=D,_}(Circuit=function(e){"use strict";function t(i){var r={};this.dispatch=function(t){var e=t&&t.type;e?r[e]?r[e].forEach(function(e){try{e(t)}catch(e){i&&i.error(e)}}):i&&i.debug("[EventTarget]: There is no listener for "+e):i&&i.error("[EventTarget]: Attempted to dispatch a bad event")},this.addEventListener=function(e,t){e&&"function"==typeof t?(r[e]||(r[e]=[]),0<=r[e].indexOf(t)?i&&i.warning("[EventTarget]: Attempted to add duplicate event listener"):(r[e].push(t),i&&i.debug("[EventTarget]: Added event listener for "+this.name+", type = "+e+", count = "+r[e].length))):i&&i.error("[EventTarget]: addEventListener invoked with invalid arguments")},this.removeEventListener=function(e,t){if(r[e]){var n=r[e].indexOf(t);0<=n&&r[e].splice(n,1),i&&i.debug("[EventTarget]: Removed event listener for "+this.name+", type = "+e+", count = "+r[e].length)}},this.hasEventListener=function(e){return!!r[e]&&0<r[e].length},this.removeAllListeners=function(){r={}}}return(t.prototype.constructor=t).prototype.createEvent=function(e){return{type:e}},t.prototype.dispatchEvent=function(e){var t=this.createEvent(e);this.dispatch(t)},e.BaseEventTarget=t,e}((Circuit=function(e){"use strict";var S,c=e.Utils,o="#f0f0f0",l=10,a=312,s=484,r="tHuMbNaIl___";function d(i){return new S(function(n){var e=new FileReader;e.onload=function(e){var t=new Image;t.onload=function(){var e=function(e){for(var t=atob(e.split(",")[1]),n=[],i=0;i<t.length;i++)n.push(t.charCodeAt(i));return new Blob([new Uint8Array(n)],{type:"image/jpeg"})}(function(e){var t,n;n=e.height,t=e.width,a/s<n/t?e.height>a&&(t=t*a/n,n=a):s<t&&(n=n*s/t,t=s);var i=document.createElement("canvas"),r=i.getContext("2d");return i.width=t,i.height=n,r.fillStyle=o,r.fillRect(0,0,i.width,i.height),r.drawImage(e,0,0,e.width,e.height,0,0,t,n),i.toDataURL("image/jpeg")}(this));e.name=r+(i.modifiedName||i.name),e.lastModified=Math.round(Date.now()/1e3),n(e)},t.src=e.target.result},e.readAsDataURL(i)})}function t(e){var a=e?e.domain:null,s=1,p={};this.uploadFiles=function(t,e,u,n,i){if(!S)throw new Error("Promise support is required to use FileUpload");if(t.length>l)return S.reject("Exceeded maximum of 10 files per message");var C=(e=e||a)?"https://"+e:"",E=[],T=s++;p[T]={xhr:null,deleteUrls:[]};var r=[];!i&&t.forEach(function(e){c.isSupportedImage&&c.isSupportedImage(e.type)&&r.push(d(e))});var o=S.all(r).then(function(e){return Array.prototype.push.apply(t,e),u=u||null,t.reduce(function(e,d){return e.then(function(){return(r=T,o=d,a=u,s=C,c=n,l=function(){p[r]&&(p[r].xhr=null)},new S(function(e,t){var n=o.modifiedName||o.name,i=new XMLHttpRequest;i.withCredentials=!0,i.open("POST",s+"/fileapi?itemid="+(a||"NULL"),!0),i.setRequestHeader("Content-Type",o.type),i.setRequestHeader("Content-Disposition",'attachment; filename="'+encodeURIComponent(n)+'"'),"function"==typeof c&&(i.upload.onprogress=function(e){0<e.total&&c(e.loaded,e.total,n)}),i.onload=function(){l(),200===i.status?e(i.response):t({filename:n,status:i.status,statusText:i.statusText,response:i.response,responseText:i.responseText})},i.onerror=function(){l(),t({filename:n,status:500,statusText:"Connection Failed"})},i.onabort=function(){l(),t({filename:n,status:0,statusText:"abort"})},(p[r].xhr=i).send(o)})).then(function(e){var t=JSON.parse(e)[0];u=u||t.id;var n=t.fileid[t.fileid.length-1],i={fileId:n,fileName:d.modifiedName||d.name,itemId:u,mimeType:t.mimeType||d.type,size:d.size,url:C+"/fileapi?fileid="+n+"&itemid="+u,deleteUrl:C+"/fileapi?fileid="+n+"&itemid="+u};return E.push(i),p[T].deleteUrls.push(i.deleteUrl),E});var r,o,a,s,c,l})},S.resolve())}).then(function(e){return delete p[T],S.resolve(e)},function(e){return delete p[T],S.reject(e)});return o.__uploadId=T,o},this.abort=function(e){if(e&&e.__uploadId&&p[e.__uploadId]){var t=p[e.__uploadId];delete p[e.__uploadId],t.xhr&&t.xhr.abort(),(n=t.deleteUrls)&&n.forEach(function(e){var t=new XMLHttpRequest;t.withCredentials=!0,t.open("DELETE",e),t.send()})}var n}}return void 0!==Promise&&(S=Promise),t.COMPRESSED_IMG_PREFIX=r,t.overridePromise=function(e){S=e},e.FileUpload=t,e}((Circuit=function(e){"use strict";var t=e.AtcCallInfo,n=e.BaseCall,i=e.Enums.CallState,r=e.Enums.CstaCallState,o=e.logger;function a(e){if(!e||!e.rtcSessionId)throw new Error("Cannot create AtcRemoteCall object without a valid conversation");a.parent.constructor.call(this,e,!0),Object.defineProperties(this,{isPullAllowed:{get:function(){return this.atcCallInfo.isHandoverAllowed()&&this.atcCallInfo.cstaState!==r.Ringing},enumerable:!0,configurable:!1},isDtmfAllowed:{get:function(){return this.checkState(i.ActiveRemote)&&this.checkCstaState(r.Active)},enumerable:!0,configurable:!1}}),this.isAtcRemote=!0,this.atcCallInfo=new t,e=null,o.info("[AtcRemoteCall]: Created new ATC remote call with callID = ",this.callId)}return e.Utils.inherit(a,n),a.prototype.isPresent=function(){return!this.checkState([i.Idle,i.Terminated])||!this.checkCstaState([r.Idle,r.Failed,r.TransferFailed,r.Terminated])},e.AtcRemoteCall=a,e}((Circuit=function(ft){"use strict";var vt=ft.Constants,Rt=ft.IceCandidate,gt=ft.logger,At=ft.ScreenSharingController,_t=ft.sdpParser,mt=ft.Utils,Nt=ft.CallStatsHandler,ht=Object.freeze({None:"None",AnswerPending:"Answer-Pending",AnswerSent:"Answer-Sent",AnswerApplied:"Answer-Applied",OfferPending:"Offer-Pending",OfferSent:"Offer-Sent",OfferReceived:"Offer-Received",Connected:"Connected",PrAnswerReceived:"PrAnswer-Received",AnswerReceived:"Answer-Received",Disconnected:"Disconnected"}),Ot=2e3,Dt=200,yt="ConstraintNotSatisfiedError",bt="OverconstrainedError",Pt="PermissionDeniedError",Ut=5e3,Lt=1e3,i=Object.freeze({audio:{maxplaybackrate:24e3,"sprop-maxcapturerate":24e3,maxaveragebitrate:16e3,usedtx:1},video:{maxBw:512},hdVideo:{maxBw:2e3},screenShare:{maxBw:300,maxFrameRate:5,minFrameRate:3},rtcpMuxPolicy:"negotiate",preferVp9:!1}),r=Object.freeze({video:{minBitRate:60},hdVideo:{startBitRate:500,minBitRate:1e3,maxBitRate:2e3,maxQuantization:56},screenShare:{}}),e=Object.freeze({AUDIO_VIDEO:0,DESKTOP:1});function Mt(e){var f=ft.WebRTCAdapter,v=12e4,t=15e3,n=1e3,R=0,o=1,s="video_screen",C={audio:0,video:1,screen:2},g=this,i=(e=e||{}).callId||"",E=!!e.isDirectCall,a=!!e.isTelephonyCall,r=0,c=[null,null],T=null,p=null,l=null,S=null,d=[],u={},A=!1,_=!1,I=!1,m=null,N=null,h=null,O=null,D=null,y=null,b=null,P=[],U=null,L=ht.None,M={audio:!1,video:!1},w=null,G=!1,H=!1,k=!1,V=!1,F=!!e.isLargeConference,B={audio:!0,video:!1,hdVideo:!1,desktop:!1},x=null,W=!a&&!e.disableTrickleIce&&!Mt.disableTrickleIce,Y=!1,K=null,q=null,j=null,Q=!1,X=null,z=!1,J=!1,$=[],Z={},ee=!!e.isLargeConference,te=!!e.isAtcPullCall,ne=[],ie=null,re=null,oe=!1,ae=null,se=!1,ce=!!e.candidatesCollectionTest,le=mt.getBrowserInfo(),de={};function ue(e,t){if(!z){var n,i=t&&!E?p:T;0<=(i?i.getLocalStreams():[]).indexOf(e)&&(gt.warn("[RtcSessionController]: Local "+(t?"Desktop":"Audio/Video")+" Media Stream has ended unexpectedly"),n=t,gt.debug("[RtcSessionController]: send LocalStreamEnded event"),ve(g.onLocalStreamEnded,{isDesktop:n}))}}function Ce(t,n,i){if(i.mediaStream){var e=i.mediaStream;e.oninactive=ue.bind(null,e,!0),Ye(e,o),t()}else i.streamId||i.screenType?Te(t,n,i):ae=At.getScreen(function(e){e&&e.streamId&&(i.streamId=e.streamId),Te(t,n,i)},n)}function Ee(e,t,n){gt.debug("[RtcSessionController]: Get User Media for ",B),n=n||{},B.audio||B.video?function(E,T){gt.debug("[RtcSessionController]: getUserMediaAudioVideo()");var p=null;try{var S,e=function(){if(c[R]){var e=c[R];return e.oninactive=ue.bind(null,e,!1),c[R]=null,e}var t=!_||"msie"===f.browser||"firefox"===f.browser&&!B.desktop&&x.desktop;if(A&&t&&"android"!==f.browser&&B.audio===x.audio&&B.video===x.video&&B.hdVideo===x.hdVideo)return N[R]}();if(e)return gt.debug("[RtcSessionController]: getUserMediaAudioVideo(): Reusing audio/video stream ID: ",e.id),Ye(e,R),E();var I={audio:!1,video:!1};f.getMediaSources(function(e,t){var i,n,r,o;if(gt.debug("[RtcSessionController]: Retrieved media sources"),B.audio)if(n=e,r=mt.selectMediaDevice(n,Mt.recordingDevices),o={enableAudioAGC:Mt.enableAudioAGC,sourceId:r&&r.id},i=A&&(le.firefox||le.chrome)&&B.audio===x.audio&&de.enableAudioAGC===o.enableAudioAGC&&de.sourceId===o.sourceId?null:o)I.audio=f.getAudioOptions(i);else{var a=N[R],s=a.getAudioTracks()[0];s&&(gt.debug("[RtcSessionController]: Reusing audio track"),S=s.clone())}var c,l=!1,d=!1;if(B.video?(l=B.hdVideo,c=mt.selectMediaDevice(t,Mt.videoDevices),I.video=f.getVideoOptions({sourceId:c&&c.id,hdVideo:l?"1080p":""})):B.desktop&&mt.isMobile()&&(I.video=f.getDesktopOptions()),A&&(B.video&&x.video&&B.hdVideo!==x.hdVideo||!B.video&&x.video)&&f.stopLocalVideoTrack(N[R]),S&&!I.audio&&!I.video){var u=new f.MediaStream([S]);return u.oninactive=ue.bind(null,u,!1),Ye(u,R),void E()}p=window.setTimeout(function(){p=null,gt.warn("[RtcSessionController]: Failed to access local media: device unresponsive"),T("res_MediaInputDevicesUnresponsive")},v);var C=function(){gt.info("[RtcSessionController]: Calling getUserMedia - constraints = ",I),f.getUserMedia(I,function(e,t){if(i&&(de=i),gt.info("[RtcSessionController]: User has granted access to local media"),gt.debug("[RtcSessionController]: Local MediaStream: ",e.id),!p)return gt.info("[RtcSessionController]: GUM time out already fired"),void Be(e);if(window.clearTimeout(p),p=null,oe)return gt.info("[RtcSessionController]: Session already terminated. Stop audio/video MediaStream: ",e.id),void Be(e);if(e.oninactive=ue.bind(null,e,!1),B.video&&!e.getVideoTracks().length){if(A&&!x.video)return void T("res_CameraAccessRestricted");B.video=!1,gt.info("[RtcSessionController]: Failed to get access to video stream. Fallback to audio-only."),n="res_AddVideoFailed","function"==typeof g.onRtcWarning&&window.setTimeout(function(){var e;e=n,gt.debug("[RtcSessionController]: send Warning event"),ve(g.onRtcWarning,{warning:e})},0),gt.info("[RtcSessionController]: New getUserMedia - constraints = ",B)}var n;S&&e.addTrack(S),Ye(e,R),E(),t&&(gt.warn("[RtcSessionController]: Get user media succeeded. But we had an exception: ",t.name||"<unknown>"),ve(g.onGetUserMediaException,{info:t}))},function(e){var t,n=e&&e.name||"Unspecified";if((l||d)&&(n===yt||n===bt))return gt.warn("[RtcSessionController]: Failed to access local media with HD constraints: ",I.video),d=l,l=!1,I.video=f.getVideoOptions({sourceId:c&&c.id,hdVideo:d?"720p":""}),void C();gt.warn("[RtcSessionController]: Failed to access local media: ",n),p&&(window.clearTimeout(p),p=null),t=-1!==n.indexOf(Pt)?B.video?"res_AccessToMediaInputDevicesFailedPermissionDenied":"res_AccessToAudioInputDeviceFailedPermissionDenied":B.video?"res_AccessToMediaInputDevicesFailed":"res_AccessToAudioInputDeviceFailed",T(t)})};C(),gt.debug("[RtcSessionController]: Requested access to Local Media")})}catch(e){gt.error("[RtcSessionController]: Exception while handling getUserMedia: ",e),p&&(window.clearTimeout(p),p=null),T(B.video?"res_AccessToMediaInputDevicesFailed":"res_AccessToAudioInputDeviceFailed")}}(function(){B.desktop&&"iOS"!==window.navigator.platform&&"dotnet"!==window.navigator.platform?c[o]?(n.mediaStream=c[o],Ce(e,t,n)):A&&x.desktop&&!I?(Ye(N[o],o),e()):(Ce(e,t,n),I=!1):(Ye(null,o),e())},t):B.desktop?(A&&x.desktop&&!I&&(n.mediaStream=N[o]),Ce(e,t,n)):window.setTimeout(e,0)}function Te(n,i,r){gt.debug("[RtcSessionController]: getUserMediaDesktop()");try{var e={audio:!1},t={frameRate:{min:Mt.sdpParameters.screenShare.minFrameRate,max:Mt.sdpParameters.screenShare.maxFrameRate}};e.video=f.getDesktopOptions(r.streamId||r.screenType,t),gt.info("[RtcSessionController]: Calling getUserMedia - constraints = ",e),f.getUserMedia(e,function(e){if(gt.info("[RtcSessionController]: User has granted access for screen capture. Stream Id:",e.id),oe)return gt.info("[RtcSessionController]: Session already terminated. Stop desktop MediaStream: ",e.id),void Be(e);var t;t=r.pointer,gt.debug("[RtcSessionController]: send ScreenSharePointerStatus event"),ve(g.onScreenSharePointerStatus,{isSupported:!(!t||!t.isSupported),isEnabled:!(!t||!t.isEnabled)}),e.oninactive=ue.bind(null,e,!0),Ye(e,o),n()},function(e){var t=e&&e.name||"Unspecified";gt.warn("[RtcSessionController]: Failed to access local media: ",t),le.msie&&"PermissionDeniedError"===t||le.firefox&&("SecurityError"===t||"NotAllowedError"===t)?i(vt.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED):i("res_AccessToDesktopFailed")}),gt.debug("[RtcSessionController]: Requested access for screen capture")}catch(e){gt.error("[RtcSessionController]: Exception while handling getUserMedia: ",e),i("res_AccessToDesktopFailed")}}function pe(){if(T)return!0;var e={};a&&(e.rtcpMuxPolicy=Mt.sdpParameters.rtcpMuxPolicy),d.length&&!te?("firefox"===f.browser&&(d=d.filter(function(e){return!/turns:\d{1,3}(\.\d{1,3}){3}/.test(e)})),e.iceServers=[{urls:d,credential:u.password,username:u.username}],Mt.allowOnlyRelayCandidates&&(e.iceTransportPolicy="relay")):e.iceServers=[];var t=!!te;te=!1,Mt.webRTCIPHandlingPolicy&&gt.info("[RtcSessionController]: webRTCIPHandlingPolicy is set to ",Mt.webRTCIPHandlingPolicy),gt.debug("[RtcSessionController]: Creating RtcPeerConnections. config: ",e);var n={optional:[{DtlsSrtpKeyAgreement:!0},{googImprovedWifiBwe:!0},{googHighBitrate:!0},{googVeryHighBitrate:!0},{googDscp:!0}]};gt.debug("[RtcSessionController]: Creating peer connections. constraints:",n);var i={extraVideoChannels:J?0:r};gt.debug("[RtcSessionController]: Creating peer connections. options:",i);try{$=[],(T=new ft.RtcPeerConnections(e,n,i)).connectionBypassed=t,gt.debug("[RtcSessionController]: Created audio/video peer connections. Connection bypassed: ",t),Mt.disableDesktopPc||"iOS"===window.navigator.platform||"dotnet"===window.navigator.platform||E||(e.iceCandidatePoolSize=1,p=new f.PeerConnection(e,n),gt.debug("[RtcSessionController]: Created screenshare peer connection"))}catch(e){return p=T=null,gt.error("[RtcSessionController]: Failed to create peer connections.",e),!1}return l=new Nt([T,p]),Se(T,l),Se(p),!0}function Se(e,t){e&&(e.onicecandidate=function(e,t){if(e!==T&&e!==p)return void be("Received icecandidate event for old PC");var n;if(t.candidate){var i=new Rt(t.candidate.candidate);if("udp"!==i.transport)return void ye("Ignore non UDP candidate");if(ye("New ICE candidate: ",t.candidate),Le()){if(!Le((n=e.localDescription).type))return;var r={candidate:t.candidate.candidate,sdpMid:t.candidate.sdpMid,sdpMLineIndex:t.candidate.sdpMLineIndex};(function(e){var t=T||p;if(Mt.allowAllIceCandidatesScreenShare||e.sdpMid!==s||t.hasRelayRtpCandidate||t.sendAllCandidates)return!0;var n=new Rt(e.candidate);if(n.isTcpTlsRelay())return n.isRtp()&&(gt.info("[RtcSessionController]: Found local relay candidate for TURN over TCP/TLS. Remove queued candidates."),t.hasRelayRtpCandidate=!0,delete t.queuedCandidates,t.relayRtpCandidateTimeout&&(window.clearTimeout(t.relayRtpCandidateTimeout),delete t.relayRtpCandidateTimeout)),!0;"udp"===n.transport&&(t.queuedCandidates||(t.queuedCandidates=[],gt.debug("[RtcSessionController]: Start timer to wait for relay candidate for TURN over TCP/TLS."),t.relayRtpCandidateTimeout=window.setTimeout(function(){gt.info("[RtcSessionController]: Timer expired. Stop waiting for relay candidate for TURN over TCP/TLS and send all pending candidates."),delete t.relayRtpCandidateTimeout,t.queuedCandidates&&(Re(t.queuedCandidates),delete t.queuedCandidates),t.sendAllCandidates=!0},Ut)),t.queuedCandidates.push(e),gt.debug("[RtcSessionController]: Queue candidate in case there is no TURN over TCP/TLS relay candidate"));return!1})(r)&&(L!==ht.None&&L!==ht.OfferPending&&L!==ht.AnswerPending?function(e){var t=T||p;t.pendingCandidates||(t.pendingCandidates=[],gt.debug("[RtcSessionController]: Start timer to collect candidates before send."),t.collectCandidatesTimeout=window.setTimeout(function(){gt.debug("[RtcSessionController]: Timer expired. Send all pending candidates."),delete t.collectCandidatesTimeout,t.pendingCandidates&&(Re(t.pendingCandidates),delete t.pendingCandidates)},Dt));t.pendingCandidates.push(e)}(r):ye("Ignore ICE candidate in state ",L))}}else if(ye("End of candidates. Audio/video PC:",e===T),e.endOfCandidates=!0,Ge()){if(!(n=e.localDescription))return void Pe("End of candidates, but cannot access pc.localDescription");Le(n.type)&&L!==ht.None&&L!==ht.OfferPending&&L!==ht.AnswerPending?function(){var e=T||p,t=[];e.pendingCandidates&&(gt.info("[RtcSessionController]: Send all pending candidates."),t=e.pendingCandidates,delete e.pendingCandidates);e.collectCandidatesTimeout&&(window.clearTimeout(e.collectCandidatesTimeout),delete e.collectCandidatesTimeout);e.queuedCandidates&&(gt.info("[RtcSessionController]: There was no relay candidate for TURN over TCP/TLS. Send all queued candidates."),Array.prototype.push.apply(t,e.queuedCandidates),delete e.queuedCandidates);e.relayRtpCandidateTimeout&&(window.clearTimeout(e.relayRtpCandidateTimeout),delete e.relayRtpCandidateTimeout);t.push({candidate:"a=end-of-candidates\r\n"}),Re(t)}():Ae(n)}K&&Le()&&(L===ht.OfferPending||L===ht.AnswerPending)&&Ae(n=e.localDescription)}.bind(null,e),e.oniceconnectionstatechange=function(e){if(e!==T&&e!==p)return void be("Received iceconnectionstatechange event for old PC");var t=e===T?"audio/video":"desktop";if(ye("Connection state change ("+t+"): ",e.iceConnectionState),L===ht.Connected)switch(e.iceConnectionState){case"connected":case"completed":ge(e,t);break;case"disconnected":e.connectionBypassed||function(e,t){if(e.iceDisconnectTimeout)return;e.iceDisconnectTimeout=window.setTimeout(function(){delete e.iceDisconnectTimeout,"disconnected"===e.iceConnectionState&&(gt.debug("[RtcSessionController]: send IceDisconnected event pcType:",t),ve(g.onIceDisconnected,{pcType:t}))},Lt)}(e,t);break;case"failed":e.connectionBypassed||(Ze(ht.Disconnected),Pe("[RtcSessionController]: ICE connection has failed"),Je("res_CallMediaDisconnected"))}else if(L===ht.AnswerReceived||L===ht.PrAnswerReceived||L===ht.AnswerApplied||L===ht.AnswerSent)switch(e.iceConnectionState){case"connected":case"completed":e.connected=!0,we()&&(q&&(window.clearTimeout(q),q=null),Ze(ht.Connected),ge(e,t));break;case"failed":q&&(window.clearTimeout(q),q=null),Je("res_CallMediaFailed")}}.bind(null,e),e.onaddstream=function(e,t){if(ye("Added Remote Stream"),A)return void ye("Renegotiation is in progress. Ignore AddStream event.");Ke([t.stream]),me()}.bind(null,e),e.onremovestream=function(e,t){be("Removed Remote Stream"),function(e){if(!e)return;var n=!1,i=f.getVideoStreamTrackId(e);i&&P.some(function(e,t){if(e.streamId===i)return P.splice(t,1),n=!0});var t=f.getAudioStreamTrackId(e);U&&U.streamId===t&&(n=!(U=null));n&&De()}(t.stream),me()}.bind(null,e)),t&&(t.onThresholdExceeded=function(e){ve(g.onStatsThresholdExceeded,{cleared:e})},t.onNoOutgoingPackets=function(){ve(g.onStatsNoOutgoingPackets,{})},t.onNetworkQuality=function(e){ve(g.onNetworkQuality,{quality:e})})}function Ie(e,t){e&&(e.onicecandidate=null,e.oniceconnectionstatechange=null,e.onaddstream=null,e.onremovestream=null),t&&(t.onThresholdExceeded=null,t.onNoOutgoingPackets=null,t.onNetworkQuality=null)}function fe(e,t){var n;ye("RTCDTMFSender - ontonechange: tone =",t.tone),n=t.tone,gt.debug("[RtcSessionController]: send DTMFToneChanged event"),ve(g.onDTMFToneChange,{tone:n})}function ve(e,t){if("function"==typeof e)try{e(t||{})}catch(e){gt.error(e)}}function Re(e){if(e){var i=!1;if(e=e.filter(function(e){if(e.candidate.startsWith("a=end-of-candidates"))return i=!0;var t=e.candidate,n=ne.some(function(e){return e.equals(t)});return n?be("Ignore duplicate ICE candidate: ",e.candidate):ne.push(new Rt(t)),!n}),i&&(ne=[]),0<e.length){var t=function(){var e=T||p;if(!e)return"";e.sdpOrigin||(e.sdpOrigin=_t.getOrigin(e.localDescription.sdp));return e.sdpOrigin}();gt.debug("[RtcSessionController]: Send IceCandidate event"),ve(g.onIceCandidate,{origin:t,candidates:e,endOfCandidates:i}),He()}}}function ge(e,t){e.iceDisconnectTimeout&&(window.clearTimeout(e.iceDisconnectTimeout),delete e.iceDisconnectTimeout),gt.debug("[RtcSessionController]: send IceConnected event pcType:",t),ve(g.onIceConnected,{pcType:t})}function Ae(e){K&&(window.clearTimeout(K),K=null),"offer"===e.type?L===ht.OfferPending&&_e(ht.OfferSent):L===ht.AnswerPending&&_e(ht.AnswerSent)}function _e(e){var t=function(){var e,t,n=T&&T.localDescription;n&&n.sdp&&(t=n.type,e=_t.parse(n.sdp));var i=p&&p.localDescription;if(i&&i.sdp){t=t||i.type;var r=_t.parse(i.sdp);r=_t.verifyFingerprintInMLines(r);var o=!E&&!Mt.allowAllIceCandidatesScreenShare;gt.info("[RtcSessionController]: Remove UDP video candidates for screenshare: ",o);var a=Le(t)&&!p.endOfCandidates;_t.validateIceCandidates(r,o,a),e?Array.prototype.push.apply(e.m,r.m):e=r}else e&&S&&(e.m.splice(C.video,0,S),S=null);return{type:t,parsedSdp:e}}();"iOS"===window.navigator.platform&&t&&(gt.debug("[RtcSessionController]: For iOS we need to convert the SDP to an actual JSON object"),t={type:t.type,parsedSdp:t.parsedSdp});var n=Le(t.type),i=t.parsedSdp;i=_t.removeAudioLevelAttr(i),i=_t.fixTrickleIceOption(i,n),n?Ge()&&(i=_t.addEndOfCandidatesLine(i)):i=_t.removeEndOfCandidatesLine(i),i=_t.removeEmptyAttributeLines(i,["ice-ufrag","ice-pwd","ice-options"]),i=_t.removeNotNeededSsrc(i);var r=se||ce;if(0!==_t.iceTotalCandidatesCount(i)||r)if(_t.validateIceCandidates(i)||n&&!Ge()||r){n&&!Ge()&&(ne=_t.getIceCandidates(i));var o={type:t.type,sdp:_t.stringify(i)};p&&(o.screen=s,T&&c[R]&&(o.video=function(e){var t,n=c[e];if(n){var i=n.id+" ",r=n.getVideoTracks()[0];r&&(i+=r.id,t=i)}return t}(R))),gt.debug("[RtcSessionController]: send SessionDescription event"),se=!1,ve(g.onSessionDescription,{sdp:o}),Ze(e)}else gt.error("[RtcSessionController]: Failure: SDP contains at least one m line without IceCandidates"),Je();else if(n){var a=nt();gt.debug("[RtcSessionController]: No ICE candidates collected yet. Waiting "+a+" more milliseconds."),K=window.setTimeout(Je.bind(null,"res_RestartBrowser"),a)}else Je("res_RestartBrowser")}function me(){gt.debug("[RtcSessionController]: send RemoteStreamUpdated event"),ve(g.onRemoteStreamUpdated,{})}function Ne(e){gt.debug("[RtcSessionController]: send Error event"),ve(g.onRtcError,{error:e})}function he(e){"function"==typeof g.onRtcError&&window.setTimeout(function(){Ne(e)},0)}function Oe(){gt.debug("[RtcSessionController]: send MediaUpdate event"),ve(g.onMediaUpdate,{})}function De(){gt.debug("[RtcSessionController]: send RemoteStreams event"),ve(g.onRemoteStreams,{audio:U,video:P})}function ye(e,t){gt.debug("[RtcSessionController]["+i+"]: "+e,t)}function be(e,t){gt.warn("[RtcSessionController]["+i+"]: "+e,t)}function Pe(e,t){gt.error("[RtcSessionController]["+i+"]: "+e,t)}function Ue(e){return e?{audio:!!e.audio,video:!!e.video,hdVideo:!!e.hdVideo,desktop:!!e.desktop}:{audio:!0,video:!1,hdVideo:!1,desktop:!1}}function Le(e){return e?"offer"===e&&W||"answer"===e&&Y:W||Y}function Me(e,t){if(!E)return!0;var n=t&&_t.isTrickleIceOption(t);return n&&gt.debug("[RtcSessionController]: SDP "+e+" indicates support for Trickle-ICE."),!!n}function we(){return(!T||T.connected)&&(!p||p.connected)}function Ge(){return(!T||T.endOfCandidates)&&(!p||p.endOfCandidates)}function He(){if(q&&(window.clearTimeout(q),q=null),we())Ze(ht.Connected);else{var e=z?n:t;gt.debug("[RtcSessionController]: Starting ICE CONNECTED timer"),q=window.setTimeout(function(){q=null,L!==ht.AnswerSent&&L!==ht.AnswerReceived&&L!==ht.AnswerApplied||we()||(z?Ze(ht.Connected):(gt.warn("[RtcSessionController]: Timed out waiting for connected state."),Je("res_CallMediaFailed")))},e)}}function ke(e,t){e&&(e.iceDisconnectTimeout&&(window.clearTimeout(e.iceDisconnectTimeout),delete e.iceDisconnectTimeout),Ie(e,t),f.closePc(e))}function Ve(){gt.debug("[RtcSessionController]: Add local streams to existing peer connection");try{var e=T?T.getLocalStreams():[];e.isEmpty()&&(c[R]&&T.addStream(c[R]),gt.debug("[RtcSessionController]: Added local audio/video stream"),!p&&c[o]&&(T.addStream(c[o]),gt.debug("[RtcSessionController]: Added local screenshare stream"))),p&&(e=p.getLocalStreams()).isEmpty()&&c[o]&&(p.addStream(c[o]),gt.debug("[RtcSessionController]: Added local screenshare stream"))}catch(e){return gt.error("[RtcSessionController]: Failed to add Local Streams ",e),!1}return!0}function Fe(){gt.debug("[RtcSessionController]: Remove local streams from existing PeerConnections");try{[T,p].forEach(function(n){n&&n.getLocalStreams().forEach(function(e,t){e&&(n.removeStream(e),gt.debug("[RtcSessionController]: Removed PeerConnection Stream  #",t))})})}catch(e){return gt.error("[RtcSessionController]: Failed to remove Local Streams ",e),!1}return!0}function Be(e){e&&(e.oninactive=null,f.stopMediaStream(e))}function xe(e){e&&e.forEach(function(e){Be(e)})}function We(e){var n=[null,null];e&&e.forEach(function(e,t){e&&0<e.getVideoTracks().length&&(n[t]=e)}),y===n[0]&&b===n[1]||(y=n[0],gt.debug("[RtcSessionController]: Set local video stream to ",y&&y.id||"<null>"),b=n[1],gt.debug("[RtcSessionController]: Set local desktop stream to ",b&&b.id||"<null>"),gt.debug("[RtcSessionController]: send LocalVideoStream event"),ve(g.onLocalVideoStream,{stream:b||y}),Oe())}function Ye(e,t){t===R||t===o?c[t]!==e&&(N&&N[t]===e&&(N[t]=null),c[t]&&Be(c[t]),c[t]=e,We(c)):gt.error("[RtcSessionController]: setLocalStream invoked with invalid index:",t)}function Ke(e,t){if(e){e instanceof Array||(e=[e]);var n=!1;t&&(U||P.length)&&(n=!0,U=null,P=[]),e.forEach(function(e){$.push(e),function(t){var n=!1;if(!t)return!1;if(0<t.getVideoTracks().length){var e=f.getVideoTrackId(t),i=Z[e]||f.getVideoStreamTrackId(t);gt.debug("[RtcSessionController]: Remote video trackId="+e+", streamId="+i),P.some(function(e){if(e.streamId===i)return e.stream!==t&&(e.stream=t,n=!0),!0})||(P.push({streamId:i,stream:t}),n=!0),n&&gt.debug("[RtcSessionController]: Updated Remote Video streams:",P)}if(0<t.getAudioTracks().length){var r=f.getAudioTrackId(t),o=Z[r]||f.getAudioStreamTrackId(t);gt.debug("[RtcSessionController]: Remote audio trackId="+r+", streamId="+o),U&&U.streamId===o?U.stream!==t&&(U.stream=t,n=!0):(U={streamId:o,stream:t},n=!0),n&&gt.debug("[RtcSessionController]: Updated Remote Audio stream:",U.streamId)}return n}(e)&&(n=!0)}),n&&De()}}function qe(e){var t=!1;c[R]&&(t=f.toggleAudio(c[R],e)),F=!t||!e,N&&N[R]&&f.toggleAudio(N[R],e)}function je(e,t){A&&(gt.debug("[RtcSessionController]: There's a renegotiation in progress, fail or succeed it based on current SdpStatus:",L),L===ht.AnswerReceived||L===ht.AnswerApplied||L===ht.AnswerSent?Xe():ze("Renegotiation already in progress")),T&&T.iceDisconnectTimeout&&(gt.info("[RtcSessionController]: Ignore previous ice Disconnection"),window.clearTimeout(T.iceDisconnectTimeout),delete T.iceDisconnectTimeout),A=!0,_=!!e,m=t||null,O=p,Ie(h=T,D=l),Ie(O),N=c,c=[p=T=null,null],x=mt.shallowCopy(B),w=mt.shallowCopy(M),L=ht.None,re=ie=null}function Qe(e){if(m){try{m(e&&e!==vt.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED?"res_ChangeMediaFailed":e)}catch(e){gt.error(e)}m=null}}function Xe(){gt.info("[RtcSessionController]: The media renegotiation was successful"),gt.info("[RtcSessionController]: Closing the old RTCPeerConnection"),St(D,!0,!h.connectionBypassed),ke(h,D),ke(O),D=O=h=null,gt.info("[RtcSessionController]: Stopping the old MediaStream"),k?H=!0:V&&(H=!1),H||G||Ve(),xe(N),w=x=N=null,We(c);var e=T.getRemoteStreams();p&&(e=e.concat(p.getRemoteStreams())),Ke(e,!0),qe(!F),A=V=k=!1,j=null,Oe(),Qe()}function ze(e){gt.info("[RtcSessionController]: The media renegotiation has failed: ",e),ke(T,l),ke(p),L=ht.Connected,p=O,l=D,Se(T=h),Se(O),D=O=h=null,xe(c),c=N,N=null,We(c),B=mt.shallowCopy(x),M=mt.shallowCopy(w),w=x=null,k?H=!1:V&&(H=!0),A=V=k=!1,Oe(),Qe(e)}function Je(e,t){A?ze(e):(e===vt.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED?gt.info("[RtcSessionController]: User cancelled the screen share request"):"res_RestartBrowser"===e?gt.error("[RtcSessionController]: Failure: No ICE candidates collected. Browser needs to be restarted"):(e=e||"res_RTCError",gt.warn("[RtcSessionController]: There was an internal failure. Send error event: ",e)),t?t(e):Ne(e))}function $e(){re?(gt.info("[RtcSessionController]: Process the pending changeMedia"),lt(re.mediaType,re.cb,re.screenConstraint),re=null):ie&&(gt.info("[RtcSessionController]: Process the pending remote description"),g.setRemoteDescription(ie.sdp,ie.cb),ie=null)}function Ze(e){if(L!==ht.PrAnswerReceived||e!==ht.Connected){if(L!==e&&(gt.debug("[RtcSessionController]: Changed SDP status from "+L+" to "+e),L=e,T))switch(e){case ht.AnswerApplied:$e();break;case ht.Connected:A&&Xe(),gt.debug("[RtcSessionController]: send SdpConnected event"),ve(g.onSdpConnected,{}),$e(),l.start();break;case ht.AnswerSent:He()}}else gt.debug("[RtcSessionController]: Cannot change SDP status to "+e+" without final SDP answer.")}function et(e,t){gt.debug("[RtcSessionController]: updateLocalDescription with mediaConstraints=",B);var n=!1,i=_t.parse(t.sdp);_t.disableMultiplex(i),a&&(_t.removeAudioMediaProtocols(i,["UDP","TLS"]),e.connectionBypassed&&_t.setConnectionMode(i,"audio","inactive")),H?(_t.setConnectionMode(i,"both","inactive"),gt.info("[RtcSessionController]: updateLocalDescription with Connection Mode Inactive")):B.video||B.desktop?n=_t.hasVideo(i):"answer"===t.type&&(n=_t.hasVideo(i))&&J&&(_t.removeVideo(i),n=!1),e===p?(_t.setMediaIdAttribute(i,0,s,!0),_t.setXGoogle(i,Mt.xGoogle.screenShare)):n&&_t.setXGoogle(i,B.desktop&&!p?Mt.xGoogle.screenShare:B.hdVideo?Mt.xGoogle.hdVideo:Mt.xGoogle.video),_t.setOpusParameters(i,Mt.sdpParameters.audio),E&&Mt.sdpParameters.preferVp9&&"offer"===t.type&&_t.preferVideoVp9(i),"answer"!==t.type&&(M={audio:!0,video:n});var r=new f.SessionDescription({type:t.type,sdp:_t.stringify(i)});return gt.debug("[RtcSessionController]: Modified local SDP: ",r),r}function tt(e,t,n){gt.debug("[RtcSessionController]: updateRemoteDescription with mediaConstraints=",B);var i=!1,r=_t.hasVideo(t);if(r){var o,a=_t.getVideoConnectionModes(t);gt.info("[RtcSessionController]: Remote description has video modes set to ",a),r=!(i=a.every(function(e){return"recvonly"===e})),o=e===p||B.desktop&&!p?"screenShare":B.hdVideo?"hdVideo":"video";var s=Mt.sdpParameters[o].maxBw,c=Mt.xGoogle[o];t=_t.setVideoBandwidth(t,s,!0),_t.setXGoogle(t,c),E&&"offer"===n&&i&&!B.video&&!B.desktop&&(t=_t.removeVideo(t))}return _t.setOpusParameters(t,Mt.sdpParameters.audio),G!==(G=!!_t.isHold(t)&&("offer"===n||!H&&B.audio))&&(G?gt.info("[RtcSessionController]: The client has been held"):gt.info("[RtcSessionController]: The client has been retrieved")),"offer"!==n||L!==ht.Connected||H||G||(P.length&&!r?(gt.debug("[RtcSessionController]: send RemoteVideoRemoved event"),ve(g.onRemoteVideoRemoved,{})):!P.length&&r&&(gt.debug("[RtcSessionController]: send RemoteVideoAdded event"),ve(g.onRemoteVideoAdded,{}))),H||"answer"===n&&i||(M={audio:!0,video:r}),t}function nt(){var e=Mt.candidatesTimeout||Ot;return 0<r&&(e+=e*(f.iceTimeoutSafetyFactor||0)),e}function it(){return Mt.trickleIceTimeout||Dt}function rt(e,t){var n;gt.debug("[RtcSessionController]: Successfully created local audio/video description:",e),t&&gt.debug("[RtcSessionController]: Successfully created local screenshare description:",t),A&&Fe(),K&&(window.clearTimeout(K),K=null);var i=e&&e.type||t&&t.type,r=2,o=!1,a=function(e,t){if(r--,t?(gt.error("[RtcSessionController]: Failed to apply Local "+e+" description:",t.message||t),o||(o=!0,Je())):gt.debug("[RtcSessionController]: Local description was successfully applied. PC=",e),!o&&r<=0){if(se)return _e(ht.Connected),T&&(T.connectionBypassed=!0,Ie(T,l)),void(p&&(p.connectionBypassed=!0,Ie(p)));A||Oe(),"offer"===i?(Ze(ht.OfferPending),W&&(0<(n=it())?(gt.debug("[RtcSessionController]: Trickle ICE is enabled. Start a short timer before sending SDP Offer ("+n+"ms)."),window.setTimeout(function(){L===ht.OfferPending&&(gt.debug("[RtcSessionController]: Trickle ICE timer expired. Send SDP Offer."),_e(ht.OfferSent))},n)):(gt.debug("[RtcSessionController]: Trickle ICE is enabled. Send the SDP Offer."),_e(ht.OfferSent)))):(Ze(ht.AnswerPending),Y&&(0<(n=it())?(gt.debug("[RtcSessionController]: Trickle ICE is enabled. Start a short timer before sending SDP Answer ("+n+"ms)."),window.setTimeout(function(){L===ht.AnswerPending&&(gt.debug("[RtcSessionController]: Trickle ICE timer expired. Send SDP Answer."),_e(ht.AnswerSent))},n)):(gt.debug("[RtcSessionController]: Trickle ICE is enabled. Send the SDP Answer."),_e(ht.AnswerSent)))),(L===ht.OfferPending&&!W||L===ht.AnswerPending&&!Y)&&(n=nt(),gt.debug("[RtcSessionController]: Waiting for ICE candidates ("+n+"ms)."),K=window.setTimeout(function(){K=null,gt.warn("[RtcSessionController]: Timed out waiting for candidates. Send session description."),T?"offer"===i?L===ht.OfferPending&&_e(ht.OfferSent):L===ht.AnswerPending&&_e(ht.AnswerSent):gt.warn("[RtcSessionController]: RTCPeerConnection instance no longer exists.")},n))}};try{if(T&&e){var s=a.bind(null,"audio/video");e=et(T,e),T.setLocalDescription(e,s,s),T.startTime=Date.now()}else r--;if(p&&t){var c=a.bind(null,"screenshare");t=et(p,t),p.setLocalDescription(t,c,c),p.startTime=Date.now()}else r--}catch(e){a("unknown",e||"error")}}function ot(){k||H&&!V?(T.oniceconnectionstatechange=null,gt.debug("[RtcSessionController]: Call is already held or is being put on hold. Stop monitoring iceConnectionState changes"),Ze(ht.Connected)):L===ht.AnswerReceived&&Ze(ht.AnswerApplied)}function at(e){return(!J||!(!e||!e.video))&&(mt.isMobile()||!ee)&&!a}function st(r){gt.debug("[RtcSessionController]: setRemoteDescription()");try{if(!pe())return void Je();var o,a=T.getLocalStreams(),e=_t.parse(r.sdp);if(Z=_t.getMediaIds(e),r.screen){var t=_t.findMediaLineIndex(e,r.screen);-1!==t&&(o=e.m[t],e.m.splice(t,1))}switch(r.type){case"offer":(Y=!Mt.disableTrickleIce&&Me(r.type,e))&&gt.info("[RtcSessionController]: Enabled Trickle-ICE for answer.");break;case"pranswer":case"answer":Ze("pranswer"===r.type?ht.PrAnswerReceived:ht.AnswerReceived),W&&((W=Me(r.type,e))||gt.warn("[RtcSessionController]: Disabled Trickle-ICE for offer."))}var s=2,c=!1,n=function(e,t){if(s--,t?(gt.error("[RtcSessionController]: Failed to apply Remote "+e+" description:",t.message||t),c||(c=!0,Je())):gt.debug("[RtcSessionController]: Remote description was successfully applied. PC=",e),!c&&s<=0)switch(gt.debug("[RtcSessionController]: Remote Descriptions were successfully applied."),A||Oe(),r.type){case"offer":H||G?0<a.length?(Fe(),gt.debug("[RtcSessionController]: Removed Local Stream (hold)")):gt.debug("[RtcSessionController]: Local Stream has not been set (hold)"):Ve(),gt.debug("[RtcSessionController]: Creating Local Description Answer...");var n={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:at()}},i={audio:B.audio,video:B.video||B.desktop};T.createAnswer(function(t){if(p&&o){var e={mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!J}};p.createAnswer(function(e){rt(t,e)},function(e){e=e||"Unspecified",gt.error("[RtcSessionController]: Failed to create screenshare Local Description: ",e.message||e),Je()},e)}else rt(t)},function(e){e=e||"Unspecified",gt.error("[RtcSessionController]: Failed to create Local Description: ",e.message||e),Je()},n,i);break;case"pranswer":gt.debug("[RtcSessionController]: Received pranswer, applying early media SDP"),ot(),He();break;case"answer":ot(),He();break;default:gt.error("[RtcSessionController]: Invalid SDP Type = ",r.type),Je()}};if(T){E&&!p&&o&&((S=e.m[C.video]).port=0,_t.setConnectionMode({m:[S]},"video","inactive"),e.m[C.video]=o,gt.debug("[RtcSessionController]: Disabled and replaced video m-line with screenshare m-line")),e=tt(T,e,r.type);var i=new f.SessionDescription({type:r.type,sdp:_t.stringify(e)});gt.debug("[RtcSessionController]: Modified remote audio/video SDP:",i);var l=n.bind(null,"audio/video");T.setRemoteDescription(i,l,l),T.remoteOrigin=_t.getOrigin(e).trim(),T.startTime=Date.now()}else s--;if(p&&o){e.m=[o],e=tt(p,e,r.type);var d=new f.SessionDescription({type:r.type,sdp:_t.stringify(e)});gt.debug("[RtcSessionController]: Modified remote screenshare SDP:",d),p.startTime=Date.now();var u=n.bind(null,"screenshare");p.setRemoteDescription(d,u,u),p.remoteOrigin=_t.getOrigin(e).trim()}else ke(p),p=null,s--}catch(e){gt.error(e),Je()}}function ct(){if(gt.debug("[RtcSessionController]: renegotiateMedia()"),pe()){H?gt.debug("[RtcSessionController]: Local Stream has not been set (holding)"):Ve(),gt.debug("[RtcSessionController]: Creating Local Descriptions...");var e={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:at(B)}};try{T.createOffer(function(t){!p||J&&!B.desktop?(p&&(ke(p),p=null),rt(t)):(e.mandatory.OfferToReceiveVideo=!0,e.mandatory.OfferToReceiveAudio=!1,p.createOffer(function(e){rt(t,e)},function(e){e=e||"Unspecified",gt.error("[RtcSessionController]: Failed to create screenshare Local Description: ",e.message||e),Je()},e))},function(e){e=e||"Unspecified",gt.error("[RtcSessionController]: Failed to create audio/video Local Description: ",e.message||e),Je()},e)}catch(e){gt.error(e),Je()}}else Je()}function lt(e,t,n){if(L===ht.AnswerReceived)return gt.warn("[RtcSessionController]: Still processing the previous answer remote description. Queue the changeMedia"),void(re={mediaType:e,cb:t,screenConstraint:n});Et()?(je(!0,t),"boolean"==typeof e.audio&&(B.audio=e.audio),"boolean"==typeof e.video&&(B.video=e.video),"boolean"==typeof e.hdVideo&&(B.hdVideo=e.hdVideo),"boolean"==typeof e.desktop&&(B.desktop=e.desktop),Ee(ct,Je,n)):Tt(t,"Connection not stable")}function dt(){gt.debug("[RtcSessionController]: Closing the RTC session controller"),Ze(ht.None),M={audio:!1,video:!1},ae&&At.unregEvtHandlers(ae),K&&(window.clearTimeout(K),K=null),q&&(window.clearTimeout(q),q=null);var t,e=D||l;e&&St(e,!1,!e.connectionBypassed),h&&(gt.debug("[RtcSessionController]: Closing the old audio/video RTCPeerConnection"),ke(h,D),h=null),O&&(gt.debug("[RtcSessionController]: Closing the old screenshare RTCPeerConnection"),ke(O),O=null),T&&(gt.debug("[RtcSessionController]: Closing the RTCPeerConnection"),ke(T,l),T=null),p&&(gt.debug("[RtcSessionController]: Closing the Desktop peer connection"),ke(p),p=null),N&&(gt.debug("[RtcSessionController]: Stopping the old MediaStream"),xe(N),N=null),F=G=H=V=k=A=!1,Ye(j=null,R),Ye(null,o),(U||P.length)&&(U=null,P=[],De()),gt.debug("[RtcSessionController]: send Closed event"),ve(g.onClosed,{}),oe=!0,t=(t=["onQosAvailable"])||[],It.forEach(function(e){t.includes(e)||(g[e]=null)})}function ut(){if(!T)return gt.error("[RtcSessionController]: PeerConnection not setup"),!1;if(j)return gt.debug("[RtcSessionController]: DTMF Sender already enabled"),!0;var e=T.getLocalStreams();if(!(0<e.length))return gt.error("[RtcSessionController]: No Local Stream to create DTMF Sender"),!1;var t=e[R].getAudioTracks();return 0<t.length?!!(j=T.createDTMFSender(t[0]))&&(j.ontonechange=fe.bind(null,T),gt.info("[RtcSessionController]: Created DTMF Sender using remote audio track: "+t[0].label),!0):(gt.error("[RtcSessionController]: No Audio Track to create DTMF Sender"),!1)}function Ct(e){if(gt.debug("[RtcSessionController]: startConn()"),e)st(e);else{Ve(),gt.debug("[RtcSessionController]: Creating Local Description...");var t={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:at(B)}};T.createOffer(function(t){if(!p||J&&!B.desktop)rt(t);else{p.createOffer(function(e){rt(t,e)},function(e){e=e||"Unspecified",gt.error("[RtcSessionController]: Failed to create screenshare Local Description: ",e.message||e),Je()},{mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!0}})}},function(e){e=e||"Unspecified",gt.error("[RtcSessionController]: Failed to create Local Description: ",e.message||e),Je()},t)}}function Et(){return T?L===ht.AnswerReceived||L===ht.AnswerApplied?(gt.debug("[RtcSessionController]: isConnStable: Processing remote answer SDP, the connection is considered stable"),!0):L===ht.AnswerSent?(gt.debug("[RtcSessionController]: isConnStable: Answer SDP sent, the connection is considered stable"),!0):A?(gt.warn("[RtcSessionController]: isConnStable: There is a pending media renegotiation"),!1):!("stable"!==T.signalingState&&!T.connectionBypassed&&(gt.warn("[RtcSessionController]: isConnStable: The connection is not established. signalingState =",T.signalingState),!z)):(gt.debug("[RtcSessionController]: isConnStable: There is no connection"),!1)}function Tt(e,t){"function"==typeof e&&window.setTimeout(function(){e(t)},0)}function pt(e){return mt.isMobile()?(gt.debug("[RtcSessionController]: Number of extra video channels for mobile clients is 0 (zero)"),!1):ee?(gt.debug("[RtcSessionController]: Number of extra video channels for large conference is 0 (zero)"),!1):r!==e&&(gt.info("[RtcSessionController]: Set number of extra video channels to",e),r=e,!0)}function St(r,o,a){r?r.stop().then(function(e){var t,n,i;a&&(o||L===ht.AnswerReceived||L===ht.PrAnswerReceived||L===ht.AnswerApplied||L===ht.AnswerSent||L===ht.Connected||L===ht.None)&&e&&(t=e,n=o,i=r.getLastSavedStats(),gt.debug("[RtcSessionController]: send QosAvailable event"),ve(g.onQosAvailable,{qos:t,renegotiationInProgress:n,lastSavedStats:i})),o||(g.onQosAvailable=null)}):o||(g.onQosAvailable=null)}var It=["onIceCandidate","onSessionDescription","onSdpConnected","onIceConnected","onIceDisconnected","onRemoteVideoAdded","onRemoteVideoRemoved","onRemoteStreamUpdated","onDTMFToneChange","onClosed","onRtcError","onRtcWarning","onLocalStreamEnded","onScreenSharePointerStatus","onMediaUpdate","onLocalVideoStream","onRemoteStreams","onGetUserMediaException","onQosAvailable","onStatsNoOutgoingPackets","onStatsThresholdExceeded","onNetworkQuality"];It.forEach(function(e){g[e]=null}),this.setTurnCredentials=function(e){u=e||{}},this.setTurnUris=function(e){e&&e.length&&(d=e)},this.getLocalVideoStream=function(){return b||y},this.getLocalDesktopStream=function(){return b},this.getRemoteAudioStream=function(){return U},this.getRemoteVideoStreams=function(){return P},this.getSdpStatus=function(){return L},this.getWarmedUpSdp=function(){return X},this.isHolding=function(){return H&&!k||V},this.isHoldInProgress=function(){return k},this.isRetrieveInProgress=function(){return V},this.isHeld=function(){return G},this.getActiveMediaType=function(){return mt.shallowCopy(M)},this.getMediaConstraints=function(){return mt.shallowCopy(B)},this.getLocalMediaType=function(){return{audio:B.audio&&M.audio,video:B.video&&M.video,desktop:B.desktop&&M.video}},this.hasScreenShare=function(){return!!b},this.warmup=function(e,t,n,i,r){return n=n||function(){},i=i||function(){},oe?(gt.error("[RtcSessionController]: Warmup Connection failed: Session already terminated"),void Tt(i,"res_UnexpectedError")):(_t.isNoOfferSdp(t)&&(t=null),e=Ue(e),gt.info("[RtcSessionController]: Warming up the connection - mediaType = ",e),f.enabled?L!==ht.None?(gt.error("[RtcSessionController]: The connection has already been started"),void Tt(i,"res_UnexpectedError")):((B=e).audio||(F=!0),void Ee(function(){t&&(X=t),Q=!0,pe(),n()},function(e){Je(e,i)},r)):(gt.warn("[RtcSessionController]: WebRTC not supported by browser"),void Tt(i,"res_NoWebRTC")))},this.start=function(e,t){if(oe)return gt.error("[RtcSessionController]: Start Connection failed: Session already terminated"),!1;if(e=Ue(e),gt.info("[RtcSessionController]: Start Connection - mediaType =",e),!f.enabled)return gt.warn("[RtcSessionController]: WebRTC not supported by browser"),he("res_NoWebRTC"),!1;if(L!==ht.None)return gt.error("[RtcSessionController]: The connection has already been started"),he("res_UnexpectedError"),!1;if(gt.debug("[RtcSessionController]: Creating Peer Connection..."),Q){if(t=X,X=null,F=!e.audio||ee,!pe())return he("res_RTCError"),!1;if(e.audio===B.audio&&e.video===B.video&&e.hdVideo===B.hdVideo&&e.desktop===B.desktop)return Ct(t),!0;Ye(null,R)}return pe()?(B=e,Ee(function(){Ct(t)},Je),!0):(he("res_RTCError"),!1)},this.addIceCandidates=function(e,t){gt.info("[RtcSessionController]: Add remote ICE candidates");var n=T||p;if(n){var i=n.remoteOrigin;e&&e!==i?(gt.warn("[RtcSessionController]: Ignoring remote ICE candidates - origin does not match."),gt.debug("[RtcSessionController]: ICE candidate origin: ",e),gt.debug("[RtcSessionController]: SDP origin: ",i)):(t.forEach(function(e){(e=JSON.parse(e)).candidate&&(e.candidate=e.candidate.replace(/(a=)*([^\r]+)(\r\n)*/i,"$2")),gt.debug("[RtcSessionController]: Remote ICE candidate",e),e.candidate&&"end-of-candidates"!==e.candidate?p&&e.sdpMid===s?(e.sdpMLineIndex=0,p.addIceCandidate(e)):T?T.addIceCandidate(e):gt.warn("[RtcSessionController]: Ignoring remote ICE candidate - no peer connection found."):gt.debug("[RtcSessionController]: Ignoring end-of-remote-candidates indication.")}),He())}else gt.warn("[RtcSessionController]: Ignoring remote ICE candidates - no peer connection found.")},this.setRemoteDescription=function(e,t){if(gt.info("[RtcSessionController]: Set Remote Description - type: ",e.type),X=null,L===ht.AnswerReceived)return gt.info("[RtcSessionController]: Still processing the previous answer remote description. Queue the new one"),void(ie={sdp:e,cb:t});if(L===ht.PrAnswerReceived)return"answer"===e.type&&(Ze(ht.AnswerReceived),He()),gt.info("[RtcSessionController]: SDP already applied. Ignoring any later remote SDPs"),void Tt(t);if("offer"===e.type){if(!Et())return void Tt(t,"Connection not stable");je(!1,t),Ee(function(){st(e)},Je)}else"sdp"===e.sdp||"data"===e.sdp?(Ze(ht.AnswerReceived),A&&Xe(),He()):st(e),Tt(t)},this.renegotiateMedia=function(e){gt.info("[RtcSessionController]: Start Media Renegotiation from client"),Et()||Tt(e,"Connection not stable"),je(!0,e),Ee(ct,Je)},this.enableRemoteVideo=function(){J&&(gt.info("[RtcSessionController]: Enable receiving remote video"),J=!1)},this.disableRemoteVideo=function(){J||(gt.info("[RtcSessionController]: Disable receiving remote video"),J=!0)},this.addAudio=function(e){gt.info("[RtcSessionController]: Add Audio"),lt({audio:!0},e)},this.removeAudio=function(e){gt.info("[RtcSessionController]: Remove Audio"),lt({audio:!1},e)},this.addVideo=function(e){gt.info("[RtcSessionController]: Add Video"),lt({video:!0},e)},this.removeVideo=function(e){gt.info("[RtcSessionController]: Remove Video"),lt({video:!1},e)},this.addDesktop=function(e){gt.info("[RtcSessionController]: Add Desktop (screen sharing)"),lt({desktop:!0},e)},this.removeDesktop=function(e){gt.info("[RtcSessionController]: Remove Desktop (screen sharing)"),lt({desktop:!1},e)},this.changeMediaType=function(e,t,n,i){if(gt.info("[RtcSessionController]: Change media type: ",e),!e)return gt.warn("[RtcSessionController]: Invalid media type"),void Tt(n,"Invalid media type");I=!!t,lt(e,n,i)},this.holdCall=function(e){if(gt.info("[RtcSessionController]: Hold Call"),Et()){if(H)return gt.warn("[RtcSessionController]: The call is already held"),void Tt(e);je(k=H=!0,e),Ee(ct,Je)}else Tt(e,"Connection not stable")},this.retrieveCall=function(e){if(gt.info("[RtcSessionController]: Retrieve Call"),Et()){if(!H)return gt.warn("[RtcSessionController]: The call is not held"),void Tt(e);je(V=!(H=!1),e),Ee(ct,Je)}else Tt(e,"Connection not stable")},this.renegotiationFailed=function(e){A&&(m||Ne("res_RTCError"),ze(e))},this.mute=function(e){gt.info("[RtcSessionController]: Mute Call"),qe(!1),Tt(e)},this.unmute=function(e){gt.info("[RtcSessionController]: Unmute Call"),qe(!0),Tt(e)},this.isMuted=function(){return F},this.isLocalMuteAllowed=function(){return F||c[R]&&c[R].getAudioTracks().length},this.setCallStatsOptions=function(e){l&&e&&(gt.debug("[RtcSessionController]: Setting call stats options: ",e),l.setOptions(e))},this.terminate=function(){gt.info("[RtcSessionController]: Terminate the RTC session controller"),dt()},this.canSendDTMFDigits=function(){return!(!j&&!ut())&&(j&&j.canInsertDTMF)},this.sendDTMFDigits=function(e){return gt.info("[RtcSessionController]: Send DTMF Digits - digits=",e),!!Et()&&(!(!j&&!ut())&&(j.canInsertDTMF?(j.insertDTMF(e,200,50),!0):(gt.error("[RtcSessionController]: DTMF Sender cannot insert DTMF digits: "+e),!1)))},this.setMockedCall=function(){z=!0},this.getCurrentPeerConnection=function(){return T.mainPeerConnection},this.setExtraVideoChannelsForParticipants=function(e){var t=0;return e&&2<e&&(t=e-2,t=Math.max(t,2),t=Math.min(t,2)),pt(t)},this.setExtraVideoChannels=function(e){return 0<(e=e||0)&&(e=Math.max(e,2),e=Math.min(e,2)),pt(e)},this.useMaxNumberOfExtraVideoChannels=function(){return pt(2)},this.getNumberOfExtraVideoChannels=function(){return r},this.hasMaxExtraVideoChannels=function(){return!!mt.isMobile()||2===r},this.isConnStable=function(){return Et()},this.isConnected=function(){return L===ht.Connected||A},this.disableIncomingVideo=function(){$.forEach(function(e){0<e.getVideoTracks().length&&(e.getVideoTracks()[0].enabled=!1)})},this.enableIncomingVideo=function(){$.forEach(function(e){0<e.getVideoTracks().length&&(e.getVideoTracks()[0].enabled=!0)})},this.getLocalStream=function(e){return c[e]},this.setLocalStream=function(e,t){c[e]=t},this.getRemoteStreams=function(){return $},this.setIgnoreTurnOnNextPC=function(){gt.debug("[RtcSessionController]: setIgnoreTurnOnNextPC..."),te=!0},this.setIgnoreNextConnection=function(){gt.debug("[RtcSessionController]: setIgnoreNextConnection..."),se=!0},this.getLastSavedStats=function(){var e=D||l;if(e)return e.getLastSavedStats()},gt.debug("[RtcSessionController]: Created new RtcSessionController instance")}return Mt.DEFAULT_CANDIDATES_TIMEOUT=Ot,Mt.DEFAULT_TRICKLE_ICE_TIMEOUT=Dt,Mt.DEFAULT_ENABLE_AUDIO_AGC=!0,Mt.DEFAULT_UPSCALE_FACTOR=1.5,Mt.LOCAL_STREAMS=e,Mt.candidatesTimeout=Ot,Mt.trickleIceTimeout=Dt,Mt.enableAudioAGC=!0,Mt.screenshareUpscaleFactor=1.5,Mt.cmrScreenshareUpscaleFactor=1.5,Mt.allowAllIceCandidatesScreenShare=!0,Mt.disableTrickleIce=!1,Mt.allowOnlyRelayCandidates=!1,Mt.mediaNode=null,Mt.playbackDevices=[],Mt.recordingDevices=[],Mt.ringingDevices=[],Mt.videoDevices=[],Mt.sdpParameters=JSON.parse(JSON.stringify(i)),Mt.xGoogle=JSON.parse(JSON.stringify(r)),Mt.disableDesktopPc=!1,Mt.webRTCIPHandlingPolicy=null,Mt.processClientSettings=function(e){try{Mt.allowAllIceCandidatesScreenShare=void 0===(e=e||{}).allowAllIceCandidatesScreenShare||!!e.allowAllIceCandidatesScreenShare,Mt.disableTrickleIce=void 0!==e.disableTrickleIce&&!!e.disableTrickleIce,Mt.screenshareUpscaleFactor=parseFloat(e.screenshareUpscaleFactor,10)||Mt.DEFAULT_UPSCALE_FACTOR,Mt.cmrScreenshareUpscaleFactor=parseFloat(e.cmrScreenshareUpscaleFactor,10)||Mt.DEFAULT_UPSCALE_FACTOR;var t=e.xGoogle||{};Object.keys(r).forEach(function(e){Mt.xGoogle[e]=void 0!==t[e]?t[e]:JSON.parse(JSON.stringify(r[e]))});var n=e.sdpParameters||{};Object.keys(i).forEach(function(e){Mt.sdpParameters[e]=void 0!==n[e]?n[e]:JSON.parse(JSON.stringify(i[e]))}),gt.info("[RtcSessionController]: Updated RtcSessionController values: ",{allowAllIceCandidatesScreenShare:Mt.allowAllIceCandidatesScreenShare,disableTrickleIce:Mt.disableTrickleIce,screenshareUpscaleFactor:Mt.screenshareUpscaleFactor,cmrScreenshareUpscaleFactor:Mt.cmrScreenshareUpscaleFactor,xGoogle:Mt.xGoogle,sdpParameters:Mt.sdpParameters})}catch(e){gt.error("[RtcSessionController]: Error processing client settings. ",e)}},ft.RtcSessionController=Mt,ft.Enums=ft.Enums||{},ft.Enums.SdpStatus=ht,ft}((Circuit=function(y){"use strict";var l,b=Circuit.logger,u=y.Utils,e=u.isMobile(),P=Object.freeze({GOOG_JITTER_RECEIVED:{StatName:"jr",StatText:"googJitterReceived",Threshold:50,RecurrenceThreshold:e?2:3,reportIssues:!0},GOOG_RTT:{StatName:"rtt",StatText:"googRtt",Threshold:300,RecurrenceThreshold:e?2:3,reportIssues:!0},PACKET_LOSS_RECV:{StatName:"",StatText:"packetLossRecv",Threshold:.05,RecurrenceThreshold:e?2:3,reportIssues:!0},PACKET_LOSS_SEND:{StatName:"",StatText:"packetLossSend",Threshold:.05,RecurrenceThreshold:e?0:3,reportIssues:!0},NO_PACKETS_RECV:{StatName:"",StatText:"noPacketsReceived",Threshold:0,RecurrenceThreshold:e?2:3,reportIssues:!0},ECHO_LIKELIHOOD:{StatName:"ecmax",StatText:"googResidualEchoLikelihoodRecentMax",Threshold:.5,RecurrenceThreshold:e?2:3,reportIssues:!1}}),U=Object.freeze({GOOG_RTT:{StatName:"rtt",StatText:"googRtt",Threshold:300,RecurrenceThreshold:e?2:3},PACKET_LOSS_RECV:{StatName:"",StatText:"packetLossRecv",Threshold:.05,RecurrenceThreshold:e?2:3},PACKET_LOSS_SEND:{StatName:"",StatText:"packetLossSend",Threshold:.05,RecurrenceThreshold:e?0:3}}),L={COLLECTION_INTERVAL:5e3,DELAY_UPON_ANSWER:e?0:5e3,DELAY_RTT_PROCESSING:3},M=Object.freeze({RTP_QUALITY_LOW:{levelName:"low",value:1,threshold:.1},RTP_QUALITY_MEDIUM:{levelName:"medium",value:2,threshold:.03},RTP_QUALITY_HIGH:{levelName:"high",value:3,threshold:0},getLevel:function(e){return e>this.RTP_QUALITY_LOW.threshold?this.RTP_QUALITY_LOW:e>this.RTP_QUALITY_MEDIUM.threshold?this.RTP_QUALITY_MEDIUM:this.RTP_QUALITY_HIGH}}),C=Object.freeze({audioOutputLevel:"aol",bytesReceived:"or",bytesSent:"os",googAvailableSendBandwidth:"abw",googResidualEchoLikelihoodRecentMax:"ecmax",googFrameHeightReceived:"fhr",googFrameHeightSent:"fhs",googFrameWidthReceived:"fwr",googFrameWidthSent:"fws",googFrameRateDecoded:"frd",googFrameRateSent:"frs",googJitterReceived:"jr",googRtt:"rtt",googTransmitBitrate:"tbr",packetsLost:"pl",packetsReceived:"pr",packetsSent:"ps"});function w(n,i,r,o){return new l(function(t){n.getStats?n.getStats(function(e){e?e=function(e,t,n,i,r){if(!t||!n)return null;var o,a,s={startTime:e,pcType:i,audio:{},video:{}},c=t.result?t.result():t;if(!Array.isArray(c))return null;if(c.forEach(function(t){if(t){var n=null;if("googCandidatePair"===t.type&&"true"===t.stat("googActiveConnection"))"Channel-audio-1"===t.stat("googChannelId")?(s.audio.rtt=parseInt(t.stat("googRtt"),10),r&&(o=t.stat("localCandidateId"),s.audio.channelInfo=u.getChannelInfo(t))):(s.video.rtt=parseInt(t.stat("googRtt"),10),r&&(a=t.stat("localCandidateId"),s.video.channelInfo=u.getChannelInfo(t,t.stat("localCandidateId"))));else if("ssrc"===t.type){var e={id:t.id,ssrc:t.stat("ssrc"),timestamp:t.timestamp};t.stat("audioInputLevel")?(s.audio.transmit||(s.audio.transmit=e),n=s.audio.transmit):t.stat("audioOutputLevel")?(s.audio.receive||(s.audio.receive=e),n=s.audio.receive):t.stat("googFrameHeightSent")?(s.video.transmit||(s.video.transmit=e),n=s.video.transmit):t.stat("googFrameHeightReceived")&&(s.video.receive||(s.video.receive=e),n=s.video.receive)}else"VideoBwe"===t.type&&(s.video.bw||(s.video.bw={id:t.id}),n=s.video.bw);t.names&&n&&((t.names()||[]).forEach(function(e){C[e]&&(n[C[e]]=parseFloat(t.stat(e)))}),n.en=t.stat("googCodecName"))}}),r){var l,d=s.audio.channelInfo?1:0;s.video.channelInfo&&d++,c.some(function(e){if(e&&"localcandidate"===e.type){if(o===e.id&&s.audio.channelInfo)return s.audio.channelInfo.ni=e.stat("networkType"),l=l||y.sdpParser.parse(n.localDescription&&n.localDescription.sdp),s.audio.channelInfo.candidate=u.getIceCandidateInfo(e,l,"audio"),--d<=0;if(a===e.id&&s.video.channelInfo)return s.video.channelInfo.ni=e.stat("networkType"),l=l||y.sdpParser.parse(n.localDescription&&n.localDescription.sdp),s.video.channelInfo.candidate=u.getIceCandidateInfo(e,l,"video"),--d<=0}})}return s}(r,e,n,i,o):b.warn("[CallStatsHandler]: getStats["+i+"] did not return a response"),t(e)},function(e){b.warn("[CallStatsHandler]: getStats["+i+"] failed with err = ",e),t()}):t()})}function t(e){if(!Array.isArray(e))throw new Error("peerConnections must be an array");var t=6,u=20,r=e.filter(function(e){return e});if(!e.length)throw new Error("Cannot create CallStatsHandler object without at least one peer connection");var d,C,E,T,p,o,S={},n=null,i=null,I=0,f=[],v=[],R=[],g=[],A=[],_=this;function a(e){var n=[],i=!o;return o=o||i,r.forEach(function(t){t&&(e||"completed"===t.iceConnectionState||"connected"===t.iceConnectionState?t.mainPeerConnection?(n.push(w(t.mainPeerConnection,"AUDIO/VIDEO",t.startTime,i)),t.groupPeerConnections.forEach(function(e){n.push(w(e,"AUX_VIDEO",t.startTime,i))})):n.push(w(t,"SCREEN_SHARE",t.startTime,i)):b.warn("[CallStatsHandler]: Do not collect stats. pc.iceConnectionState = ",t.iceConnectionState))}),new l(function(t){l.all(n).then(function(e){(e=e&&e.filter(function(e,t){return e&&(e.audio&&!e.audio.channelInfo&&v[t]&&(e.audio.channelInfo=v[t]),e.video&&!e.video.channelInfo&&R[t]&&(e.video.channelInfo=R[t])),e}))&&e.length?t(e):t()})})}function m(e,t){var n=0,i=0;return t&&(n=t.pl||0,i=t.ps||0),(e.pl-n)/(e.ps-i||-1)}function N(e,t){var n=0,i=0;return t&&(n=t.pl||0,i=t.pr||0),(e.pl-n)/(e.pr-i+e.pl-n||-1)}function h(e,t,n){var i=n+"Sum",r=n+"Count",o=n+"Max";t?(void 0!==t[i]?(e[i]=t[i]+(e[n]||0),e[r]=++t[r]):(e[i]=e[n]||0,e[r]=1),void 0!==t[o]?e[o]=Math.max(t[o],e[n]||0):e[o]=e[n]||0):(e[i]=e[o]=e[n]||0,e[r]=1)}function O(e,t,n,i,r,o){var a;t.reportIssues?a=e[t.StatText]||{}:a={counter:(e[t.StatText]||{}).counter};var s=t.StatText+"LastViStart",c=t.StatText+"Violations",l=t.StatText+"ViCounter";if(r[s]=o&&o[s],r[c]=o&&o[c],r[l]=o&&o[l]||0,-1===n){if(r[s]){var d=r[c];d=d?d+",":"",r[c]=d+"("+r[s]+","+parseInt((Date.now()-i)/1e3,10)+")",r[l]++,delete r[s]}a.reported?a.counter=++a.counter:a.counter&&(delete e[t.StatText],b.debug("[CallStatsHandler]: issueCounter cleared=",t.StatText))}else a.reported?(a.counter=0,a.value=n):a.counter?(a.counter=++a.counter,a.value=n):(e[t.StatText]={statObj:t,counter:1,value:n},r[l]<u&&(r[s]=parseInt((Date.now()-i)/1e3,10)))}function s(e){if(e&&e.length){var C=!1;e.forEach(function(e,t){var n,i=e.audio&&e.audio.transmit,r=e.audio&&e.audio.receive,o=g[t]||{},a=A[t]||{},s=f[t]||{};r&&s.audio&&s.audio.receive&&!S.sendOnlyStream&&O(o,P.NO_PACKETS_RECV,!(r.pr>s.audio.receive.pr)||-1,e.startTime,e.audio,s.audio);var c,l=P.GOOG_JITTER_RECEIVED;r&&(h(r,s.audio&&s.audio.receive,P.GOOG_JITTER_RECEIVED.StatName),O(o,l,(c=r[l.StatName])&&c>=l.Threshold?c:-1,e.startTime,e.audio,s.audio)),l=P.PACKET_LOSS_SEND,i&&i.pl&&i.ps&&O(o,l,(n=m(i,s.audio&&s.audio.transmit))>=l.Threshold?n:-1,e.startTime,e.audio,s.audio),l=P.PACKET_LOSS_RECV,r&&r.pl&&r.pr&&O(o,l,(n=N(r,s.audio&&s.audio.receive))>=l.Threshold?n:-1,e.startTime,e.audio,s.audio),e.audio&&I>L.DELAY_RTT_PROCESSING&&(h(e.audio,s.audio,P.GOOG_RTT.StatName),O(o,l=P.GOOG_RTT,e.audio.rtt>=l.Threshold?e.audio.rtt:-1,e.startTime,e.audio,s.audio)),l=P.ECHO_LIKELIHOOD,i&&(h(i,s.audio&&s.audio.transmit,P.ECHO_LIKELIHOOD.StatName),O(o,l,(c=i[l.StatName])&&c>=l.Threshold?c:-1,e.startTime,e.audio,s.audio)),i=e.video&&e.video.transmit,r=e.video&&e.video.receive,l=U.PACKET_LOSS_SEND,i&&i.pl&&i.ps&&O(a,l,(n=m(i,s.video&&s.video.transmit))>=l.Threshold?n:-1,e.startTime,e.video,s.video),l=U.PACKET_LOSS_RECV,r&&r.pl&&r.pr&&O(a,l,(n=N(r,s.video&&s.video.receive))>=l.Threshold?n:-1,e.startTime,e.video,s.video),(i||r)&&I>L.DELAY_RTT_PROCESSING&&(h(e.video,s.video,P.GOOG_RTT.StatName),O(a,l=U.GOOG_RTT,e.video&&e.video.rtt>=l.Threshold?e.video.rtt:-1,e.startTime,e.video,s.video)),e.audio&&e.audio.channelInfo&&(v[t]=e.audio.channelInfo),e.video&&e.video.channelInfo&&(R[t]=e.video.channelInfo),f[t]=e,g[t]=o,A[t]=a;var d=D(o),u=D(a);(d||u)&&(C=!0,p||(u=u||"none",p=!0,(d=d||"none").noPacketsReceived?b.warn("[CallStatsHandler]: processRTPStats - No packets received from remote peer"):(b.warn("[CallStatsHandler]: processRTPStats - Quality issues detected",[{audio:d},{video:u}]),_.onThresholdExceeded&&_.onThresholdExceeded())))}),!C&&p&&(b.debug("[CallStatsHandler]: processRTPStats - No quality issues detected. Clear threshold exceeded error."),p=!1,_.onThresholdExceeded&&_.onThresholdExceeded(!0)),(p||I%t==0)&&f.forEach(function(e,t){var n,i,r,o,a;n=e,i=[g[t],A[t]],n&&(n.audio||n.video)&&(r="[CallStatsHandler]: statsReport: audioRtt="+(n.audio&&n.audio.rtt||"n/a")+" videoRtt="+((n.video.receive||n.video.transmit)&&n.video&&n.video.rtt||"n/a"),n.audio&&((o=n.audio.receive)&&(r+="\n audioReceive:  id="+o.id+" pl="+o.pl+" pr="+o.pr+" or="+o.or+" jr="+o.jr),(o=n.audio.transmit)&&(r+="\n audioTransmit: id="+o.id+" pl="+o.pl+" ps="+o.ps+" os="+o.os)),n.video&&((o=n.video.receive)&&(r+="\n videoReceive:  id="+o.id+" pl="+o.pl+" pr="+o.pr+" or="+o.or+" fwr="+o.fwr+" fhr="+o.fhr+" frd="+o.frd),(o=n.video.transmit)&&(r+="\n videoTransmit: id="+o.id+" pl="+o.pl+" ps="+o.ps+" os="+o.os+" fws="+o.fws+" fhs="+o.fhs+" frs="+o.frs)),b.debug(r)),i&&i.length&&(r="[CallStatsHandler]: statsReport:\n",i.forEach(function(t,e){r+=0===e?" Audio issues=":"\n Video issues=";var n=Object.keys(t);n.length?(a=!0,n.forEach(function(e){r+=" "+e+"="+t[e].value+" count="+t[e].counter})):r+=" none"}),a&&b.info(r))}),I++}}function c(){y.isElectron&&b.debug("[CallStatsHandler]: Get RTP stats for local call(s)"),a().then(function(e){e?(y.isElectron&&b.debug("[CallStatsHandler]: Process RTP stats for local call(s)"),s(e),function(e){if(!e||!e.length)return b.debug("[CallStatsHandler]: processNetworkIndication - No stats for network indication.");E||(E=[],C=M.RTP_QUALITY_HIGH,T=!(d={noPacketsSeq:0,qualityLevelSeq:0}));e.forEach(function(e,t){var n=0,i=0,r=e.audio&&e.audio.transmit,o=e.audio&&e.audio.receive,a=!0,s=!0,c=E[t]||{};!r||isNaN(r.pl)||isNaN(r.ps)||(n=m(r,c.audio&&c.audio.transmit)||0,c.audio&&c.audio.transmit&&c.audio.transmit.ps&&(a=r.ps!==c.audio.transmit.ps),a||b.warn("[CallStatsHandler]: processNetworkIndication - No packets sent to remote peer")),!o||isNaN(o.pl)||isNaN(o.pr)||(i=N(o,c.audio&&c.audio.receive)||0,c.audio&&c.audio.receive&&c.audio.receive.pr&&(s=o.pr!==c.audio.receive.pr),s||S.sendOnlyStream||b.warn("[CallStatsHandler]: processNetworkIndication - No packets received from remote peer"));var l={currentPlSend:n,currentPlReceive:i};a?(d.noPacketsSeq=0,l.qualityLevel=M.getLevel(Math.max(n,i))):(d.noPacketsSeq++,1<d.noPacketsSeq?(l.qualityLevel=M.RTP_QUALITY_LOW,_.onNoOutgoingPackets&&_.onNoOutgoingPackets()):l.qualityLevel=M.RTP_QUALITY_HIGH),function(e){var t=d;t.qualityLevel=e.qualityLevel,t.currentPlSend=e.currentPlSend,t.currentPlReceive=e.currentPlReceive;var n=C;n!==t.qualityLevel.value&&b.debug("[CallStatsHandler]: setQualityEstimation - estimation="+t.qualityLevel.value+" seq="+t.qualityLevelSeq+" current="+n);n<t.qualityLevel.value?(t.qualityLevelSeq++,1<t.qualityLevelSeq&&(C=t.qualityLevel.value,t.qualityLevelSeq=0)):(C=t.qualityLevel.value,t.qualityLevelSeq=0);if(n!==C){var i=1===n&&!T;i&&(t.firstTimeLowQuality=i,T=i),_.onNetworkQuality&&_.onNetworkQuality(t)}}(l),E[t]=e})}(e)):y.isElectron&&b.debug("[CallStatsHandler]: No RTP stats collected")})}function D(n){var i=null;return Object.keys(n).forEach(function(e){var t=n[e];t.counter>=t.statObj.RecurrenceThreshold?t.reported?(delete n[e],b.debug("[CallStatsHandler]: issueCounter cleared=",e)):(t.reported=!0,t.counter=0,(i=i||{})[e]=!0):t.reported&&((i=i||{})[e]=!0)}),i}this.start=function(){n||i?(b.debug("[CallStatsHandler]: Restart collecting RTPStats"),E=C=d=null,T=!1):(b.debug("[CallStatsHandler]: Waiting to start collecting RTPstats"),n=window.setTimeout(function(){b.info("[CallStatsHandler]: Start collecting RTPStats"),n=null,I=0,c(),i=window.setInterval(function(){c()},L.COLLECTION_INTERVAL)},L.DELAY_UPON_ANSWER))},this.stop=function(){return new l(function(t){a(!0).then(function(e){t(e)}),n?(b.debug("[CallStatsHandler]: cancel collecting RTPStats "),window.clearTimeout(n),n=null):i&&(b.debug("[CallStatsHandler]: stop collecting RTPStats"),window.clearInterval(i),E=C=d=i=null,T=!1,f&&b.debug("[CallStatsHandler]: savedRTPStats =",f),_.onThresholdExceeded&&_.onThresholdExceeded(!0),p=!1)})},this.onThresholdExceeded=null,this.onNoOutgoingPackets=null,this.onNetworkQuality=null,this.setOptions=function(e){e&&(S=e)},this.getLastSavedStats=function(){return f}}return void 0!==window.Promise&&(l=window.Promise),t.overridePromise=function(e){l=e},y.CallStats=C,y.CallStatsHandler=t,y.RtpStatsConfig=L,y}(Circuit=function(l){"use strict";var d=l.AppMessagingHandlerSingleton,u=l.ChromeExtension,C=l.Constants,E=l.logger,T=l.Utils,p=l.TemasysAdapter,e=function(){var i=d?d.getInstance():null,e={getScreen:function(e,t){t&&t("NOT_SUPPORTED")},unregEvtHandlers:function(){},isScreensharingAvailable:function(){return!1},installExtension:function(){},injectExtensionSvc:function(){},injectTemasysSvc:function(){}},t=T.getBrowserInfo();if(l.isElectron)e.getScreen=function(i,r){var e=require("electron").ipcRenderer;e.once("screenshare-chooser",function(e,t,n){"share"===t?(E.info("[ScreenSharingController]: Got screen share stream. Stream id: ",n.streamId),i&&i({streamId:n.streamId,pointer:n.pointer})):"cancel"===t&&(E.info("[ScreenSharingController]: User canceled screen share"),r&&r(C.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED))}),E.info("[ScreenSharingController]: Request screen in Electron"),e.send("screenshare-chooser","open")},e.isScreensharingAvailable=function(){return!0};else if(l.isVdiApp)e.getScreen=function(t,n){i.sendInternalMessage({method:"showwindow"}),window.setTimeout(function(){chrome.desktopCapture.chooseDesktopMedia(["screen"],null,function(e){i.sendInternalMessage({method:"minimizewindow"}),e?t&&t({streamId:e}):n&&n(C.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED)})},0)},e.isScreensharingAvailable=function(){return!0};else if(t.chrome||t.phantomjs){var r,o,a,s=function(e){e&&e===o&&r&&o&&(r.removeEventListener(u.BgTarget.SCREEN_SHARE,o),o=null)},c=function(e,t){if(r)return s(o),o=function(e,t,n){var i=n.data;switch(n.suppressLog||E.info("[ScreenSharingController]: Received screenshare event from extension - ",i.type),i.type){case u.BgScreenShareMsgType.CHOOSE_DESKTOP_MEDIA_DONE:E.info("[ScreenSharingController]: CHOOSE_DESKTOP_MEDIA done. Stream Id:",i.streamId),s(o),e&&e({streamId:i.streamId});break;case u.BgScreenShareMsgType.CHOOSE_DESKTOP_MEDIA_CANCELLED:E.info("[ScreenSharingController]: CHOOSE_DESKTOP_MEDIA cancelled"),s(o),t(C.ReturnCode.CHOOSE_DESKTOP_MEDIA_CANCELLED)}}.bind(null,e,t),r.addEventListener(u.BgTarget.SCREEN_SHARE,o),o};e.getScreen=function(e,t){var n=null;return a&&a.isExtensionRunning()?(n=c(e,t),r.getScreenShareUserMedia(function(e){e&&(E.warn("[ScreenSharingController]: Error starting screen share using chrome extension: ",e),s(n),t("res_AccessToExtensionFailed"))})):t("res_AccessToExtensionFailed"),n},e.isScreensharingAvailable=function(){return!!a&&a.isExtensionRunning()},e.installExtension=function(){a&&(E.debug("[ScreenSharingController]: Install Chrome extension"),a.installExtension(!0).then(function(){E.info("[ScreenSharingController]: Chrome extension was successfully installed")}).catch(function(e){E.warn("[ScreenSharingController]: Failed to install Chrome extension. ",e)}))},e.injectExtensionSvc=function(e,t){a=e,r=t},e.unregEvtHandlers=s}else if(t.msie){var n;e.getScreen=function(e,t){p&&p.isScreensharingAvailable()?e&&e():t&&t("NOT_AVAILABLE")},e.isScreensharingAvailable=function(){return!!p&&p.isScreensharingAvailable()},e.installExtension=function(){n&&n.showPopup()},e.injectTemasysSvc=function(e){n=e}}else if(t.firefox){e.getScreen=function(e){e&&e()},e.isScreensharingAvailable=function(){return 33<=parseInt(t.version,10)}}else"Android"!==window.navigator.platform&&"iOS"!==window.navigator.platform||(e.getScreen=function(e){e&&e()},e.isScreensharingAvailable=function(){return!0});return e}();return l.ScreenSharingController=e,l}((Circuit=function(y){"use strict";var b=y.logger,e=y.BaseCall,P=y.Enums.CallState,n=y.Enums.ParticipantState,U=y.Utils,L=y.Constants,t=Object.freeze({SERVER_ENDED_PRFX:"SERVER_ENDED:"}),i="CLIENT_ENDED:",r=Object.freeze({CLIENT_ENDED_PRFX:i,ANOTHER_CLIENT_ANSWERED:i+"ANOTHER_CLIENT_ANSWERED",ANOTHER_CLIENT_REJECTED:i+"ANOTHER_CLIENT_REJECTED",ANOTHER_CLIENT_PULLED_CALL:i+"ANOTHER_CLIENT_PULLED_CALL",CALL_MOVED_TO_ANOTHER_CONV:i+"CALL_MOVED_TO_ANOTHER_CONV",CALLER_LEFT_CONFERENCE:i+"CALLER_LEFT_CONFERENCE",ENDED_BY_ANOTHER_USER:i+"ENDED_BY_ANOTHER_USER",LOST_WEBSOCKET_CONNECTION:i+"LOST_WEBSOCKET_CONNECTION",NO_USERS_LEFT:i+"NO_USERS_LEFT",REQUEST_TO_SERVER_FAILED:i+"REQUEST_TO_SERVER_FAILED",RTC_SESSION_START_FAILED:i+"RTC_SESSION_START_FAILED",SET_REMOTE_SDP_FAILED:i+"SET_REMOTE_SDP_FAILED",USER_ENDED:i+"USER_ENDED",LOST_MEDIA_STREAM:i+"LOST_MEDIA_STREAM",ICE_TIMED_OUT:i+"ICE_TIMED_OUT",USER_LOGGED_OUT:i+"USER_LOGGED_OUT",PAGE_UNLOADED:i+"PAGE_UNLOADED",DISCONNECTED:i+"WS_DISCONNECTED",FAILED_TO_SEND:i+"WS_FAILED_TO_SEND",REQUEST_TIMEOUT:i+"WS_REQUEST_TIMEOUT",MEDIA_RENEGOTIATION:i+"MEDIA_RENEGOTIATION"});function M(e,t){var o=y.WebRTCAdapter;t=t||{};var a=y.RtcSessionController;if(!e||!e.rtcSessionId)throw new Error("Cannot create LocalCall object without a valid conversation");M.parent.constructor.call(this,e,!1);var s=this,n=null,i=!1,r=null,c=!1,l=!1,d=!1,u=!1,C=!1,E=!1,T=null,p=null,S=null,I=null,f=!1,v=[],R=[],g=[],A="",_="",m=!1;function N(){b.debug("[LocalCall]: RtcSessionController - onMediaUpdate: callId =",s.callId),s.activeMediaType=n.getActiveMediaType(),b.debug("[LocalCall]: Set active media type to ",s.activeMediaType),s.localMediaType=n.getMediaConstraints(),b.debug("[LocalCall]: Set local media type to ",s.localMediaType),s.updateMediaType(),s.updateCallState()}function h(e){b.debug("[LocalCall]: RtcSessionController - onLocalVideoStream: callId =",s.callId),s.localVideoStream=e.stream,A="",b.debug("[LocalCall]: Set local video stream to",e.stream&&e.stream.id||"<null>")}function O(e){b.debug("[LocalCall]: RtcSessionController - onScreenSharePointerStatus",e),s.pointer={isSupported:e.isSupported,isEnabled:e.isEnabled}}function D(e){b.debug("[LocalCall]: RtcSessionController - onRemoteStreams: callId =",s.callId),s.remoteAudioStream=e.audio&&e.audio.stream||null,_="",b.debug("[LocalCall]: Set remote audio stream to",s.remoteAudioStream&&s.remoteAudioStream.id||"<empty>"),s.remoteVideoStreams=e.video||[],b.debug("[LocalCall]: Set remote video streams to",e.video||"<empty>"),s.participants.forEach(function(e){s.setParticipantRemoteVideoStream(e)}),s.checkForActiveRemoteVideo()}Object.defineProperties(this,{sessionCtrl:{get:function(){return n},enumerable:!0,configurable:!1},isVdi:{get:function(){return!!n.isRemoteController},enumerable:!0,configurable:!1},locallyMuted:{get:function(){return n.isMuted()},enumerable:!0,configurable:!1},remoteVideoDisabled:{get:function(){return l},enumerable:!0,configurable:!1},remoteAudioDisabled:{get:function(){return d},enumerable:!0,configurable:!1},isMocked:{get:function(){return C},enumerable:!0,configurable:!1},isMeetingPointInvited:{get:function(){return E},enumerable:!0,configurable:!1},ringAllAllowed:{get:function(){return!!(this.peerUsers&&0<this.peerUsers.length&&this.peerUsers.length<=9)},enumerable:!0,configurable:!1},ringAllMaxNumber:{get:function(){return 9},enumerable:!0,configurable:!1},conversationFeedView:{get:function(){return m||this.state===P.Ringing},set:function(e){m=e},enumerable:!0,configurable:!1},curtain:{get:function(){return T||{}},set:function(e){var t;(t=e)&&t.curtainState&&(T&&(t.lastCurtainState=T.curtainState),(T=t).curtainClosed=t.curtainState!==L.CurtainState.OPEN)},enumerable:!0,configurable:!1},playbackDevice:{get:function(){return p},enumerable:!0,configurable:!1},recordingDevice:{get:function(){return S},enumerable:!0,configurable:!1},videoDevice:{get:function(){return I},enumerable:!0,configurable:!1},playbackDeviceList:{get:function(){return v},enumerable:!0,configurable:!1},recordingDeviceList:{get:function(){return R},enumerable:!0,configurable:!1},videoDeviceList:{get:function(){return g},enumerable:!0,configurable:!1},atcAdvancing:{get:function(){return f},set:function(e){f=!!e},enumerable:!0,configurable:!1},savedRTPStats:{get:function(){if(this.sessionCtrl)return this.sessionCtrl.getLastSavedStats()},enumerable:!0,configurable:!1},isDtmfAllowed:{get:function(){return!!this.checkState([P.Active,P.Delivered])&&(!!this.sessionCtrl.canSendDTMFDigits()||!!this.checkState(P.Active)&&!!this.atcCallInfo)},enumerable:!0,configurable:!1},localVideoUrl:{get:function(){return b.warn("[LocalCall]: localVideoUrl is deprecated and will eventually be removed"),A=s.localVideoStream?A||o.createObjectURL(s.localVideoStream):""},enumerable:U.isMobile(),configurable:!1},remoteAudioUrl:{get:function(){return b.warn("[LocalCall]: remoteAudioUrl is deprecated and will eventually be removed"),_=s.remoteAudioStream?_||o.createObjectURL(s.remoteAudioStream):""},enumerable:U.isMobile(),configurable:!1},remoteVideoUrlStreams:{get:function(){return b.warn("[LocalCall]: remoteVideoUrlStreams is deprecated and will eventually be removed"),s.remoteVideoStreams.map(function(e){return e.url||(e.url=o.createObjectURL(e.stream)),{streamId:e.streamId,url:e.url}})},enumerable:U.isMobile(),configurable:!1}}),this.localVideoStream=null,this.remoteAudioStream=null,this.remoteVideoStreams=[],this.activeMediaType={audio:!1,video:!1,desktop:!1},this.ringingTimeout=15e3,this.whiteboardEnabled=!1,this.whiteboard=null,this.pointer={isSupported:!1,isEnabled:!1},this.badQualityNotification={detected:!1,acted:!1,dismissed:!1},this.clientId=t.clientId,this.terminate=function(){i||(b.debug("[LocalCall]: Terminating call with callId =",this.callId),n&&(n.onMediaUpdate=null,n.onLocalVideo=null,n.onRemoteStreams=null,n.onScreenSharePointerStatus=null),n.terminate(),_=A="",this.localVideoStream=null,this.remoteAudioStream=null,this.remoteVideoStreams=[],M.prototype.terminate.call(this),this.stopRingingTimer(),i=!0)},this.setMockedCall=function(){var t;(b.debug("[LocalCall]: Setting call as mocked"),C=!0,n.setMockedCall(),0===n.getNumberOfExtraVideoChannels())?(this.participants.forEach(function(e){e.streamId="",(e.mediaType.desktop||!t&&e.mediaType.video)&&(t=e)}),t&&(t.streamId="mock")):this.participants.forEach(function(e){e.streamId=e.mediaType.video||e.mediaType.desktop?"mock":""});window.setTimeout(function(){this.state!==P.Terminated&&(b.debug("[LocalCall]: Initialize remote mocked streams"),D({audio:null,video:[{streamId:"mock",stream:"content/images/mock/trailer.mp4"}]}),n.onRemoteStreams=null)},100)},this.startRingingTimer=function(e){"function"==typeof e&&(b.info("[LocalCall]: Starting ringing timer for callId =",s.callId),r=window.setTimeout(function(){b.info("[LocalCall]: Ringing timeout for callId =",s.callId),r=null,e()},this.ringingTimeout))},this.stopRingingTimer=function(){r&&(b.info("[LocalCall]: Cancelling ringing timer for callId =",s.callId),window.clearTimeout(r),r=null)},this.hasRemoteVideo=function(){return c},this.checkForActiveRemoteVideo=function(){c=!l&&this.participants.some(function(e){return!!e.videoStream}),b.debug("[LocalCall]: Set hasActiveRemoteVideo to ",c)},this.enableRemoteVideo=function(){l&&(l=!1,this.checkForActiveRemoteVideo(),this.sessionCtrl.enableRemoteVideo(),b.debug("[LocalCall]: Enabled remote video"))},this.disableRemoteVideo=function(){l||(c=!(l=!0),this.participants.forEach(function(e){e.videoStream=null,s.isDirect&&(e.streamId="")}),this.sessionCtrl.disableRemoteVideo(),b.debug("[LocalCall]: Disabled remote video"))},this.enableRemoteAudio=function(){d&&(d=!1,b.debug("[LocalCall]: Enabled remote audio."))},this.disableRemoteAudio=function(){d||(d=!0,b.debug("[LocalCall]: Disabled remote audio."))},this.setMeetingPointInviteState=function(e){E=!!e,b.debug("[LocalCall]: Set Circuit Meeting Point state to ",e)},this.setHasUnmutedParticipants=function(){u=this.participants.some(function(e){return!e.muted})},this.hasUnmutedParticipants=function(){return u},this.getUnmutedParticipantIds=function(){var t=[];return this.participants.forEach(function(e){e.muted||t.push(e.userId)}),t},this.getMediaNode=function(){return this.isTestCall?a.mediaNode:null},this.updateMediaDevices=function(){var r=function(e){return e?e.filter(function(e){return"default"!==e.id&&"communications"!==e.id&&e.label}).map(function(e){return e.label}):[]};o.getMediaSources(function(e,t,n){if(o.getMediaSourcesSupported){var i=U.selectMediaDevice(n,a.playbackDevices);p=i&&i.label,v=r(n),i=U.selectMediaDevice(e,a.recordingDevices),S=i&&i.label,R=r(e),i=U.selectMediaDevice(t,a.videoDevices),I=i&&i.label,g=r(t)}else p=Audio.getPlaybackDevice&&Audio.getPlaybackDevice(),S=Audio.getRecordingDevice&&Audio.getRecordingDevice(),I=Audio.getVideoDevice&&Audio.getVideoDevice();b.debug("[LocalCall]: Updated media devices: recording="+S+" playback="+p+" video="+I+" callId="+s.callId)})},n||((n=new a({callId:s.callId,isDirectCall:s.isDirect,isTelephonyCall:s.isTelephonyCall,isLargeConference:s.isLarge,isAtcPullCall:t.isAtcPullCall,reuseDesktopStreamFrom:t.reuseDesktopStreamFrom})).onMediaUpdate=N,n.onLocalVideoStream=h,n.onRemoteStreams=D,n.onScreenSharePointerStatus=O,s.isDirect||n.setExtraVideoChannelsForParticipants(s.numConvParticipants)),e=null,s.updateMediaDevices(),b.info("[LocalCall]: Created new WebRTC call with callID = ",this.callId)}function o(e,t){var n;t.mediaType.video||t.mediaType.desktop?0===e.sessionCtrl.getNumberOfExtraVideoChannels()?(e.participants.some(function(e){if(e.streamId)return n=e,!0}),t.streamId=n&&n.userId!==t.userId?"":"mock"):t.streamId="mock":t.streamId=""}return U.inherit(M,e),M.prototype.hasRemoteMedia=function(){return!(!this.remoteAudioStream&&!this.remoteVideoStreams.length)},M.prototype.hasRemoteScreenShare=function(){return this.mediaType.desktop&&!this.remoteVideoDisabled&&(!this.localMediaType.desktop||this.isDirect&&this.participants[0].mediaType.desktop)},M.prototype.addParticipant=function(e){this.isMocked&&e&&e.mediaType&&o(this,e);var t=M.parent.addParticipant.apply(this,arguments);return t&&(this.setParticipantRemoteVideoStream(t),this.checkForActiveRemoteVideo(),this.setHasUnmutedParticipants()),t},M.prototype.updateParticipant=function(e){this.isMocked&&e&&e.mediaType&&o(this,e);var t=M.parent.updateParticipant.apply(this,arguments);return t&&(this.setParticipantRemoteVideoStream(t),this.checkForActiveRemoteVideo(),this.setHasUnmutedParticipants()),t},M.prototype.removeParticipant=function(){var e=M.parent.removeParticipant.apply(this,arguments);return e&&this.setHasUnmutedParticipants(),e},M.prototype.setParticipantRemoteVideoStream=function(t){if(t.videoStream=null,this.isDirect&&(t.streamId=""),!this.remoteVideoDisabled)if(!t.mediaType||t.mediaType.video||t.mediaType.desktop){if(this.isDirect){if(this.remoteVideoStreams&&this.remoteVideoStreams.length){var e=this.remoteVideoStreams[this.remoteVideoStreams.length-1];t.streamId=e.streamId,t.videoStream=e.stream,t.pcState=t.muted?n.Muted:n.Active}}else{if(!t.streamId&&!t.screenStreamId)return void b.info("[LocalCall]: The participant does not have a video streamId. userId = ",t.userId);this.remoteVideoStreams&&this.remoteVideoStreams.length&&this.remoteVideoStreams.some(function(e){if(e.streamId===t.streamId||e.streamId===t.screenStreamId)return t.videoStream=e.stream,t.pcState=t.muted?n.Muted:n.Active,b.debug("[LocalCall]: Set remote video stream for participant: ",t),!0})}t.videoStream||b.debug("[LocalCall]: We still do not have a video stream for the participant. ",t)}else b.debug("[LocalCall]: The participant does not have video or screen-share. Do not set video stream. userId = ",t.userId)},M.prototype.hasLocalScreenShare=function(){return this.sessionCtrl.hasScreenShare()},M.prototype.isMuted=function(){return this.remotelyMuted||this.locallyMuted},M.prototype.mute=function(e){return this.checkState(P.Terminated)?(b.error("[LocalCall]: Cannot mute a call that has already been terminated"),!1):(b.debug("[LocalCall]: Mute call with callId =",this.callId),this.sessionCtrl.mute(e))},M.prototype.unmute=function(e){return this.checkState(P.Terminated)?(b.error("[LocalCall]: Cannot mute a call that has already been terminated"),!1):(b.debug("[LocalCall]: Unmute call with callId =",this.callId),this.sessionCtrl.unmute(e))},M.prototype.isLocalMuteAllowed=function(){return this.sessionCtrl.isLocalMuteAllowed()},M.prototype.toggleMute=function(){return this.sessionCtrl.isMuted()?this.unmute():this.mute()},M.prototype.setActiveSpeakers=function(n){if(!n)return!1;n instanceof Array||(n=[n]);var i=!1;return this.participants.forEach(function(e){var t=-1!==n.indexOf(e.userId);e.activeSpeaker!==t&&(e.activeSpeaker=t,i=!0)}),i},M.prototype.updateCallState=function(){var e;this.state.established&&(e=!this.sessionCtrl.isConnected()||!this.isDirect&&!this.hasOtherParticipants()||this.isATCCall&&!this.getCstaState().established?P.Waiting:this.sessionCtrl.isHolding()?P.Holding:this.sessionCtrl.isHeld()?P.Held:P.Active,this.setState(e))},y.LocalCall=M,y.Enums.CallServerTerminatedReason=t,y.Enums.CallClientTerminatedReason=r,y}((Circuit=function(e){"use strict";var t=Object.freeze({Disconnected:"Disconnected",Unregistered:"Unregistered",Registering:"Registering",Registered:"Registered"});return e.Enums=e.Enums||{},e.Enums.AtcRegistrationState=t,e}((Circuit=function(e){"use strict";var t=e.BaseCall,n=e.Enums.CallState,i=e.Proto;function r(e){var t=Circuit.logger;if(!e||!e.rtcSessionId)throw new Error("Cannot create RemoteCall object without a valid conversation");r.parent.constructor.call(this,e,!0),Object.defineProperties(this,{isPullAllowed:{get:function(){return!this.pullNotAllowed&&this.state===n.ActiveRemote},enumerable:!0,configurable:!1}}),e=this.activeClient=null,t.info("[RemoteCall]: Created new remote call with callID = ",this.callId)}return e.Utils.inherit(r,t),r.prototype.setActiveClient=function(e){e&&(e.userId?(this.activeClient={clientId:e.clientId,clientDisplayName:e.clientDisplayName,mediaType:i.getMediaType(e.mediaTypes)},this.pullNotAllowed=!1===e.pullCall):this.activeClient=e)},e.RemoteCall=r,e}((Circuit=function(e){"use strict";var f=e.Constants,t=e.Enums.CstaCallState,n=e.DefaultAvatars,v=e.logger,i=e.Enums.ParticipantState,r=e.RtcParticipant,R=e.UserProfile,g=e.Utils,A=Object.freeze({INCOMING:"incoming",OUTGOING:"outgoing",NONE:""}),_=Object.freeze({Idle:{name:"Idle",ui:"",established:!1},Initiated:{name:"Initiated",ui:"res_Calling",established:!1,css:"outgoing"},Connecting:{name:"Connecting",ui:"",established:!1,css:"connecting"},Delivered:{name:"Delivered",ui:"res_Calling",established:!1,css:"outgoing"},Busy:{name:"Busy",ui:"res_BusyCall",established:!1,css:"busy"},Failed:{name:"Failed",ui:"res_FailedCall",established:!1,css:"failed"},Missed:{name:"Missed",ui:"res_MissedCall",established:!1,css:"missed"},Declined:{name:"Declined",ui:"res_CallDeclined",established:!1,css:"declined"},NotAnswered:{name:"NotAnswered",ui:"res_CallNotAnswered",established:!1,css:"not-answered"},Ringing:{name:"Ringing",ui:"res_IncomingCall",established:!1,css:"incoming"},Answering:{name:"Answering",ui:"res_IncomingCall",established:!1,css:"answering"},Active:{name:"Active",ui:"",established:!0,css:"active-call"},Held:{name:"Held",ui:"res_OnHold",established:!0,css:"active-call"},Holding:{name:"Holding",ui:"res_Holding",established:!0,css:"holding-call"},HoldOnHold:{name:"HoldOnHold",ui:"res_Holding",established:!0,css:"holding-call"},Waiting:{name:"Waiting",ui:"res_Waiting",established:!0,css:"waiting"},Started:{name:"Started",ui:"res_InProgress",established:!1,css:"started"},NotStarted:{name:"NotStarted",ui:"res_NotStarted",established:!1,css:"not-started"},ActiveRemote:{name:"ActiveRemote",ui:"res_RemoteCall",established:!0,css:"active-call-remote"},Terminated:{name:"Terminated",ui:"res_Terminated",established:!1,css:"declined"}});function o(e,t){if(!e)throw new Error("Cannot create BaseCall object without a conversation");t=!!t;var n=this,i=null,r=null,o=null,a=null,s=null,c=null,l=null,d=null,u=!1,C=!1,E=!1,T=!1,p=_.Idle,S=null;function I(e){i=e.rtcSessionId,o=e.convId,a=e.type,s=e.topic||e.participantFirstNames||null,c=e.topicEscaped||e.participantFirstNamesEscaped||null,l=e.creatorId,u=e.type===f.ConversationType.DIRECT,C=e.type===f.ConversationType.LARGE,E=e.isTelephonyConv,T=e.testCall,u?n.peerUser=e.peerUser:delete n.peerUser,n.peerUsers=e.peerUsers,n.numConvParticipants=e.participants.length,n.avatar=e.avatar,n.isGuestInvite=!!e.isTemporary}Object.defineProperties(this,{isRemote:{value:t,writable:!1,enumerable:!0,configurable:!1},callId:{get:function(){return i},enumerable:!0,configurable:!1},instanceId:{get:function(){return r},enumerable:!0,configurable:!1},transactionId:{get:function(){return d},enumerable:!0,configurable:!1},state:{get:function(){return p},enumerable:!0,configurable:!1},convId:{get:function(){return o},enumerable:!0,configurable:!1},convType:{get:function(){return a},enumerable:!0,configurable:!1},convTitle:{get:function(){return s||(u?this.peerUser.displayName:"")},enumerable:!0,configurable:!1},convTitleEscaped:{get:function(){return c||(u?this.peerUser.displayNameEscaped:"")},enumerable:!0,configurable:!1},containsExternals:{get:function(){return this.participants.some(function(e){return e.participantType===f.RTCParticipantType.SESSION_GUEST||e.participantType===f.RTCParticipantType.EXTERNAL})},enumerable:!1,configurable:!1},ownerId:{get:function(){return l},enumerable:!0,configurable:!1},isDirect:{get:function(){return u},enumerable:!0,configurable:!1},isLarge:{get:function(){return C},enumerable:!0,configurable:!1},conferenceCall:{get:function(){return!u},enumerable:!0,configurable:!1},isGroupCallStarted:{get:function(){return!(this.isDirect||this.state!==_.Started)},enumerable:!0,configurable:!1},isGroupCallInitiated:{get:function(){return!(this.isDirect||this.state!==_.Initiated)},enumerable:!0,configurable:!1},isGroupCallActive:{get:function(){return!(this.isDirect||this.state!==_.Active)},enumerable:!0,configurable:!1},isTelephonyCall:{get:function(){return E},enumerable:!0,configurable:!1},isTestCall:{get:function(){return T},enumerable:!0,configurable:!1},conversationFeedView:{get:function(){return!0},enumerable:!0,configurable:!0},isPullAllowed:{value:!1,enumerable:!0,configurable:!0},isHandoverAllowed:{get:function(){return!!this.atcCallInfo&&this.atcCallInfo.isHandoverAllowed()},enumerable:!0,configurable:!0},isHandoverInProgress:{get:function(){return!!this.atcCallInfo&&this.atcCallInfo.isHandoverInProgress()},enumerable:!0,configurable:!0},redirectingUser:{get:function(){return this.getRedirectingUser()},enumerable:!0,configurable:!0},forwarded:{get:function(){return this.isForwarded()},enumerable:!0,configurable:!0},pickupNotification:{get:function(){return this.isPickupNotification()},enumerable:!0,configurable:!0},pickedUp:{get:function(){return this.isPickedUp()},enumerable:!0,configurable:!0},disconnectCause:{get:function(){return S},set:function(e){S=e},enumerable:!0,configurable:!1},transferCallFailedCause:{get:function(){return this.atcCallInfo?this.atcCallInfo.getTransferCallFailedCause():null},enumerable:!0,configurable:!1},isATCCall:{get:function(){return!!this.atcCallInfo},enumerable:!0,configurable:!1},isDtmfAllowed:{get:function(){return!1},enumerable:!0,configurable:!0}}),this.localMediaType={audio:!1,video:!1,desktop:!1},this.mediaType={audio:!1,video:!1,desktop:!1},this.lastMediaType=this.mediaType,this.direction=A.NONE,this.secureCall=!1,this.establishedTime=0,this.creationTime=Date.now(),this.peerUsers=null,this.peerUser=null,this.numConvParticipants=0,this.avatar=null,this.activeNotification=null,this.activeRTPStatsWarning=null,this.participants=[],this.participantsHashTable={},this.attendeeCount=0,this.remotelyMuted=!1,this.sessionMuted=!1,this.sessionLocked=!1,this.recording={state:f.RecordingInfoState.INITIAL,notifyByCurtain:!1,notifyByUser:!1,duration:0,starter:{userId:""},reason:f.RecordingInfoReason.NONE,resumeTime:0,wasStarted:function(){return this.state!==f.RecordingInfoState.INITIAL},isActive:function(){return this.state===f.RecordingInfoState.STARTED||this.state===f.RecordingInfoState.START_PENDING},isPaused:function(){return this.state===f.RecordingInfoState.START_PENDING},isFailed:function(){return this.reason!==f.RecordingInfoReason.NONE&&this.reason!==f.RecordingInfoReason.STOPPED_MANUALLY&&this.reason!==f.RecordingInfoReason.STOPPED_AUTOMATICALLY&&(this.state===f.RecordingInfoState.INITIAL||this.state===f.RecordingInfoState.STOPPED)}},this.setState=function(e,t){e&&e!==p&&(p!==_.Terminated?(v.debug("[BaseCall]: Changing call state from "+p.name+" to "+e.name),this.establishedTime||!e.established||this.isATCCall&&!this.getCstaState().established||(this.establishedTime=Date.now()),(p=e)!==_.Terminated||t||this.terminate()):v.error("[BaseCall]: The call has already been terminated. Cannot set state to ",e.name))},this.checkState=function(e){return Array.isArray(e)?e.some(function(e){return e===p}):e===p},this.updateCall=function(e){return!!e&&(I(e),!0)},this.setPeerUser=function(e,t,n){(this.peerUser.hasTelephonyRole||!this.peerUser.userId||n&&n!==this.peerUser.userId||g.cleanPhoneNumber(e)!==g.cleanPhoneNumber(this.peerUser.phoneNumber))&&(this.peerUser={userId:n||"",firstName:null,lastName:null,displayName:t,phoneNumber:e},R&&R.extend&&(this.peerUser=R.extend(this.peerUser)),c=(s=t||e||null)?g.textToHtmlEscaped(s):null)},this.setTransactionId=function(e){d=e||g.createTransactionId()},this.clearTransactionId=function(){d=null},this.setInstanceId=function(e){r=e},this.setCallIdForTelephony=function(e){n.isTelephonyCall&&e&&e!==i&&(v.debug("[BaseCall]: Changing callId from "+i+" to "+e),i=e)},I(e),e=null}return o.prototype.sameAs=function(e){return!!e&&this.callId===e.callId&&this.isRemote===e.isRemote},o.prototype.terminate=function(){v.debug("[BaseCall]: Terminating call with callId = ",this.callId),this.lastMediaType=this.mediaType,this.mediaType={audio:!1,video:!1,desktop:!1},this.setState(_.Terminated,!0)},o.prototype.isEstablished=function(){return this.state.established},o.prototype.isOutgoingState=function(){return this.state===_.Initiated||this.state===_.Connecting||this.state===_.Delivered||this.state===_.Busy},o.prototype.isPresent=function(){return this.state!==_.Idle&&this.state!==_.Terminated},o.prototype.isHeld=function(){return this.state===_.Held},o.prototype.hasRemoteMedia=function(){return!1},o.prototype.isCallingOut=function(){return this.state===_.Waiting&&0<this.participants.length&&this.participants.every(function(e){return e.pcState===i.Initiated})},o.prototype.hasVideo=function(){return!(!this.mediaType.video&&!this.mediaType.desktop)},o.prototype.updateSecurityStatus=function(e){!0!==e&&!1!==e||(this.secureCall=e)},o.prototype.canToggleVideo=function(){return!this.isRemote&&this.checkState([_.Active,_.Waiting])},o.prototype.hasRemoteVideo=function(){return!1},o.prototype.hasLocalVideo=function(){return this.localMediaType.video||this.localMediaType.desktop},o.prototype.hasLocalScreenShare=function(){return this.localMediaType.desktop},o.prototype.hasRemoteScreenShare=function(){return this.mediaType.desktop&&!this.localMediaType.desktop},o.prototype.isMuted=function(){return!1},o.prototype.mute=function(){return v.warning("[BaseCall]: Mute is not implemented in base object"),!1},o.prototype.unmute=function(){return v.warning("[BaseCall]: Unmute is not implemented in base object"),!1},o.prototype.toggleMute=function(){return v.warning("[BaseCall]: toggleMute is not implemented in base object"),!1},o.prototype.outgoingFailed=function(){return!this.isRemote&&this.direction===A.OUTGOING&&this.checkState([_.Declined,_.Busy,_.NotAnswered,_.Failed])},o.prototype.setPeerUsersAsParticipants=function(){if(this.direction===A.OUTGOING&&this.peerUsers){this.participants=this.peerUsers.map(function(e){return r.createFromUser(e,i.Initiated)});for(var e=0;e<this.participants.length;e++)this.participantsHashTable[this.participants[e].userId]=this.participants[e];v.debug("[BaseCall]: Initialized participants: ",this.participants)}},o.prototype.hasParticipant=function(t){return this.participants.some(function(e){return e.userId===t})},o.prototype.getParticipant=function(e){for(var t=0;t<this.participants.length;t++)if(this.participants[t].userId===e)return this.participants[t];return null},o.prototype.addParticipant=function(e,t,n){return e&&e.userId?(v.debug("[BaseCall]: Add participant with userId =",e.userId),this.hasParticipant(e.userId)?n?this.updateParticipant(e,t):(v.warning("[BaseCall]: addParticipant called with existing participant. userId =",e.userId),null):(t&&(e.pcState=t),this.participants.push(e),this.participantsHashTable[e.userId]=e,v.debug("[BaseCall]: Added participant to call: ",e.userId),e)):(v.warning("[BaseCall]: addParticipant called with invalid participant"),null)},o.prototype.updateParticipant=function(e,t){if(!e||!e.userId)return v.warning("[BaseCall]: updateParticipant called with invalid participant"),null;v.debug("[BaseCall]: Update participant with userId =",e.userId);var n=this.getParticipant(e.userId);return n?(t=t||e.pcState,n.isMeetingPointInvitee&&n.locallyMuted?(n.muted=!0,n.pcState=t!==i.Active?t:i.Muted):(n.muted=e.muted,n.pcState=t),n.streamId=e.streamId,n.screenStreamId=e.screenStreamId,n.mediaType=e.mediaType,n.screenSharePointerSupported=e.screenSharePointerSupported,n.isModerator=e.isModerator,n.isMeetingGuest=e.isMeetingGuest,v.debug("[BaseCall]: Updated participant data for ",n.userId),n):(v.warning("[BaseCall]: The given participant is not part of the call"),null)},o.prototype.removeParticipant=function(e){delete this.participantsHashTable[e];for(var t=0;t<this.participants.length;t++)if(this.participants[t].userId===e){var n=this.participants.splice(t,1)[0];return n.videoStream=null,n.mediaType={audio:!1,video:!1,desktop:!1},v.debug("[BaseCall]: Removed participant from call: ",n.userId),n}return null},o.prototype.setParticipantState=function(t,n){n&&this.participants.some(function(e){if(e.userId===t)return e.pcState=n,v.debug("[BaseCall]: Set participant state to "+n.name+", userId =",e.userId),!0})},o.prototype.hasOtherParticipants=function(){return 0<this.participants.length||0<this.attendeeCount},o.prototype.updateMediaType=function(){var t={audio:this.localMediaType.audio,video:this.localMediaType.video,desktop:this.localMediaType.desktop};this.participants.forEach(function(e){e.mediaType&&(e.mediaType.audio&&(t.audio=!0),e.mediaType.video&&(t.video=!0),e.mediaType.desktop&&(t.desktop=!0))}),v.debug("[BaseCall]: Updating call media type to ",t),this.mediaType=t},o.prototype.callTypeCss=function(){if(this.isDirect)return this.hasVideo()?"webrtc-video":"webrtc-audio";if(this.isRemote)return"remote";switch(this.state.css){case"outgoing":return"ongoing";case"incoming":return"incoming";case"answering":return"answering";case"active-call":return"active";default:return""}},o.prototype.callHeaderType=function(){return this.isDirect?"Direct":this.isGuestInvite?"Guest":this.isLarge?"Large":"Group"},o.prototype.toString=function(){return JSON.stringify(this,null,3)},o.prototype.getCstaState=function(){return this.atcCallInfo?this.atcCallInfo.cstaState:null},o.prototype.setCstaState=function(e){this.atcCallInfo&&(this.atcCallInfo.cstaState=e,this.avatar=this.isHolding()?n.TELEPHONY_HOLD:n.TELEPHONY,this.consultation=this.consultation&&!this.isHolding())},o.prototype.checkCstaState=function(e){if(!this.atcCallInfo)return!1;if(!Array.isArray(e))return e===this.atcCallInfo.cstaState;var t=this;return e.some(function(e){return e===t.atcCallInfo.cstaState})},o.prototype.isHolding=function(){return!!this.atcCallInfo&&this.checkCstaState([t.Holding,t.HoldOnHold,t.ConferenceHolding])},o.prototype.isHoldAllowed=function(){return!!this.atcCallInfo&&this.atcCallInfo.isHoldAllowed()},o.prototype.isConsultAllowed=function(){return!!this.atcCallInfo&&this.atcCallInfo.isConsultAllowed()},o.prototype.isConferenceCallAllowed=function(){return!!this.atcCallInfo&&this.atcCallInfo.isConferenceCallAllowed()},o.prototype.isRetrieveAllowed=function(){return!!this.atcCallInfo&&this.atcCallInfo.isRetrieveAllowed()},o.prototype.isTransferCallAllowed=function(){return!!this.atcCallInfo&&this.atcCallInfo.isTransferCallAllowed()},o.prototype.isTransferAllowed=function(){return!!this.atcCallInfo&&this.atcCallInfo.isTransferAllowed()},o.prototype.getPosition=function(){return this.atcCallInfo?this.atcCallInfo.getPosition():null},o.prototype.setAtcHandoverInProgress=function(){this.atcCallInfo&&this.atcCallInfo.setHandoverInProgress()},o.prototype.clearAtcHandoverInProgress=function(){this.atcCallInfo&&this.atcCallInfo.clearHandoverInProgress()},o.prototype.isHoldInProgress=function(){return!!this.atcCallInfo&&this.atcCallInfo.isHoldInProgress()},o.prototype.setHoldInProgress=function(){this.atcCallInfo&&this.atcCallInfo.setHoldInProgress()},o.prototype.clearHoldInProgress=function(){this.atcCallInfo&&this.atcCallInfo.clearHoldInProgress()},o.prototype.isRetrieveInProgress=function(){return!!this.atcCallInfo&&this.atcCallInfo.isRetrieveInProgress()},o.prototype.setRetrieveInProgress=function(){this.atcCallInfo&&this.atcCallInfo.setRetrieveInProgress()},o.prototype.clearRetrieveInProgress=function(){this.atcCallInfo&&this.atcCallInfo.clearRetrieveInProgress()},o.prototype.isAtcConferenceCall=function(){return!!this.atcCallInfo&&this.atcCallInfo.isConferenceCall()},o.prototype.setRedirectingUser=function(e,t,n,i,r){this.atcCallInfo&&this.atcCallInfo.setRedirectingUser(e,t,n,i,r)},o.prototype.getRedirectingUser=function(){return this.atcCallInfo?this.atcCallInfo.getRedirectingUser():null},o.prototype.setRedirectionType=function(e){if(this.atcCallInfo)return this.atcCallInfo.setRedirectionType(e)},o.prototype.getRedirectionType=function(){return this.atcCallInfo?this.atcCallInfo.getRedirectionType():null},o.prototype.isForwarded=function(){return!!this.atcCallInfo&&this.atcCallInfo.isForwarded()},o.prototype.isPickupNotification=function(){return!!this.atcCallInfo&&this.atcCallInfo.isPickupNotification()},o.prototype.isPickedUp=function(){return!!this.atcCallInfo&&this.atcCallInfo.isPickedUp()},o.prototype.setDisconnectCause=function(e,t){this._disconnectCause||(this.disconnectCause={cause:e,reason:t})},e.BaseCall=o,e.Enums=e.Enums||{},e.Enums.CallDirection=A,e.Enums.CallState=_,e}((Circuit=function(e){"use strict";var n=e.logger,i=e.Utils,r={WebRTC:{name:"WebRTC",ui:"res_CircuitClient",css:"circuit"},Cell:{name:"Cell",ui:"res_BackupNumber",css:"mobile"},Desk:{name:"Desk",ui:"res_Deskphone",css:"desk"},VM:{name:"VM",ui:"res_Voicemail",css:"vm"},Other:{name:"Other",ui:"res_CallAtOther",css:""}},o=Object.freeze({Idle:{name:"Idle",ui:"",established:!1},Initiated:{name:"Initiated",established:!1},Connecting:{name:"Connecting",established:!1},Delivered:{name:"Delivered",established:!1},Busy:{name:"Busy",established:!1},Offered:{name:"Offered",established:!1},Failed:{name:"Failed",established:!1},TransferFailed:{name:"TransferFailed",established:!1},Ringing:{name:"Ringing",established:!1},ExtendedRinging:{name:"ExtendedRinging",established:!1},Active:{name:"Active",established:!0},Held:{name:"Held",established:!0},Holding:{name:"Holding",established:!0},HoldOnHold:{name:"HoldOnHold",established:!0},Parked:{name:"Parked",established:!0},Conference:{name:"Conference",established:!0},ConferenceHolding:{name:"ConferenceHolding",established:!0},Terminated:{name:"Terminated",established:!1}}),t=Object.freeze({DefaultRouting:{name:"DefaultRouting",ui:"res_BusyHandling_DefaultRouting"},BusySignal:{name:"BusySignal",ui:"res_BusyHandling_BusySignal"},SendToAlternativeNumber:{name:"SendToAlternativeNumber",ui:"res_BusyHandling_AlternativeNumber"},SendToVM:{name:"SendToVM",ui:"res_BusyHandling_Voicemail"}}),a=Object.freeze({DefaultRouting:{name:"DefaultRouting",ui:"res_BusyHandling_DefaultRouting",desc:"res_DefaultRoutingDescription",newDesc:"res_DefaultRoutingDescriptionTimersPBXConfigurable"},DeskPhone:{name:"DeskPhone",ui:"res_Deskphone",desc:"res_DeskphoneRoutingDescription"},AlternativeNumber:{name:"AlternativeNumber",ui:"res_BusyHandling_AlternativeNumber",desc:"res_AlternativeNumberRoutingDescription"},VM:{name:"VoiceMail",ui:"res_Voicemail",desc:"res_VoicemailRoutingDescription"},Other:{name:"Other",ui:"res_Other",desc:""}}),s=Object.freeze({REGULAR:"REGULAR",MISSED:"MISSED"}),c=Object.freeze({DEFAULT:"DEFAULT",DEST_OUT_OF_ORDER:"DEST_OUT_OF_ORDER",REORDER_TONE:"REORDER_TONE",BUSY:"BUSY",CANCELLED:"CANCELLED",DECLINED:"DECLINED",TRANSFERRED:"TRANSFERRED"}),l=Object.freeze({Busy:{name:"Busy",ui:"res_TransferCallFailedCauseBusy"},Unreachable:{name:"Unreachable",ui:"res_TransferCallFailedCauseUnreachable"},DND:{name:"Dnd",ui:"res_TransferCallFailedCauseDND"}}),d=Object.freeze({CallForward:{name:"callForward",ui:"res_ForwardedFrom"},CallPickupNotification:{name:"callPickupNotification",ui:"res_CallPickupNotification"},CallPickedUp:{name:"callPickedUp",ui:"res_CallPickedUp"}}),u=Object.freeze({Ready:"ready",NotReady:"notReady"});return e.AtcCallInfo=function(){var t=null;this.cstaConn=null,this.cstaState=o.Idle,this.position=r.Other,this.servicesPermitted={},this.peerFQN="",this.peerDn="",this.peerName=null,this.missedReason="",this.ignoreCall=!1,this.originalPartnerDisplay={},this.handoverInProgress=!1,this.holdInProgress=!1,this.retrieveInProgress=!1,this.redirectingUser={},this.masterParallelHgCall=!1,this.setPeerName=function(e){this.peerName=e||""},this.setPartnerDisplay=function(e){e&&(this.peerFQN=e.fqn||"",this.peerDn=e.dn||e.fqn||"",this.peerName=e.name||this.peerDn,!this.peerFQN&&this.peerDn.startsWith("+")&&(this.peerFQN=this.peerDn))},this.setOriginalPartnerDisplay=function(e){e&&i.isEmptyObject(this.originalPartnerDisplay)&&(this.originalPartnerDisplay=e)},this.setCstaConnection=function(e){this.cstaConn=e,this.isRemote&&(this.callId=e.cID)},this.getCstaConnection=function(){return this.cstaConn},this.getCstaCallId=function(){return this.cstaConn&&this.cstaConn.cID},this.getCstaDeviceId=function(){return this.cstaConn&&this.cstaConn.dID},this.setServicesPermitted=function(e){e&&!i.isEmptyObject(e)?(e.rSP&&void 0!==e.rSP.cCSs&&(this.servicesPermitted.rSP=e.rSP),void 0!==e.eSP&&(this.servicesPermitted.eSP=e.eSP),n.info("[AtcCallInfo]: Updated services permitted: ",this.servicesPermitted)):n.info("[AtcCallInfo]: Empty services permitted, keeping last values")},this.clearServicesPermitted=function(){this.servicesPermitted={}},this.getServicesPermitted=function(){return this.servicesPermitted},this.isHandoverAllowed=function(){return(this.isSilentHandoverAllowed()||this.isSeamlessHandoverAllowed())&&!this.isHandoverInProgress()},this.isSeamlessHandoverAllowed=function(){return!(!this.servicesPermitted.eSP||!this.servicesPermitted.eSP.zseHo)},this.isSilentHandoverAllowed=function(){return!(!this.servicesPermitted.eSP||!this.servicesPermitted.eSP.zsiHo)},this.isTransferAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.sST||this.isHandoverInProgress())},this.isAlternateAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.alC)},this.isAnswerAllowed=function(){return this.servicesPermitted.rSP?!!this.servicesPermitted.rSP.cCSs.anC:this.cstaState===o.Ringing},this.isCallBackAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.cB)},this.isConsultAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.csC)},this.isDeflectAllowed=function(){return this.cstaState===o.Parked||this.cstaState===o.Ringing||!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.dCl)},this.isGenerateDigitsAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cAS.gD)},this.isHoldAllowed=function(){if(this.isHandoverInProgress())return!1;if(this.servicesPermitted.rSP)return this.servicesPermitted.rSP.cCSs.hCl;switch(this.cstaState){case o.Active:case o.Conference:case o.Held:return!0;default:return!1}},this.isConferenceCall=function(){return this.cstaState===o.Conference||this.cstaState===o.ConferenceHolding},this.isMakeCallAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.mCl)},this.isReconnectAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.rC)},this.isRetrieveAllowed=function(){if(this.isHandoverInProgress())return!1;if(this.servicesPermitted.rSP)return this.servicesPermitted.rSP.cCSs.reC;switch(this.cstaState){case o.ConferenceHolding:case o.Holding:case o.HoldOnHold:return!0;default:return!1}},this.isTransferCallAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.tCl||this.isHandoverInProgress())},this.isConferenceCallAllowed=function(){return!(!this.servicesPermitted.rSP||!this.servicesPermitted.rSP.cCSs.coC)},this.getPosition=function(){return this.position},this.setPosition=function(e){e&&e!==this.position&&(this.position=e,n.debug("[AtcCallInfo]: Set call position to ",e.name))},this.getMissedReason=function(){return this.missedReason},this.setMissedReason=function(e){e&&e!==this.missedReason&&(this.missedReason=e,n.debug("[AtcCallInfo]: Set missedReason to ",e))},this.getIgnoreCall=function(){return this.ignoreCall||this.cstaState===o.Offered},this.setIgnoreCall=function(e){this.ignoreCall=e},this.isHandoverInProgress=function(){return this.handoverInProgress},this.setHandoverInProgress=function(){this.handoverInProgress=!0},this.clearHandoverInProgress=function(){this.handoverInProgress=!1},this.isHoldInProgress=function(){return this.holdInProgress},this.setHoldInProgress=function(){this.holdInProgress=!0},this.clearHoldInProgress=function(){this.holdInProgress=!1},this.isRetrieveInProgress=function(){return this.retrieveInProgress},this.setRetrieveInProgress=function(){this.retrieveInProgress=!0},this.clearRetrieveInProgress=function(){this.retrieveInProgress=!1},this.setTransferCallFailedCause=function(e){if(this.cstaState===o.TransferFailed)switch(e){case"busy":t=l.Busy;break;case"doNotDisturb":t=l.DND;break;default:t=l.Unreachable}},this.getTransferCallFailedCause=function(){return this.cstaState===o.TransferFailed?t||l.Unreachable:null},this.setRedirectingUser=function(e,t,n,i,r){r=r||this.redirectingUser.redirectionType,this.redirectingUser&&this.redirectingUser.fqNumber&&this.redirectingUser.fqNumber!==t||(this.redirectingUser={userId:i||"",displayName:n,phoneNumber:e,fqNumber:t,redirectionType:r})},this.getRedirectingUser=function(){return this.redirectingUser},this.setRedirectionType=function(e){this.redirectingUser.redirectionType=e},this.getRedirectionType=function(){return this.redirectingUser&&this.redirectingUser.redirectionType},this.isForwarded=function(){return!!this.redirectingUser&&this.redirectingUser.redirectionType===d.CallForward},this.isPickupNotification=function(){return!!this.redirectingUser&&this.redirectingUser.redirectionType===d.CallPickupNotification},this.isPickedUp=function(){return!!this.redirectingUser&&this.redirectingUser.redirectionType===d.CallPickedUp}},e.Enums=e.Enums||{},e.Enums.CstaCallState=o,e.Enums.Targets=r,e.Enums.JournalEntryTypes=s,e.Enums.MissedReasonTypes=c,e.BusyHandlingOptions=t,e.RoutingOptions=a,e.Enums.TransferCallFailedCauses=l,e.Enums.RedirectionTypes=d,e.Enums.AgentState=u,e}((Circuit=function(o){"use strict";var a=o.Constants,s=o.logger,c=o.Utils,l={Active:{name:"Active",ui:"",established:!0,css:"active-call"},Busy:{name:"Busy",ui:"res_ParticipantState_busy",established:!1,css:"busy"},Calling:{name:"Calling",ui:"",established:!1,css:"calling"},Connecting:{name:"Connecting",ui:"",established:!1,css:"connecting"},ConnectionLost:{name:"ConnectionLost",ui:"res_ParticipantState_connectionLost",established:!1,css:"connection-lost"},Declined:{name:"Declined",ui:"res_ParticipantState_declined",established:!1,css:"declined"},Delivered:{name:"Delivered",ui:"",established:!1,css:"outgoing"},Idle:{name:"Idle",ui:"",established:!1,css:"idle"},Inactive:{name:"Inactive",ui:"",established:!1,css:"inactive"},Initiated:{name:"Initiated",ui:"",established:!1,css:"outgoing"},Joined:{name:"Joined",ui:"res_ParticipantState_joined",established:!0,css:"joined-call"},Muted:{name:"Muted",ui:"res_ParticipantState_muted",established:!0,css:"muted"},Offline:{name:"Offline",ui:"res_ParticipantState_offline",established:!1,css:"offline"},OffStage:{name:"OffStage",ui:"res_ParticipantState_leftStage",established:!1,css:"declined"},OnStage:{name:"OnStage",ui:"res_ParticipantState_enteredStage",established:!0,css:"joined-call"},Removed:{name:"Removed",ui:"res_ParticipantState_removed",established:!1,css:"declined"},Ringing:{name:"Ringing",ui:"",established:!1,css:"incoming"},Terminated:{name:"Terminated",ui:"res_ParticipantState_left",established:!1,css:"declined"},Timeout:{name:"Timeout",ui:"res_ParticipantState_missed",established:!1,css:"busy"}},d={Drop:{name:"Drop",type:"hangup",icon:"",localize:"res_Hangup"},Mute:{name:"Mute",type:"microphone",icon:"unmuted",localize:"res_Mute"},Unmute:{name:"Unmute",type:"microphone",icon:"muted",localize:"res_Unmute"},StartVideo:{name:"StartVideo",type:"video",icon:"inactive",localize:"res_StartVideo"},StopVideo:{name:"StopVideo",type:"video",icon:"active",localize:"res_StopVideo"},ToggleVideoInProgress:{name:"ToggleVideoInProgress",type:"video",icon:"progress-icon",localize:""},RemoveFromStage:{name:"DropFromStage",type:"hangup",icon:"drop-from-stage",localize:""}},u={createFromUser:function(e,t){if(!e)return null;var n=Object.create(e);n.pcState=t||l.Idle,n.streamId=null,n.screenStreamId=null,n.videoStream=null,n.mediaType={audio:!1,video:!1,desktop:!1},n.muted=!1,n.activeSpeaker=!1,n.isExternal=!!e.isExternal,n.isActive=u.isActive.bind(null,n),n.actions=[],n.screenSharePointerSupported=!1,n.hasSameMediaType=u.hasSameMediaType.bind(null,n),n.hasVideoStream=u.hasVideoStream.bind(null,n),n.setActions=u.setActions.bind(null,n),n.toJSON=function(){return this},n.userId=e.userId,n.firstName=e.firstName,n.lastName=e.lastName;var i=null,r="";return Object.defineProperties(n,{videoStream:{get:function(){return i},set:function(e){i=e,r=""},enumerable:!0,configurable:!1},videoUrl:{get:function(){return s.warn("[RtcParticipant]: videoUrl is deprecated and will eventually be removed"),r=i?r||o.WebRTCAdapter.createObjectURL(i):""},enumerable:c.isMobile(),configurable:!1}}),n},isActive:function(e){switch(e.pcState){case l.Active:case l.Joined:case l.Muted:case l.OnStage:return!0}return!1},hasSameMediaType:function(e,t){return!!(e&&t&&e.mediaType&&t.mediaType&&e.mediaType.audio===t.mediaType.audio&&e.mediaType.video===t.mediaType.video&&e.mediaType.desktop===t.mediaType.desktop)},hasVideoStream:function(e){return!(!e.videoStream||!e.streamId&&!e.screenStreamId||!e.mediaType.video&&!e.mediaType.desktop)},setActions:function(e,t,n){if(e.actions=[],!t||!t.isTemporary)if(e.pcState.established)if(e.isMeetingPointInvitee)e.toggleVideoInProgress?e.actions.push(d.ToggleVideoInProgress):e.actions.push(e.mediaType.video?d.StopVideo:d.StartVideo),e.actions.push(e.muted?d.Unmute:d.Mute),e.actions.push(d.Drop);else{var i=!t||t.isModerated,r=t&&t.userIsModerator(n),o=t&&t.userIsModerator(e);e.muted||i&&o&&!r||e.actions.push(d.Mute),i&&!r||(t.type===a.ConversationType.LARGE&&e.isSessionGuest&&r?e.actions.push(d.RemoveFromStage):e.actions.push(d.Drop))}else e.pcState===l.Initiated&&e.actions.push(d.Drop)}};return o.RtcParticipant=u,o.Enums=o.Enums||{},o.Enums.ParticipantState=l,o.Enums.ParticipantAction=d,o}((Circuit=function(A){"use strict";var _=A.logger,m=A.sdpParser,N=A.Utils;function h(e,t,n){var d=A.WebRTCAdapter,o=this,i=N.shallowCopy(e),r=t,u=null,C=n&&n.extraVideoChannels||0,E=[],T={mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!0}},a=0,s="new";function c(e){e.onnegotiationneeded=function(e,t){if(_.debug("[RTCPeerConnections]: onnegotiationneeded"),!p(e))return void _.debug("[RTCPeerConnections]:  Event is from Old Peer Connection");n=t,g(o.onnegotiationneeded,n);var n}.bind(null,e),e.onicecandidate=function(e,t){if(_.debug("[RTCPeerConnections]: onicecandidate: iceGatheringState = ",e.iceGatheringState),!p(e))return void _.debug("[RTCPeerConnections]:  Event is from Old Peer Connection");if(t.candidate){if(e!==u){var n=E.indexOf(e);if(0<=n){var i=new d.IceCandidate({sdpMLineIndex:t.candidate.sdpMLineIndex+n+2,sdpMid:t.candidate.sdpMid,candidate:t.candidate.candidate});t={candidate:i}}}}else{if(++a<E.length+1)return;_.debug("[RTCPeerConnections]:  End of candidates - all peer connections"),a=0}r=t,g(o.onicecandidate,r);var r}.bind(null,e),e.onsignalingstatechange=function(e,t){if(_.debug("[RTCPeerConnections]: onsignalingstatechange: signalingState = ",e.signalingState),!p(e))return void _.debug("[RTCPeerConnections]:  Event is from Old Peer Connection");n=t,g(o.onsignalingstatechange,n);var n}.bind(null,e),e.onaddstream=function(e,t){if(_.debug("[RTCPeerConnections]: onaddstream"),!p(e))return void _.debug("[RTCPeerConnections]:  Event is from Old Peer Connection");n=t,g(o.onaddstream,n);var n}.bind(null,e),e.onremovestream=function(e,t){if(_.debug("[RTCPeerConnections]: onremovestream"),!p(e))return void _.debug("[RTCPeerConnections]:  Event is from Old Peer Connection");n=t,g(o.onremovestream,n);var n}.bind(null,e),e.oniceconnectionstatechange=function(e,t){var n=0<C?" - "+(e===u?1:E.indexOf(e)+2):"",i=e.iceConnectionState;if(_.debug("[RTCPeerConnections]: oniceconnectionstatechange"+n+": iceConnectionState = ",i),!p(e))return void _.debug("[RTCPeerConnections]: Event is from Old Peer Connection.");if(e!==u||s===i)return;s=i,r=t,g(o.oniceconnectionstatechange,r);var r}.bind(null,e)}function l(e){e.onnegotiationneeded=null,e.onicecandidate=null,e.onsignalingstatechange=null,e.onaddstream=null,e.onremovestream=null,e.oniceconnectionstatechange=null}function p(t){return t===u||E.some(function(e){if(t===e)return!0})}function S(e,t){0<h.maxVideoBandwidth&&m.setVideoBandwidth(e,h.maxVideoBandwidth,t)}function I(n){if(0===C)return u[n];var i=m.parse(u[n].sdp);return 1===i.m.length&&"audio"===i.m[0].media&&"remoteDescription"!==n&&m.addEmptyVideoLine(i),E.every(function(e){if(!e[n])return!1;var t=m.parse(e[n].sdp);return!!(t=m.verifyFingerprintInMLines(t)).m.some(function(e){if("video"===e.media)return i.m.push(e),!0})}),new d.SessionDescription({type:u[n].type,sdp:m.stringify(i)})}function f(){u.createdLocalSdp=void 0,E.forEach(function(e){e.createdLocalSdp=void 0})}function v(e,t){var n=m.parse(e.sdp);if(!m.hasVideo(n))return e;var i=m.getConnectionMode(n,{mediaType:"video"});return _.info("[RTCPeerConnections]: Local description has video with a="+i),"sendonly"!==i||t.video?S(n,!0):(n=m.setConnectionMode(n,"video","inactive"),_.warning("[RTCPeerConnections]:  Set video connection mode to inactive")),new d.SessionDescription({type:e.type,sdp:m.stringify(n)})}function R(e){return"pranswer"===e.type&&(e.type="answer"),e}function g(e,t){if("function"==typeof e)try{e(t)}catch(e){_.error(e)}}this.onnegotiationneeded=null,this.onicecandidate=null,this.onsignalingstatechange=null,this.onaddstream=null,this.onremovestream=null,this.oniceconnectionstatechange=null,this.createOffer=function(a,s,e){var c=0,l=null;function t(e,t){var n,i,r;if(c++,_.debug("[RTCPeerConnections]: createOffer, count: ",c),e.createdLocalSdp=(n=t,i=c,S(r=m.parse(n.sdp),!0),C&&r.m.forEach(function(e){if("video"===e.media)for(var t=0,n=e.a.length;t<n;t++)if("mid"===e.a[t].field){e.a[t].value="video_"+(i-1);break}}),new d.SessionDescription({type:n.type,sdp:m.stringify(r)})),c>=E.length+1){if(l)s(l);else{var o=I("createdLocalSdp");a(o)}f()}}function n(e){l||(l=e),++c>=E.length+1&&s(l)}u.createOffer(t.bind(null,u),n,e),E.forEach(function(e){e.createOffer(t.bind(null,e),n,T)})},this.createAnswer=function(i,r,t,o){var a=0,s=null;function n(e,t){if(a++,_.debug("[RTCPeerConnections]: createAnswer, count: ",a),e.createdLocalSdp=v(t,e===u?o:{video:!1}),a>=E.length+1){if(s)r(s);else{var n=I("createdLocalSdp");i(n)}f()}}function c(e){s||(s=e),++a>=E.length+1&&r(s)}u.createAnswer(n.bind(null,u),c),E.forEach(function(e){e.remoteDescription?e.createAnswer(n.bind(null,e),c,t):a++})},this.setLocalDescription=function(n,e,t){var i=0,r=null;function o(){i++,_.debug("[RTCPeerConnections]: setLocalDescription onLocalSdpApplied, count: ",i),i>=E.length+1&&(r?t(r):e())}function a(e){i++,_.error("[RTCPeerConnections]: setLocalDescription error, count: "+i+"\n",e),r||(r=e),i>=E.length+1&&t(r)}var s=m.parse(n.sdp),c=s.m;(s.m=c.slice(0,2),"answer"===n.type)&&(1===m.parse(u.remoteDescription.sdp).m.length&&(_.info("[RTCPeerConnections]: only 1 mline in remote sdp offer"),s.m=s.m.slice(0,1)));var l=new d.SessionDescription({type:n.type,sdp:m.stringify(s)});u.setLocalDescription(l,o,a),E.forEach(function(e,t){if(!c[t+2])return i++,void _.warning("[RTCPeerConnections]: missing sdp mline for peer connection: "+i);s.m=[c[t+2]],l=new d.SessionDescription({type:n.type,sdp:m.stringify(s)}),e.setLocalDescription(l,o,a)})},this.setRemoteDescription=function(n,e,t){var i=0,r=null;function o(){i++,_.debug("[RTCPeerConnections]: setRemoteDescription onRemoteSdpApplied, count: ",i),i>=E.length+1&&(r?t(r):e())}function a(e){r||(r=e),++i>=E.length+1&&t(r)}var s=m.parse(n.sdp),c=s.m;s.m=c.slice(0,2);var l=new d.SessionDescription({type:n.type,sdp:m.stringify(s)});l=R(l),u.setRemoteDescription(l,o.bind(null,u),a),E.forEach(function(e,t){if(!c[t+2])return i++,void _.warning("[RTCPeerConnections]: missing sdp mline for peer connection: "+i);s.m=[c[t+2]],l=R(l=new d.SessionDescription({type:n.type,sdp:m.stringify(s)})),e.setRemoteDescription(l,o.bind(null,e),a)})},this.removeStream=function(e){return u.removeStream(e)},this.addStream=function(e){return u.addStream(e)},this.getLocalStreams=function(){return u.getLocalStreams()},this.getRemoteStreams=function(){var t=u.getRemoteStreams().slice(0);return E.forEach(function(e){t.push.apply(t,e.getRemoteStreams())}),t},this.addIceCandidate=function(e){if(!e)return u.addIceCandidate(),void E.forEach(function(e){e.addIceCandidate()});if(e.sdpMLineIndex<=1)u.addIceCandidate(new d.IceCandidate(e));else{var t=e.sdpMLineIndex-2;E[t]&&(e.sdpMLineIndex=0,E[t].addIceCandidate(new d.IceCandidate(e)))}},this.close=function(){u.close(),l(u),E.forEach(function(e){e.close(),l(e)})},this.createDTMFSender=function(e){return u.createDTMFSender(e)},Object.defineProperties(this,{localDescription:{get:function(){return I("localDescription")},enumerable:!0,configurable:!1}}),Object.defineProperties(this,{remoteDescription:{get:function(){return I("remoteDescription")},enumerable:!0,configurable:!1}}),Object.defineProperties(this,{signalingState:{get:function(){return u.signalingState},enumerable:!0,configurable:!1},iceConnectionState:{get:function(){return 0<C?s:u.iceConnectionState},enumerable:!0,configurable:!1}}),Object.defineProperties(this,{mainPeerConnection:{get:function(){return u},enumerable:!1,configurable:!1},groupPeerConnections:{get:function(){return E},enumerable:!0,configurable:!1}}),i.iceCandidatePoolSize=2,c(u=new d.PeerConnection(i,r)),_.debug("[RTCPeerConnections]: Created main audio/video RTCPeerConnection"),d.groupPeerConnectionsSupported&&function(){for(var e=0;e<C;e++)try{i.iceCandidatePoolSize=1;var t=new d.PeerConnection(i,r);E.push(t),c(t),_.debug("[RTCPeerConnections]: Created aux video PeerConnection")}catch(e){_.error("[RTCPeerConnections]:  Failed to create aux video PeerConnection.",e)}}()}return h.maxVideoBandwidth=512,A.RtcPeerConnections=h,A}((Circuit=function(C){"use strict";var E=C.logger,T=function(e){if(e)try{e.oninactive=null;var t=e.getAudioTracks().concat(e.getVideoTracks());t.length&&t[0].stop?t.forEach(function(e){e.stop()}):e.stop&&e.stop(),E.info("[WebRTCAdapter]: Media stream has been stopped")}catch(e){E.error("[WebRTCAdapter]: Failed to stop media stream. ",e)}},p=function(e){if(e)try{var t=e.getVideoTracks();t?t.forEach(function(e){e.stop&&"video"===e.kind&&!e.remote&&e.stop()}):E.info("[WebRTCAdapter]: No video tracks to be changed")}catch(e){E.error("[WebRTCAdapter]: Failed to disable local video tracks. ",e)}},S=function(e){try{e.close(),E.debug("[WebRTCAdapter]: RTCPeerConnection has been closed")}catch(e){E.error(e)}},I=function(){return!!navigator.mediaDevices&&"function"==typeof navigator.mediaDevices.enumerateDevices&&"undefined"!=typeof HTMLMediaElement&&"function"==typeof HTMLMediaElement.prototype.setSinkId},o=[],a=null,s=null,c=function(){a&&(window.clearTimeout(a),a=null)},f=function(e){if("function"==typeof e){var n,i,r;if(E.debug("[WebRTCAdapter]: Get audio output, microphone and camera devices"),!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return n=[{kind:"audio",id:"default",label:"",facing:""}],r=[{kind:"video",id:"default",label:"",facing:""}],void window.setTimeout(function(){e(n,r,null)},0);if(0<o.length)return E.debug("[WebRTCAdapter]: There is a pending MediaDevices.enumerateDevices() request"),void o.push(e);if(s&&s.validTimestamp>Date.now())return E.debug("[WebRTCAdapter]: Return cached devices"),n=s.audioSources,i=s.audioOutputs,r=s.videoSources,void window.setTimeout(function(){e(n,r,i)},0);o.push(e),E.debug("[WebRTCAdapter]: Invoke MediaDevices.enumerateDevices()");var t=function(t,n,i){c();var e=o;o=[],e.forEach(function(e){try{e(t||[],n||[],i||null)}catch(e){}})};c(),a=window.setTimeout(function(){a=null,o.length&&(s?(E.error("[WebRTCAdapter]: MediaDevices.enumerateDevices timed out. Return cached devices."),n=s.audioSources,i=s.audioOutputs,r=s.videoSources):E.error("[WebRTCAdapter]: MediaDevices.enumerateDevices timed out. Device cache is empty, no devices available!"),t(n,r,i),t=null)},3e3),navigator.mediaDevices.enumerateDevices().then(function(e){e=e||[],n=[],i=[],r=[],E.info("[WebRTCAdapter]: MediaDevices.enumerateDevices returned "+e.length+" device(s)"),e.forEach(function(e){var t={id:e.deviceId,groupId:e.groupId,kind:e.kind,label:e.label};switch(Circuit.isElectron&&("default"!==t.id||t.label||(t.label="res_DefaultDeviceLabel")),t.kind){case"audioinput":n.push(t);break;case"audiooutput":i.push(t);break;case"videoinput":r.push(t)}}),0!==i.length&&I()||(i=null),E.debug("[WebRTCAdapter]: Update DeviceInfos cache"),s={audioSources:n,audioOutputs:i,videoSources:r},!n.some(function(e){return e.label})||r.length&&!r.some(function(e){return e.label})?(E.debug("[WebRTCAdapter]: User hasn't authorized access to audio and/or video input devices yet"),s.validTimestamp=0):s.validTimestamp=Date.now()+6e4,t&&t(n,r,i)}).catch(function(e){E.error("[WebRTCAdapter]: Failed to enumerate devices. ",e),t&&t()})}},v=function(){E.debug("[WebRTCAdapter]: Cleared device info cache"),s=null},R=function(e){if(!e||!e.iceServers)return e;var n=[];return e.iceServers.forEach(function(t){t.url?n.push(t):t.urls&&t.urls.forEach(function(e){n.push({url:e,credential:t.credential,username:t.username})})}),{iceServers:n}},g=function(e){return{optional:[{echoCancellation:!0},{googEchoCancellation:!0},{googEchoCancellation2:!0},{autoGainControl:!!(e=e||{}).enableAudioAGC},{googAutoGainControl:!!e.enableAudioAGC},{googAutoGainControl2:!!e.enableAudioAGC},{noiseSuppression:!0},{googNoiseSuppression:!0},{googNoiseSuppression2:!0},{googHighpassFilter:!0},{googDucking:!1},{chromeRenderToAssociatedSink:!0}]}},A=function(e){if(e&&e.hdVideo){var t={mandatory:{minAspectRatio:1.76,maxAspectRatio:1.78,minFrameRate:30},optional:[{googNoiseReduction:!0}]};switch(e.hdVideo){case"1080p":t.mandatory.minWidth=1920,t.mandatory.minHeight=1080;break;case"720p":t.mandatory.minWidth=1280,t.mandatory.minHeight=720}return t}return{mandatory:{minAspectRatio:1.32,maxAspectRatio:1.34},optional:[{googNoiseReduction:!0}]}},_=function(e,t){var n=e&&e.getAudioTracks();return!(!n||!n[0])&&(n[0].enabled=!!t,!0)},m=function(o,a,s){if(s=s||function(){},E.debug("[WebRTCAdapter]: Attach sinkId to audio element"),o)return a&&a.length?void(void 0!==o.sinkId&&C.WebRTCAdapter?(E.debug("[WebRTCAdapter]: Get media sources to find available device"),C.WebRTCAdapter.getMediaSources(function(e,t,n){var i=C.Utils.selectMediaDevice(n,a),r=i&&i.id||"";if(E.debug("[WebRTCAdapter]: Found audio output device to attach as sinkId. deviceId = ",r||"NONE"),o.sinkId===r)return E.debug("[WebRTCAdapter]: Audio output device is already attached to element"),void s();r||E.warn("[WebRTCAdapter]: A previously selected output device could not be found. Fallback to browser's default. Device not found: ",o.sinkId),o.setSinkId(r).then(function(){E.debug("[WebRTCAdapter]: Success, audio output device attached: ",r||"<default>"),s()}).catch(function(e){var t=(e=e||{}).message||"unknown error";"SecurityError"===e.name&&(t="You need to use HTTPS for selecting audio output device."),E.error("[WebRTCAdapter]: Failed to attach output device. Device Id:"+r+" - ",t),s(t)}),E.debug("[WebRTCAdapter]: setSinkId has been invoked")})):s("setSinkId not available")):(E.debug("[WebRTCAdapter]: There is no audio output device selected"),void s());s("Invalid parameters")},N=function(e){var t={offerToReceiveAudio:1,offerToReceiveVideo:1};return e&&(e.mandatory&&(e.mandatory.hasOwnProperty("OfferToReceiveAudio")&&(t.offerToReceiveAudio=e.mandatory.OfferToReceiveAudio?1:0),e.mandatory.hasOwnProperty("OfferToReceiveVideo")&&(t.offerToReceiveVideo=e.mandatory.OfferToReceiveVideo?1:0)),e.optional&&e.optional.some(function(e){if(e.hasOwnProperty("VoiceActivityDetection"))return t.voiceActivityDetection=!!e.VoiceActivityDetection,!0})),t},h=function(r,o,a,s,c){var e=function(t){var e=function(e,t,n,i){if(!e||!e[t])return e;var r=e[t];if(r.mandatory){var o=r.mandatory[n];if(o){var a=(e=Object.create(e))[t];a.optional=a.optional||[];var s={};s[n]=o,a.optional.push(s),delete a.mandatory}}else{var c=r[i];c&&c.exact&&((e=Object.create(e))[t][i]=c.exact)}return e}(a,"audio","sourceId","deviceId");if(e!==a){E.warn("[WebRTCAdapter]: First getUserMedia attempt with required audio sourceId/deviceId failed. Falling back to optional.");var n=function(e){s(e,t)},i=r.apply(o,[e,n,c]);i&&i.then&&i.then(n).catch(c)}else c&&c(t)},t=r.apply(o,[a,s,e]);t&&t.then&&t.then(s).catch(e)},O=function(t,n,i,r,o){var a=null,s=Circuit.isElectron?1:3,c=0;function l(e){E.warn("[WebRTCAdapter]: Get user media failed: ",e&&e.name||e),a&&window.clearTimeout(a),a=null,o&&o(e),o=r=null}!function e(){E.info("[WebRTCAdapter]: Get user media attempt #:",c),a=null,c!==s?(++c,h(t,n,i,function(e,t){var n,i;n=e,i=t,E.info("[WebRTCAdapter]: Get user media succeeded"),r?r(n,i):T(n),o=r=null,a&&window.clearTimeout(a),a=null},l),a=window.setTimeout(e,1e4)):l("Timeout")}()};return function e(){var r=C.TemasysAdapter,t=C.Utils.getBrowserInfo();try{if(t.chrome||t.phantomjs)return E.info("Setting WebRTC APIs for Chrome"),RTCSessionDescription.prototype.toJSON=function(){return{type:this.type,sdp:this.sdp}},RTCIceCandidate.prototype.toJSON=function(){return{sdpMLineIndex:this.sdpMLineIndex,sdpMid:this.sdpMid,candidate:this.candidate}},C.WebRTCAdapter={enabled:!0,browser:"chrome",MediaStream:webkitMediaStream,PeerConnection:function(e,t){var r=new webkitRTCPeerConnection(e,t);return r.origCreateOffer=r.createOffer,r.createOffer=function(t,n,e){var i=N(e);r.origCreateOffer(i).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})},r.origCreateAnswer=r.createAnswer,r.createAnswer=function(t,n,e){var i=N(e);r.origCreateAnswer(i).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})},r},SessionDescription:RTCSessionDescription,IceCandidate:RTCIceCandidate,getUserMedia:function(e,t,n){O(navigator.mediaDevices.getUserMedia,navigator.mediaDevices,e,t,n)},createObjectURL:URL.createObjectURL.bind(URL),getAudioStreamTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?e.id+" "+t.id:""},getVideoStreamTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?e.id+" "+t.id:""},getAudioTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?t.id:""},getVideoTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?t.id:""},hasDeviceNameOnTrackLabel:!0,getAudioTrackLabel:function(e){var t=e&&e.getAudioTracks()[0];return t?t.label:""},getVideoTrackLabel:function(e){var t=e&&e.getVideoTracks()[0];return t?t.label:""},stopMediaStream:T,stopLocalVideoTrack:p,closePc:S,getMediaSources:function(e){e&&f(e)},clearMediaSourcesCache:function(){v()},getAudioOptions:function(e){var t=g(e);return e&&e.sourceId&&"default"!==e.sourceId&&(t.mandatory=t.mandatory||{},t.mandatory.sourceId=e.sourceId),t},getVideoOptions:function(e){var t=A(e);return e&&e.sourceId&&t.optional.push({sourceId:e.sourceId}),t},getDesktopOptions:function(e,t){var n=(t=t||{}).frameRate||{};return{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxWidth:2560,maxHeight:1600},optional:[{googNoiseReduction:!0},{maxFrameRate:n.max||10},{minFrameRate:n.min||5}]}},audioOutputSelectionSupported:I(),groupPeerConnectionsSupported:!0,getMediaSourcesSupported:!0,attachSinkIdToAudioElement:m,toggleAudio:_},C;if(t.firefox){E.info("Setting WebRTC APIs for Firefox");var i=function(e){switch(this.stats=e,this.id=e.id,e.type){case"inboundrtp":case"inbound-rtp":e.isRemote||(this.type="ssrc","audio"===e.mediaType?(this.stats.audioOutputLevel=!0,this.stats.googJitterReceived=e.jitter):this.stats.googFrameHeightReceived=!0);break;case"outboundrtp":case"outbound-rtp":e.isRemote||(this.type="ssrc","audio"===e.mediaType?this.stats.audioInputLevel=!0:this.stats.googFrameHeightSent=!0);break;case"candidatepair":case"candidate-pair":this.type="googCandidatePair","boolean"==typeof e.selected&&(this.googActiveConnection=e.selected?"true":"false");break;default:this.type=e.type}};i.prototype.names=function(){return Object.keys(this.stats)},i.prototype.stat=function(e){return this.stats[e]};var n="undefined"==typeof RTCPeerConnection?mozRTCPeerConnection:RTCPeerConnection,o="undefined"==typeof RTCSessionDescription?mozRTCSessionDescription:RTCSessionDescription,a="undefined"==typeof RTCIceCandidate?mozRTCIceCandidate:RTCIceCandidate;return C.WebRTCAdapter={enabled:!0,browser:"firefox",MediaStream:MediaStream,PeerConnection:function(e){var r=new n(e);return r.origCreateOffer=r.createOffer,r.createOffer=function(t,n,e){var i=N(e);r.origCreateOffer(i).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})},r.origCreateAnswer=r.createAnswer,r.createAnswer=function(t,n,e){var i=N(e);r.origCreateAnswer(i).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})},r.origGetStats=r.getStats,r.getStats=function(n,e){"function"==typeof n&&r.origGetStats().then(function(e){var t;n((t=[],e.forEach(function(e){t.push(new i(e))}),t))},e)},r.removeStream=function(){},r.createDTMFSender=function(t){if("function"!=typeof r.getSenders)return null;var e=r.getSenders().find(function(e){return e.track===t}),n=e&&e.dtmf;return n?(n.canInsertDTMF=!0,n):null},r.getRemoteStreams=function(){var n=[];return r.getReceivers().forEach(function(e){if(e.track){var t=new MediaStream([e.track]);n.push(t)}}),n},r.getLocalStreams=function(){var n=[];return r.getSenders().forEach(function(e){if(e.track){var t=new MediaStream([e.track]);n.push(t)}}),n},46<=parseInt(t.version,10)&&Object.defineProperty(r,"onaddstream",{enumerable:!0,get:function(){return r.onaddstreamCb},set:function(n){r.onaddstreamCb=n,r.ontrack=n?function(e){var t=e&&e.transceiver&&e.transceiver.mid;t&&e.track&&(e.track.mid=t),n({stream:e&&e.streams&&e.streams[0]})}:null}.bind(r)}),r},SessionDescription:o,IceCandidate:a,getUserMedia:function(e,t,n){O(navigator.mediaDevices.getUserMedia,navigator.mediaDevices,e,t,n)},createObjectURL:function(e){return URL.createObjectURL(e)},getAudioStreamTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?e.id+" "+(t.mid||t.id):""},getVideoStreamTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?e.id+" "+(t.mid||t.id):""},getAudioTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?t.mid||t.id:""},getVideoTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?t.mid||t.id:""},hasDeviceNameOnTrackLabel:!1,getAudioTrackLabel:function(e){var t=e&&e.getAudioTracks()[0];return t?t.label:""},getVideoTrackLabel:function(e){var t=e&&e.getVideoTracks()[0];return t?t.label:""},stopMediaStream:T,stopLocalVideoTrack:p,closePc:function(e){window.setTimeout(function(){S(e)},500)},getMediaSources:function(e){e&&f(e)},clearMediaSourcesCache:function(){v()},getAudioOptions:function(e){var t=g(e);return e&&e.sourceId&&(t.deviceId={exact:e.sourceId}),t.advanced=t.optional,delete t.optional,t},getVideoOptions:function(e){var t=A(e);return e&&e.sourceId&&(t.deviceId=e.sourceId),t.advanced=t.optional,delete t.optional,t},getDesktopOptions:function(e,t){var n=(t=t||{}).frameRate||{};return n.min=n.min||5,n.max=n.max||10,{mozMediaSource:e||"screen",mediaSource:e||"screen",width:{max:2560},height:{max:1600},advanced:[{frameRate:n}]}},audioOutputSelectionSupported:I(),groupPeerConnectionsSupported:!0,getMediaSourcesSupported:!0,attachSinkIdToAudioElement:m,iceTimeoutSafetyFactor:.5,toggleAudio:_},C}if(t.ios){E.info("Setting WebRTC APIs for iOS client");var s=function(t){this.id=t.id,this.type=t.type,this.timestamp=new Date(t.timestamp);var n={};Object.getOwnPropertyNames(t.values).forEach(function(e){n[e]=t.values[e]}),this.names=function(){return Object.getOwnPropertyNames(n)},this.stat=function(e){return n[e]},t=null},c=function(e){var t=e.map(function(e){return new s(e)});this.result=function(){return t},e=null};return C.WebRTCAdapter={enabled:!0,browser:"ios",PeerConnection:function(e,t){e=R(e);var n=RTCPeerConnection.createRTCPeerConnection(e,t);return n.origGetStats=n.getStats,n.getStats=function(t){"function"==typeof t&&n.origGetStats(function(e){t(new c(e))})},n.addIceCandidate=n.addIceCandidateJS,Object.defineProperties(n,{localDescription:{get:function(){return n.getLocalDescriptionJS()},enumerable:!0,configurable:!1},remoteDescription:{get:function(){return n.getRemoteDescriptionJS()},enumerable:!0,configurable:!1},signalingState:{get:function(){return n.getSignalingStateJS()},enumerable:!0,configurable:!1},iceConnectionState:{get:function(){return n.getIceConnectionStateJS()},enumerable:!0,configurable:!1},iceGatheringState:{get:function(){return n.getIceGatheringStateJS()},enumerable:!0,configurable:!1}}),n},SessionDescription:function(e){return RTCSessionDescription.createRTCSessionDescription(e)},IceCandidate:function(e){return{sdpMLineIndex:e.sdpMLineIndex,sdpMid:e.sdpMid,candidate:e.candidate}},getUserMedia:navigator.getUserMedia.bind(navigator),createObjectURL:URL.createObjectURL.bind(URL),getAudioStreamTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?e.streamId+" "+t.trackId:""},getVideoStreamTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?e.streamId+" "+t.trackId:""},getAudioTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?t.trackId:""},getVideoTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?t.trackId:""},hasDeviceNameOnTrackLabel:!1,getAudioTrackLabel:function(e){var t=e&&e.getAudioTracks()[0];return t?t.label:""},getVideoTrackLabel:function(e){var t=e&&e.getVideoTracks()[0];return t?t.label:""},stopMediaStream:T,stopLocalVideoTrack:p,closePc:S,getMediaSources:function(e){e&&e([],[])},clearMediaSourcesCache:function(){},getAudioOptions:g,getVideoOptions:A,getDesktopOptions:function(){return{mandatory:{iOSMediaSource:"desktop"}}},audioOutputSelectionSupported:!1,groupPeerConnectionsSupported:!1,getMediaSourcesSupported:!1,attachSinkIdToAudioElement:m,toggleAudio:_},C}if(t.android){E.info("Setting WebRTC APIs for Android client");var l=function(n){this.id=n.id,this.type=n.type,this.timestamp=new Date(n.timestamp);var i={};Object.getOwnPropertyNames(n.values).forEach(function(e){var t=n.values[e];t.name&&(i[t.name]=t.value)}),this.names=function(){return Object.getOwnPropertyNames(i)},this.stat=function(e){return i[e]},n=null},d=function(e){var t=e.map(function(e){return new l(e)});this.result=function(){return t},e=null},u=RTCPeerConnection.bind(RTCPeerConnection);return C.WebRTCAdapter={enabled:!0,browser:"android",PeerConnection:function(e,t){e=R(e);var n=u(e,t);return n.getStats=function(t){"function"==typeof t&&n.origGetStats(function(e){t(new d(e.data))})},n},SessionDescription:function(e){return{type:e.type,sdp:e.sdp}},IceCandidate:function(e){return{sdpMLineIndex:e.sdpMLineIndex,sdpMid:e.sdpMid,candidate:e.candidate}},getUserMedia:navigator.getUserMedia.bind(navigator),createObjectURL:function(){return"dummy"},getAudioStreamTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?e.id+" "+t.id:""},getVideoStreamTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?e.id+" "+t.id:""},getAudioTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?t.id:""},getVideoTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?t.id:""},hasDeviceNameOnTrackLabel:!1,getAudioTrackLabel:function(e){var t=e&&e.getAudioTracks()[0];return t?t.label:""},getVideoTrackLabel:function(e){var t=e&&e.getVideoTracks()[0];return t?t.label:""},stopMediaStream:T,stopLocalVideoTrack:p,closePc:S,getMediaSources:function(e){e&&e([],[])},clearMediaSourcesCache:function(){},getAudioOptions:g,getVideoOptions:A,getDesktopOptions:function(){return{mandatory:{androidMediaSource:"screen"}}},audioOutputSelectionSupported:!1,groupPeerConnectionsSupported:!1,getMediaSourcesSupported:!1,attachSinkIdToAudioElement:m,toggleAudio:_},C}if(t.dotnet)return E.info("Setting WebRTC APIs for .NET client"),C.WebRTCAdapter={enabled:!0,browser:"dotnet",PeerConnection:function(e,t){e=R(e);var n=new RTCPeerConnection(e,t);return n.origGetStats=n.getStats,n.getStats=function(e){"function"==typeof e&&e()},Object.defineProperties(n,{localDescription:{get:function(){return n.getLocalDescription()},enumerable:!0,configurable:!1},remoteDescription:{get:function(){return n.getRemoteDescription()},enumerable:!0,configurable:!1},signalingState:{get:function(){return n.getSignalingState()},enumerable:!0,configurable:!1},iceConnectionState:{get:function(){return n.getIceConnectionState()},enumerable:!0,configurable:!1},iceGatheringState:{get:function(){return n.getIceGatheringState()},enumerable:!0,configurable:!1}}),n},SessionDescription:function(e){return{type:e.type,sdp:e.sdp}},IceCandidate:function(e){return{sdpMLineIndex:e.sdpMLineIndex,sdpMid:e.sdpMid,candidate:e.candidate}},getUserMedia:function(e,t,n){var i={audioEnabled:!(!e||!e.audio),videoEnabled:!(!e||!e.video)};return navigator.getUserMedia(i,t,n)},createObjectURL:function(e){return e.id},getAudioStreamTrackId:function(e){var t=e&&e.getAudioTracks();return t&&t.length?e.id+" "+t[0].id:""},getVideoStreamTrackId:function(e){var t=e&&e.getVideoTracks();return t&&t.length?e.id+" "+t[0].id:""},getAudioTrackId:function(e){var t=e&&e.getAudioTracks();return t&&t.length?t[0].id:""},getVideoTrackId:function(e){var t=e&&e.getVideoTracks();return t&&t.length?t[0].id:""},hasDeviceNameOnTrackLabel:!0,getAudioTrackLabel:function(e){var t=e&&e.getAudioTracks();return t&&t.length?t[0].label:""},getVideoTrackLabel:function(e){var t=e&&e.getVideoTracks();return t&&t.length?t[0].label:""},stopMediaStream:T,stopLocalVideoTrack:p,closePc:S,getMediaSources:function(e){e&&e([],[])},clearMediaSourcesCache:function(){},getAudioOptions:function(e){var t=g(e);return e&&e.sourceId&&(t.mandatory=t.mandatory||{},t.mandatory.sourceId=e.sourceId),t},getVideoOptions:function(e){var t=A(e);return e&&e.sourceId&&t.optional.push({sourceId:e.sourceId}),t},getDesktopOptions:function(e,t){var n=(t=t||{}).frameRate||{};return{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxWidth:2560,maxHeight:1600},optional:[{googNoiseReduction:!0},{maxFrameRate:n.max||10},{minFrameRate:n.min||5}]}},audioOutputSelectionSupported:I(),groupPeerConnectionsSupported:!1,getMediaSourcesSupported:!1,attachSinkIdToAudioElement:m,toggleAudio:_},C;if(t.cordovaios)return E.info("Setting WebRTC APIs for Cordova iOS"),cordova.plugins.iosrtc.RTCSessionDescription.prototype.toJSON=function(){return{type:this.type,sdp:this.sdp}},cordova.plugins.iosrtc.RTCIceCandidate.prototype.toJSON=function(){return{sdpMLineIndex:this.sdpMLineIndex,sdpMid:this.sdpMid,candidate:this.candidate}},C.WebRTCAdapter={enabled:!0,browser:"cordovaios",MediaStream:cordova.plugins.iosrtc.MediaStream,PeerConnection:function(e,t){var r=new cordova.plugins.iosrtc.RTCPeerConnection(e,t);return r.origCreateOffer=r.createOffer,r.createOffer=function(t,n,e){var i=N(e);r.origCreateOffer(i).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})},r.origCreateAnswer=r.createAnswer,r.createAnswer=function(t,n,e){var i=N(e);r.origCreateAnswer(i).then(function(e){t&&t(e)}).catch(function(e){n&&n(e)})},r.origGetStats=r.getStats,r.getStats=function(e,t){"function"==typeof e&&r.origGetStats().then(e,t)},r},SessionDescription:cordova.plugins.iosrtc.RTCSessionDescription,IceCandidate:cordova.plugins.iosrtc.RTCIceCandidate,getUserMedia:cordova.plugins.iosrtc.getUserMedia.bind(cordova.plugins.iosrtc),createObjectURL:URL.createObjectURL.bind(URL),getAudioStreamTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?e.id+" "+t.id:""},getVideoStreamTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?e.id+" "+t.id:""},getAudioTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?t.id:""},getVideoTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?t.id:""},hasDeviceNameOnTrackLabel:!0,getAudioTrackLabel:function(e){var t=e&&e.getAudioTracks()[0];return t?t.label:""},getVideoTrackLabel:function(e){var t=e&&e.getVideoTracks()[0];return t?t.label:""},stopMediaStream:T,stopLocalVideoTrack:p,closePc:S,getMediaSources:function(e){e&&f(e)},clearMediaSourcesCache:function(){v()},getAudioOptions:function(e){var t=g(e);return e&&e.sourceId&&t.optional.push({sourceId:e.sourceId}),t},getVideoOptions:function(e){var t=A(e);return e&&e.sourceId&&t.optional.push({sourceId:e.sourceId}),t},getDesktopOptions:function(e,t){var n=(t=t||{}).frameRate||{};return{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxWidth:2560,maxHeight:1600},optional:[{googNoiseReduction:!0},{maxFrameRate:n.max||10},{minFrameRate:n.min||5}]}},audioOutputSelectionSupported:I(),groupPeerConnectionsSupported:!1,getMediaSourcesSupported:!0,attachSinkIdToAudioElement:m,toggleAudio:_},C;if(r)return E.info("Setting WebRTC APIs for IE with Temasys plugin"),C.WebRTCAdapter={enabled:!0,browser:"msie",PeerConnection:function(e,t){return e=R(e),r.PeerConnection(e,t)},SessionDescription:r.SessionDescription,IceCandidate:r.IceCandidate,getUserMedia:function(e,t,n){h(r.getUserMedia,r,e,t,n)},createObjectURL:function(e,t,n){return r.createObjectURL(e,n)},attachMediaStream:r.attachMediaStream,getAudioStreamTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?e.label+" "+t.id:""},getVideoStreamTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?e.label+" "+t.id:""},getAudioTrackId:function(e){var t=e&&e.getAudioTracks()[0];return t?t.id:""},getVideoTrackId:function(e){var t=e&&e.getVideoTracks()[0];return t?t.id:""},hasDeviceNameOnTrackLabel:!1,getAudioTrackLabel:function(e){var t=e&&e.getAudioTracks()[0];return t?t.label:""},getVideoTrackLabel:function(e){var t=e&&e.getVideoTracks()[0];return t?t.label:""},stopMediaStream:T,stopLocalVideoTrack:p,closePc:S,getMediaSources:function(i){"function"==typeof i&&r.getMediaSources(function(e){var t=[],n=[];e&&e.forEach(function(e){"audio"===e.kind?t.push(e):"video"===e.kind&&n.push(e)}),i(t,n,null)})},clearMediaSourcesCache:function(){},getAudioOptions:function(e){return!e||!e.sourceId||{mandatory:{sourceId:e.sourceId}}},getVideoOptions:function(e){return!e||!e.sourceId||{optional:[{sourceId:e.sourceId}]}},getDesktopOptions:function(){return{optional:[{sourceId:r.screensharingKey()}]}},audioOutputSelectionSupported:!1,groupPeerConnectionsSupported:!0,getMediaSourcesSupported:!1,attachSinkIdToAudioElement:m,toggleAudio:_},C;E.info("WebRTC is not supported")}catch(e){E.error("Failed to initialize WebRTCAdapter. ",e)}C.WebRTCAdapter={enabled:!1,browser:"",PeerConnection:function(){},SessionDescription:function(){},IceCandidate:function(){},getUserMedia:function(e,t,n){n&&n("Not supported")},createObjectURL:function(){return""},getAudioStreamTrackId:function(){return""},getVideoStreamTrackId:function(){return""},getAudioTrackId:function(){return""},getVideoTrackId:function(){return""},hasDeviceNameOnTrackLabel:!1,getAudioTrackLabel:function(){return""},getVideoTrackLabel:function(){return""},stopMediaStream:function(){},stopLocalVideoTrack:function(){},closePc:function(){},getMediaSources:function(e){e&&e([],[])},clearMediaSourcesCache:function(){},getAudioOptions:function(){return!1},getVideoOptions:function(){return!1},getDesktopOptions:function(){return!1},audioOutputSelectionSupported:!1,groupPeerConnectionsSupported:!1,getMediaSourcesSupported:!1,attachSinkIdToAudioElement:function(e,t,n){n&&n()},toggleAudio:function(){return!1},init:e}}(),C}(Circuit=function(Y){"use strict";var K=Y.Utils,q=Object.freeze({Disconnected:"Disconnected",Connecting:"Connecting",Reconnecting:"Reconnecting",Connected:"Connected"});return Y.ConnectionController=function(e){var t,n,i,r,o,a=Y.logger;e=e||{},K.isMobile()?i=o=r=n=t=0:(t=1e3,n=8e3,r=64e3,o=1350,i=1);var s=4e3,c=20,l=2e3,d=200,u=200,C=5,E=this,T=null,p=null,S=null,I=q.Disconnected,f=null,v=0,R=null,g=null,A=null,_=e||{},m=null,N=null,h=[],O=[],D=null;function y(e,t){if("function"==typeof e)try{e(t)}catch(e){a.error(e)}}function b(){a.debug("[CONN]: online event received"),A&&(a.debug("[CONN]: Clear offline timeout"),window.clearTimeout(A),A=null),I===q.Reconnecting&&(f=n,E.reconnect(null,1e3))}function P(){a.debug("[CONN]: offline event received"),I===q.Connected&&(window.addEventListener("online",b),A||(A=window.setTimeout(function(){A=null,window.navigator.onLine||(a.debug("[CONN]: The client is offline. Change state to Reconnecting."),E.reconnect())},s)))}function U(){T&&(T.onopen=null,T.onclose=null,T.onmessage=null,T.onerror=null,T=null)}function L(n){if(n!==I){a.debug("[CONN]: Changed connection state from "+I+" to "+n),a.debug("[CONN]: Raising connectionStateChange event");var i=I;I=n,window.setTimeout(function(){var e,t;e=n,t=i,y(E.onStateChange,{newState:e,oldState:t})},0)}}function M(e){try{p&&p(e)}catch(e){a.error("[CONN]: Exception on errorCallback. ",e)}finally{S=p=null}}function w(){D&&(window.clearTimeout(D),D=null),O=[],h=[]}function G(e){if(R&&(window.clearTimeout(R),R=null),g&&(window.clearTimeout(g),g=null),w(),T){a.debug("[CONN]: Disconnecting from server");var t=T;U(),t.close()}e||(window.removeEventListener&&(window.removeEventListener("online",b),window.removeEventListener("offline",P)),L(q.Disconnected))}function H(e){e===T&&(a.info("[CONN]: WebSocket is opened"),f=t+K.randomNumber(0,n),v=0,I!==q.Disconnected&&(L(q.Connected),window.addEventListener&&(window.addEventListener("offline",P),window.removeEventListener("online",b)),function(){try{a.debug("[CONN]: Registered Successfully"),S&&S()}catch(e){a.error("[CONN]: Exception on successCallback. ",e)}finally{S=p=null}}()))}function k(e,t){if(e===T)switch(w(),t=t||{},a.info("[CONN]: WebSocket is closed. Code: "+t.code+". Reason:",t.reason),I){case q.Connected:case q.Reconnecting:I===q.Reconnecting&&y(E.onReconnectFailed),L(q.Reconnecting),function(){if(K.isMobile())a.warn("[CONN]: Mobile Client - Do not attempt to reconnect from JS");else{if(0<o&&o<=v)return a.warn("[CONN]: Reached max number of attempts reconnecting to WebSocket"),G();!1===window.navigator.onLine&&(a.warn("[CONN]: Client is offline. Set retry timer to max value."),f=r),a.info("[CONN]: Retry to open socket in "+Math.floor(f/1e3)+" seconds"),R=window.setTimeout(function(){R=null,F()},f),f<r&&(f=++v>i?2*f:n,f=Math.min(f,r))}}();break;case q.Connecting:G(),a.error("[CONN]: Failed to open WebSocket connection"),M("Failed to open WebSocket connection")}}function V(e,t){var n;if(e===T)try{if(!t.data||"PING"===t.data)return;var i=t.data;if(!_.doNotParseMessages)try{i=JSON.parse(i)}catch(e){return void a.error("[CONN]: Message discarded (Cannot Parse): ",t.data)}n=i,y(E.onMessage,n)}catch(e){a.error(e)}}function F(){if(I===q.Connecting||I===q.Reconnecting){a.info("[CONN]: Opening WebSocket to ",N);try{switch(window.navigator.platform){case"iOS":T=WebSocket.createWebSocket(m);break;case"node":T=new WebSocket(m,_.cookie);break;default:T=new WebSocket(m)}}catch(e){return a.error("[CONN]: Failed to connect WebSocket. ",e),void M(e)}T.onopen=H.bind(null,T),T.onclose=k.bind(null,T),T.onmessage=V.bind(null,T),T.onerror=function(e,t){e===T&&(w(),I!==q.Reconnecting&&I!==q.Connected?(a.error("[CONN]: WebSocket Connection Error"),L(q.Disconnected),U(),M("Failed to open WebSocket connection")):"node"!==window.navigator.platform&&"iOS"!==window.navigator.platform&&"Android"!==window.navigator.platform||(a.error("[CONN]: WebSocket connection error. Force _socket.onclose. ",t),T.onclose()))}.bind(null,T)}}function B(){var n=Date.now(),i=h.length-1;h.some(function(e,t){if(n-e<l)return h.splice(0,t),!0;t===i&&(h=[])})}function x(){if(!D){var e=d;h.length>=c&&(e+=l-(Date.now()-h[0])),a.info("[CONN]: Start throttle timeout with delay = ",e),D=window.setTimeout(function(){D=null,function(){a.info("[CONN]: Dequeue throttled messages. Number of queued messages = ",O.length),B();for(var e=0;0<O.length&&h.length<c&&e<C;)W(O.shift()),e++;0<O.length?(a.warn("[CONN]: Number of remaining queued messages = ",O.length),x()):a.info("[CONN]: Dequeued all throttled messages")}()},e)}}function W(e){try{var t=e.request&&e.request.requestId||"N/A";T.send(JSON.stringify(e)),h.push(Date.now()),a.debug("[CONN]: Sent message with requestId:",t)}catch(e){a.error("[CONN]: Failed to send message. ",e)}}this.onStateChange=null,this.onReconnectFailed=null,this.onMessage=null,this.getState=function(){return I},this.isConnected=function(){return I===q.Connected},this.setTarget=function(e){N=(m=e).split("?")[0]},this.connect=function(e,t,n){a.debug("[CONN]: Connect WebSocket to ",e),I!==q.Disconnected&&G(!0),E.setTarget(e),S=t||function(){},p=n||function(){},L(q.Connecting),window.setTimeout(F,0)},this.disconnect=function(){a.debug("[CONN]: Disconnect WebSocket from ",N),G()},this.reconnect=function(e,t){a.debug("[CONN]: Reconnect WebSocket to ",N),G(!0),e&&E.setTarget(e),L(q.Reconnecting),g=window.setTimeout(function(){g=null,F()},t||50)},this.sendMessage=function(e,t){return I!==q.Connected?(a.warn("[CONN]: WebSocket is not connected. Cannot send message. ",e),!1):e?(t||a.msgSend("[CONN]: ",e),"string"==typeof e?"PING"===e&&K.isMobile()?T.ping():T.send(e):(delete e.keysToOmitFromLogging,!D&&(h.length>=c&&B(),h.length<c)?W(e):(n=e,a.warn("[CONN]: Throttling limit exceeded. Queue the message."),O.length>=u?a.error("[CONN]: Throttling queue is full. Drop the message."):(O.push(n),a.info("[CONN]: Queued message #",O.length)),x())),!0):(a.error("[CONN]: Data is missing. Cannot send message."),!1);var n}},Y.Enums=Y.Enums||{},Y.Enums.ConnectionState=q,Y}(Circuit=function(e){"use strict";var l=e.Utils,i=Object.freeze({TLS:{name:"tls",start:0,end:11e6},TCP:{name:"tcp",start:12e6,end:31e6},UDP:{name:"udp",start:35e6,end:6e7}});function p(e){if(e){var t=(e=e.replace(/(a=)*candidate:([^\r]+)(\r\n)*/i,"$2")).split(" ");if(t.length<7)throw new Error("Invalid candidate: "+e);this.foundation=parseInt(t[0],10),this.componentId=parseInt(t[1],10),this.transport=t[2].toLowerCase(),this.priority=parseInt(t[3],10),this.address=t[4],this.port=parseInt(t[5],10),this.typ=t[7],this.optional=[];for(var n=8;n<t.length;n+=2)this.optional.push(t[n]),this[t[n]]=t[n+1]}else this.foundation=1,this.componentId=1,this.transport="udp",this.priority=1,this.address="0.0.0.0",this.port=1,this.typ="host",this.generation=0,this.optional=[]}p.prototype.equals=function(e){return e=e&&"string"!=typeof e?e:new p(e),this.foundation===e.foundation&&this.componentId===e.componentId&&this.transport===e.transport&&this.priority===e.priority&&this.address===e.address&&this.port===e.port&&this.typ===e.typ},p.prototype.isRtp=function(){return 1===this.componentId},p.prototype.isRtcp=function(){return 2===this.componentId},p.prototype.isTcpTlsRelay=function(){return"relay"===this.typ&&this.priority<=i.TCP.end},p.prototype.getRelayClientTransportType=function(){var t="";if("relay"===this.typ){var n=this.priority;[i.TLS,i.TCP,i.UDP].some(function(e){if(n>=e.start&&n<=e.end)return t=e.name,!0})}return t},p.prototype.getValue=function(){for(var e=this.foundation+" "+this.componentId+" "+this.transport+" "+this.priority+" "+this.address+" "+this.port+" typ "+this.typ,t=0;t<this.optional.length;t++){var n=this.optional[t];e+=" "+n+" "+this[n]}return e},p.prototype.getParsedAttribute=function(){return{field:"candidate",value:this.getValue()}},p.prototype.toString=function(){return"candidate:"+this.getValue()};var t=function(){var d=Circuit.logger;function u(e){var t=e.split(/\s+/);return{nettype:t[0],addrtype:t[1],address:t[2]}}function C(e){var t=/^([^:]+)(?::(.*))?/.exec(e);return{field:t[1],value:t[2]}}var E=/^(\w+) +(\d+)(?:\/(\d))? +(\S+)(?: (\d+( +\d+)*))?/;function T(e,t,n){switch(t){case"v":case"o":case"s":case"i":case"u":case"e":case"p":case"c":e[t]=n;break;default:e[t]?e[t].push(n):e[t]=[n]}}var r={o:function(e){return[e.username||"-",e.id,e.version,e.nettype||"IN",e.addrtype||"IP4",e.address].join(" ")},c:function(e){return[e.nettype||"IN",e.addrtype||"IP4",e.address].join(" ")},m:function(e){return[e.media||"audio",e.port||"0",e.proto||"RTP/AVP",e.fmt.join(" ")].join(" ")},a:function(e){return e.value?[e.field,e.value].join(":"):e.field}};function n(e,t,n){if(void 0!==e[t]){var i=function(e){return t+"="+(r[t]&&r[t](e)||e)+"\r\n"};return Array.isArray(e[t])?e[t].map(i).join(""):i(e[t])}return n?t+"="+n+"\r\n":""}function o(e){return e.filter(function(e){switch(e.field){case"inactive":case"recvonly":case"sendonly":case"sendrecv":return!1}return!0})}function a(e){var t,n,i=e.split(/\r\n/),r={};for(t=0;t<i.length&&((n=/^(\w)=(.*)/.exec(i[t]))&&"m"!==n[1]);++t)"a"===n[1]&&n[2]?T(r,n[1],C(n[2])):T(r,n[1],n[2]);r.m=[];for(var o,a,s,c,l=null;t<i.length&&(n=/(\w)=(.*)/.exec(i[t]));++t)"m"===n[1]?(o=n[2],a=void 0,l={media:(a=E.exec(o))[1],port:+a[2],portnum:+(a[3]||1),proto:a[4],fmt:a[5]?a[5].split(/\s+/).map(function(e){return+e}):[]},r.m.push(l)):"a"===n[1]&&n[2]?T(l,n[1],C(n[2])):T(l,n[1],n[2]);return r.s&&""!==r.s.trim()||(r.s="-"),r.o&&(r.o=(s=r.o,{username:(c=s.split(/\s+/))[0],id:c[1],version:c[2],nettype:c[3],addrtype:c[4],address:c[5]})),r.c&&(r.c=u(r.c)),r.m.forEach(function(e){e.c&&(e.c=u(e.c))}),r}function i(e,t){var n="string"==typeof e?a(e):e,i="sendrecv";return void 0!==(t=t||{}).mLineIndex?n.m[t.mLineIndex].a.forEach(function(e){switch(e.field){case"sendrecv":case"sendonly":case"recvonly":case"inactive":i=e.field}}):(t.mediaType&&"both"!==t.mediaType||(t.mediaType="audio"),n.a&&n.a.forEach(function(e){switch(e.field){case"sendonly":case"recvonly":case"inactive":i=e.field}}),n.m&&n.m.forEach(function(e){e.media===t.mediaType&&e.a.forEach(function(e){switch(e.field){case"sendrecv":case"sendonly":case"recvonly":case"inactive":i=e.field}})})),i}function s(e){return!!Array.isArray(e)&&e.some(function(e){return e.includes("AS:")})}function c(e){return!!Array.isArray(e)&&e.some(function(e){return e.includes("TIAS:")})}return{parse:a,stringify:function(e){var t="";return t+=n(e,"v",0),t+=n(e,"o"),t+=n(e,"s","-"),t+=n(e,"i"),t+=n(e,"u"),t+=n(e,"e"),t+=n(e,"p"),t+=n(e,"c"),t+=n(e,"b"),t+=n(e,"t","0 0"),t+=n(e,"r"),t+=n(e,"z"),t+=n(e,"k"),t+=n(e,"a"),e.m.forEach(function(e){t+=n({m:e},"m"),t+=n(e,"i"),t+=n(e,"c"),t+=n(e,"b"),t+=n(e,"k"),t+=n(e,"a")}),t},getConnectionMode:i,getVideoConnectionModes:function(e){var t="string"==typeof e?a(e):e,n=[];return t.m&&t.m.forEach(function(e){"video"===e.media&&e.a.some(function(e){switch(e.field){case"sendrecv":case"sendonly":case"recvonly":case"inactive":return n.push(e.field),!0}})}),n},setConnectionMode:function(e,t,n){var i="string"==typeof e?a(e):e,r=t&&"both"!==t?[t]:["audio","video"];return"both"===t&&i.a&&(i.a=o(i.a),i.a.push({field:n})),i.m&&i.m.forEach(function(e){r.includes(e.media)&&(e.a=o(e.a),e.a.push({field:n}))}),i},isHold:function(e){var t=i(e);return"inactive"===t||"sendonly"===t},disableMultiplex:function(e){var t="string"==typeof e?a(e):e;return t.a&&(t.a=t.a.filter(function(e){return"group"!==e.field})),t},hasVideo:function(e){var n="string"==typeof e?a(e):e;return!!n.m&&n.m.some(function(e,t){return"video"===e.media&&0!==e.port&&0!==e.fmt.length&&("inactive"!==i(n,{mLineIndex:t})&&e.a.some(function(e){return"rtpmap"===e.field&&/VP[89]/.test(e.value)}))})},addEmptyVideoLine:function(e){var t="string"==typeof e?a(e):e;return t.m.push({media:"video",port:0,proto:"RTP/SAVPF",fmt:[100],c:{nettype:"IN",addrtype:"IP4",address:"0.0.0.0"},a:[{field:"inactive"}]}),t},removeVideo:function(e){var t="string"==typeof e?a(e):e;return t.m&&t.m.forEach(function(e){"video"===e.media&&(e.port=0,e.c={nettype:"IN",addrtype:"IP4",address:"0.0.0.0"},e.a=e.a.filter(function(e){return"mid"===e.field}),e.a.push({field:"inactive"}))}),t},setOpusParameters:function(e,r){var t="string"==typeof e?a(e):e;return t.m&&r&&(r=l.shallowCopy(r),t.m.forEach(function(e){var n;"audio"===e.media&&e.a&&(e.a.some(function(e){if("rtpmap"===e.field&&e.value.includes("opus"))return n=e.value.split(" ")[0],!0}),n&&e.a.some(function(e){if("fmtp"===e.field&&e.value.includes(n)){e.value.substring(n.length+1).split(";").forEach(function(e){var t=e.split("="),n=t[0].trim(),i=t[1].trim();r.hasOwnProperty(n)||(r[n]=i)});var t=Object.keys(r).map(function(e){return e+"="+r[e]});return e.value=n+" "+t.join(";"),!0}}))})),t},setVideoBandwidth:function(e,t,n){var i="string"==typeof e?a(e):e;return i.m&&i.m.forEach(function(e){"video"===e.media&&(n?t&&0<t.valueOf()?e.b=["AS:"+t,"TIAS:"+1e3*t]:(s(e.b)||c(e.b))&&delete e.b:(s(e.b)||T(e,"b","AS:"+t),c(e.b)||T(e,"b","TIAS:"+1e3*t)))}),i},setXGoogle:function(e,r){var t="string"==typeof e?a(e):e;return t.m&&r&&t.m.forEach(function(n){if("video"===n.media&&n.a){var i=[];n.a=n.a.filter(function(e,t){return"rtpmap"===e.field&&/VP[89]/.test(e.value)&&i.push({idx:t+i.length,pt:e.value.split(" ")[0]}),("fmtp"!==e.field||e.value&&!e.value.includes("x-google"))&&"x-google-buffer-latency"!==e.field}),i.forEach(function(e){var t=[];r.minBitRate&&0<r.minBitRate.valueOf()&&t.push("x-google-min-bitrate="+r.minBitRate),r.maxBitRate&&0<r.maxBitRate.valueOf()&&t.push("x-google-max-bitrate="+r.maxBitRate),r.startBitRate&&0<r.startBitRate.valueOf()&&t.push("x-google-start-bitrate="+r.startBitRate),r.maxQuantization&&0<r.maxQuantization.valueOf()&&t.push("x-google-max-quantization="+r.maxQuantization),0<t.length&&(t=e.pt+" "+t.join("; "),n.a.splice(e.idx+1,0,{field:"fmtp",value:t}))})}}),t},preferVideoVp9:function(e){var t="string"==typeof e?a(e):e;return t.m&&t.m.forEach(function(e,t){if("video"===e.media){var n=e.a.find(function(e){return"rtpmap"===e.field&&e.value.includes("VP9")});if(n){var i=parseInt(n.value.split(" ")[0],10),r=e.fmt.indexOf(i);0<r&&(e.fmt.splice(r,1),e.fmt.unshift(i),d.debug("[SdpParser]: Prefer VP9 format for video m-line #:",t))}}}),t},removeVideoBandwidth:function(e){var t="string"==typeof e?a(e):e;return t.m&&t.m.forEach(function(e){"video"===e.media&&(e.b=e.b&&e.b.filter(function(e){return!e.startsWith("AS:")&&!e.startsWith("TIAS:")}))}),t},removeAudioLevelAttr:function(e){var t="string"==typeof e?a(e):e;return t.m&&t.m.forEach(function(e){"audio"===e.media&&(e.a=e.a&&e.a.filter(function(e){return"extmap"!==e.field||!e.value||!e.value.includes("ssrc-audio-level")}))}),t},isTrickleIceOption:function(e){var t="string"==typeof e?a(e):e;return t.a=t.a||[],t.a.some(function(e){return"ice-options"===e.field&&(e.value=e.value||"",e.value.includes("trickle"))})},fixTrickleIceOption:function(e,n){var i="string"==typeof e?a(e):e;i.a=i.a||[];var t=i.a.some(function(e,t){if("ice-options"===e.field)return e.value=e.value||"",n?e.value.includes("trickle")||(e.value+=" trickle"):(e.value=e.value.replace(/trickle\s*/gi,"").trim(),e.value||i.a.splice(t,1)),!0});return n&&!t&&i.a.push({field:"ice-options",value:"trickle"}),i},addEndOfCandidatesLine:function(e){var t="string"==typeof e?a(e):e;return t.m&&t.m.forEach(function(e){e.a=e.a||[],e.a.some(function(e){return"end-of-candidates"===e.field})||e.a.push({field:"end-of-candidates"})}),t},removeEndOfCandidatesLine:function(e){var t="string"==typeof e?a(e):e;return t.m&&t.m.forEach(function(n){n.a&&n.a.some(function(e,t){if("end-of-candidates"===e.field)return n.a.splice(t,1),!0})}),t},removeEmptyAttributeLines:function(e,t){var n="string"==typeof e?a(e):e;if(n.m){var i={};Array.isArray(t)?t.forEach(function(e){i[e]=!0}):i[t]=!0,n.m.forEach(function(e){e.a=e.a&&e.a.filter(function(e){return e.value||!i[e.field]})})}return n},validateIceCandidates:function(e,n,i){return!("string"==typeof e?a(e):e).m.some(function(e,t){if(!function e(n,t,i,r){if(0===n.port)return!0;var o=0,a=!1,s=null,c=null,l=n.a.filter(function(e){if("candidate"!==e.field)return!0;var t=new p(e.value);if("udp"!==t.transport)return!1;if(i&&"video"===n.media){if("relay"!==t.typ)return!(a=!0);if(!t.isTcpTlsRelay())return d.debug("[SdpParser]: Removed UDP relay candidate: ",e.value),!(a=!0);!s&&t.isRtp()&&(s=t),!c&&t.isRtcp()&&(c=t)}return o++,!0});return s||!a||r?!(0===o&&!r||(n.a=l,c&&n.a.some(function(e){if("rtcp"===e.field)return e.value=c.port+" IN IP4 "+c.address,!0}),s&&(n.port=s.port,n.c&&(n.c.address=s.address)),0)):(d.info("[SdpParser]: Media description does not have TCP/TLS relay candidates. Do not filter UDP candidates!"),e(n,t,!1))}(e,t,n,i))return!0})},isNoOfferSdp:function(e){return!!e&&""===e.sdp&&"nooffer"===e.type},iceTotalCandidatesCount:function(e){var t=0;return("string"==typeof e?a(e):e).m.forEach(function(e){e.a.forEach(function(e){"candidate"===e.field&&t++})}),t},getIceCandidates:function(e){var t=[];return("string"==typeof e?a(e):e).m.forEach(function(e){e.a.forEach(function(e){"candidate"===e.field&&t.push(new p(e.value))})}),t},removeNotNeededSsrc:function(e){var t="string"==typeof e?a(e):e;return t.m.forEach(function(e){e.a.some(function(e){return"recvonly"===e.field})&&(e.a=e.a.filter(function(e){return"ssrc"!==e.field}))}),t},removeAudioMediaProtocols:function(e,n){var t="string"==typeof e?a(e):e;return n&&n.length&&t.m.some(function(e){if("audio"===e.media&&e.proto){var t=e.proto.split("/");return t=t.filter(function(e){return!n.includes(e)}),e.proto=t.join("/"),!0}}),t},verifyFingerprintInMLines:function(e){var n="string"==typeof e?a(e):e;return n.m&&n.m.forEach(function(t,e){t.a.some(function(e){return"fingerprint"===e.field})||n.a.some(function(e){if("fingerprint"===e.field)return t.a.push(e),!0})||d.debug("[SdpParser]: verifyFingerprintInMLines(): No session fingerprint found for video m-line #:",e)}),n},findMediaLineIndex:function(e,t){if(t){var n,i,r="string"==typeof e?a(e):e;return n=t,i=-1,r.m.some(function(e,t){if(e.a.some(function(e){return"mid"===e.field&&e.value===n}))return i=t,!0}),i}},setMediaIdAttribute:function(e,t,n,i){var r=("string"==typeof e?a(e):e).m[t];r&&(r.a.some(function(e){if("mid"===e.field)return i&&(e.value=n),!0})||r.a.push({field:"mid",value:n}))},getMediaIds:function(e){var t="string"==typeof e?a(e):e,i={};return t.m.forEach(function(e){var t,n;e.a.some(function(e){return"mid"===e.field?t=e.value:"msid"===e.field&&(n=e.value),t&&n})&&(i[t]=n)}),i},getOrigin:function(e){if("string"==typeof e){var t=/(o=[^\r]+)\r\n/i.exec(e);return t&&t[1]||""}return n(e,"o")}}}();return e.IceCandidate=p,e.sdpParser=t,e}((Circuit=function(e){"use strict";var r,i,o,a=e.logger,s=e.Utils,c=Object.freeze({WSMessageType:{REQUEST:"REQUEST",RESPONSE:"RESPONSE",EVENT:"EVENT"},ContentType:{SYSTEM:"SYSTEM",NONE:"NONE",EXTENSION:"EXTENSION",CONVERSATION:"CONVERSATION",USER:"USER",RTC_SESSION:"RTC_SESSION",RTC_CALL:"RTC_CALL",SEARCH:"SEARCH",KEEPALIVE:"KEEPALIVE",INSTRUMENTATION:"INSTRUMENTATION",GUEST:"GUEST",ADMINISTRATION:"ADMINISTRATION",THIRDPARTYCONNECTORS:"THIRDPARTYCONNECTORS",USER_TO_USER:"USER_TO_USER",VERSION:"VERSION",SANITY_CHECK:"SANITY_CHECK",WEB_HOOK:"WEB_HOOK",ACCOUNT:"ACCOUNT",ACTIVITYSTREAM:"ACTIVITYSTREAM",PROVISIONING:"PROVISIONING",RTC_CONNECTION:"RTC_CONNECTION",CONVERSATION_USER_DATA:"CONVERSATION_USER_DATA",MS_CONNECTOR:"MS_CONNECTOR",SPACE:"SPACE",USER_DATA:"USER_DATA"},ReturnCode:{OK:"OK",AUTHORIZATION_FAILED:"AUTHORIZATION_FAILED",AUTHORIZATION_REQUIRED:"AUTHORIZATION_REQUIRED",SERVICE_EXCEPTION:"SERVICE_EXCEPTION",PROTOBUF_CONVERSION_EXCEPTION:"PROTOBUF_CONVERSION_EXCEPTION",CONVERSION_EXCEPTION:"CONVERSION_EXCEPTION",NO_MESSAGE_HANDLER:"NO_MESSAGE_HANDLER",INVALID_CLIENT:"INVALID_CLIENT",NO_RESULT:"NO_RESULT",OPERATION_NOT_SUPPORTED:"OPERATION_NOT_SUPPORTED",ENTITY_ALREADY_EXISTS:"ENTITY_ALREADY_EXISTS",FRAME_SIZE_TO_LONG:"FRAME_SIZE_TO_LONG",BACKEND_UNAVAILABLE:"BACKEND_UNAVAILABLE",OVERLOADED:"OVERLOADED",OLD_VERSION:"OLD_VERSION",STORAGE_OVERLOADED:"STORAGE_OVERLOADED",USER_NOT_FOUND:"USER_NOT_FOUND",CLOUD_TELEPHONY_EXCEPTION:"CLOUD_TELEPHONY_EXCEPTION",SERVICE_UNAVAILABLE:"SERVICE_UNAVAILABLE",REQUEST_TIMEOUT:"REQUEST_TIMEOUT",DISCONNECTED:"DISCONNECTED",INVALID_MESSAGE:"INVALID_MESSAGE",FAILED_TO_SEND:"FAILED_TO_SEND",UNEXPECTED_RESPONSE:"UNEXPECTED_RESPONSE",MISSING_REQUIRED_PARAMETER:"MISSING_REQUIRED_PARAMETER",CHOOSE_DESKTOP_MEDIA_CANCELLED:"CHOOSE_DESKTOP_MEDIA_CANCELLED",SDK_ERROR:"SDK_ERROR"},ErrorCode:{UNEXPECTED_ERROR:"UNEXPECTED_ERROR",CONSTRAINT_VIOLATION:"CONSTRAINT_VIOLATION",MAX_NUM_CONV_PARTICIPANTS:"MAX_NUM_CONV_PARTICIPANTS",THIRDPARTY_ERROR:"THIRDPARTY_ERROR",AUTHORIZATION_FAILED:"AUTHORIZATION_FAILED",PERMISSION_DENIED:"PERMISSION_DENIED",RTC_NO_MEDIA_NODES_AVAILABLE:"RTC_NO_MEDIA_NODES_AVAILABLE",RTC_CONCURRENT_INCOMING_CALL:"RTC_CONCURRENT_INCOMING_CALL",DUPLICATED_ENTITY_ERROR:"DUPLICATED_ENTITY_ERROR",RTC_MEDIA_NODE_UNREACHABLE:"RTC_MEDIA_NODE_UNREACHABLE",CLOUD_TELEPHONY_ERROR:"CLOUD_TELEPHONY_ERROR"},ThirdPartyError:{UNSUPPORTED_PROVIDER:"UNSUPPORTED_PROVIDER",BAD_REQUEST:"BAD_REQUEST",GENERAL_ERROR:"GENERAL_ERROR",INSUFFICIENT_PERMISSION:"INSUFFICIENT_PERMISSION",NOT_AUTHORIZED:"NOT_AUTHORIZED",RESOURCE_NOT_FOUND:"RESOURCE_NOT_FOUND",SERVER_DOWN:"SERVER_DOWN",SESSION_EXPIRED:"SESSION_EXPIRED",UNSUPPORTED_FILE_TYPE:"UNSUPPORTED_FILE_TYPE",WRONG_SERVER:"WRONG_SERVER",EMPTY_SETTINGS:"EMPTY_SETTINGS",EMPTY_USERNAME:"EMPTY_USERNAME",EMPTY_PASSWORD:"EMPTY_PASSWORD",EMPTY_SERVER_ADDRESS:"EMPTY_SERVER_ADDRESS",INVALID_SERVER_ADDRESS:"INVALID_SERVER_ADDRESS",NOT_CONNECTED:"NOT_CONNECTED",ALREADY_CONNECTED:"ALREADY_CONNECTED",INVALID_ITEMIDS:"INVALID_ITEMIDS"},CloudTelephonyErrorType:{CMP_NEXT:"CMP_NEXT",VALIDATION:"VALIDATION"},CloudTelephonyValidationError:{UNKNOWN:"UNKNOWN",DN_NOT_FOUND_IN_TENANT:"DN_NOT_FOUND_IN_TENANT",DUPLICATE_SITE_NAME:"DUPLICATE_SITE_NAME",OVERLAPPING_PUBLIC_RANGES_WITHIN_SITE:"OVERLAPPING_PUBLIC_RANGES_WITHIN_SITE",OVERLAPPING_PUBLIC_RANGES_ACROSS_DEPLOYMENT:"OVERLAPPING_PUBLIC_RANGES_ACROSS_DEPLOYMENT",OVERLAPPING_PRIVATE_RANGES_WITHIN_SITE:"OVERLAPPING_PRIVATE_RANGES_WITHIN_SITE",OVERLAPPING_PRIVATE_RANGES_ACROSS_TENANT:"OVERLAPPING_PRIVATE_RANGES_ACROSS_TENANT",EXISTING_USERS_IN_RANGE:"EXISTING_USERS_IN_RANGE",EXISTING_USERS_IN_PUBLIC_RANGE:"EXISTING_USERS_IN_PUBLIC_RANGE",EXISTING_USERS_IN_PRIVATE_RANGE:"EXISTING_USERS_IN_PRIVATE_RANGE",AREA_CODES_INCONSISTENT:"AREA_CODES_INCONSISTENT"},CloudTelephonyCmpNextError:{COUNTRY_DETAILS_NOT_FOUND:"COUNTRY_DETAILS_NOT_FOUND",OSV_OPERATION_FAILED:"OSV_OPERATION_FAILED"},ClientCapability:{GUEST_EXPERIENCE:1,SYSTEM_MESSAGES:2},ConversationActionType:{CREATE:"CREATE",UPDATE:"UPDATE",DELETE:"DELETE",ADD_PARTICIPANT:"ADD_PARTICIPANT",REMOVE_PARTICIPANT:"REMOVE_PARTICIPANT",ADD_TEXT_ITEM:"ADD_TEXT_ITEM",UPDATE_TEXT_ITEM:"UPDATE_TEXT_ITEM",DELETE_TEXT_ITEM:"DELETE_TEXT_ITEM",GET_CONVERSATION_BY_ID:"GET_CONVERSATION_BY_ID",GET_CONVERSATIONS:"GET_CONVERSATIONS",GET_ITEM_BY_ID:"GET_ITEM_BY_ID",GET_ITEMS_BY_CONVERSATION:"GET_ITEMS_BY_CONVERSATION",GET_ITEMS_BY_CONVERSATION_ITEM_ID:"GET_ITEMS_BY_CONVERSATION_ITEM_ID",SET_READ_POINTER:"SET_READ_POINTER",SUBSCRIBE:"SUBSCRIBE",UNSUBSCRIBE:"UNSUBSCRIBE",TYPING:"TYPING",GET_CONVERSATION_USER_DATA:"GET_CONVERSATION_USER_DATA",SET_FLAG_ITEM:"SET_FLAG_ITEM",CLEAR_FLAG_ITEM:"CLEAR_FLAG_ITEM",GET_FLAGGED_ITEMS:"GET_FLAGGED_ITEMS",GET_JOIN_DETAILS:"GET_JOIN_DETAILS",GET_SUPPORT_CONVERSATION_ID:"GET_SUPPORT_CONVERSATION_ID",GET_SUPPORT_CONVERSATION:"GET_SUPPORT_CONVERSATION",GET_OPEN_CONVERSATIONS:"GET_OPEN_CONVERSATIONS",JOIN_OPEN_CONVERSATION:"JOIN_OPEN_CONVERSATION",MARK_CONVERSATION:"MARK_CONVERSATION",UNMARK_CONVERSATION:"UNMARK_CONVERSATION",GET_MARKED_CONVERSATIONS_LIST:"GET_MARKED_CONVERSATIONS_LIST",SET_CONVERSATION_AVATAR:"SET_CONVERSATION_AVATAR",GET_TELEPHONY_CONVERSATION_ID:"GET_TELEPHONY_CONVERSATION_ID",GET_ATTACHMENTS:"GET_ATTACHMENTS",GET_CONVERSATION_BY_USER:"GET_CONVERSATION_BY_USER",GET_CONVERSATION_SUMMARY:"GET_CONVERSATION_SUMMARY",LIKE_TEXT_ITEM:"LIKE_TEXT_ITEM",UNLIKE_TEXT_ITEM:"UNLIKE_TEXT_ITEM",DELETE_RECORDING:"DELETE_RECORDING",MODERATE_CONVERSATION:"MODERATE_CONVERSATION",UNMODERATE_CONVERSATION:"UNMODERATE_CONVERSATION",ADD_SCHEDULE_ITEM:"ADD_SCHEDULE_ITEM",UPDATE_SCHEDULE_ITEM:"UPDATE_SCHEDULE_ITEM",DELETE_SCHEDULE_ITEM:"DELETE_SCHEDULE_ITEM",GET_ALL_USER_SCHEDULE_ITEMS:"GET_ALL_USER_SCHEDULE_ITEMS",GRANT_MODERATOR_RIGHTS:"GRANT_MODERATOR_RIGHTS",DROP_MODERATOR_RIGHTS:"DROP_MODERATOR_RIGHTS",GET_CONVERSATION_THREADS:"GET_CONVERSATION_THREADS",GET_THREAD_COMMENTS:"GET_THREAD_COMMENTS",GET_THREADS_BY_IDS:"GET_THREADS_BY_IDS",ADD_JOURNAL_ENTRY:"ADD_JOURNAL_ENTRY",GET_THREADS_BY_ITEM_IDS:"GET_THREADS_BY_ITEM_IDS",DELETE_ATTACHMENTS:"DELETE_ATTACHMENTS",UPDATE_GUEST_ACCESS:"UPDATE_GUEST_ACCESS",GET_CONVERSATION_PARTICIPANTS:"GET_CONVERSATION_PARTICIPANTS",GET_CONVERSATION_FEED:"GET_CONVERSATION_FEED",SET_FAVORITE_POSITION:"SET_FAVORITE_POSITION",GET_ITEMS_BY_IDS:"GET_ITEMS_BY_IDS",ADD_LABELS:"ADD_LABELS",ASSIGN_LABELS:"ASSIGN_LABELS",UNASSIGN_LABELS:"UNASSIGN_LABELS",GET_LABELS:"GET_LABELS",GET_LABEL_PAGE:"GET_LABEL_PAGE",REMOVE_LABELS:"REMOVE_LABELS",EDIT_LABEL:"EDIT_LABEL",UPDATE_RTC_ITEM_ATTACHMENTS:"UPDATE_RTC_ITEM_ATTACHMENTS",GET_CONVERSATIONS_BY_FILTER:"GET_CONVERSATIONS_BY_FILTER",ADD_FILTER:"ADD_FILTER",REMOVE_FILTERS:"REMOVE_FILTERS",GET_FILTERS:"GET_FILTERS",EDIT_FILTER:"EDIT_FILTER",GET_FAVORITE_CONVERSATION_IDS:"GET_FAVORITE_CONVERSATION_IDS",GET_CONVERSATIONS_BY_IDS:"GET_CONVERSATIONS_BY_IDS",GET_USER_DATA_SINCE:"GET_USER_DATA_SINCE",GET_CONFERENCE_INVITATION_TEXT:"GET_CONFERENCE_INVITATION_TEXT",GET_CONFERENCE_INVITATION_EXAMPLE:"GET_CONFERENCE_INVITATION_EXAMPLE",GET_TEASER_MESSAGES:"GET_TEASER_MESSAGES",TAKE_MODERATION_RIGHT:"TAKE_MODERATION_RIGHT"},ConversationEventType:{CREATE:"CREATE",UPDATE:"UPDATE",DELETE:"DELETE",ADD_ITEM:"ADD_ITEM",UPDATE_ITEM:"UPDATE_ITEM",READ_ITEMS:"READ_ITEMS",TYPING:"TYPING",DRAFT_MESSAGE_SAVED:"DRAFT_MESSAGE_SAVED",DRAFT_MESSAGE_DISCARDED:"DRAFT_MESSAGE_DISCARDED",DRAFT_MESSAGE_PUBLISHED:"DRAFT_MESSAGE_PUBLISHED",FLAG_ITEM:"FLAG_ITEM",CLEAR_FLAGGED_ITEM:"CLEAR_FLAGGED_ITEM",CONVERSATION_MARKED:"CONVERSATION_MARKED",CONVERSATION_UNMARKED:"CONVERSATION_UNMARKED",FAVORITE_POSITION_CHANGED:"FAVORITE_POSITION_CHANGED",USER_DATA_CHANGED:"USER_DATA_CHANGED"},SearchDirection:{AFTER:"AFTER",BEFORE:"BEFORE",BOTH:"BOTH"},TimestampFilter:{MODIFICATION:"MODIFICATION",CREATION:"CREATION"},OrderBy:{TIMESTAMP_ASC:"TIMESTAMP_ASC",TIMESTAMP_DESC:"TIMESTAMP_DESC"},OrderType:{MODIFICATION:"MODIFICATION",CREATION:"CREATION"},ConversationType:{DIRECT:"DIRECT",GROUP:"GROUP",OPEN:"OPEN",LARGE:"LARGE"},ConversationItemType:{TEXT:"TEXT",RTC:"RTC",SYSTEM:"SYSTEM"},ConversationItemTypeMapping:{RTC:"phone",CALL_SUMMARY:"call-summary",TEXT:"text",SYSTEM:"notification",VOICEMAIL:"vm",MARKER:"marker",DIVIDER:"divider",GAP:"gap"},ConversationFilter:{ALL:"ALL",OPEN_MEMBER:"OPEN_MEMBER",MARKED:"MARKED",ARCHIVED:"ARCHIVED",UNARCHIVED:"UNARCHIVED"},ConversationMarkFilter:{MUTE:"MUTE",FAVORITE:"FAVORITE"},GetConversationParticipantCriteria:{DISPLAY_NAME:"DISPLAY_NAME",TYPE:"TYPE"},ConversationParticipantType:{ACTIVE:"ACTIVE",REGULAR:"REGULAR",FORMER:"FORMER",MODERATOR:"MODERATOR",GUEST:"GUEST"},DataRetentionState:{UNTOUCHED:"UNTOUCHED",OUTDATED:"OUTDATED",DELETED:"DELETED"},RetrieveAction:{CONVERSATIONS:"CONVERSATIONS",CONVERSATION_IDS:"CONVERSATION_IDS",CONVERSATIONS_AND_IDS:"CONVERSATIONS_AND_IDS"},RTCItemType:{STARTED:"STARTED",ENDED:"ENDED",MISSED:"MISSED",PARTICIPANT_JOINED:"PARTICIPANT_JOINED",PARTICIPANT_LEFT:"PARTICIPANT_LEFT",MOVED:"MOVED"},RTCItemMissed:{UNREACHABLE:"UNREACHABLE",TIMEOUT:"TIMEOUT",USER_BUSY:"USER_BUSY",DECLINED:"DECLINED",CANCELED:"CANCELED",INVALID_NUMBER:"INVALID_NUMBER",TEMPORARILY_UNAVAILABLE:"TEMPORARILY_UNAVAILABLE"},RTCItemMoved:{MOVED_FROM:"MOVED_FROM",MOVED_TO:"MOVED_TO"},ExternalUnshareProviderType:{SYNCPLICITY:"SYNCPLICITY"},SortingType:{RECENT_ACTIVITY_ASC:"RECENT_ACTIVITY_ASC",RECENT_ACTIVITY_DESC:"RECENT_ACTIVITY_DESC",ALPHABETICALLY_ASC:"ALPHABETICALLY_ASC",ALPHABETICALLY_DESC:"ALPHABETICALLY_DESC",POPULARITY_ASC:"POPULARITY_ASC",POPULARITY_DESC:"POPULARITY_DESC",TIMESTAMP_ASC:"TIMESTAMP_ASC"},TextItemContentType:{PLAIN:"PLAIN",RICH:"RICH"},TextItemState:{CREATED:"CREATED",EDITED:"EDITED",DELETED:"DELETED",CLUSTERED:"CLUSTERED"},SystemItemType:{CONVERSATION_CREATED:"CONVERSATION_CREATED",PARTICIPANT_ADDED:"PARTICIPANT_ADDED",PARTICIPANT_REMOVED:"PARTICIPANT_REMOVED",CONVERSATION_RENAMED:"CONVERSATION_RENAMED",GUEST_JOINED:"GUEST_JOINED",GUEST_INVITED:"GUEST_INVITED",CONFERENCE_DETAILS_CHANGED:"CONFERENCE_DETAILS_CHANGED",CONVERSATION_MODERATED:"CONVERSATION_MODERATED",AVATAR_CHANGED:"AVATAR_CHANGED"},AttachmentOrderType:{CREATION:"CREATION",FILENAME:"FILENAME",SIZE:"SIZE",MIMETYPE:"MIMETYPE",FILEEXTENSION:"FILEEXTENSION"},AttachmentOrderDirection:{ASC:"ASC",DSC:"DSC"},BridgeLocale:{EN_US:"EN_US",EN_GB:"EN_GB",DE_DE:"DE_DE",ES_ES:"ES_ES",FR_FR:"FR_FR",IT_IT:"IT_IT",RU_RU:"RU_RU",ZH_HANS_CN:"ZH_HANS_CN"},BridgeNumberType:{TOLL:"TOLL",TOLL_FREE:"TOLL_FREE",LOCAL:"LOCAL"},FilterTarget:{CONVERSATION_TYPE:"CONVERSATION_TYPE",LABEL_ID:"LABEL_ID"},FilterTargetComparator:{EQ:"EQ",NOT:"NOT"},FilterBoolConnector:{AND:"AND",OR:"OR"},SystemLabel:{ARCHIVED:"ARCHIVED"},IncludedUserData:{LAST_READ_TS:"LASTREADTS",UNREAD_COUNT:"UNREADCOUNT",LABEL_IDS:"LABELIDS",SYSTEM_LABEL_IDS:"SYSTEMLABELIDS"},ChangedUserData:{LAST_READ_TS:"LASTREADTS",LABEL_IDS:"LABELIDS",SYSTEM_LABEL_IDS:"SYSTEMLABELIDS"},ModerationTakenResult:{OK:"OK",ALREADY_HAS_MODERATOR:"ALREADY_HAS_MODERATOR",NO_MODERATED_CONVERTION:"NO_MODERATED_CONVERTION",NO_FULL_CONVERSATION_MEMBER:"NO_FULL_CONVERSATION_MEMBER",TAKE_MODERATION_FORBIDDEN:"TAKE_MODERATION_FORBIDDEN"},InstrumentationActionType:{SUBMIT_CLIENT_DATA:"SUBMIT_CLIENT_DATA",SUBMIT_QOS_DATA:"SUBMIT_QOS_DATA"},SubmitDataResult:{UNKNOWN:"UNKNOWN",OK:"OK",NO_USERID:"NO_USERID",NO_CLIENTID:"NO_CLIENTID",NO_DATA:"NO_DATA",PROCESSING_ERROR:"PROCESSING_ERROR"},QOSMediaType:{AUDIO:"AUDIO",VIDEO:"VIDEO",SCREEN_SHARE:"SCREEN_SHARE"},RTCCallActionType:{JOIN:"JOIN",ANSWER:"ANSWER",ICE_CANDIDATES:"ICE_CANDIDATES",LEAVE:"LEAVE",TERMINATE:"TERMINATE",CHANGE_MEDIA_TYPE:"CHANGE_MEDIA_TYPE",INVITE_REJECT:"INVITE_REJECT",CHANGE_MEDIA_ACCEPT:"CHANGE_MEDIA_ACCEPT",CHANGE_MEDIA_REJECT:"CHANGE_MEDIA_REJECT",PREPARE:"PREPARE",RENEW_TURN_CREDENTIALS:"RENEW_TURN_CREDENTIALS",SEND_PROGRESS:"SEND_PROGRESS",SUBMIT_RTC_QUALITY_RATING:"SUBMIT_RTC_QUALITY_RATING"},RTCCallEventType:{SDP_ANSWER:"SDP_ANSWER",SDP_FAILED:"SDP_FAILED",INVITE:"INVITE",INVITE_CANCEL:"INVITE_CANCEL",INVITE_FAILED:"INVITE_FAILED",CHANGE_MEDIA_TYPE_REQUESTED:"CHANGE_MEDIA_TYPE_REQUESTED",PROGRESS:"PROGRESS",CHANGE_MEDIA_TYPE_FORCED:"CHANGE_MEDIA_TYPE_FORCED",ICE_CANDIDATES:"ICE_CANDIDATES",RTC_QUALITY_RATING_EVENT:"RTC_QUALITY_RATING_EVENT",IFRAME_STATISTICS:"IFRAME_STATISTICS"},SdpFailedCause:{SESSION_STARTED_FAILED:"SESSION_STARTED_FAILED",CONNECTION_LOST:"CONNECTION_LOST",SERVICE_ERROR:"SERVICE_ERROR",CHANGE_MEDIA_REJECT:"CHANGE_MEDIA_REJECT",JOIN_FORBIDDEN:"JOIN_FORBIDDEN",SESSION_TERMINATED:"SESSION_TERMINATED",MAX_PARTICIPANTS_REACHED:"MAX_PARTICIPANTS_REACHED"},InviteCancelCause:{ACCEPT:"ACCEPT",BUSY:"BUSY",DECLINE:"DECLINE",REVOKED:"REVOKED"},InviteFailedCause:{BUSY:"BUSY",DECLINE:"DECLINE",TIMEOUT:"TIMEOUT",NOT_REACHABLE:"NOT_REACHABLE",INVALID_NUMBER:"INVALID_NUMBER",TEMPORARILY_UNAVAILABLE:"TEMPORARILY_UNAVAILABLE",REVOKED:"REVOKED"},InviteRejectCause:{BUSY:"BUSY",DECLINE:"DECLINE",TIMEOUT:"TIMEOUT"},RTCProgressType:{ALERTING:"ALERTING",PROGRESS:"PROGRESS",EARLY_CONNECT:"EARLY_CONNECT"},DisconnectCause:{HANGUP:"HANGUP",CONNECTION_LOST:"CONNECTION_LOST",NEGOTIATION_FAILED:"NEGOTIATION_FAILED",TRANSPORT_NEGOTIATION_FAILED:"TRANSPORT_NEGOTIATION_FAILED",SECURITY_NEGOTIATION_FAILED:"SECURITY_NEGOTIATION_FAILED",REMOTE_SDP_FAILED:"REMOTE_SDP_FAILED",STREAM_LOST:"STREAM_LOST",CALL_SETUP_FAILED:"CALL_SETUP_FAILED"},DisconnectReason:{PAGE_UNLOADED:"PAGE_UNLOADED",CALL_LOST:"CALL_LOST",LOGOUT:"LOGOUT"},RTCSessionActionType:{LOCK:"LOCK",MUTE_SESSION:"MUTE_SESSION",MUTE:"MUTE",ADD_PARTICIPANT:"ADD_PARTICIPANT",REMOVE_PARTICIPANT:"REMOVE_PARTICIPANT",GET_ACTIVE_SESSIONS:"GET_ACTIVE_SESSIONS",GET_SESSION:"GET_SESSION",MOVE:"MOVE",START_RECORDING:"START_RECORDING",STOP_RECORDING:"STOP_RECORDING",RAISE_QUESTION:"RAISE_QUESTION",INVITE_TO_STAGE:"INVITE_TO_STAGE",INVITE_TO_STAGE_ANSWER:"INVITE_TO_STAGE_ANSWER",UPDATE_QUESTION_STATE:"UPDATE_QUESTION_STATE",INVITE_TO_STAGE_CANCEL:"INVITE_TO_STAGE_CANCEL",REMOVE_FROM_STAGE:"REMOVE_FROM_STAGE",GET_QUESTIONS:"GET_QUESTIONS",OPEN_CURTAIN:"OPEN_CURTAIN",CLOSE_CURTAIN:"CLOSE_CURTAIN",GET_NODE_STATE:"GET_NODE_STATE",ENABLE_WHITEBOARD:"ENABLE_WHITEBOARD",DISABLE_WHITEBOARD:"DISABLE_WHITEBOARD",ADD_WHITEBOARD_ELEMENT:"ADD_WHITEBOARD_ELEMENT",REMOVE_WHITEBOARD_ELEMENT:"REMOVE_WHITEBOARD_ELEMENT",UPDATE_WHITEBOARD_ELEMENT:"UPDATE_WHITEBOARD_ELEMENT",CLEAR_WHITEBOARD:"CLEAR_WHITEBOARD",GET_WHITEBOARD:"GET_WHITEBOARD",SET_WHITEBOARD_BACKGROUND:"SET_WHITEBOARD_BACKGROUND",CLEAR_WHITEBOARD_BACKGROUND:"CLEAR_WHITEBOARD_BACKGROUND",TOGGLE_WHITEBOARD_OVERLAY:"TOGGLE_WHITEBOARD_OVERLAY",UNDO_WHITEBOARD:"UNDO_WHITEBOARD",SEND_CLIENT_INFO:"SEND_CLIENT_INFO",REQUEST_SCREEN_CONTROL:"REQUEST_SCREEN_CONTROL",REJECT_SCREEN_CONTROL_REQUEST:"REJECT_SCREEN_CONTROL_REQUEST",OFFER_SCREEN_CONTROL:"OFFER_SCREEN_CONTROL",ACCEPT_SCREEN_CONTROL:"ACCEPT_SCREEN_CONTROL",REJECT_SCREEN_CONTROL:"REJECT_SCREEN_CONTROL",STOP_SCREEN_CONTROL:"STOP_SCREEN_CONTROL"},RTCSessionEventType:{SESSION_STARTED:"SESSION_STARTED",SESSION_TERMINATED:"SESSION_TERMINATED",SESSION_UPDATED:"SESSION_UPDATED",SESSION_MOVED:"SESSION_MOVED",PARTICIPANT_JOINED:"PARTICIPANT_JOINED",PARTICIPANT_LEFT:"PARTICIPANT_LEFT",PARTICIPANT_UPDATED:"PARTICIPANT_UPDATED",ACTIVE_SPEAKER:"ACTIVE_SPEAKER",VIDEO_ACTIVE_SPEAKER:"VIDEO_ACTIVE_SPEAKER",SESSION_RECORDING_INFO:"SESSION_RECORDING_INFO",SESSION_RECORDING_STARTED:"SESSION_RECORDING_STARTED",SESSION_RECORDING_STOPPED:"SESSION_RECORDING_STOPPED",SESSION_RECORDING_FAILED:"SESSION_RECORDING_FAILED",SESSION_TERMINATION_TIMER_STARTED:"SESSION_TERMINATION_TIMER_STARTED",SESSION_TERMINATION_TIMER_CANCELLED:"SESSION_TERMINATION_TIMER_CANCELLED",SESSION_ATTRIBUTES_CHANGED_EVENT:"SESSION_ATTRIBUTES_CHANGED_EVENT",QUESTION_EVENT:"QUESTION_EVENT",INVITE_TO_STAGE_EVENT:"INVITE_TO_STAGE_EVENT",INVITE_TO_STAGE_CANCEL_EVENT:"INVITE_TO_STAGE_CANCEL_EVENT",CURTAIN_EVENT:"CURTAIN_EVENT",WHITEBOARD_ENABLED:"WHITEBOARD_ENABLED",WHITEBOARD_DISABLED:"WHITEBOARD_DISABLED",WHITEBOARD_ELEMENT_ADDED:"WHITEBOARD_ELEMENT_ADDED",WHITEBOARD_ELEMENT_REMOVED:"WHITEBOARD_ELEMENT_REMOVED",WHITEBOARD_ELEMENT_UPDATED:"WHITEBOARD_ELEMENT_UPDATED",WHITEBOARD_CLEARED:"WHITEBOARD_CLEARED",WHITEBOARD_BACKGROUND_SET:"WHITEBOARD_BACKGROUND_SET",WHITEBOARD_BACKGROUND_CLEARED:"WHITEBOARD_BACKGROUND_CLEARED",WHITEBOARD_OVERLAY_TOGGLED:"WHITEBOARD_OVERLAY_TOGGLED",WHITEBOARD_SYNC:"WHITEBOARD_SYNC",SCREEN_CONTROL_REQUESTED:"SCREEN_CONTROL_REQUESTED",SCREEN_CONTROL_REQUEST_REJECTED:"SCREEN_CONTROL_REQUEST_REJECTED",SCREEN_CONTROL_OFFERED:"SCREEN_CONTROL_OFFERED",SCREEN_CONTROL_ACCEPTED:"SCREEN_CONTROL_ACCEPTED",SCREEN_CONTROL_REJECTED:"SCREEN_CONTROL_REJECTED",HANDOVER_SCREEN_CONTROL:"HANDOVER_SCREEN_CONTROL",SCREEN_CONTROL_TERMINATED:"SCREEN_CONTROL_TERMINATED",SCREEN_CONTROL_FAILED:"SCREEN_CONTROL_FAILED"},RTCSessionTerminatedCause:{FORCED:"FORCED",NO_USERS_LEFT:"NO_USERS_LEFT",CONDITIONAL:"CONDITIONAL"},RTCSessionParticipantLeftCause:{LEFT:"LEFT",CONNECTION_LOST:"CONNECTION_LOST",REMOVED:"REMOVED",CONDITIONAL_TERMINATE:"CONDITIONAL_TERMINATE",FORCED_TERMINATE:"FORCED_TERMINATE",MAX_PARTICIPANTS_REACHED:"MAX_PARTICIPANTS_REACHED",USER_LEFT_STAGE:"USER_LEFT_STAGE",NEGOTIATION_FAILED:"NEGOTIATION_FAILED",OFFER_NOT_ACCEPTED:"OFFER_NOT_ACCEPTED",STREAM_LOST:"STREAM_LOST",TRANSPORT_NEGOTIATION_FAILED:"TRANSPORT_NEGOTIATION_FAILED",SECURITY_NEGOTIATION_FAILED:"SECURITY_NEGOTIATION_FAILED",CALL_SETUP_FAILED:"CALL_SETUP_FAILED",REMOTE_SDP_FAILED:"REMOTE_SDP_FAILED"},RtcSupportedFeatures:{UPGRADE_TO_CONFERENCE:"UPGRADE_TO_CONFERENCE",SCREEN_CONTROL:"SCREEN_CONTROL"},RealtimeMediaType:{AUDIO:"AUDIO",VIDEO:"VIDEO",DESKTOP_SHARING:"DESKTOP_SHARING"},RTCParticipantType:{USER:"USER",EXTERNAL:"EXTERNAL",TELEPHONY:"TELEPHONY",SESSION_GUEST:"SESSION_GUEST",MEETING_POINT:"MEETING_POINT"},QuestionState:{RAISED:"RAISED",ANSWERED:"ANSWERED",DISCARDED:"DISCARDED",ANSWER_LATER:"ANSWER_LATER"},StageState:{INITIAL:"INITIAL",INVITED:"INVITED",REJECTED:"REJECTED",ACCEPTED:"ACCEPTED",WAS_ON_STAGE:"WAS_ON_STAGE",TIMEOUT:"TIMEOUT",LEFT_CONFERENCE:"LEFT_CONFERENCE"},QuestionEventType:{CREATED:"CREATED",UPDATED:"UPDATED",REVOKED:"REVOKED"},StageAction:{USER_ENTERED_STAGE:"USER_ENTERED_STAGE",USER_LEFT_STAGE:"USER_LEFT_STAGE"},CurtainState:{OPEN:"OPEN",INITIAL:"INITIAL",FINAL:"FINAL",PAUSED:"PAUSED"},NodeType:{MEDIA_ACCESS:"MEDIA_ACCESS",APPLICATION:"APPLICATION",STORAGE:"STORAGE",ACCESS:"ACCESS",LOAD_BALANCER:"LOAD_BALANCER",ZOOKEEPER:"ZOOKEEPER",MANAGEMENT:"MANAGEMENT",OPERATIONS:"OPERATIONS"},NodeState:{UP:"UP",DOWN:"DOWN",OVERLOAD:"OVERLOAD",MAINTENANCE:"MAINTENANCE"},RecordingInfoState:{INITIAL:"INITIAL",START_PENDING:"START_PENDING",STARTED:"STARTED",STOPPED:"STOPPED",FINISHED:"FINISHED"},RecordingInfoReason:{NONE:"NONE",STOPPED_MANUALLY:"STOPPED_MANUALLY",STOPPED_AUTOMATICALLY:"STOPPED_AUTOMATICALLY",NO_INPUT_TIMEOUT:"NO_INPUT_TIMEOUT",MAX_INPUT_TIMEOUT:"MAX_INPUT_TIMEOUT",NO_STREAMING_DATA:"NO_STREAMING_DATA",LENGTH_LIMIT_REACHED:"LENGTH_LIMIT_REACHED",NO_MORE_DISK_SPACE_LEFT:"NO_MORE_DISK_SPACE_LEFT",UNKNOWN_ERROR:"UNKNOWN_ERROR"},RecordingTriggerReason:{USER:"USER",CURTAIN:"CURTAIN"},RtcClientInfoType:{OFFLINE_JOIN_FAILURE:"OFFLINE_JOIN_FAILURE",DEVICE_DIAGNOSTICS:"DEVICE_DIAGNOSTICS",CALL_CONNECTED:"CALL_CONNECTED"},RtcClientInfoReason:{NO_NETWORK_CONNECTION:"NO_NETWORK_CONNECTION",DISCONNECTED:"DISCONNECTED",FAILED_TO_SEND:"FAILED_TO_SEND",REQUEST_TIMEOUT:"REQUEST_TIMEOUT",JOIN_DELAY:"JOIN_DELAY",CALL_CONNECTED:"CALL_CONNECTED"},RtcActionInfoType:{REQUEST_RESPONSE:"REQUEST_RESPONSE",EVENT:"EVENT"},RtcDiagnosticsAction:{RENEW_TURN_CREDENTIALS:"RENEW_TURN_CREDENTIALS",PREPARE:"PREPARE",JOIN:"JOIN",ICE_CANDIDATES:"ICE_CANDIDATES",SDP_CONNECTED:"SDP_CONNECTED",SDP_ANSWER:"SDP_ANSWER",REMOTE_ICE_CANDIDATES:"REMOTE_ICE_CANDIDATES"},SearchActionType:{START_BASIC_SEARCH:"START_BASIC_SEARCH",START_DETAIL_SEARCH:"START_DETAIL_SEARCH",START_USER_SEARCH:"START_USER_SEARCH",CANCEL_SEARCH:"CANCEL_SEARCH",ADD_RECENT_SEARCH:"ADD_RECENT_SEARCH",GET_RECENT_SEARCHES:"GET_RECENT_SEARCHES",SEARCH_CONVERSATION_PARTICIPANTS:"SEARCH_CONVERSATION_PARTICIPANTS"},SearchEventType:{BASIC_SEARCH_RESULT:"BASIC_SEARCH_RESULT",DETAILED_SEARCH_RESULT:"DETAILED_SEARCH_RESULT",SEARCH_STATUS:"SEARCH_STATUS",RECENT_SEARCH_ADDED:"RECENT_SEARCH_ADDED"},SystemActionType:{GET_GLOBAL_PROPERTY:"GET_GLOBAL_PROPERTY",GET_GLOBAL_PROPERTIES:"GET_GLOBAL_PROPERTIES"},SystemEventType:{BROADCAST:"BROADCAST",BROADCAST_REMOVED:"BROADCAST_REMOVED",MAINTENANCE:"MAINTENANCE",MAINTENANCE_REMOVED:"MAINTENANCE_REMOVED",MAINTENANCE_ADDED:"MAINTENANCE_ADDED"},GlobalPropertyName:{ATTACHMENT_UPLOAD_MAX_SIZE:"ATTACHMENT_UPLOAD_MAX_SIZE",CONV_PARTICIPANTS_MAX_SIZE:"CONV_PARTICIPANTS_MAX_SIZE",CONV_PARTICIPANTS_ADD_LIMIT:"CONV_PARTICIPANTS_ADD_LIMIT",XMPP_FEDERATION_ENABLED:"XMPP_FEDERATION_ENABLED",CLIENT_AUTOUPDATE_MAX_TIME:"CLIENT_AUTOUPDATE_MAX_TIME"},SearchTypes:{CONVERSATION:"CONVERSATION",USER:"USER"},SearchStatusCode:{ERROR:"ERROR",CANCELED:"CANCELED",FINISHED:"FINISHED",TIMEOUT:"TIMEOUT",NO_RESULT:"NO_RESULT",MORE_RESULT:"MORE_RESULT"},SearchResultType:{TOPIC_MATCH:"TOPIC_MATCH",USER_MATCH:"USER_MATCH",ATTACHMENT_MATCH:"ATTACHMENT_MATCH",ITEM_MATCH:"ITEM_MATCH"},SearchScope:{ALL:"ALL",PEOPLE:"PEOPLE",MEMBERS:"MEMBERS",MESSAGES:"MESSAGES",CONVERSATIONS:"CONVERSATIONS",FILES:"FILES",SENT_BY:"SENT_BY",DATE:"DATE",LABEL:"LABEL",FILTER:"FILTER"},UserActionType:{LOGON:"LOGON",LOGOUT:"LOGOUT",RENEW_TOKEN:"RENEW_TOKEN",GET_USER_BY_ID:"GET_USER_BY_ID",UPDATE:"UPDATE",GET_LOGGED_ON:"GET_LOGGED_ON",GET_STUFF:"GET_STUFF",SET_PRESENCE:"SET_PRESENCE",GET_PRESENCE:"GET_PRESENCE",SUBSCRIBE_PRESENCE:"SUBSCRIBE_PRESENCE",UNSUBSCRIBE_PRESENCE:"UNSUBSCRIBE_PRESENCE",CHANGE_PASSWORD:"CHANGE_PASSWORD",GET_USERS_BY_IDS:"GET_USERS_BY_IDS",GET_DEVICES:"GET_DEVICES",GET_USER_SETTINGS:"GET_USER_SETTINGS",SET_USER_SETTINGS:"SET_USER_SETTINGS",GET_USER_BY_MAIL:"GET_USER_BY_MAIL",GET_USERS_BY_MAILS:"GET_USERS_BY_MAILS",EMAIL_UPDATE:"EMAIL_UPDATE",GENERATE_EMAIL_UPDATE_TOKEN:"GENERATE_EMAIL_UPDATE_TOKEN",GET_TELEPHONY_DATA:"GET_TELEPHONY_DATA",GET_USER_EXTENSIONS:"GET_USER_EXTENSIONS",SET_USER_EXTENSION_STATE:"SET_USER_EXTENSION_STATE",GET_LDAP_TECHNICAL_USER_PRESENCE:"GET_LDAP_TECHNICAL_USER_PRESENCE",GET_ATTACHMENTS:"GET_ATTACHMENTS",SET_PASSWORD:"SET_PASSWORD",GET_TENANT_SETTINGS:"GET_TENANT_SETTINGS",SUBSCRIBE_DEVICES:"SUBSCRIBE_DEVICES",UNSUBSCRIBE_DEVICES:"UNSUBSCRIBE_DEVICES",OAUTH_GET_GRANTED_ACCESS_TOKENS:"OAUTH_GET_GRANTED_ACCESS_TOKENS",OAUTH_REVOKE_ACCESS_TOKEN:"OAUTH_REVOKE_ACCESS_TOKEN",REVOKE_MANAGED_DEVICES:"REVOKE_MANAGED_DEVICES",GET_SECURITY_TOKEN_INFO:"GET_SECURITY_TOKEN_INFO",REVOKE_SECURITY_TOKEN:"REVOKE_SECURITY_TOKEN",RESET_OPENSCAPE_DEVICE_PINS:"RESET_OPENSCAPE_DEVICE_PINS",SUBSCRIBE_TENANT_PRESENCE:"SUBSCRIBE_TENANT_PRESENCE",UNSUBSCRIBE_TENANT_PRESENCE:"UNSUBSCRIBE_TENANT_PRESENCE",WAKE_UP:"WAKE_UP",GO_TO_SLEEP:"GO_TO_SLEEP",SET_CLIENT_CAPABILITIES:"SET_CLIENT_CAPABILITIES"},UserEventType:{ATC_REFRESH_FAILED:"ATC_REFRESH_FAILED",USER_PRESENCE_CHANGE:"USER_PRESENCE_CHANGE",USER_UPDATED:"USER_UPDATED",SESSION_EXPIRES:"SESSION_EXPIRES",SESSION_EXPIRING:"SESSION_EXPIRING",SESSION_CLOSED:"SESSION_CLOSED",PASSWORD_CHANGED:"PASSWORD_CHANGED",USER_SETTING_UPDATED:"USER_SETTING_UPDATED",TELEPHONY_DATA:"TELEPHONY_DATA",DEVICE_LIST_CHANGED:"DEVICE_LIST_CHANGED",NOTIFICATION_SUBSCRIPTION_CHANGE:"NOTIFICATION_SUBSCRIPTION_CHANGE",TENANT_CONFIGURATION_UPDATED:"TENANT_CONFIGURATION_UPDATED",UCAAS_DEVICE_UPDATED:"UCAAS_DEVICE_UPDATED",TENANT_PRESENCE_CHANGE:"TENANT_PRESENCE_CHANGE"},GetStuffType:{USER:"USER",ACCOUNTS:"ACCOUNTS",FIRST_WEB_LOGIN:"FIRST_WEB_LOGIN",PRESENCE_STATE:"PRESENCE_STATE",RECENT_SEARCHES:"RECENT_SEARCHES",SETTINGS:"SETTINGS",TENANT_DATA:"TENANT_DATA",SUPPORT_CONVERSATION_ID:"SUPPORT_CONVERSATION_ID",TELEPHONY_CONVERSATION_ID:"TELEPHONY_CONVERSATION_ID",GLOBAL_PROPERTIES:"GLOBAL_PROPERTIES",TENANT:"TENANT",NOTIFICATION_SUBSCRIPTIONS:"NOTIFICATION_SUBSCRIPTIONS",PENDING_SYSTEM_NOTIFICATIONS:"PENDING_SYSTEM_NOTIFICATIONS"},NotificationSubscriptionType:{ONLINE_STATUS:"ONLINE_STATUS"},NotificationSubscriptionAction:{SUBSCRIBE:"SUBSCRIBE",UNSUBSCRIBE:"UNSUBSCRIBE"},DeviceType:{PHONE:"PHONE",WEB:"WEB",APPLICATION:"APPLICATION",MOBILE:"MOBILE",SDK:"SDK"},PresenceState:{AVAILABLE:"AVAILABLE",OFFLINE:"OFFLINE",AWAY:"AWAY",BUSY:"BUSY",DND:"DND"},ChangePasswordResult:{OK:"OK",NEW_INVALID:"NEW_INVALID",OLD_INVALID:"OLD_INVALID",ALREADY_CHANGED:"ALREADY_CHANGED",OPERATION_ERROR:"OPERATION_ERROR"},SetPasswordResult:{OK:"OK",NOT_OK:"NOT_OK"},SessionClosedReason:{NEW_CONNECTION_DETECTED:"NEW_CONNECTION_DETECTED",UPGRADE_REQUIRED:"UPGRADE_REQUIRED",SUSPENDED:"SUSPENDED",DELETED:"DELETED",TENANT_DELETED:"TENANT_DELETED",TENANT_SUSPENDED:"TENANT_SUSPENDED"},RecordingStoppedReason:{LENGTH_LIMIT_REACHED:"LENGTH_LIMIT_REACHED",NO_INPUT:"NO_INPUT"},RecordingUploadState:{IN_PROGRESS:"IN_PROGRESS",RETRYING:"RETRYING",FINISHED:"FINISHED",FAILED:"FAILED",DELETED:"DELETED"},UserRole:{GUEST:"GUEST",USER:"USER",TENANT_ADMIN:"TENANT_ADMIN",SUPPORT:"SUPPORT",SYSTEM_ADMIN:"SYSTEM_ADMIN",TELEPHONY_CONNECTOR:"TELEPHONY_CONNECTOR",VIRTUAL_TELEPHONY_CONNECTOR:"VIRTUAL_TELEPHONY_CONNECTOR",SESSION_GUEST:"SESSION_GUEST",MEETING_POINT:"MEETING_POINT",BOT:"BOT"},UserType:{REGULAR:"REGULAR",GUEST:"GUEST",SUPPORT:"SUPPORT",TELEPHONY:"TELEPHONY",SESSION_GUEST:"SESSION_GUEST",MEETING_POINT:"MEETING_POINT",TECHNICAL:"TECHNICAL",BOT:"BOT",XMPP:"XMPP"},UserState:{INACTIVE:"INACTIVE",ACTIVE:"ACTIVE",SUSPENDED:"SUSPENDED",DELETED:"DELETED",PURGED:"PURGED"},Locale:{EN_US:"EN_US",DE_DE:"DE_DE",ES_ES:"ES_ES",FR_FR:"FR_FR",IT_IT:"IT_IT",RU_RU:"RU_RU",ZH_HANS_CN:"ZH_HANS_CN"},PhoneNumberType:{WORK:"WORK",MOBILE:"MOBILE",HOME:"HOME",FAX:"FAX",OTHER:"OTHER",UCAAS:"UCAAS"},PhoneNumberNpi:{PUBLIC:"PUBLIC",PRIVATE:"PRIVATE"},EmailAddressType:{WORK:"WORK",HOME:"HOME",OTHER:"OTHER"},UserSettingArea:{ALL:"ALL",EMAIL:"EMAIL",DESKTOP:"DESKTOP",PRIVACY:"PRIVACY",CLIENT:"CLIENT"},UserSettingDataType:{BOOLEAN:"BOOLEAN",NUMBER:"NUMBER",STRING:"STRING",TIMESTAMP:"TIMESTAMP"},UserSettingKey:{EMAIL_INVITES:"EMAIL_INVITES",EMAIL_MISSED_RTC:"EMAIL_MISSED_RTC",EMAIL_SUMMARY:"EMAIL_SUMMARY",EMAIL_UPDATE:"EMAIL_UPDATE",DESKTOP_RTC:"DESKTOP_RTC",DESKTOP_MISSED_MESSAGE:"DESKTOP_MISSED_MESSAGE",DESKTOP_CONVERSATION_CHANGE:"DESKTOP_CONVERSATION_CHANGE",DESKTOP_SYSINFO:"DESKTOP_SYSINFO",SHARE_LOCATION:"SHARE_LOCATION",RELEASE_NOTES_WEB_VERSION:"RELEASE_NOTES_WEB_VERSION",RELEASE_NOTES_MOBILE_VERSION:"RELEASE_NOTES_MOBILE_VERSION",TM_WEB_START_CONV_WITH:"TM_WEB_START_CONV_WITH",TM_WEB_ENTER_NAME:"TM_WEB_ENTER_NAME",TM_WEB_CALL_ACTION_BUTTONS:"TM_WEB_CALL_ACTION_BUTTONS",TM_WEB_SUPPORT_FEEDBACK:"TM_WEB_SUPPORT_FEEDBACK",TM_WEB_SUPPORT_ISSUE:"TM_WEB_SUPPORT_ISSUE",TM_WEB_SCREEN_SHARING_ENABLED:"TM_WEB_SCREEN_SHARING_ENABLED",TM_WEB_SEARCH_FILTER:"TM_WEB_SEARCH_FILTER",AUDIO_WEB_SOUNDS:"AUDIO_WEB_SOUNDS",TM_WEB_OPEN_CONVERSATION:"TM_WEB_OPEN_CONVERSATION",TM_WEB_ADD_CONVERSATION_TITLE:"TM_WEB_ADD_CONVERSATION_TITLE",TM_WEB_RICH_TEXT_EDITING:"TM_WEB_RICH_TEXT_EDITING",TM_WEB_MUTE_CONVERSATION:"TM_WEB_MUTE_CONVERSATION",TM_WEB_VIEW_MUTED_CONVERSATIONS:"TM_WEB_VIEW_MUTED_CONVERSATIONS",TM_WEB_LEAVING_CONVERSATION:"TM_WEB_LEAVING_CONVERSATION",TM_WEB_FOCUS_MODE:"TM_WEB_FOCUS_MODE",TM_WEB_CONFERENCE_DIAL_IN:"TM_WEB_CONFERENCE_DIAL_IN",TM_WEB_REMOVING_PARTICIPANTS:"TM_WEB_REMOVING_PARTICIPANTS",TM_WEB_FULL_SCREEN_MODES:"TM_WEB_FULL_SCREEN_MODES",TM_WEB_ADD_MULTIPLE_USERS:"TM_WEB_ADD_MULTIPLE_USERS",TM_WEB_THIRD_COLUMN:"TM_WEB_THIRD_COLUMN",TM_WEB_RESERVE_1:"TM_WEB_RESERVE_1",TM_WEB_RESERVE_2:"TM_WEB_RESERVE_2",TM_IOS_SEARCH:"TM_IOS_SEARCH",MOBILE_ENABLE_VIDEO_WIFI_ONLY:"MOBILE_ENABLE_VIDEO_WIFI_ONLY",TM_WEB_ADMIN_TELEPHONY_ENABLED:"TM_WEB_ADMIN_TELEPHONY_ENABLED",TM_WEB_TELPHONY_NUMBER_ASSIGNED:"TM_WEB_TELPHONY_NUMBER_ASSIGNED",TM_WEB_ACTIVE_SPEAKER_VIDEO:"TM_WEB_ACTIVE_SPEAKER_VIDEO",TM_WEB_FIRST_DIRECT_CONVERSATION:"TM_WEB_FIRST_DIRECT_CONVERSATION",TM_WEB_FIRST_GROUP_CONVERSATION:"TM_WEB_FIRST_GROUP_CONVERSATION",TM_WEB_FIRST_CONV_ADD_PARTCPNTS:"TM_WEB_FIRST_CONV_ADD_PARTCPNTS",TM_WEB_FIRST_CONV_SET_NAME:"TM_WEB_FIRST_CONV_SET_NAME",TM_WEB_FIRST_CONV_START_CONV:"TM_WEB_FIRST_CONV_START_CONV",TM_WEB_INVITE_USERS:"TM_WEB_INVITE_USERS",TM_WEB_EMERGENCY_CALL_DISCLAIMER:"TM_WEB_EMERGENCY_CALL_DISCLAIMER",TM_WEB_FIRST_DIRECT_PRIVATE_CONV:"TM_WEB_FIRST_DIRECT_PRIVATE_CONV",TM_WEB_FIRST_DIRECT_CONV_SAY_HI:"TM_WEB_FIRST_DIRECT_CONV_SAY_HI",TM_WEB_FIRST_DIRECT_CONV_ADD:"TM_WEB_FIRST_DIRECT_CONV_ADD",TM_WEB_GUEST_ACCESS:"TM_WEB_GUEST_ACCESS",TM_WEB_SHARE_CONFERENCE_DETAILS:"TM_WEB_SHARE_CONFERENCE_DETAILS",TM_WEB_START_RECORDING:"TM_WEB_START_RECORDING",TM_WEB_STOP_RECORDING_INIT:"TM_WEB_STOP_RECORDING_INIT",TM_WEB_STOP_RECORDING_PART:"TM_WEB_STOP_RECORDING_PART",TM_WEB_FIRST_CONF_RING_ALL:"TM_WEB_FIRST_CONF_RING_ALL",TM_WEB_FIRST_CALL_ACTIONS:"TM_WEB_FIRST_CALL_ACTIONS",TM_WEB_FIRST_CALL_GO_TO_FEED:"TM_WEB_FIRST_CALL_GO_TO_FEED",TM_WEB_FIRST_CALL_FULLSCREEN:"TM_WEB_FIRST_CALL_FULLSCREEN",FIRST_WEB_LOGIN_TIMESTAMP:"FIRST_WEB_LOGIN_TIMESTAMP",VOICEMAIL_ENABLED:"VOICEMAIL_ENABLED",VOICEMAIL_TIMEOUT:"VOICEMAIL_TIMEOUT",STATUS_MESSAGE_TEXT:"STATUS_MESSAGE_TEXT",OPT_OUT_PRESENCE:"OPT_OUT_PRESENCE",SECOND_TELEPHONY_CALL_ROUTING:"SECOND_TELEPHONY_CALL_ROUTING",ATC_ROUTING:"ATC_ROUTING",VOICEMAIL_CUSTOMGREETING_ENABLED:"VOICEMAIL_CUSTOMGREETING_ENABLED",VOICEMAIL_CUSTOMGREETING_URI:"VOICEMAIL_CUSTOMGREETING_URI",DESKTOP_MESSAGE_NOTIFICATIONS_SETTING:"DESKTOP_MESSAGE_NOTIFICATIONS_SETTING",MOBILE_MESSAGE_NOTIFICATIONS_SETTING:"MOBILE_MESSAGE_NOTIFICATIONS_SETTING",PLAY_SOUND_MESSAGE_NOTIFICATIONS:"PLAY_SOUND_MESSAGE_NOTIFICATIONS",PLAY_SOUND_RTC:"PLAY_SOUND_RTC",PLAY_SYSTEM_SOUNDS:"PLAY_SYSTEM_SOUNDS",ENHANCED_DESKTOP_MESSAGE_NOTIFICATION:"ENHANCED_DESKTOP_MESSAGE_NOTIFICATION",ENHANCED_MOBILE_MESSAGE_NOTIFICATION:"ENHANCED_MOBILE_MESSAGE_NOTIFICATION"},OAuthScope:{ALL:"ALL",CALLS:"CALLS",READ_CONVERSATIONS:"READ_CONVERSATIONS",READ_USER:"READ_USER",READ_USER_PROFILE:"READ_USER_PROFILE",WRITE_CONVERSATIONS:"WRITE_CONVERSATIONS",WRITE_USER_PROFILE:"WRITE_USER_PROFILE"},OAuthGrantTypes:{AUTHORIZATION_CODE:"AUTHORIZATION_CODE",IMPLICIT:"IMPLICIT",CLIENT_CREDENTIALS:"CLIENT_CREDENTIALS",RESOURCE_OWNER_CREDENTIALS:"RESOURCE_OWNER_CREDENTIALS",RESOURCE_OWNER:"RESOURCE_OWNER"},MessageNotificationsSetting:{ALL:0,DIRECT_AND_MENTIONS:1,NONE:2},EnhancedMessageNotificationsSetting:{ALL:-1,NONE:0,DIRECT:1,MENTION:2,FAVORITE:4},AdministrationActionType:{INVITE_USER:"INVITE_USER",ADD_USER:"ADD_USER",INVITE_MULTIPLE_USERS:"INVITE_MULTIPLE_USERS",UPDATE_USER:"UPDATE_USER",DELETE_USER:"DELETE_USER",VALIDATE_USER_INVITATION_TOKEN:"VALIDATE_USER_INVITATION_TOKEN",ACTIVATE_INVITED_USER:"ACTIVATE_INVITED_USER",RESEND_USER_INVITATION:"RESEND_USER_INVITATION",CHECK_INVALID_TENANTS:"CHECK_INVALID_TENANTS",GET_TENANT:"GET_TENANT",GET_SHARED_KEY:"GET_SHARED_KEY",GET_TENANT_SETTINGS:"GET_TENANT_SETTINGS",SET_TENANT_SETTINGS:"SET_TENANT_SETTINGS",FIND_TENANT_SETTING:"FIND_TENANT_SETTING",EXPORT_TENANT:"EXPORT_TENANT",SAVE_TENANT_LOGIN_PROVIDER:"SAVE_TENANT_LOGIN_PROVIDER",UPDATE_TENANT_LOGIN_PROVIDER:"UPDATE_TENANT_LOGIN_PROVIDER",DELETE_TENANT_LOGIN_PROVIDER:"DELETE_TENANT_LOGIN_PROVIDER",GET_ALL_TENANT_LOGIN_PROVIDERS:"GET_ALL_TENANT_LOGIN_PROVIDERS",GET_TENANT_LOGIN_PROVIDER_BY_PROVIDERID_AND_TENANTID:"GET_TENANT_LOGIN_PROVIDER_BY_PROVIDERID_AND_TENANTID",GET_TENANT_LOGIN_PROVIDER_CONFIGURATION_BY_PROVIDERID:"GET_TENANT_LOGIN_PROVIDER_CONFIGURATION_BY_PROVIDERID",SEND_TENANT_LOGIN_PROVIDER_EMAIL_NOTIFICATIONS:"SEND_TENANT_LOGIN_PROVIDER_EMAIL_NOTIFICATIONS",UPDATE_TENANT:"UPDATE_TENANT",UPLOAD_EXTENSION_CONFIGURATION:"UPLOAD_EXTENSION_CONFIGURATION",GET_TENANT_EXTENSIONS:"GET_TENANT_EXTENSIONS",SET_EXTENSION_STATE:"SET_EXTENSION_STATE",DELETE_EXTENSION:"DELETE_EXTENSION",REGENERATE_API_KEY:"REGENERATE_API_KEY",ADD_API_TECHNICAL_USER:"ADD_API_TECHNICAL_USER",GET_CUSTOM_APPS:"GET_CUSTOM_APPS",ADD_CUSTOM_APP:"ADD_CUSTOM_APP",GET_PROVISIONED_TENANT_USERS:"GET_PROVISIONED_TENANT_USERS",CREATE_PROVISIONED_USER:"CREATE_PROVISIONED_USER",REMOVE_PROVISIONED_USER:"REMOVE_PROVISIONED_USER",UPDATE_PROVISIONED_USER:"UPDATE_PROVISIONED_USER",SET_TELEPHONY_STATUS:"SET_TELEPHONY_STATUS",SET_TELEPHONY_TRUNK_DATA:"SET_TELEPHONY_TRUNK_DATA",GET_TELEPHONY_TRUNK_STATUS:"GET_TELEPHONY_TRUNK_STATUS",GET_TENANT_BRIDGE_NUMBERS:"GET_TENANT_BRIDGE_NUMBERS",SET_TENANT_BRIDGE_NUMBERS:"SET_TENANT_BRIDGE_NUMBERS",GET_TECHNICAL_CREDENTIALS:"GET_TECHNICAL_CREDENTIALS",ADD_TRUNK:"ADD_TRUNK",GET_TENANT_TELEPHONY_CONFIGURATION:"GET_TENANT_TELEPHONY_CONFIGURATION",ADD_TRUNK_WITHOUT_PARAMETERS:"ADD_TRUNK_WITHOUT_PARAMETERS",SET_TRUNK_PASSWORD:"SET_TRUNK_PASSWORD",GET_TELEPHONY_ROUTING_RULES:"GET_TELEPHONY_ROUTING_RULES",ADD_TELEPHONY_ROUTING_RULE:"ADD_TELEPHONY_ROUTING_RULE",UPDATE_TELEPHONY_ROUTING_RULE:"UPDATE_TELEPHONY_ROUTING_RULE",REMOVE_TELEPHONY_ROUTING_RULE:"REMOVE_TELEPHONY_ROUTING_RULE",TEST_TELEPHONY_ROUTING_RULES:"TEST_TELEPHONY_ROUTING_RULES",UPDATE_TENANT_TELEPHONY_CONFIGURATION:"UPDATE_TENANT_TELEPHONY_CONFIGURATION",GET_TELEPHONY_TRUNK_GROUPS:"GET_TELEPHONY_TRUNK_GROUPS",GET_TELEPHONY_TRUNK_GROUP:"GET_TELEPHONY_TRUNK_GROUP",ADD_TELEPHONY_TRUNK_GROUP:"ADD_TELEPHONY_TRUNK_GROUP",REMOVE_TELEPHONY_TRUNK_GROUP:"REMOVE_TELEPHONY_TRUNK_GROUP",UPDATE_TELEPHONY_TRUNK_GROUP:"UPDATE_TELEPHONY_TRUNK_GROUP",ADD_TELEPHONY_TRUNK_TO_GROUP:"ADD_TELEPHONY_TRUNK_TO_GROUP",REMOVE_TELEPHONY_TRUNK_FROM_GROUP:"REMOVE_TELEPHONY_TRUNK_FROM_GROUP",GET_CLASSLESS_INTER_DOMAIN_ROUTING_BLOCKS:"GET_CLASSLESS_INTER_DOMAIN_ROUTING_BLOCKS",GET_CLASSLESS_INTER_DOMAIN_ROUTING_BLOCK:"GET_CLASSLESS_INTER_DOMAIN_ROUTING_BLOCK",ADD_CLASSLESS_INTER_DOMAIN_ROUTING_BLOCK:"ADD_CLASSLESS_INTER_DOMAIN_ROUTING_BLOCK",UPDATE_CLASSLESS_INTER_DOMAIN_ROUTING_BLOCK:"UPDATE_CLASSLESS_INTER_DOMAIN_ROUTING_BLOCK",REMOVE_CLASSLESS_INTER_DOMAIN_ROUTING_BLOCK:"REMOVE_CLASSLESS_INTER_DOMAIN_ROUTING_BLOCK",SET_TENANT_VOICEMAIL_NUMBERS:"SET_TENANT_VOICEMAIL_NUMBERS",GET_TENANT_VOICEMAIL_NUMBERS:"GET_TENANT_VOICEMAIL_NUMBERS",UPDATE_TRUNK:"UPDATE_TRUNK",GET_VACANT_HOME_DIRECTORY_NUMBERS:"GET_VACANT_HOME_DIRECTORY_NUMBERS",CREATE_OPENSCAPE_USER:"CREATE_OPENSCAPE_USER",UPDATE_OPENSCAPE_USER:"UPDATE_OPENSCAPE_USER",DELETE_OPENSCAPE_USER:"DELETE_OPENSCAPE_USER",GET_OPENSCAPE_USER:"GET_OPENSCAPE_USER",GET_OPENSCAPE_USER_V2:"GET_OPENSCAPE_USER_V2",GET_OPENSCAPE_TENANT:"GET_OPENSCAPE_TENANT",DELETE_OPENSCAPE_SITES:"DELETE_OPENSCAPE_SITES",CREATE_OPENSCAPE_SITE:"CREATE_OPENSCAPE_SITE",UPDATE_OPENSCAPE_SITE:"UPDATE_OPENSCAPE_SITE",GET_OPENSCAPE_SITE:"GET_OPENSCAPE_SITE",DELETE_PUBLIC_NUMBER_RANGE:"DELETE_PUBLIC_NUMBER_RANGE",DELETE_PRIVATE_NUMBER_RANGE:"DELETE_PRIVATE_NUMBER_RANGE",CREATE_HUNT_GROUP:"CREATE_HUNT_GROUP",DELETE_HUNT_GROUP:"DELETE_HUNT_GROUP",GET_HUNT_GROUP:"GET_HUNT_GROUP",GET_TENANT_HUNT_GROUPS:"GET_TENANT_HUNT_GROUPS",GET_HUNT_GROUP_PILOT_CANDIDATES:"GET_HUNT_GROUP_PILOT_CANDIDATES",GET_HUNT_GROUP_MEMBER_CANDIDATES:"GET_HUNT_GROUP_MEMBER_CANDIDATES",UPDATE_HUNT_GROUP:"UPDATE_HUNT_GROUP",SUSPEND_USER:"SUSPEND_USER",UNSUSPEND_USER:"UNSUSPEND_USER",INVITE_PARTNER_USER:"INVITE_PARTNER_USER",INVITE_MULTIPLE_PARTNER_USERS:"INVITE_MULTIPLE_PARTNER_USERS",ADD_MEETING_POINT:"ADD_MEETING_POINT",ADD_MEETING_POINT_V2:"ADD_MEETING_POINT_V2",UPDATE_MEETING_POINT_V2:"UPDATE_MEETING_POINT_V2",SET_CMR_SETTINGS:"SET_CMR_SETTINGS",GET_CMR_SETTINGS:"GET_CMR_SETTINGS",GET_AUTOMATEDATTENDANT_CONFIGURATION:"GET_AUTOMATEDATTENDANT_CONFIGURATION",SET_AUTOMATEDATTENDANT_CONFIGURATION:"SET_AUTOMATEDATTENDANT_CONFIGURATION",GET_PARTNER_MANAGEABLE_TENANTS:"GET_PARTNER_MANAGEABLE_TENANTS",GET_SYSTEM_NOTIFICATIONS:"GET_SYSTEM_NOTIFICATIONS",ADD_SYSTEM_NOTIFICATION:"ADD_SYSTEM_NOTIFICATION",REMOVE_SYSTEM_NOTIFICATION:"REMOVE_SYSTEM_NOTIFICATION",UPDATE_SYSTEM_NOTIFICATION:"UPDATE_SYSTEM_NOTIFICATION"},InvitationResponseCode:{INVITATION_SEND:"INVITATION_SEND",INVITATION_NOT_SEND:"INVITATION_NOT_SEND",INVALID_USER_STATE:"INVALID_USER_STATE",EMAIL_ALREADY_EXISTS:"EMAIL_ALREADY_EXISTS",ACCOUNT_ASSIGNMENT_FAILED:"ACCOUNT_ASSIGNMENT_FAILED",ERROR:"ERROR",SYSTEM_OVERLOADED:"SYSTEM_OVERLOADED",EMAIL_ALREADY_EXISTS_ON_SAME_TENANT:"EMAIL_ALREADY_EXISTS_ON_SAME_TENANT",UNTRUSTED_PARTNER_TENANT:"UNTRUSTED_PARTNER_TENANT",XMPP_FEDERATED_USER_NOT_FOUND:"XMPP_FEDERATED_USER_NOT_FOUND",LICENSE_LIMIT_EXCEEDED:"LICENSE_LIMIT_EXCEEDED",LICENSE_ERROR:"LICENSE_ERROR"},InvitationStatusCode:{RUNNING:"RUNNING",FINISHED:"FINISHED"},GetUsersOrdering:{ASCENDING:"ASCENDING",DESCENDING:"DESCENDING"},GetUsersSorting:{USER_NAME:"USER_NAME",DATA_USAGE:"DATA_USAGE",LAST_ACCESS:"LAST_ACCESS",ROLE:"ROLE",STATUS:"STATUS",PHONE_NUMBER_ASSIGNED:"PHONE_NUMBER_ASSIGNED",EMAIL:"EMAIL"},GetUsersSearchFor:{ROLE:"ROLE",STATUS:"STATUS",NAME:"NAME",PRIMARY_EMAIL:"PRIMARY_EMAIL"},SetRoleRole:{ADMIN:"ADMIN",USER:"USER"},ExportTenantFormat:{CSV:"CSV",JSON:"JSON"},AdministrationEventType:{INVITE_MULTIPLE_USERS:"INVITE_MULTIPLE_USERS",INVITE_MULTIPLE_PARTNER_USERS:"INVITE_MULTIPLE_PARTNER_USERS"},SystemNotificationType:{MAINTENANCE:"MAINTENANCE",BROADCAST:"BROADCAST"},HuntType:{INIT:"INIT",LINEAR:"LINEAR",CIRCULAR_WITH_HUNT:"CIRCULAR_WITH_HUNT",UCD:"UCD",MANUAL:"MANUAL",PARALLEL:"PARALLEL",PARALLEL_SA:"PARALLEL_SA"},TenantSettingsType:{CREDENTIALS_LOGIN_ENABLED:"CREDENTIALS_LOGIN_ENABLED",HELP_URL:"HELP_URL",PLUGIN_SELF_MANAGED_ENABLED:"PLUGIN_SELF_MANAGED_ENABLED",EXTENSION_MICROSOFT_EXCHANGE_ENABLED:"EXTENSION_MICROSOFT_EXCHANGE_ENABLED",EXTENSION_SYNCPLICITY_ENABLED:"EXTENSION_SYNCPLICITY_ENABLED",EXTENSION_BOX_ENABLED:"EXTENSION_BOX_ENABLED",EXTENSION_GOOGLE_DRIVE_ENABLED:"EXTENSION_GOOGLE_DRIVE_ENABLED",EXTENSION_ONE_DRIVE_ENABLED:"EXTENSION_ONE_DRIVE_ENABLED",EXTENSION_JABRA_ENABLED:"EXTENSION_JABRA_ENABLED",EXTENSION_VDI_ENABLED:"EXTENSION_VDI_ENABLED",EXTENSION_PLANTRONICS_ENABLED:"EXTENSION_PLANTRONICS_ENABLED",EXTENSION_SKYPE_FOR_BUSINESS_ENABLED:"EXTENSION_SKYPE_FOR_BUSINESS_ENABLED",DT_LEGAL_INFORMATION:"DT_LEGAL_INFORMATION",SSO_REDIRECT_URL:"SSO_REDIRECT_URL",PHONE_DIALOUT_CALLER_ID_PREFIX:"PHONE_DIALOUT_CALLER_ID_PREFIX",PHONE_DIALOUT_MODE:"PHONE_DIALOUT_MODE",PHONE_DIALOUT_ENABLED:"PHONE_DIALOUT_ENABLED",SKYPE4B_CLIENT_ID:"SKYPE4B_CLIENT_ID",SKYPE4B_ROOT_URL:"SKYPE4B_ROOT_URL",DA_AUTO_UPDATE:"DA_AUTO_UPDATE",EXTENSION_SENNHEISER_ENABLED:"EXTENSION_SENNHEISER_ENABLED",MUTE_ON_ENTRY:"MUTE_ON_ENTRY",MUTE_ON_ENTRY_CMR:"MUTE_ON_ENTRY_CMR",MUTE_ON_ENTRY_OUTCALL:"MUTE_ON_ENTRY_OUTCALL"},TenantConfigurableTextType:{GUEST_ACCESS_ACCEPTANCE_TEXT:"GUEST_ACCESS_ACCEPTANCE_TEXT",USER_INVITE_ACCEPTANCE_TEXT:"USER_INVITE_ACCEPTANCE_TEXT"},TrunkState:{UP:"UP",DOWN:"DOWN",NOT_REQUESTED:"NOT_REQUESTED",REQUESTED:"REQUESTED"},GtcTrunkType:{GTC_TRUNK_TYPE:"GTC_TRUNK_TYPE",ETC_TRUNK_TYPE:"ETC_TRUNK_TYPE",ATC_TRUNK_TYPE:"ATC_TRUNK_TYPE",EMBEDDED_TC_TRUNK_TYPE:"EMBEDDED_TC_TRUNK_TYPE",OSBIZ_TRUNK_TYPE:"OSBIZ_TRUNK_TYPE"},TelephonyRoutingRuleCriteria:{ORIGIN:"ORIGIN",DESTINATION:"DESTINATION"},TelephonyRoutingRuleOperator:{AND:"AND",OR:"OR"},TelephonyRoutingRuleApplication:{TELEPHONY:"TELEPHONY",CONF_DIAL_OUT:"CONF_DIAL_OUT",BOTH:"BOTH"},TelephonyConfigurationDefaultRouting:{ANY:"ANY",NONE:"NONE"},TelephonyRoutingRuleResult:{NO_MATCH:"NO_MATCH",MATCH:"MATCH",SELECTED:"SELECTED"},ProviderType:{CREDENTIALS:"CREDENTIALS",SAML:"SAML",OPENID:"OPENID"},PhoneDialoutMode:{PHONE_USERS_ONLY:"PHONE_USERS_ONLY",ALL_USERS:"ALL_USERS"},RemoveTrunkGroupResult:{SUCCESS:"SUCCESS",REFERENCES_EXIST:"REFERENCES_EXIST",UNKNOWN_ERROR:"UNKNOWN_ERROR"},CMRSettingKey:{CMR_ADDRESS:"CMR_ADDRESS"},UcaasDeviceStatus:{NO_DEVICE:"NO_DEVICE",NOT_CONFIGURED:"NOT_CONFIGURED",CONFIGURED:"CONFIGURED"},OpenscapeDirectoryNumberUsage:{MLHG_MEMBER:"MLHG_MEMBER",MLHG_PILOT:"MLHG_PILOT",PICKUP_MEMBER:"PICKUP_MEMBER",AA_MEMBER:"AA_MEMBER"},ThirdPartyConnectorsActionType:{GET_SETTINGS:"GET_SETTINGS",SAVE_SETTINGS:"SAVE_SETTINGS",CONNECT:"CONNECT",DISCONNECT:"DISCONNECT",SEND_AUTH_CODE:"SEND_AUTH_CODE",GET_CONNECTION_STATUS:"GET_CONNECTION_STATUS",GET_FOLDER_ITEMS:"GET_FOLDER_ITEMS",SHARE_FOLDER_ITEMS:"SHARE_FOLDER_ITEMS",UNSHARE_FOLDER_ITEMS:"UNSHARE_FOLDER_ITEMS",GET_EDIT_URL:"GET_EDIT_URL",GET_FOLDER_ITEMS_WITH_CURSOR:"GET_FOLDER_ITEMS_WITH_CURSOR",CONNECT_STORAGE:"CONNECT_STORAGE",REFRESH_CONNECTION:"REFRESH_CONNECTION"},ThirdPartyConnectorType:{EXCHANGE_CONNECTOR:"EXCHANGE_CONNECTOR",BOX:"BOX",OPEN_XCHANGE:"OPEN_XCHANGE",GOOGLE_DRIVE:"GOOGLE_DRIVE",SYNCPLICITY:"SYNCPLICITY",ONE_DRIVE:"ONE_DRIVE",CLIENT_THIRDPARTY:"CLIENT_THIRDPARTY"},ThirdPartyEventType:{CONNECTED_TO_THIRDPARTY:"CONNECTED_TO_THIRDPARTY",DISCONNECTED_FROM_THIRDPARTY:"DISCONNECTED_FROM_THIRDPARTY"},ThirdPartyContentType:{SKYPE4B:"SKYPE4B"},Skype4BAuthentication:{BASIC:"BASIC",AZUREAD:"AZUREAD"},GuestActionType:{VALIDATE_SESSION_INVITE_TOKEN:"VALIDATE_SESSION_INVITE_TOKEN",REGISTER_SESSION_GUEST:"REGISTER_SESSION_GUEST",GET_REGIONS:"GET_REGIONS"},SessionInviteInfoResult:{INVALID:"INVALID",VALID_NOSESSION:"VALID_NOSESSION",VALID_SESSION:"VALID_SESSION",VALID_NO_GUEST_ACCESS:"VALID_NO_GUEST_ACCESS"},UserRoutingMessageType:{ATC:"ATC",CMP:"CMP",CONTACT_CARD:"CONTACT_CARD",DESKTOP_APP:"DESKTOP_APP",MOBILE_BREAKOUT:"MOBILE_BREAKOUT",SDK:"SDK"},VersionActionType:{GET_VERSION:"GET_VERSION"},AccountActionType:{GET_PACKAGE_TEMPLATES:"GET_PACKAGE_TEMPLATES",GET_ASSIGNED_PACKAGES:"GET_ASSIGNED_PACKAGES",VALIDATE_ASSIGN_ACCOUNT_TEMPLATE:"VALIDATE_ASSIGN_ACCOUNT_TEMPLATE",ASSIGN_ACCOUNT_TEMPLATE:"ASSIGN_ACCOUNT_TEMPLATE",VALIDATE_MIGRATE_ACCOUNT:"VALIDATE_MIGRATE_ACCOUNT",MIGRATE_ACCOUNT:"MIGRATE_ACCOUNT",MIGRATE_MULTIPLE_USERS:"MIGRATE_MULTIPLE_USERS",GET_ACCOUNTS:"GET_ACCOUNTS",GET_SEARCH_TAGS:"GET_SEARCH_TAGS",SUSPEND_ACCOUNT:"SUSPEND_ACCOUNT",UNSUSPEND_ACCOUNT:"UNSUSPEND_ACCOUNT",ASSIGN_TELEPHONY_CONFIGURATION:"ASSIGN_TELEPHONY_CONFIGURATION",DELETE_TELEPHONY_CONFIGURATION:"DELETE_TELEPHONY_CONFIGURATION",GET_ACCOUNT_BY_ID:"GET_ACCOUNT_BY_ID",GET_ACCOUNT_BY_USER_ID:"GET_ACCOUNT_BY_USER_ID",GET_TECHNICAL_ADMIN_USER_ID:"GET_TECHNICAL_ADMIN_USER_ID",RENEW_ASSOCIATED_TELEPHONY_USER:"RENEW_ASSOCIATED_TELEPHONY_USER",ADD_ACCOUNT_PERMISSION:"ADD_ACCOUNT_PERMISSION",REMOVE_ACCOUNT_PERMISSION:"REMOVE_ACCOUNT_PERMISSION"},UserDataActionType:{GET_USER_DATA:"GET_USER_DATA"},AccountEventType:{MIGRATE_MULTIPLE_USERS:"MIGRATE_MULTIPLE_USERS",TELEPHONY_CONFIGURATION_UPDATED:"TELEPHONY_CONFIGURATION_UPDATED"},AccountTemplateName:{USER:"USER",ADMIN:"ADMIN",MEETING_POINT:"MEETING_POINT",XMPP_FEDERATED_USER:"XMPP_FEDERATED_USER"},AccountStatus:{NONE:"NONE",CREATED:"CREATED",INITIAL:"INITIAL",INVITED:"INVITED",ACTIVE:"ACTIVE",SUSPENDED:"SUSPENDED",DELETED:"DELETED"},GetAccountsOrdering:{ASCENDING:"ASCENDING",DESCENDING:"DESCENDING"},GetAccountsSorting:{BY_FIRST_NAME:"BY_FIRST_NAME",BY_LAST_NAME:"BY_LAST_NAME",BY_NAME:"BY_NAME",BY_PRIMARY_EMAIL:"BY_PRIMARY_EMAIL",BY_PHONE_NUMBER:"BY_PHONE_NUMBER",BY_LAST_LOGIN:"BY_LAST_LOGIN",BY_LOCATION:"BY_LOCATION"},GetAccountsFilterCriteria:{PRIMARY_EMAIL:"PRIMARY_EMAIL",FIRST_NAME:"FIRST_NAME",LAST_NAME:"LAST_NAME",DISPLAY_NAME:"DISPLAY_NAME",STATUS:"STATUS",TAG:"TAG"},SystemPermission:{IGNORE:"IGNORE",CLIENT_LOGON:"CLIENT_LOGON",INVITE_USER:"INVITE_USER",ROLE_TELEPHONY_CONNECTOR:"ROLE_TELEPHONY_CONNECTOR",ROLE_VIRTUAL_TELEPHONY_CONNECTOR:"ROLE_VIRTUAL_TELEPHONY_CONNECTOR",ROLE_TECHNICAL:"ROLE_TECHNICAL",ROLE_SESSION_GUEST:"ROLE_SESSION_GUEST",ROLE_USER:"ROLE_USER",ROLE_TENANT_ADMIN:"ROLE_TENANT_ADMIN",ROLE_SUPPORT:"ROLE_SUPPORT",ROLE_SYSTEM_ADMIN:"ROLE_SYSTEM_ADMIN",MANAGE_TENANT:"MANAGE_TENANT",TELEPHONY:"TELEPHONY",RECORDING:"RECORDING",MODERATION:"MODERATION",GUEST_ACCESS:"GUEST_ACCESS",MAX_PACKAGE_ACCOUNTS:"MAX_PACKAGE_ACCOUNTS",FREE_TRIAL:"FREE_TRIAL",USER_STORAGE:"USER_STORAGE",INTEGRATIONS:"INTEGRATIONS",RTC_PARTICIPANTS:"RTC_PARTICIPANTS",ACCOUNTS:"ACCOUNTS",IE_PLUGIN_SUPPORT:"IE_PLUGIN_SUPPORT",SUPPORT_CONVERSATION:"SUPPORT_CONVERSATION",SUPPORT_FORUM:"SUPPORT_FORUM",OUTLOOK_PLUGIN:"OUTLOOK_PLUGIN",TENANT_STORAGE:"TENANT_STORAGE",PSTN_DIAL_IN:"PSTN_DIAL_IN",LDAP_AGENT:"LDAP_AGENT",INVITE_PARTNER:"INVITE_PARTNER",LARGE_CONFERENCE:"LARGE_CONFERENCE",CREATE_COMMUNITY:"CREATE_COMMUNITY",CONTENT_MODERATOR:"CONTENT_MODERATOR",ANALYTICS:"ANALYTICS",VIEW_OPEN_CONVERSATION:"VIEW_OPEN_CONVERSATION",SSO:"SSO",IE_PLUGIN_SUPPORT_LIMITATION:"IE_PLUGIN_SUPPORT_LIMITATION",ROLE_MEETING_POINT:"ROLE_MEETING_POINT",MOBILE_BREAKOUT:"MOBILE_BREAKOUT",UCAAS:"UCAAS",PARTNER_ADMIN:"PARTNER_ADMIN",DEVELOPER_CONSOLE_ACCESS:"DEVELOPER_CONSOLE_ACCESS",S4B_INTEGRATION:"S4B_INTEGRATION"},PermissionType:{TENANT_QUOTA:"TENANT_QUOTA",USER_QUOTA:"USER_QUOTA",FEATURE:"FEATURE",OVERALL_PACKAGE_QUOTA:"OVERALL_PACKAGE_QUOTA",OVERALL_PACKAGE_FEATURE:"OVERALL_PACKAGE_FEATURE",RESTRICTION:"RESTRICTION"},MigrateMultipleStatusCode:{RUNNING:"RUNNING",FINISHED:"FINISHED"},MigrateResponseCode:{NULL_PARAMETER:"NULL_PARAMETER",ACCOUNT_DOES_NOT_EXIST:"ACCOUNT_DOES_NOT_EXIST",TECHNICAL_ACCOUNT_NOT_ALLOWED:"TECHNICAL_ACCOUNT_NOT_ALLOWED",ACCOUNT_TEMPLATE_DOES_NOT_EXIST:"ACCOUNT_TEMPLATE_DOES_NOT_EXIST",ILLEGAL_ACCOUNT_TEMPLATE_ASSIGNMENT:"ILLEGAL_ACCOUNT_TEMPLATE_ASSIGNMENT",MAXIMUM_ACCOUNTS_REACHED:"MAXIMUM_ACCOUNTS_REACHED",ERROR:"ERROR",OK:"OK"},ActivityStreamActionType:{CREATE_MENTION:"CREATE_MENTION",GET_MENTIONS_BY_USER:"GET_MENTIONS_BY_USER",GET_ACTIVITIES_BY_USER:"GET_ACTIVITIES_BY_USER",UPDATE_ACTIVITY_READ:"UPDATE_ACTIVITY_READ",MARK_ALL_READ:"MARK_ALL_READ"},ActivityStreamEventType:{ACTIVITY_CREATED:"ACTIVITY_CREATED",ACTIVITY_MARKED_READ:"ACTIVITY_MARKED_READ",ACTIVITY_MARKED_UNREAD:"ACTIVITY_MARKED_UNREAD",ACTIVITY_DELETED:"ACTIVITY_DELETED",ACTIVITY_MARK_ALL_READ:"ACTIVITY_MARK_ALL_READ"},ConversationUserDataEventType:{LABELS_ADDED:"LABELS_ADDED",LABELS_REMOVED:"LABELS_REMOVED",LABEL_EDITED:"LABEL_EDITED",FILTERS_REMOVED:"FILTERS_REMOVED",FILTER_ADDED:"FILTER_ADDED",FILTER_EDITED:"FILTER_EDITED"},VotingType:{ACCEPT_DECLINE:"ACCEPT_DECLINE",APPROVE_REJECT:"APPROVE_REJECT",YES_NO:"YES_NO",YES_NO_MAYBE:"YES_NO_MAYBE",A_B:"A_B",ONE_TWO_THREE_FOUR:"ONE_TWO_THREE_FOUR"},LabFeatureName:{ADD_CMR_VIA_QR_CODE:"ADD_CMR_VIA_QR_CODE",ANSWER_CALL_SCREEN:"ANSWER_CALL_SCREEN",AUTHENTICATION_SETTINGS:"AUTHENTICATION_SETTINGS",BROADCAST_MESSAGES:"BROADCAST_MESSAGES",CIRCUIT_GUEST:"CIRCUIT_GUEST",COLOR_CONTRAST:"COLOR_CONTRAST",DEVELOPER_CONSOLE:"DEVELOPER_CONSOLE",EXPORT_USER_DATA:"EXPORT_USER_DATA",FILTER_BY_LABEL:"FILTER_BY_LABEL",GLOBAL_FUNCTIONS_REDESIGN:"GLOBAL_FUNCTIONS_REDESIGN",GROUP_PICKUP:"GROUP_PICKUP",INCOMING_CALL_ROUTING:"INCOMING_CALL_ROUTING",IP_HANDLING_POLICY:"IP_HANDLING_POLICY",KEYBOARD_NAVIGATION:"KEYBOARD_NAVIGATION",LANDSCAPE_MODE:"LANDSCAPE_MODE",LEAK_CANARY:"LEAK_CANARY",MEETING_CANVAS:"MEETING_CANVAS",OPEN_XCHANGE:"OPEN_XCHANGE",ORGANISE_CONTENT:"ORGANISE_CONTENT",PARTICIPANT_DRAWING:"PARTICIPANT_DRAWING",SCOPE_SEARCHES:"SCOPE_SEARCHES",SCREEN_CONTROL:"SCREEN_CONTROL",SECOND_LOCAL_CALL:"SECOND_LOCAL_CALL",SIRI_SEARCH:"SIRI_SEARCH",THREADABLE_RTC_ITEM:"THREADABLE_RTC_ITEM",UCAAS_HUNT_GROUPS:"UCAAS_HUNT_GROUPS",VIDEO_PLAYER:"VIDEO_PLAYER",VOICEMAIL_CONFIG:"VOICEMAIL_CONFIG",VOTING:"VOTING",WHITEBOARD:"WHITEBOARD"},DraftType:{PRIVATE:"PRIVATE",OPEN:"OPEN",BRIDGE:"BRIDGE",LARGE:"LARGE"},AvatarBadgeType:{COMMUNITY:"COMMUNITY",EVENT:"EVENT",SKYPE:"SKYPE"},AudioVideoDeviceCategories:{AUDIO_OUTPUT:"AUDIO_OUTPUT",RINGING_OUTPUT:"RINGING_OUTPUT",AUDIO_INPUT:"AUDIO_INPUT",VIDEO_INPUT:"VIDEO_INPUT"},AtcCapabilities:{EXTENDED_ALERTING:"EXTENDED_ALERTING",CLEAR_CONNECTION_BUSY:"CLEAR_CONNECTION_BUSY",PBX_CALL_LOG:"PBX_CALL_LOG"}}),t=(i="||::$$privateData=%%1::||",o=/^\|\|::\$\$privateData=({.*})::\|\|/,{SUPPORTED_PRIVATE_DATA_FIELDS:r=["voting"],convertPrivateDataToContent:function(t){if(!t)return"";var n={};if(r.forEach(function(e){void 0!==t[e]&&null!==t[e]&&(n[e]=t[e])}),s.isEmptyObject(n))return"";var e=JSON.stringify(n);return e=s.textToHtmlEscaped(e),i.replace("%%1",e)},retrievePrivateDataFromContent:function(t){if(t&&t.text)try{if(r.forEach(function(e){void 0===t[e]&&(t[e]=null)}),!t.text.content)return;var e=o.exec(t.text.content);if(e&&e[0]){t.text.content=t.text.content.slice(e[0].length);var n=e[1];if(n){n=s.escapedHtmlToText(n);var i=JSON.parse(n);r.forEach(function(e){void 0!==i[e]&&(t[e]=i[e])})}}}catch(e){a.error("[Proto]: Failed to retrieve private data. ",e)}}}),l={requestNr:0,Request:function(e,t,n){var i={msgType:c.WSMessageType.REQUEST,request:{requestId:++l.requestNr,type:e}};switch(n&&(i.request.tenantContext=n),e){case c.ContentType.CONVERSATION:i.request.conversation=t;break;case c.ContentType.USER:i.request.user=t;break;case c.ContentType.RTC_CALL:i.request.rtcCall=t;break;case c.ContentType.RTC_SESSION:i.request.rtcSession=t;break;case c.ContentType.SEARCH:i.request.search=t;break;case c.ContentType.INSTRUMENTATION:i.request.instrumentation=t;break;case c.ContentType.ADMINISTRATION:i.request.administration=t;break;case c.ContentType.SYSTEM:i.request.system=t;break;case c.ContentType.THIRDPARTYCONNECTORS:i.request.thirdpartyconnectors=t;break;case c.ContentType.GUEST:i.request.guest=t;break;case c.ContentType.USER_TO_USER:i.request.userToUser=t;break;case c.ContentType.VERSION:i.request.version=t;break;case c.ContentType.ACCOUNT:i.request.account=t;break;case c.ContentType.ACTIVITYSTREAM:i.request.activityStream=t;break;case c.ContentType.USER_DATA:i.request.userData=t}return i},ParseEvent:function(e){var t,n={};switch(e.type){case c.ContentType.CONVERSATION:switch(t="Conversation."+e.conversation.type,e.conversation.type){case c.ConversationEventType.CREATE:n=e.conversation.create;break;case c.ConversationEventType.UPDATE:n=e.conversation.update;break;case c.ConversationEventType.ADD_ITEM:n=e.conversation.addItem;break;case c.ConversationEventType.ADD_PARTICIPANT:n=e.conversation.addParticipant;break;case c.ConversationEventType.UPDATE_ITEM:n=e.conversation.updateItem;break;case c.ConversationEventType.READ_ITEMS:n=e.conversation.readItems;break;case c.ConversationEventType.TYPING:n=e.conversation.typing;break;case c.ConversationEventType.DRAFT_MESSAGE_SAVED:case c.ConversationEventType.DRAFT_MESSAGE_DISCARDED:case c.ConversationEventType.DRAFT_MESSAGE_PUBLISHED:n=e.conversation.draftMessage;break;case c.ConversationEventType.FLAG_ITEM:n=e.conversation.setFlagItem;break;case c.ConversationEventType.CLEAR_FLAGGED_ITEM:n=e.conversation.clearFlaggedItem;break;case c.ConversationEventType.CONVERSATION_MARKED:n=e.conversation.conversationMarked;break;case c.ConversationEventType.CONVERSATION_UNMARKED:n=e.conversation.conversationUnmarked;break;case c.ConversationEventType.FAVORITE_POSITION_CHANGED:n=e.conversation.favoritePositionChangedEvent;break;case c.ConversationEventType.USER_DATA_CHANGED:n=e.conversation.userDataChangedEvent}n.convId=e.conversation.convId;break;case c.ContentType.USER:switch(t="User."+e.user.type,e.user.type){case c.UserEventType.USER_PRESENCE_CHANGE:n=e.user.presenceChanged;break;case c.UserEventType.USER_UPDATED:n=e.user.userUpdated;break;case c.UserEventType.SESSION_CLOSED:n=e.user.sessionClosed;break;case c.UserEventType.PASSWORD_CHANGED:n=e.user.passwordChanged;break;case c.UserEventType.USER_SETTING_UPDATED:n=e.user.userSettingUpdated;break;case c.UserEventType.TELEPHONY_DATA:n=e.user.telephonyData;break;case c.UserEventType.DEVICE_LIST_CHANGED:n=e.user.deviceListChangedEvent;break;case c.UserEventType.NOTIFICATION_SUBSCRIPTION_CHANGE:n=e.user.notificationSubscriptionChange;break;case c.UserEventType.TENANT_CONFIGURATION_UPDATED:n=e.user.tenantConfigurationUpdatedEvent;break;case c.UserEventType.UCAAS_DEVICE_UPDATED:break;case c.UserEventType.TENANT_PRESENCE_CHANGE:n=e.user.tenantPresenceChanged}n.userId=e.user.userId;break;case c.ContentType.RTC_CALL:switch(t="RTCCall."+e.rtcCall.type,e.rtcCall.type){case c.RTCCallEventType.SDP_ANSWER:n=e.rtcCall.sdpAnswer;break;case c.RTCCallEventType.SDP_FAILED:n=e.rtcCall.sdpFailed;break;case c.RTCCallEventType.INVITE:n=e.rtcCall.invite;break;case c.RTCCallEventType.INVITE_CANCEL:n=e.rtcCall.inviteCancel;break;case c.RTCCallEventType.INVITE_FAILED:n=e.rtcCall.inviteFailed;break;case c.RTCCallEventType.CHANGE_MEDIA_TYPE_REQUESTED:n=e.rtcCall.changeMediaRequested;break;case c.RTCCallEventType.PROGRESS:n=e.rtcCall.participantProgress;break;case c.RTCCallEventType.CHANGE_MEDIA_TYPE_FORCED:n=e.rtcCall.changeMediaTypeForcedEvent;break;case c.RTCCallEventType.ICE_CANDIDATES:n=e.rtcCall.iceCandidates;break;case c.RTCCallEventType.RTC_QUALITY_RATING_EVENT:n=e.rtcCall.ratingEvent;break;case c.RTCCallEventType.IFRAME_STATISTICS:n=e.rtcCall.iFrameStatisticsEvent}n.sessionId=e.rtcCall.sessionId,n.instanceId=e.rtcCall.instanceId;break;case c.ContentType.RTC_SESSION:switch(t="RTCSession."+e.rtcSession.type,e.rtcSession.type){case c.RTCSessionEventType.SESSION_STARTED:n=e.rtcSession.sessionStarted;break;case c.RTCSessionEventType.SESSION_TERMINATED:n=e.rtcSession.sessionTerminated;break;case c.RTCSessionEventType.SESSION_UPDATED:void 0!==(n=e.rtcSession.sessionUpdated).session.whiteBoardEnabled&&(n.session.whiteboardEnabled=n.session.whiteBoardEnabled,delete n.session.whiteBoardEnabled);break;case c.RTCSessionEventType.SESSION_MOVED:n=e.rtcSession.sessionMoved;break;case c.RTCSessionEventType.PARTICIPANT_JOINED:n=e.rtcSession.participantJoined;break;case c.RTCSessionEventType.PARTICIPANT_LEFT:n=e.rtcSession.participantLeft;break;case c.RTCSessionEventType.PARTICIPANT_UPDATED:n=e.rtcSession.participantUpdated;break;case c.RTCSessionEventType.ACTIVE_SPEAKER:n=e.rtcSession.speaker;break;case c.RTCSessionEventType.VIDEO_ACTIVE_SPEAKER:n=e.rtcSession.videoSpeaker;break;case c.RTCSessionEventType.SESSION_RECORDING_INFO:n=e.rtcSession.sessionRecordingInfo;break;case c.RTCSessionEventType.SESSION_RECORDING_STARTED:n=e.rtcSession.sessionRecordingStarted;break;case c.RTCSessionEventType.SESSION_RECORDING_STOPPED:n=e.rtcSession.sessionRecordingStopped;break;case c.RTCSessionEventType.SESSION_RECORDING_FAILED:n=e.rtcSession.sessionRecordingFailed;break;case c.RTCSessionEventType.SESSION_TERMINATION_TIMER_STARTED:n=e.rtcSession.sessionTerminationTimerStarted;break;case c.RTCSessionEventType.SESSION_TERMINATION_TIMER_CANCELLED:n=e.rtcSession.sessionTerminationTimerCancelled;break;case c.RTCSessionEventType.SESSION_ATTRIBUTES_CHANGED_EVENT:n=e.rtcSession.sessionAttributesChangedEvent;break;case c.RTCSessionEventType.QUESTION_EVENT:n=e.rtcSession.questionEvent;break;case c.RTCSessionEventType.INVITE_TO_STAGE_EVENT:n=e.rtcSession.inviteToStageEvent;break;case c.RTCSessionEventType.INVITE_TO_STAGE_CANCEL_EVENT:n=e.rtcSession.inviteToStageCancelEvent;break;case c.RTCSessionEventType.CURTAIN_EVENT:n=e.rtcSession.curtainEvent;break;case c.RTCSessionEventType.WHITEBOARD_ENABLED:n=e.rtcSession.whiteboardEnabled;break;case c.RTCSessionEventType.WHITEBOARD_ELEMENT_ADDED:n=e.rtcSession.whiteboardElementAdded;break;case c.RTCSessionEventType.WHITEBOARD_ELEMENT_REMOVED:n=e.rtcSession.whiteboardElementRemoved;break;case c.RTCSessionEventType.WHITEBOARD_ELEMENT_UPDATED:n=e.rtcSession.whiteboardElementUpdated;break;case c.RTCSessionEventType.WHITEBOARD_CLEARED:n=e.rtcSession.whiteboardCleared;break;case c.RTCSessionEventType.WHITEBOARD_BACKGROUND_SET:n=e.rtcSession.whiteboardBackgroundSet;break;case c.RTCSessionEventType.WHITEBOARD_SYNC:n=e.rtcSession.whiteboardSync;break;case c.RTCSessionEventType.WHITEBOARD_DISABLED:case c.RTCSessionEventType.WHITEBOARD_BACKGROUND_CLEARED:case c.RTCSessionEventType.WHITEBOARD_OVERLAY_TOGGLED:break;case c.RTCSessionEventType.SCREEN_CONTROL_REQUESTED:n=e.rtcSession.screenControlRequested;break;case c.RTCSessionEventType.SCREEN_CONTROL_OFFERED:n=e.rtcSession.screenControlOffered;break;case c.RTCSessionEventType.SCREEN_CONTROL_ACCEPTED:n=e.rtcSession.screenControlAccepted;break;case c.RTCSessionEventType.HANDOVER_SCREEN_CONTROL:n=e.rtcSession.handoverScreenControl;break;case c.RTCSessionEventType.SCREEN_CONTROL_REQUEST_REJECTED:case c.RTCSessionEventType.SCREEN_CONTROL_REJECTED:case c.RTCSessionEventType.SCREEN_CONTROL_TERMINATED:case c.RTCSessionEventType.SCREEN_CONTROL_FAILED:}n.sessionId=e.rtcSession.sessionId;break;case c.ContentType.SEARCH:switch(t="Search."+e.search.type,e.search.type){case c.SearchEventType.BASIC_SEARCH_RESULT:n=e.search.basicSearchResult;break;case c.SearchEventType.DETAILED_SEARCH_RESULT:n=e.search.detailSearchResult;break;case c.SearchEventType.SEARCH_STATUS:n=e.search.searchStatus;break;case c.SearchEventType.RECENT_SEARCH_ADDED:n=e.search.recentSearchAdded}n.searchId=e.search.searchId;break;case c.ContentType.SYSTEM:switch(t="System."+e.system.type,e.system.type){case c.SystemEventType.BROADCAST:(n=e.system.systemNotificationEvent).eventId=e.system.eventId;break;case c.SystemEventType.MAINTENANCE:case c.SystemEventType.MAINTENANCE_ADDED:(n=e.system.maintenance).eventId=e.system.eventId;break;case c.SystemEventType.BROADCAST_REMOVED:case c.SystemEventType.MAINTENANCE_REMOVED:n=e.system.eventId}break;case c.ContentType.ADMINISTRATION:switch(t="Administration."+e.administration.type,e.administration.type){case c.AdministrationEventType.INVITE_MULTIPLE_USERS:n=e.administration.inviteMultipleUsers;break;case c.AdministrationEventType.INVITE_MULTIPLE_PARTNER_USERS:n=e.administration.inviteMultiplePartnerUsers}break;case c.ContentType.THIRDPARTYCONNECTORS:switch(t="ThirdParty."+e.thirdParty.type,e.thirdParty.type){case c.ThirdPartyEventType.CONNECTED_TO_THIRDPARTY:n=e.thirdParty;break;case c.ThirdPartyEventType.DISCONNECTED_FROM_THIRDPARTY:n=e.thirdParty.provider}break;case c.ContentType.USER_TO_USER:t="UserToUser."+e.userToUser.userToUser.type,(n=e.userToUser.userToUser).routing=e.userToUser.routing;break;case c.ContentType.ACTIVITYSTREAM:switch(t="ActivityStream."+e.activity.type,e.activity.type){case c.ActivityStreamEventType.ACTIVITY_CREATED:n=e.activity.create.item;break;case c.ActivityStreamEventType.ACTIVITY_DELETED:n=e.activity.delete.item;break;case c.ActivityStreamEventType.ACTIVITY_MARKED_READ:n=e.activity.markRead.itemId;break;case c.ActivityStreamEventType.ACTIVITY_MARKED_UNREAD:n=e.activity.markUnread.itemId;break;case c.ActivityStreamEventType.ACTIVITY_MARK_ALL_READ:n=e.activity.markAllRead.status}break;case c.ContentType.ACCOUNT:switch(t="Account."+e.account.type,e.account.type){case c.AccountEventType.MIGRATE_MULTIPLE_USERS:n=e.account.migrateMultipleUsers;break;case c.AccountEventType.TELEPHONY_CONFIGURATION_UPDATED:n=e.account.telephonyConfigurationUpdated}break;case c.ContentType.CONVERSATION_USER_DATA:switch(t="ConversationUserData."+e.conversationUserData.type,e.conversationUserData.type){case c.ConversationUserDataEventType.LABELS_ADDED:n=e.conversationUserData.labelsAdded;break;case c.ConversationUserDataEventType.LABELS_REMOVED:n=e.conversationUserData.labelsRemoved;break;case c.ConversationUserDataEventType.LABEL_EDITED:n=e.conversationUserData.labelEdited;break;case c.ConversationUserDataEventType.FILTERS_REMOVED:n=e.conversationUserData.filtersRemoved;break;case c.ConversationUserDataEventType.FILTER_ADDED:n=e.conversationUserData.filterAdded;break;case c.ConversationUserDataEventType.FILTER_EDITED:n=e.conversationUserData.filterEdited}break;default:return null}return{name:t,data:n}},getMediaType:function(e){if(!e)return{audio:!1,video:!1,desktop:!1};var t={audio:!1,video:!1,desktop:!1};return e.forEach(function(e){switch(e){case c.RealtimeMediaType.AUDIO:t.audio=!0;break;case c.RealtimeMediaType.VIDEO:t.video=!0;break;case c.RealtimeMediaType.DESKTOP_SHARING:t.desktop=!0}}),t},isOfflineFailure:function(e){return e===c.ReturnCode.DISCONNECTED||e===c.ReturnCode.FAILED_TO_SEND||e===c.ReturnCode.REQUEST_TIMEOUT}};return e.Constants=c,e.PrivateData=t,e.Proto=l,e}(Circuit=function(e){"use strict";var r=e.Utils||{};r.EMOTICON_MAPPING={":)":128515,":D":128516,":(":128542,":heart":128525,";)":128521,":awesome":128516,":angry":128544,":zzz":128554,":O":128562,";(":128546};var t=/<(img[^>|<]*(?:shortcut|abbr)="(\S*)"[^\/?>]*\/?)>/gi;function n(e,t,n){var i=r.EMOTICON_MAPPING[n];return i?String.fromCodePoint(i):""}return r.standardizeEmoticon=function(e){return e?e.replace(t,n):""},r.removeMentionHtml=function(e){var i=0;return e.replace(/(<span.*?>)|(<\/span>)/gi,function(e,t,n){return t?t.match(/class="mention"/i)?"":(i++,t):n?i?(i--,n):"":void 0})},e}((Circuit=function(l){"use strict";l.__server="",l.__domain="",l.isElectron=!(l.isSDK||"undefined"==typeof process||!process.versions||!process.versions.electron);var t,c=l.logger,d=l.Emoticons,u=l.Emoji;l.isElectron&&(t=require("electron").remote,l.__server=t.getCurrentWindow()._domain),"undefined"!=typeof Skype&&(l.SkypeSDK=Skype,Skype=null);var C="https://",E="circuit://",T=/<(img[^>|<]*(?:shortcut|abbr)="(\S*)"[^\/?>]*\/?)>/gi,p=l.Utils||{};var n=["items","parents","peerUsers","previousMembers"];p.trimCallForMobile=function(e){var t;return e&&(t=p.flattenObj(e)),t},p.trimConvForMobile=function(e){var t;return e&&(t=p.flattenObj(e),n.forEach(function(e){delete t[e]}),t.call=p.trimCallForMobile(e.call)),t},p.isPromise=function(e){return!(!e||"function"!=typeof e.then)},p.convertVersionToNumber=function(e){if("string"!=typeof e)return 0;var t=e.split("."),n=parseInt(t[0],10)||0,i=parseInt(t[1],10)||0;i=Math.min(i,99);var r=parseInt(t[2],10)||0;return(r=Math.min(r,9999))+1e4*i+1e6*n},p.trimTextWithEmoticonsBeforeMatch=function(e,t,n){for(var i=e.indexOf(t),r=e.slice(i),o=e.slice(0,i),a=String.fromCharCode(17),s=String.fromCharCode(18),c=o.replace(T,function(e,t){return a+t+s}),l=!0,d=c.length-1,u=c.length-1,C=u;o.length-1-d<=n&&0<=u;)18===c.charCodeAt(u)?(c=c.replaceAt(u,">"),l=!1):17===c.charCodeAt(u)&&(c=c.replaceAt(u,"<"),l=!0),C=u,u--,l&&d--;return(o=0<C?"..."+c.slice(C):c)+r},p.enhanceEncodeURI=function(e){var t={"!":"%21","(":"%28",")":"%29","#":"%23","{":"%7B","}":"%7D"};return encodeURIComponent(e).replace(/[!\(\)#\{\}]/gi,function(e){return t[e]})},p.normalizeDn=function(e){return e?e.replace("+",""):""},p.cleanPhoneNumber=function(e){return e?e.replace(/[^\*\#\d\+]/g,""):""},p.cleanPhoneNumberDigitsWithPin=function(e){return e?e.replace(/[^\*\#\d\+\,]/g,""):""},p.isMSDoc=function(e){return 0<=e.search(/<\S*?WordDocument>/i)||0<=e.search(/<[^>]*?style=[^>]*?mso-[^<]+?>/i)||0<=e.search(/<meta[^>]*?Microsoft/i)},p.isXCodeDoc=function(e){return 0<=e.search(/<[^>]*?content=[^>]*?Cocoa[^<]+?>/)},p.sanitizer=null,p.sanitize=function(t){if(!t||!p.sanitizer)return t||"";try{t=(t=(t=(t=t.replace(/style="background-color: rgb\(212, 239, 181\);"/gi,'class="rich-text-highlight"')).replace(/<[^>]+background-color: rgb\(212, 239, 181\);.*?>/gi,function(e){return 0<e.indexOf("class=")?e.replace(/class=".*?"/gi,function(e){return 0<e.indexOf("rich-text-highlight")?e:e.replace(/[^=]\s*(.*)/gi,function(e){return e.slice(0,-1)+" rich-text-highlight"})}):e.replace(">",function(e){return' class="rich-text-highlight" '+e})})).replace(/<img(?![^>]*class="(emoticon-icon|emojione-icon))[^>]*>/gi,"")).replace(/<title[^>]*>([\s\S]*?)<\/title>/gi,""),t=(t=(t=(t=(t=d.normalizeEmoticonHtml(t)).replace(/<font[^>]*>|<\/font>/gi,"")).replace(/(<\s*hr\s*><\s*\/hr\s*>|<\s*hr\s*>)/gi,"<hr/>")).replace(/(\r|\n)+(?=[^<]*?>)/gi," ")).replace(/\r\n|\r|\n/g,"<br>"),"function"==typeof p.sanitizer&&(t=p.sanitizer(t));var e=t.split(/<\/?div.*?>|<\/?p.*?>/g).filter(function(e){return!!e}),n=e.length,i="";if(1<n)for(var r,o,a=new RegExp("<br>(?![\\s\\S]*<br>)(?=(<[^/][^>]*></[^>]*>)*$|(</[^>]*>)*$|$)","i"),s=0;s<n;s++)r=e[s].replace(/((<span( class="[\S]*")*>)|(<b( class="[\S]*")*>)|(<i( class="[\S]*")*>))*(<br>|<br\/>)(<\/span>|<\/b>|<\/i>)*/g,"<br>"),!o||o.endsWith("</ul>")||o.endsWith("</ol>")||a.test(o)||(i+="<br>"),i+=r,o=r;else i=e[0];t=i}catch(e){return c.error("[Utils]: Error sanitizing content. ",e),c.error("[Utils]: Unexpected content: ",t),""}return t||""},p.sanitizeSymbols=function(e){return p.isMobile()&&"undefined"!=typeof he?e&&he.encode(e,{allowUnsafeSymbols:!0,decimal:!0}):e},p.convertSymbolCodes=function(e){return p.isMobile()?e&&e.replace(u.HTML_ENTITY_REGEX,function(e){return function(e){var t=e.replace(/[&#;]/g,"");if(!/^[0-9]+$/.test(t)||55296<=t&&t<=57343||1114111<t)return e;var n="";return 65535<t&&(t-=65536,n+=String.fromCharCode(t>>>10&1023|55296),t=56320|1023&t),n+=String.fromCharCode(t)}(e)}):e},p.toPlainText=function(e,t){if(e&&(!t||"RICH"===t)){e=e.replace(d.HTML_REGEX,function(e,t){return d.isEmoticonContent(e)?t:e});var n=document.createElement("div");return n.innerHTML=e.replace(/<(br[\/]?|\/li|hr[\/]?)>/gi,"&nbsp;"),n.textContent}return e},p.toPlainTextWithEmoticonHtml=function(e,t){if(e&&(!t||"RICH"===t)){var n=String.fromCharCode(17),i=String.fromCharCode(18);e=e.replace(d.HTML_REGEX,function(e,t){return d.isEmoticonContent(e)?n+t+i:e}),e=u.convertEmojis(e);var r=String.fromCharCode(19),o=String.fromCharCode(20);e=e.replace(u.HTML_REGEX,function(e,t){return u.isEmojiContent(e)?r+t+o:e});var a=document.createElement("div");a.innerHTML=e.replace(/<(br[\/]?|\/li|hr[\/]?)>/gi,"&nbsp;");var s=p.textToHtmlEscaped(a.textContent,!0);return(s=s.replace(/\x11([^\x11\x12]*)\x12/gim,function(e,t){return d.getHtmlFromShortcut(t,!1,!0,!0)})).replace(/\x13([^\x13\x14]*)\x14/gim,function(e,t){return u.convertEmojis(t.replace(/&amp;/g,"&"))})}return e},p.truncateFileName=function(e){return!e||e.length<=22?e:e.substring(0,10)+" ..."+e.substring(e.length-8,e.length)},p.convertItemText=function(e,t,n){return e?n?p.toPlainTextWithEmoticonHtml(e,t):p.toPlainText(e,t):""},p.createMentionedUsersArray=function(e,n){for(var t=[],i=/<span.*?class=["']mention["'].*?>/g,r=/abbr=["'](.*?)["']/,o=i.exec(e);null!==o;){var a=r.exec(o[0]);a=a&&a[1],-1===t.indexOf(a)&&t.push(a),o=i.exec(e)}return n&&(t=t.filter(function(t){return n.some(function(e){return e.userId===t})})),t},p.DEFAULT_HELP_URL="https://www.circuit.com/support",p.SEPARATORS_PATTERN="!-/:-@[-^{-~\\s",p.NUMERIC_PATTERN="^[0-9]*$",p.NUMERIC_SIGN_PATTERN="^[*+]?[0-9]*$",p.ALPHANUMERIC_PATTERN="^[a-zA-Z0-9_]*$",p.URL_SEPARATORS_PATTERN=/(?=[.,;!?]?\s+|[.,;!?]$)/,p.URL_PATTERN=/(http|ftp|https|circuit):\/\/[\w-]+?((\.|:)[\w-]+?)+?([\w.,@?'^=$%&amp;:\/~+#!\(\)\{\}\[\]-]*[\w@?'^=$%&amp;\/~+#!\(\)\{\}-])?/gim,p.EXACT_URL_PATTERN=new RegExp("^"+p.URL_PATTERN.source+"$","i"),p.PSEUDO_URL_PATTERN=/www\.+[\w-]+?(\.[\w-]+?)+?([\w.,@?\'^=$%&amp;:\/~+#!\(\)\{\}\[\]-]*[\w@?\'^=$%&amp;\/~+#!\(\)\{\}-])?/gim,p.TABBABLE_ELEMENTS_PATTERN="a[href], area[href], input:not([disabled]):not([tabindex='-1']), button:not([disabled]):not([tabindex='-1']),select:not([disabled]):not([tabindex='-1']), textarea:not([disabled]):not([tabindex='-1']), iframe, object, embed, *[tabindex]:not([tabindex='-1']), *[contenteditable=true]",p.RICH_TEXT_LINK_CLASS="text-linkDarkGreen",p.EMAIL_ADDRESS_INCLUDED_PATTERN=/[\w\*\+\-\$\?\^\{!#%&'\/=`|}~]+?(?:\.[\w\*\+\-\$\?\^\{!#%&'\/=`|}~]+?)*?@[a-z\d-]+?(?:\.[a-z\d-]{2,})+/gim,p.EMAIL_ADDRESS_PATTERN=new RegExp("^"+p.EMAIL_ADDRESS_INCLUDED_PATTERN.source+"$","i"),l.isElectron&&t&&(p.SSO_EMAIL_DOMAINS_MAPPING=t.getGlobal("constants").SSO_EMAIL_DOMAINS_MAPPING||[],p.SSO_PATTERN="[_a-z0-9-]+?@(("+p.SSO_EMAIL_DOMAINS_MAPPING.join(")|(")+"))",p.SSO_EMAIL_ADDRESS_PATTERN=new RegExp(p.SSO_PATTERN,"i")),p.CIRCUIT_CONVERSATION_HASH_PATTERN=/\#\/(conversation|open|muted)\/[0-9\-a-z]+?(\?((user=(\d)+?)|(item=([0-9\-a-z])+?(\&user=(\d)+?)?)))?$/gim,p.CIRCUIT_LINKS_HASH_PATTERN=/\#\/(profile|phone|user)\/[0-9\-a-z]+?$/gim,p.CIRCUIT_EMAIL_HASH_PATTERN=new RegExp("#/email/"+p.EMAIL_ADDRESS_INCLUDED_PATTERN.source+"$","gim"),p.PHONE_PATTERN=/^(\+\s*)?\d+(\s*\(\s*\d+\s*\)\s*\d+)?((\s*-?\s*\d+)*|(\s*\.\s*\d+)*)$/,p.GNF_PHONE_PATTERN=/^((\+)|(\+\s*\d+(\s*\(\s*\d+\s*\)\s*\d+)?((\s*-?\s*\d+)*|(\s*\.\s*\d+)*)))$/,p.PHONE_PAC=/^([#\*]+[#\*\(\)\-\s\+\d]*)$/,p.PHONE_DIAL_PATTERN=/^([#\*\(\)\\\/\-\.\s\+\d]*)$/,p.PHONE_DIAL_WITH_PIN_PATTERN=/^([#\*\(\)\\\/\-\.\s\+\d\,]*)$/,p.PHONE_WITH_EXTENSION_PATTERN=/^([#\*\(\)\\\/\-\.\s\+\d]*)(\s*(x|X|ext\.)\s*\d+)$/,p.matchPhonePattern=function(e){return e&&"string"==typeof e?e.match(p.PHONE_PATTERN):null},p.matchUrlPattern=function(e){return e&&"string"==typeof e?e.match(p.URL_PATTERN)||e.match(p.PSEUDO_URL_PATTERN):null},p.matchEmailPattern=function(e){return e&&"string"==typeof e?e.match(p.EMAIL_ADDRESS_INCLUDED_PATTERN):null},p.getEmails=function(e){var t=e&&e.split(/[;,]\s*|\s+/i);return(t=t&&t.map(function(e){var t=e.match(p.EMAIL_ADDRESS_INCLUDED_PATTERN);return t&&t[0]}).filter(function(e){return!!e}))||[]},p.matchNames=function(e,t,n){if(!e||"string"!=typeof e||!t)return!1;var i=new RegExp("^"+RegExp.escape(t),n||"i");return i.test(e)||e.split(" ").some(function(e){return i.test(e)})},p.compareStrings=function(e,t){return"string"==typeof e&&"string"==typeof t&&new RegExp("^"+RegExp.escape(e)+"$","i").test(t)},p.rstring=function(){return Math.floor(1e9*Math.random()).toString()},p.randomNumber=function(e,t){return Math.floor(Math.random()*(t-e+1))+e},p.randomBoolean=function(){return Math.random()<.5},p.generateCallId=function(){return"WRTC-"+p.rstring()+"-"+p.rstring()},p.createTransactionId=function(){for(var e=[],t="0123456789abcdef",n=0;n<36;n++)e[n]=t.substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]=t.substr(e[19]?3:8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")},p.getLegalRegion=function(e){switch(e){case"europe":return"de"===(navigator.language||navigator.browserLanguage).split("-").last().toLowerCase()?"de":"uk";case"americas":case"apac":default:return"us"}},p.getBrowserInfo=function(){if("iOS"===window.navigator.platform)return{ios:!0,type:"ios"};if("Android"===window.navigator.platform)return{android:!0,type:"android"};if("node"===window.navigator.platform)return{node:!0,type:"node"};if(Circuit.isElectron)return{chrome:!0,type:"chrome"};if("dotnet"===window.navigator.platform)return{dotnet:!0,type:"dotnet"};if(window.cordova&&"ios"===window.cordova.platformId)return{cordovaios:!0,type:"cordovaios"};var e={},t=navigator.userAgent.toLowerCase(),n=/(msie|trident)(?: |.*rv:)([\d.]+)/.exec(t)||/(opera|opr)(?:.*version|)\/([\d.]+)/.exec(t)||/(firefox)\/([\d.]+)/.exec(t)||/(edge)\/([\d.]+)/.exec(t)||/(chrome)\/([\d.]+)/.exec(t)||/version\/([\d.]+).*(safari)/.exec(t)||/(phantomjs)\/([\d.]+)/.exec(t)||[],i=n[1]||"",r=n[2]||0;return"safari"===r?(i=n[2],r=n[1]):"trident"===i?i="msie":"opr"===i?i="opera":"phantomjs"===i&&(i="phantomjs"),e[i]=!0,e.type=i,e.version=r,e};var r=[{s:"Windows 10",r:/(Windows.* 10|Windows 10.0|Windows[ _]NT.* 10.0)/},{s:"Windows 8.1",r:/(Windows.* 8.1|Windows[ _]NT.* 6.3)/},{s:"Windows 8",r:/(Windows.* 8|Windows[ _]NT.* 6.2)/},{s:"Windows 7",r:/(Windows.* 7|Windows[ _]NT.* 6.1)/},{s:"Windows Vista",r:/(Windows.* Vista|Windows[ _]NT.* 6.0)/},{s:"Windows Server 2003",r:/(Windows Server 2003|Windows[ _]NT.* 5.2)/},{s:"Windows XP",r:/(Windows[ _]NT.* 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows[ _]NT.* 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Windows 3.11|Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/Open BSD|OpenBSD/},{s:"Sun OS",r:/Sun OS|SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iOS|iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(Mac OS|MacPPC|MacIntel|Mac_PowerPC|Macintosh|Darwin)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(Search Bot|nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];function i(e){if(!e)return"";var t=document.createElement("div"),n=document.createElement("div");e=e.replace(/\$/gm,"$$$$");var i=0;return e=e.replace(/(<span.*?>)|(<\/span>)/gi,function(e,t,n){return t?t.match(/class="mention"/i)?e.replace(/.*abbr="(.*?)".*?>/gi,'<span class="mention" abbr="$1"><a href="#/profile/$1">'):(i++,t):n?i?(i--,n):"</a></span>":void 0}),e=u.convertEmojis(e),t.innerHTML=e,function e(t,n){if(!t||!t.childNodes||!t.childNodes.length)return t;var i;for(var r=0,o=t.childNodes.length;r<o;r++)switch((i=t.childNodes[r]).nodeType){case 1:if("A"===i.nodeName){var a=l.isElectron?l.__server:window.location&&window.location.origin;p.isCircuitLink(a,i.href)||(i.target="_blank",i.rel="noopener noreferrer")}e(i,n);break;case 3:for(n.innerHTML=p.linkifyText(i.textContent),r+=n.childNodes.length-1;n.childNodes.length;)t.insertBefore(n.childNodes[0],i);t.removeChild(i),o=t.childNodes.length}return t}(t,n).innerHTML.replace(/&nbsp;/gi," ")}function S(){return l.isElectron?C+l.__server:window.location&&window.location.origin}p.getOSInfo=function(t){if(!t)return{type:"",version:"",info:""};var n=t,e="",i="";if(r.some(function(e){if(e.r.test(t))return n=e.s,!0})&&/Windows/.test(n))i=/Windows (.*)/.exec(n)[1],e="Windows";else{e=n;try{switch(n){case"Mac OS X":i=/Mac OS X (10[\.\_\d]+)/.exec(t)[1];break;case"Android":i=/Android ([\.\_\d]+)/.exec(t)[1]}}catch(e){c.debug("[Utils]: osVersion does not contain version on it. ",t)}}return{type:e,version:i,info:n}},p.checkUserDomain=function(e){return l.isElectron?l.__server.split(":")[0].endsWith(e):window.location.hostname.endsWith(e)},p.parseIpWithPort=function(e){if(!e&&"string"!=typeof e)return null;if("["===e[0]){var t=/\[(.*)\]:(\d*)/.exec(e);if(t&&3===t.length)return{ipAddress:t[1],port:t[2]}}else if(0<e.indexOf(":")){var n=e.split(":");if(2===n.length)return{ipAddress:n[0],port:n[1]}}return null},p.getChannelInfo=function(e){var t=p.parseIpWithPort(e.stat("googLocalAddress"))||{},n=p.parseIpWithPort(e.stat("googRemoteAddress"))||{},i=function(e){switch(e){case"local":return"host";case"stun":return"srflx";default:return e}};return{ipl:t.ipAddress,ptl:t.port,ipr:n.ipAddress,ptr:n.port,lct:i(e.stat("googLocalCandidateType")),rct:i(e.stat("googRemoteCandidateType")),tt:e.stat("googTransportType")}},p.getIceCandidateInfo=function(i,e,t){var r,o,a={};if(!i||!e||!t)return a;var s=i.stat("candidateType");"prflx"===s?o=i.stat("ipAddress"):r=i.stat("portNumber");var c=function(e,n,i){var r;return e.a.some(function(e){if("candidate"===e.field&&e.value){var t=new l.IceCandidate(e.value);if(t.typ===i&&t["network-id"]===n["network-id"])return r=t.address,!0}}),r};return("string"==typeof e?l.sdpParser.parse(e):e).m.some(function(n){if(n.media===t)return n.a.some(function(e){var t;if("candidate"===e.field&&e.value)if(r&&0<=e.value.indexOf(r)){if(t=new l.IceCandidate(e.value),String(t.port)===r)return a.value=e.value,"host"===s?(a.hAddr=i.stat("ipAddress"),a.sAddr=c(n,t,"srflx"),a.sAddr||(a.sAddr=a.hAddr)):(a.sAddr=t.raddr,a.hAddr=c(n,t,"host"),"relayed"!==s&&"relay"!==s||(a.tt=t.getRelayClientTransportType())),!0}else if(o&&0<=e.value.indexOf("srflx")&&"srflx"===(t=new l.IceCandidate(e.value)).typ&&String(t.address)===o)return a.sAddr=o,a.hAddr=c(n,t,"host"),!0}),!0}),a},p.isEmptyObject=function(e){return 0===Object.keys(e).length},p.getBaseObject=function(t,e){if(!t||"object"!=typeof t)return null;if(t instanceof Array)return t;var n=Object.getPrototypeOf(t);return p.isEmptyObject(n)?t:(!1!==e&&Object.getOwnPropertyNames(n).forEach(function(e){"function"!=typeof n[e]&&t.hasOwnProperty(e)&&(n[e]=t[e])}),n)},p.syncBaseObject=function(t){var e=p.getBaseObject(t,!0);e&&e!==t&&Object.getOwnPropertyNames(e).forEach(function(e){t.hasOwnProperty(e)&&delete t[e]})},p.flattenObj=function(e){if(!e||"object"!=typeof e)return e;var t=Object.getPrototypeOf(e);if(p.isEmptyObject(t))return e;var n={};for(var i in e)"function"!=typeof e[i]&&(n[i]=e[i]);return n},p.getNormalizedFileExtension=function(e){var t=e&&(e.fileName||e.name);if(!t)return null;if(/audio/i.test(e.mimeType))return"audio";if(/video/i.test(e.mimeType))return"video";var n=t.split(".").pop();if(n)switch(n.toLowerCase()){case"doc":case"docx":return"doc";case"ppt":case"pptx":return"ppt";case"pdf":return"pdf";case"xls":case"xlsx":return"xls";case"gz":case"zip":return"zip";case"html":return"html";case"csv":return"csv";case"png":return"png";case"jpg":case"jpeg":return"jpg";case"log":return"log";case"flv":case"mp4":case"ogv":case"webm":return"video";case"wav":case"mp3":case"ogg":return"audio"}return"def"},p.getImageFileExtension=function(e){if(e.type)switch(e.type.toLowerCase()){case"image/png":return"png";case"image/jpeg":return"jpg";case"image/gif":return"gif";case"image/bmp":return"bmp";case"image/svg+xml":return"svg"}return null},p.getMimeTypes=function(e){if(!e)return null;var t=e.split(".").pop();if(t)switch(t.toLowerCase()){case"xlsx":return"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet";case"xltx":return"application/vnd.openxmlformats-officedocument.spreadsheetml.template";case"potx":return"application/vnd.openxmlformats-officedocument.presentationml.template";case"ppsx":return"application/vnd.openxmlformats-officedocument.presentationml.slideshow";case"pptx":return"application/vnd.openxmlformats-officedocument.presentationml.presentation";case"sldx":return"application/vnd.openxmlformats-officedocument.presentationml.slide";case"docx":return"application/vnd.openxmlformats-officedocument.wordprocessingml.document";case"dotx":return"application/vnd.openxmlformats-officedocument.wordprocessingml.template";case"xlam":return"application/vnd.ms-excel.addin.macroEnabled.12";case"xlsb":return"application/vnd.ms-excel.sheet.binary.macroEnabled.12"}return"application/octet-stream"},p.textToHtmlEscaped=function(e,t){if(!e)return"";var n=t?"&nbsp;":"<br>";return e.replace(/&/g,"&amp;").replace(/"/g,"&#34;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r\n|\r|\n/gm,n)},p.escapedHtmlToText=function(e){return e?e.replace(/&amp;/g,"&").replace(/&#34;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&nbsp;/g," ").replace(/<br\/?>/g,"\r\n"):""},p.stripParenthesis=function(e){for(var t=(e=e.trim()).match(/\(/g)||[],n=e.match(/\)/g)||[],i=0;"("===e[i];)i++;return e.slice(i,e.length-Math.abs(t.length-i-n.length))},p.linkifyText=function(e){e=e.replace(/\xA0|&#160;|\x0A|\x0D/gim," ");for(var a=String.fromCharCode(17),s=String.fromCharCode(18),c=String.fromCharCode(19),t=function(e){var t="",n="",i=S(),r=p.isCircuitLink(i,e);if(!r){var o=!0;if((r=e).startsWith(E))new RegExp(i.replace(C,"")+"\\/guest\\?token=","i").exec(e)?r=e.replace(E,C):o=!1;else/^(?:http|https|ftp):\/\//.exec(e)||(r="http://"+r);t=o?" target="+c+"_blank"+c:"",n=" rel="+c+"noopener noreferrer"+c}return a+"a href="+c+r+c+t+n+s+e+a+"/a"+s},n=e.split(p.URL_SEPARATORS_PATTERN),i=0;i<n.length;i++){var r=n[i],o=p.stripParenthesis(r),l=o;0<=l.search(/http|ftp|https|circuit/gim)&&0<=l.search(p.URL_PATTERN)?l=l.replace(p.URL_PATTERN,t):0<=l.search(/www\./gim)&&0<=l.search(p.PSEUDO_URL_PATTERN)?l=l.replace(p.PSEUDO_URL_PATTERN,t):0<=l.search(/\S@\S/gim)&&0<=l.search(p.EMAIL_ADDRESS_INCLUDED_PATTERN)&&(l=l.replace(p.EMAIL_ADDRESS_INCLUDED_PATTERN,a+"a href="+c+"mailto:$&"+c+" target="+c+"_blank"+c+" rel="+c+"noopener noreferrer"+c+s+"$&"+a+"/a"+s)),r=r.replace(o,l),n[i]=r}return e=n.join(""),p.textToHtmlEscaped(e).replace(/\x11/gi,"<").replace(/\x12/gi,">").replace(/\x13/gi,"'")},p.linkifyContent=function(e,t){if(p.isMobile())return"";switch(e=d.addEmoticonsAltAttr(e),t){case"RICH":return i(e);case"PLAIN":return p.linkifyText(e)}return e},p.invalidFileTypes=["ade","adp","app","asp","bas","bat","cer","chm","cmd","cnt","com","cpl","crt","csh","der","exe","fxp","gadget","hlp","hpj","hta","inf","ins","isp","its","js","jse","ksh","lnk","mad","maf","mag","mam","maq","mar","mas","mat","mau","mav","maw","mda","mdb","mde","mdt","mdw","mdz","msc","msh","msh1","msh1xml","msh2","msh2xml","mshxml","msi","msp","mst","ops","osd","pcd","pif","plg","prf","prg","ps1","ps1xml","ps2","ps2xml","psc1","psc2","pst","reg","scf","scr","sct","shb","shs","tmp","url","vb","vbe","vbp","vbs","vsmacros","vsw","ws","wsc","wsf","wsh","xnk"],p.hasScrollbar=function(e){if(e&&0<e.length){var t=e[0];return!!t&&t.scrollHeight>t.clientHeight}return!1},p.isDescendantOrEqual=function(e,t){if(e===t)return!0;for(var n=e;n;)if((n=n.parentElement)===t)return!0;return!1},p.isSupportedImage=function(e){return/^image\/(jpeg|gif|bmp|png)$/i.test(e)},p.isVideoSupportedByBrowser=function(e){return/^video\/(quicktime|mp4|webm)$/i.test(e)},p.shallowCopy=function(e){if(!e||"object"!=typeof e)return e;if(Array.isArray(e))return e.slice();var t=p.flattenObj(e),n={};for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);return n},p.normalizeLocaleProto=function(e){var t;return e&&5<=e.length&&(t=e.replace(/-/g,"_").toUpperCase()),t},p.normalizeLocale=function(e){var t;return e&&5<=e.length&&(t=e.substr(0,2).toLowerCase()+e.substr(2,e.length-2).replace(/_/g,"-")),t},p.getLocalTime=function(e){var t=new Date;return null==e||t.setTime(t.getTime()+60*(t.getTimezoneOffset()-e)*1e3),t.getTime()},p.delayOrTimestamp=function(e,t){return 0<e?Date.now()+e:t},p.buildAttachmentMetaData=function(e){var n=function(e){return{fileId:e.fileId,fileName:e.fileName,itemId:e.itemId,mimeType:e.mimeType,size:e.size}},i=[],r=[];return e&&e.forEach(function(e){if(e.isThirdParty){var t=n(e);r.push({type:e.provider,attachment:t,downloadLocation:e.url,previewLocation:e.url,shareLinkToken:e.shareLinkToken})}else i.push(n(e)),e.thumbnail&&i.push(n(e.thumbnail))}),{attachments:i,externalAttachments:r}},p.inherit=function(e,t){function n(){}n.prototype=t.prototype,e.prototype=new n,(e.prototype.constructor=e).parent=t.prototype},p.bytesToSize=function(e,t){if(!(e=parseInt(e,10)))return"0 Bytes";var n=Math.floor(Math.log(e)/Math.log(1024));return Number((e/Math.pow(1024,n)).toPrecision(t||3))+" "+["Bytes","KB","MB","GB","TB","PB"][n]},p.isMacOs=!(!window.navigator||!window.navigator.userAgent)&&(-1!==window.navigator.userAgent.indexOf("Mac")||-1!==window.navigator.userAgent.indexOf("Darwin")),p.isWindowsOs=!(!window.navigator||!window.navigator.platform)&&"win"===window.navigator.platform.substring(0,3).toLowerCase(),p.daysBetween=function(e,t){if(e instanceof Date&&t instanceof Date){return Math.floor(Math.abs(t.getTime()-e.getTime())/864e5)}},p.isMobile=function(){return"iOS"===window.navigator.platform||"Android"===window.navigator.platform},p.formatPIN=function(e,t,n){if(!t)return"";if(n)return(e||"")+t+"#";for(var i,r=[],o=e?3:4,a=0;a<t.length;a+=o)0<a&&(o=3),2<=(i=t.substr(a,o)).length||0===r.length?r.push(i):r[r.length-1]+=i;return e&&r.unshift(e),r.push("#"),r.join(" ")},p.CountriesArray=[{name:"res_countryName_Andorra",code:"AD"},{name:"res_countryName_United_Arab_Emirates",code:"AE"},{name:"res_countryName_Afghanistan",code:"AF"},{name:"res_countryName_Antigua_and_Barbuda",code:"AG"},{name:"res_countryName_Anguilla",code:"AI"},{name:"res_countryName_Albania",code:"AL"},{name:"res_countryName_Armenia",code:"AM"},{name:"res_countryName_Netherland_Antilles",code:"AN"},{name:"res_countryName_Angola",code:"AO"},{name:"res_countryName_Antarctic",code:"AQ"},{name:"res_countryName_Argentina",code:"AR"},{name:"res_countryName_American_Samoa",code:"AS"},{name:"res_countryName_Austria",code:"AT"},{name:"res_countryName_Australia",code:"AU"},{name:"res_countryName_Aruba",code:"AW"},{name:"res_countryName_Azerbaijan",code:"AZ"},{name:"res_countryName_Bosnia_and_Herzegovina",code:"BA"},{name:"res_countryName_Barbados",code:"BB"},{name:"res_countryName_Bangladesh",code:"BD"},{name:"res_countryName_Belgium",code:"BE"},{name:"res_countryName_Burkina_Faso",code:"BF"},{name:"res_countryName_Bulgaria",code:"BG"},{name:"res_countryName_Bahrain",code:"BH"},{name:"res_countryName_Burundi",code:"BI"},{name:"res_countryName_Benin",code:"BJ"},{name:"res_countryName_Bermuda",code:"BM"},{name:"res_countryName_Brunei_Darussalam",code:"BN"},{name:"res_countryName_Bolivia",code:"BO"},{name:"res_countryName_Brazil",code:"BR"},{name:"res_countryName_Bahamas",code:"BS"},{name:"res_countryName_Bhutan",code:"BT"},{name:"res_countryName_Botswana",code:"BW"},{name:"res_countryName_Belarus",code:"BY"},{name:"res_countryName_Belize",code:"BZ"},{name:"res_countryName_Canada",code:"CA"},{name:"res_countryName_Dem_Republic_Congo",code:"CD"},{name:"res_countryName_Central_African_Republik",code:"CF"},{name:"res_countryName_Congo",code:"CG"},{name:"res_countryName_Switzerland",code:"CH"},{name:"res_countryName_Cote_d_Ivoire",code:"CI"},{name:"res_countryName_Chile",code:"CL"},{name:"res_countryName_Cameroon",code:"CM"},{name:"res_countryName_China_Peoples_Republic",code:"CN"},{name:"res_countryName_Colombia",code:"CO"},{name:"res_countryName_Costa_Rica",code:"CR"},{name:"res_countryName_Cuba",code:"CU"},{name:"res_countryName_Cap_Verde",code:"CV"},{name:"res_countryName_Cyprus",code:"CY"},{name:"res_countryName_Czech_Republik",code:"CZ"},{name:"res_countryName_Germany",code:"DE"},{name:"res_countryName_Djibouti",code:"DJ"},{name:"res_countryName_Denmark",code:"DK"},{name:"res_countryName_Dominica",code:"DM"},{name:"res_countryName_Dominican_Republik",code:"DO"},{name:"res_countryName_Algeria",code:"DZ"},{name:"res_countryName_Ecuador",code:"EC"},{name:"res_countryName_Estonia",code:"EE"},{name:"res_countryName_Egypt",code:"EG"},{name:"res_countryName_Westsahara",code:"EH"},{name:"res_countryName_Eritrea",code:"ER"},{name:"res_countryName_Spain",code:"ES"},{name:"res_countryName_Ethiopia",code:"ET"},{name:"res_countryName_Finland",code:"FI"},{name:"res_countryName_Fiji",code:"FJ"},{name:"res_countryName_Falkland_Islands",code:"FK"},{name:"res_countryName_Micronesia_Fed_States",code:"FM"},{name:"res_countryName_Faroer",code:"FO"},{name:"res_countryName_France",code:"FR"},{name:"res_countryName_Gaboon",code:"GA"},{name:"res_countryName_United_Kingdom",code:"GB"},{name:"res_countryName_United_Kingdom",code:"UK"},{name:"res_countryName_Grenada",code:"GD"},{name:"res_countryName_Georgia",code:"GE"},{name:"res_countryName_French_Guayana",code:"GF"},{name:"res_countryName_Ghana",code:"GH"},{name:"res_countryName_Gibraltar",code:"GI"},{name:"res_countryName_Greenland",code:"GL"},{name:"res_countryName_Gambia",code:"GM"},{name:"res_countryName_Guinea",code:"GN"},{name:"res_countryName_Guadeloupe",code:"GP"},{name:"res_countryName_Equatorial_Guinea",code:"GQ"},{name:"res_countryName_Greece",code:"GR"},{name:"res_countryName_South_Georgia_South_Sandwichisland",code:"GS"},{name:"res_countryName_Guatemala",code:"GT"},{name:"res_countryName_Guam",code:"GU"},{name:"res_countryName_Guinea_Bissau",code:"GW"},{name:"res_countryName_Guyana",code:"GY"},{name:"res_countryName_Hong_Kong",code:"HK"},{name:"res_countryName_Honduras",code:"HN"},{name:"res_countryName_Croatia",code:"HR"},{name:"res_countryName_Haiti",code:"HT"},{name:"res_countryName_Hungary",code:"HU"},{name:"res_countryName_Canary_Island",code:"IC"},{name:"res_countryName_Indonesia",code:"ID"},{name:"res_countryName_Ireland",code:"IE"},{name:"res_countryName_Israel",code:"IL"},{name:"res_countryName_India",code:"IN"},{name:"res_countryName_British_Indian_Ocean_Territory",code:"IO"},{name:"res_countryName_Iraq",code:"IQ"},{name:"res_countryName_Iran_Islamic_Republic",code:"IR"},{name:"res_countryName_Iceland",code:"IS"},{name:"res_countryName_Italy",code:"IT"},{name:"res_countryName_Jamaica",code:"JM"},{name:"res_countryName_Jordan",code:"JO"},{name:"res_countryName_Japan",code:"JP"},{name:"res_countryName_Kenya",code:"KE"},{name:"res_countryName_Kyrgyzstan",code:"KG"},{name:"res_countryName_Cambodia",code:"KH"},{name:"res_countryName_Kiribati",code:"KI"},{name:"res_countryName_Comoros",code:"KM"},{name:"res_countryName_St_Kitts_and_Nevis",code:"KN"},{name:"res_countryName_Korea_Dem_Peoples_Rep_North_Korea",code:"KP"},{name:"res_countryName_Korea_South",code:"KR"},{name:"res_countryName_Kuwait",code:"KW"},{name:"res_countryName_Cayman_Islands",code:"KY"},{name:"res_countryName_Kazakhstan",code:"KZ"},{name:"res_countryName_Laos_Democratic_Peoples_Republic",code:"LA"},{name:"res_countryName_Lebanon",code:"LB"},{name:"res_countryName_Saint_Lucia",code:"LC"},{name:"res_countryName_Liechtenstein",code:"LI"},{name:"res_countryName_Sri_Lanka",code:"LK"},{name:"res_countryName_Liberia",code:"LR"},{name:"res_countryName_Lesotho",code:"LS"},{name:"res_countryName_Lithuania",code:"LT"},{name:"res_countryName_Luxembourg",code:"LU"},{name:"res_countryName_Latvia",code:"LV"},{name:"res_countryName_Libya_Libyan_Arabian_Dschamahirija",code:"LY"},{name:"res_countryName_Morocco",code:"MA"},{name:"res_countryName_Monaco",code:"MC"},{name:"res_countryName_Moldova_Republic",code:"MD"},{name:"res_countryName_Montenegro",code:"ME"},{name:"res_countryName_Madagascar",code:"MG"},{name:"res_countryName_Marshall_Islands",code:"MH"},{name:"res_countryName_Mazedonia_former_Rep_of_Yugoslavia",code:"MK"},{name:"res_countryName_Mali",code:"ML"},{name:"res_countryName_Myanmar_Burma",code:"MM"},{name:"res_countryName_Mongolia",code:"MN"},{name:"res_countryName_Macau",code:"MO"},{name:"res_countryName_Northern_Marians",code:"MP"},{name:"res_countryName_Martinique",code:"MQ"},{name:"res_countryName_Mauretania",code:"MR"},{name:"res_countryName_Montserrat",code:"MS"},{name:"res_countryName_Malta",code:"MT"},{name:"res_countryName_Mauritius",code:"MU"},{name:"res_countryName_Maledives",code:"MV"},{name:"res_countryName_Malawi",code:"MW"},{name:"res_countryName_Mexico",code:"MX"},{name:"res_countryName_Malaysia",code:"MY"},{name:"res_countryName_Mozambique",code:"MZ"},{name:"res_countryName_Namibia",code:"NA"},{name:"res_countryName_New_Caledonia",code:"NC"},{name:"res_countryName_Niger",code:"NE"},{name:"res_countryName_Norfolk_Islands",code:"NF"},{name:"res_countryName_Nigeria",code:"NG"},{name:"res_countryName_Nicaragua",code:"NI"},{name:"res_countryName_Netherlands",code:"NL"},{name:"res_countryName_Norway",code:"NO"},{name:"res_countryName_Nepal",code:"NP"},{name:"res_countryName_Nauru",code:"NR"},{name:"res_countryName_New_Zealand",code:"NZ"},{name:"res_countryName_Oman",code:"OM"},{name:"res_countryName_Panama",code:"PA"},{name:"res_countryName_Peru",code:"PE"},{name:"res_countryName_French_Polynesia",code:"PF"},{name:"res_countryName_Papua_New_Guinea",code:"PG"},{name:"res_countryName_Philippines",code:"PH"},{name:"res_countryName_Pakistan",code:"PK"},{name:"res_countryName_Poland",code:"PL"},{name:"res_countryName_Saint_Pierre_and_Miquelon",code:"PM"},{name:"res_countryName_Pitcairn_Island",code:"PN"},{name:"res_countryName_Puerto_Rico",code:"PR"},{name:"res_countryName_Palestine_regions_occupied",code:"PS"},{name:"res_countryName_Portugal",code:"PT"},{name:"res_countryName_Palau",code:"PW"},{name:"res_countryName_Paraguay",code:"PY"},{name:"res_countryName_Quatar",code:"QA"},{name:"res_countryName_Reunion",code:"RE"},{name:"res_countryName_Romania",code:"RO"},{name:"res_countryName_Russian_Federation",code:"RU"},{name:"res_countryName_Rwanda",code:"RW"},{name:"res_countryName_Saudi_Arabia",code:"SA"},{name:"res_countryName_Solomonen",code:"SB"},{name:"res_countryName_Seychelles",code:"SC"},{name:"res_countryName_Sudan",code:"SD"},{name:"res_countryName_Sweden",code:"SE"},{name:"res_countryName_Singapore",code:"SG"},{name:"res_countryName_Saint_Helena",code:"SH"},{name:"res_countryName_Slovenia",code:"SI"},{name:"res_countryName_Spitzbergen",code:"SJ"},{name:"res_countryName_Slovakia",code:"SK"},{name:"res_countryName_Sierra_Leone",code:"SL"},{name:"res_countryName_San_Marino",code:"SM"},{name:"res_countryName_Senegal",code:"SN"},{name:"res_countryName_Somalia",code:"SO"},{name:"res_countryName_Suriname",code:"SR"},{name:"res_countryName_South_Sudan_Republic_of",code:"SS"},{name:"res_countryName_Sao_Tome_and_Principe",code:"ST"},{name:"res_countryName_El_Salvador",code:"SV"},{name:"res_countryName_Syria_Arabian_Republic",code:"SY"},{name:"res_countryName_Swaziland",code:"SZ"},{name:"res_countryName_Turks_and_Caicos_Islands",code:"TC"},{name:"res_countryName_Chad",code:"TD"},{name:"res_countryName_Togo",code:"TG"},{name:"res_countryName_Thailand",code:"TH"},{name:"res_countryName_Tajikstan",code:"TJ"},{name:"res_countryName_Tokelau",code:"TK"},{name:"res_countryName_Timor_Leste",code:"TL"},{name:"res_countryName_Turkmenistan",code:"TM"},{name:"res_countryName_Tunisia",code:"TN"},{name:"res_countryName_Tonga",code:"TO"},{name:"res_countryName_Turkey",code:"TR"},{name:"res_countryName_Trinidad_and_Tobago",code:"TT"},{name:"res_countryName_Tuvalu",code:"TV"},{name:"res_countryName_Taiwan",code:"TW"},{name:"res_countryName_Tanzania_United_Republic",code:"TZ"},{name:"res_countryName_Ukraine",code:"UA"},{name:"res_countryName_Uganda",code:"UG"},{name:"res_countryName_Minor_American_Oversea_Islands",code:"UM"},{name:"res_countryName_United_States_of_America",code:"US"},{name:"res_countryName_Uruguay",code:"UY"},{name:"res_countryName_Uzbekistan",code:"UZ"},{name:"res_countryName_Vatican_City",code:"VA"},{name:"res_countryName_Saint_Vincent_and_Grenadines",code:"VC"},{name:"res_countryName_Venezuela",code:"VE"},{name:"res_countryName_British_Virgin_Islands",code:"VG"},{name:"res_countryName_American_Virgin_Islands",code:"VI"},{name:"res_countryName_Vietnam",code:"VN"},{name:"res_countryName_Vanuatu",code:"VU"},{name:"res_countryName_Wallis_and_Futuna",code:"WF"},{name:"res_countryName_Samoa",code:"WS"},{name:"res_countryName_Kosovo",code:"XK"},{name:"res_countryName_Serbia",code:"XS"},{name:"res_countryName_Yemen",code:"YE"},{name:"res_countryName_Mayotte",code:"YT"},{name:"res_countryName_South_Africa",code:"ZA"},{name:"res_countryName_Zambia",code:"ZM"},{name:"res_countryName_Zimbabwe",code:"ZW"}],p.CountryCodeToCountryNameResourceMap={},p.CountriesArray.forEach(function(e){p.CountryCodeToCountryNameResourceMap[e.code]=e.name}),p.isCircuitLink=function(e,t){if(e&&t){if(l.isElectron&&0===t.search(/^file:\/\/\S+?\.html#\/\S+?$/i))return!0;if(t.startsWith("#/"))return!0;var n=/^(?:http|https|ftp):\/\//;if(n.exec(e)||(e=C+e),e.endsWith("/")||(e+="/"),n.exec(t)||(t=t.startsWith(E)?t.replace(E,C):C+t),!t.startsWith(e)){var i=C+"partner.",r=e.startsWith(i)?e.replace(i,C):e.replace(C,i);t.startsWith(r)&&(t=t.replace(r,e))}if(t.length>e.length&&t.startsWith(e)){var o=t.slice(e.length),a=o.match(p.CIRCUIT_CONVERSATION_HASH_PATTERN);return a?a[0].replace(/\/(muted|open)/gim,"/conversation"):(a=o.match(p.CIRCUIT_LINKS_HASH_PATTERN)||o.match(p.CIRCUIT_EMAIL_HASH_PATTERN))&&a[0]}return!1}},p.throttle=function(n,i,r){var o,a,s,c=null,l=0;r=r||{};var d=function(){l=!1===r.leading?0:Date.now(),c=null,s=n.apply(o,a),o=a=null};return function(){var e=Date.now();l||!1!==r.leading||(l=e);var t=i-(e-l);return o=this,a=arguments,t<=0?(c&&(window.clearTimeout(c),c=null),l=e,s=n.apply(o,a),o=a=null):c||!1===r.trailing||(c=window.setTimeout(d,t)),s}},p.hasEmptyPrototype=function(e){return!(!e||"object"!=typeof e)&&p.isEmptyObject(Object.getPrototypeOf(e))},p.compareElements=function(e,t){if(e===t)return!0;if(!e||!t)return!1;if("object"!=typeof e||"object"!=typeof t)return!1;if(e instanceof Array&&t instanceof Array)return function(e,t){var n=e.length,i=[];if(e===t)return!0;if(e.length!==t.length)return!1;for(var r=0;r<n;++r)for(var o=0;o<n;++o)if(-1===i.indexOf(t[o])&&p.compareElements(e[r],t[o])){i.push(t[o]);break}return i.length===n}(e,t);if(!p.hasEmptyPrototype(e)||!p.hasEmptyPrototype(t))return!1;for(var n in e)if(e.hasOwnProperty(n)&&0!==n.indexOf("$$")&&!p.compareElements(e[n],t[n]))return!1;return!0},p.copyToClipboard=function(e,t,n){var i,r,o,a,s;if(e)try{r=document.createRange(),i=window.getSelection(),a=document.body.style.overflow,s=this.getBrowserInfo().msie,o=document.createElement("div"),n||(e=e.replace(/\r\n/gi,"<br>")),o.style.backgroundColor="#fff",o.style.font="normal normal 15px Calibri, sans-serif",o.style["white-space"]="pre-wrap",n?o.innerText=e:o.innerHTML=e,document.body.appendChild(o),r.selectNode(o),i.removeAllRanges(),i.addRange(r),s&&(document.body.style.overflow="hidden"),document.execCommand("copy")?t&&t():t&&t("Failed to copy")}catch(e){c.error("[Utils]: Copy to clipboard failed"),t&&t("Internal error")}finally{i&&("function"==typeof i.removeRange?i.removeRange(r):i.removeAllRanges()),s&&(document.body.style.overflow=a),o&&document.body.removeChild(o)}},p.sslProxify=function(e){return e&&e.startsWith("http:")?"https://embed-proxy.circuitsandbox.net/?target="+encodeURIComponent(e):e},p.appIsFocused=function(){if(l.isElectron){var e=t.getCurrentWindow();return e.isFocused()&&e.isVisible()&&!e.isMinimized()}return!0!==document.hidden},p.validatePreviewProtocol=function(e){return e?e.match(/https:/)?e:e.replace('src="//','src="https://'):""},p.TabSelector=function(e){if(Array.isArray(e)&&0!==e.length){var n=this,i={},r="";e.forEach(function(t,e){0===e?(i[t]=!0,r=t):i[t]=!1,Object.defineProperty(n,t,{get:function(){return i[t]},set:function(e){e&&(Object.keys(i).forEach(function(e){i[e]=!1}),i[t]=!0,r=t)},enumerable:!0,configurable:!1})}),Object.defineProperty(this,"selected",{get:function(){return r},enumerable:!0,configurable:!1}),Object.defineProperty(this,"selectedIdx",{get:function(){return e.indexOf(r)},enumerable:!0,configurable:!1})}},p.getOrigin=S,p.parseQS=function(e){var t={};e=e.substring(1);for(var n=/([^&=]+)=([^&]*)/g,i=n.exec(e);i;)t[decodeURIComponent(i[1])]=decodeURIComponent(i[2]),i=n.exec(e);return t},p.toQS=function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&void 0!==e[n]&&t.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t.join("&")},p.extractConfigurableText=function(e,t,n){var i=e&&e.find(function(e){return e.type===t});if(i&&i.texts){var r,o=function(t){return i.texts.find(function(e){return e.language===t})};return n&&((r=o(n))||(r=o(n=n.split("-",1)[0]))),r||(r=o("default")),r&&r.translation}},p.selectMediaDevice=function(e,t,n){var i;if(e&&t)return t.some(function(t){return!!(i=void 0===t.id?t:e.find(function(e){return t.id===e.id}))}),!i&&n&&t.some(function(t){return!!(i=e.find(function(e){return t.label===e.label}))}),i},p.removeArrayElement=function(e,t){if(Array.isArray(e)&&void 0!==t&&t){var n=e.indexOf(t);-1<n&&e.splice(n,1)}},"function"!=typeof Object.values&&(Object.values=function(t){return Object.keys(t).map(function(e){return t[e]})}),"function"!=typeof Object.assign&&(Object.assign=function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var i=arguments[n];if(i)for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t}),String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{value:function(e,t){return null!=e&&(e=e.toString(),t=Math.floor(t)||0,this.substr(t,e.length)===e)}}),String.prototype.endsWith||Object.defineProperty(String.prototype,"endsWith",{value:function(e,t){return null!=e&&(t=void 0===t?this.length:Math.min(Math.floor(t)||0,this.length),!((t-=(e=e.toString()).length)<0)&&this.substr(t,e.length)===e)}}),String.prototype.includes||Object.defineProperty(String.prototype,"includes",{value:function(e){return-1!==this.indexOf(e)}}),Object.defineProperty(String.prototype,"format",{value:function(){var n=arguments;return this.replace(/{(\d+)}/g,function(e,t){return n[t]||e})}}),Object.defineProperty(String.prototype,"replaceAt",{value:function(e,t){return this.substr(0,e)+t+this.substr(e+t.length)}}),Object.defineProperty(String.prototype,"randomCharacter",{value:function(){return this[Math.floor(this.length*Math.random())]}}),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(e){return-1!==this.indexOf(e)}}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(null==this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,n=Object(this),i=n.length>>>0,r=arguments[1],o=0;o<i;o++)if(t=n[o],e.call(r,t,o,n))return t}}),Array.prototype.findIndex||Object.defineProperty(Array.prototype,"findIndex",{value:function(e){if(null==this)throw new TypeError("Array.prototype.findIndex called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t,n=Object(this),i=n.length>>>0,r=arguments[1],o=0;o<i;o++)if(t=n[o],e.call(r,t,o,n))return o;return-1}}),Object.defineProperty(Array.prototype,"isEmpty",{value:function(){return 0===this.length}}),Object.defineProperty(Array.prototype,"last",{value:function(){if(0<this.length)return this[this.length-1]}}),Object.defineProperty(Array.prototype,"shuffle",{value:function(){for(var e=this.length,t=0;t<e;t++){var n=Math.floor(Math.random()*e),i=this[n];this[n]=this[t],this[t]=i}return this}}),Object.defineProperty(Array.prototype,"randomCopy",{value:function(e){var t=this.slice(0);return t.shuffle(),t.splice(0,e)}}),Object.defineProperty(Array.prototype,"move",{value:function(e,t){if(void 0!==e&&void 0!==t){if(t>=this.length)for(var n=t-this.length;1+n--;)this.push(void 0);this.splice(t,0,this.splice(e,1)[0])}}}),Object.defineProperty(Array.prototype,"binaryInsert",{value:function(e,t){if("function"!=typeof t)return!1;for(var n,i,r=0,o=this.length-1,a=!1;r<=o;)if(t(i=this[n=Math.floor((r+o)/2)],e)<0)r=n+1;else{if(!(0<t(i,e))){a=!0;break}o=n-1}var s=a?n+1:r;return 0<=s&&(this.splice(s,0,e),!0)}}),Array.prototype.empty||Object.defineProperty(Array.prototype,"empty",{value:function(){for(;0<this.length;)this.pop()}}),Array.prototype.diff||Object.defineProperty(Array.prototype,"diff",{value:function(t){return this.filter(function(e){return!t.includes(e)})}}),Number.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},RegExp.escape=function(e){return e?e.replace(/[.*+?|()\[\]{}\\$^]/g,"\\$&"):""},Date.prototype.moveToEndOfDay=function(){return this.set({hour:23,minute:59,second:59})},Date.prototype.moveToFirstDayOfYear=function(){return this.set({day:1,month:0})},Date.prototype.moveToLastDayOfYear=function(){return this.set({month:11}).moveToLastDayOfMonth()};var e={format:function(e){if("undefined"!=typeof PhoneNumberUtil&&e&&"+"===e.charAt(0))try{var t=PhoneNumberUtil.parseAndKeepRawInput(e,null);e=PhoneNumberUtil.formatInternational(t)}catch(e){}return e}};return l.Utils=p,l.PhoneNumberFormatter=e,l}((Circuit=function(e){"use strict";var t={SIGNATURE:"ansibleChromeExtensionSignature"};return t.DOMEvent=Object.freeze({TO_EXTENSION:"toExtension",FROM_EXTENSION:"fromExtension"}),t.BgMsgType=Object.freeze({REQUEST:"request",RESPONSE:"response",EVENT:"event"}),t.BgTarget=Object.freeze({INTERNAL:"internal",LOG:"log",SCREEN_SHARE:"screenShare",EXCHANGE_CONNECTOR:"exchange_connector",HEADSET_APP:"headsetAppManager",PRIVACY_SETTINGS:"privacySettings"}),t.ResponseError=Object.freeze({UNREGISTERED:"unregistered",TIMEOUT:"timeout",UNSUPPORTED_REQUEST:"unsupportedRequest",INTERNAL_ERROR:"internalError"}),t.BgLogMsgType=Object.freeze({LOG:"log"}),t.BgInternalMsgType=Object.freeze({INIT_MSG:"initMsg",INIT_MSG_ACK:"initMsgAck",INJECT_SIGNATURE:"injectChromeAppSignature",IS_ALIVE:"isAlive",GET_WINDOW_SIZE:"getWindowSize",EXTENSION_DISCONNECTED:"extensionDisconnected",BRING_TO_FRONT:"bringToFront",GET_FILE:"getFile"}),t.BgScreenShareMsgType=Object.freeze({CHOOSE_DESKTOP_MEDIA:"cdm",CHOOSE_DESKTOP_MEDIA_DONE:"cdmDone",CHOOSE_DESKTOP_MEDIA_CANCELLED:"cdmCancelled"}),t.BgPrivacySettingsMsgType=Object.freeze({SET_IP_HANDLING_POLICY:"setWebRTCIPHandlingPolicy",GET_IP_HANDLING_POLICY:"getWebRTCIPHandlingPolicy",IP_HANDLING_POLICY_CHANGED:"webRTCIPHandlingPolicyChanged"}),t.BgPrivacySettingsError=Object.freeze({NOT_AUTHORIZED:"notAuthorized",NOT_CONTROLLABLE:"notControllable",CONTROLLED_BY_OTHER_EXTENSIONS:"controlledByOtherExtensions"}),t.BgExchangeMsgType=Object.freeze({CONNECT:"connect",DISCONNECT:"disconnect",SEARCH_CONTACTS:"searchContacts",AUTODISCOVER_GET_SERVER:"autodiscoverGetServer",GET_CONNECTION_STATUS:"getConnectionStatus",GET_CAPABILITIES:"getCapabilities",GET_CONTACT:"getContact",STORE_EXCH_CREDENTIALS:"storeCredentials",CONNECTION_STATUS:"connectionStatus",GET_ALL_PERSONAL_CONTACTS:"getAllPersonalContacts",CONTACT_FOLDERS_SYNC_STATE:"contactFoldersSyncState",SYNC_ALL_PERSONAL_CONTACTS:"syncAllPersonalContacts",GET_APPOINTMENTS:"getAppointments",GET_STORED_CREDENTIALS:"getStoredCredentials",GET_RENEWED_TOKEN:"getRenewedToken",ON_RENEWED_TOKEN:"onRenewedToken",GET_OOO_MSG:"getOooMsg"}),t.BgHeadsetAppMsgType=Object.freeze({GET_HEADSET_APP_STATUS:"getHeadsetAppStatus",LAUNCH_HEADSET_APP:"launchHeadsetApp",HEADSET_APP_LAUNCHED:"headsetAppLaunched",HEADSET_APP_UNINSTALLED:"headsetAppUninstalled",RESTART_HEADSET_APP:"restartHeadsetApp"}),t.ExchangeConnResponse=Object.freeze({OK:"ok",NO_RESULT:"noResult",FAILED:"failed",COULD_NOT_CONNECT:"couldNotConnect",UNAUTHORIZED:"unauthorized",UNSUPPORTED_METHOD:"unsupportedMethod",TIMED_OUT:"timedOut",MAILBOX_NOT_FOUND:"mailboxNotFound",NTLM_NOT_SUPPORTED:"ntlmNotSupported"}),t.HeadsetAppStatus=Object.freeze({NO_MANAGEMENT_PERMISSION:"noManagementPermission",NOT_INSTALLED:"notInstalled",INSTALLED:"installed",DISABLED:"disabled",UNKNOWN:"unknown"}),t.Exchange=Object.freeze({CONFIGURED_PASSWORD_MASKED:"$$$$"}),t.PortMsg=Object.freeze({CONNECT:"connect",DISCONNECT:"disconnect",MSG:"msg"}),e.ChromeExtension=t,"undefined"!=typeof module&&module.exports&&(module.exports=t),e}((Circuit=function(e){"use strict";var n=null;try{n=window.localStorage||n}catch(e){n=window.sessionStorage||n}function i(e,t){try{return n?n[e].apply(n,t):null}catch(e){return null}}var t={getItem:function(e){return i("getItem",[e])},setItem:function(e,t){return i("setItem",[e,t])},removeItem:function(e){return i("removeItem",[e])}};return e.storeManager=t,e}((Circuit=function(e){"use strict";return e.Error=function(e,t){this.code=e||"UNEXPECTED_ERROR","string"==typeof t?this.message=t:"object"==typeof t&&(this.errObj=t).info&&!t.message&&(t.message=t.info),this.stack=Error().stack},e.Error.prototype=Object.create(Error.prototype),e.Error.prototype.name="Error",e}((Circuit=function(e){"use strict";var n=Object.freeze({Debug:1,Info:2,Warning:3,Error:4,Off:5}),i=n.Warning,t="undefined"!=typeof _circuitLogger?_circuitLogger:{setLevel:function(e){i=e},getLevel:function(){return i},debug:function(){i<=n.Debug&&console.log.apply(console,Array.prototype.slice.apply(arguments))},info:function(){i<=n.Info&&console.info.apply(console,Array.prototype.slice.apply(arguments))},warning:function(){i<=n.Warning&&console.warn.apply(console,Array.prototype.slice.apply(arguments))},warn:function(){i<=n.Warning&&console.warn.apply(console,Array.prototype.slice.apply(arguments))},error:function(e,t){i<=n.Error&&(e=e&&e.stack||e,(t=t&&t.stack||t)?console.error(e,t):console.error(e))},msgSend:function(){i<=n.Debug&&console.log.apply(console,Array.prototype.slice.apply(arguments))},msgRcvd:function(){i<=n.Debug&&console.log.apply(console,Array.prototype.slice.apply(arguments))},logMsg:function(e,t,n){switch(e.name){case"DEBUG":this.debug(t,n);break;case"INFO":this.info(t,n);break;case"WARN":case"WARNING":case"ERROR":this.info(t,n);break;default:this.debug(t,n)}},setExtensionVersion:function(e){console.log("ExtensionVersion = "+e)}};return e.logger=t,e.Enums=e.Enums||{},e.Enums.LogLevel=n,e}((Circuit=function(e){"use strict";e.isSDK=!0;var t={name:"unknown"};return"undefined"!=typeof process?process.versions&&process.versions.node?t={name:"node",version:process.versions.node,hostname:require("os").hostname()}:process.argv&&process.argv[0]&&(t={name:process.argv[0]}):t={name:"browser"},window.setTimeout=window.setTimeout||setTimeout,window.clearTimeout=window.clearTimeout||clearTimeout,window.setInterval=window.setInterval||setInterval,window.clearInterval=window.clearInterval||clearInterval,window.location||(window.location={host:t.hostname}),navigator.platform||(navigator.platform=t.name),navigator.userAgent||(navigator.userAgent="Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/64.0.3282.140 Safari/537.36"),window.navigator||(window.navigator=navigator),window.btoa||(window.btoa=function(e){return new Buffer(e).toString("base64")}),e._runtime=t,e.DefaultAvatars={},e}(Circuit||{}))||{}))||{}))||{}))||{}))||{}))||{})))||{}))))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{})))||{}))||{}))||{}))||{}))))))))))||{}))))))))))))||{}));
return Circuit;

}));
